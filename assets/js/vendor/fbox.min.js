var Ur=Object.defineProperty;var _t=(e,t)=>{for(var r in t)Ur(e,r,{get:t[r],enumerable:!0})};var xe,Kr=new Uint8Array(16);function Fe(){if(!xe&&(xe=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!xe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xe(Kr)}var xt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function qr(e){return typeof e=="string"&&xt.test(e)}var bt=qr;var $=[];for(var He=0;He<256;++He)$.push((He+256).toString(16).substr(1));function Gr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=($[e[t+0]]+$[e[t+1]]+$[e[t+2]]+$[e[t+3]]+"-"+$[e[t+4]]+$[e[t+5]]+"-"+$[e[t+6]]+$[e[t+7]]+"-"+$[e[t+8]]+$[e[t+9]]+"-"+$[e[t+10]]+$[e[t+11]]+$[e[t+12]]+$[e[t+13]]+$[e[t+14]]+$[e[t+15]]).toLowerCase();if(!bt(r))throw TypeError("Stringified UUID is invalid");return r}var Nt=Gr;function Wr(e,t,r){e=e||{};var l=e.random||(e.rng||Fe)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=l[a];return t}return Nt(l)}var Ye=Wr;var x="record",S="list",E="tuple",I="string",P="number",be="integer",j="boolean",B="null",N="union",J="any",R="ref",M="value",Et=[x,E,S,N],A="fmodel",K=()=>({type:J}),wt=()=>({type:I}),gt=()=>({type:j}),$t=()=>({type:P}),vt=()=>({type:B}),Ve=()=>({type:x,fields:{},order:[]}),kt=()=>({type:S,sch:O(K)}),St=()=>({type:E,schs:[O(K)]}),Ot=()=>({type:N,schs:[O(K)]}),At=e=>({type:R,$ref:e}),Je=e=>{try{return e=JSON.parse(e),e==null||[I,P,j].includes(typeof e)?{type:M,const:e}:!1}catch(t){return!1}},O=(e,t,r={force:!1})=>{let l=e();return l.$anchor||(l.$anchor=Ye()),r.force&&(l.$anchor=Ye()),t&&(l._tag=t),l};var Ne=e=>{let t=JSON.parse(JSON.stringify(e));return C(t,(r,l)=>O(()=>r,null,{force:!0})),t},w=e=>C(JSON.parse(JSON.stringify(e)),(t,r)=>{let{type:l,$anchor:a,key:n,_tag:o}=t,d={type:l,$anchor:a,key:n,_tag:o};switch(t.type){case x:let{fields:s,order:c}=t;return Object.assign(d,{fields:s,order:c});case E:case N:let{schs:p}=t;return Object.assign(d,{schs:p});case S:let{sch:u}=t;return Object.assign(d,{sch:u});case M:let{const:_}=t;return Object.assign(d,{const:_});case R:let{$ref:y}=t;return Object.assign(d,{$ref:y});default:return Object.assign(d,{})}}),C=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,e=t(e,r),e._halt)return e;let l=({_tag:a,type:n,$anchor:o,key:d},{path:s,parent:{prune:c}})=>({_tag:a,type:n,$anchor:o,key:d,path:s,prune:c});switch(!0){case[x].includes(e.type):let a=Object.keys(e.fields);for(let d=e.order.length-1;d>=0;d--){let s=e.order[d],c=e.fields[s],p={path:`${r.path}[${s}]`,level:r.level+1,index:d,parent:l(e,r)};if(c=C(c,t,p),c.key=s,e.fields[s]=c,c._halt)return Object.assign(e,{_halt:!0})}break;case[E,N].includes(e.type):for(let d=0;d<e.schs.length;d++){let s=e.schs[d],c={path:`${r.path}[][${d}]`,level:r.level+1,index:d,parent:l(e,r)};if(s=C(s,t,c),e.schs[d]=s,s._halt)return Object.assign(e,{_halt:!0})}break;case[S].includes(e.type):let n={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:l(e,r)},o=C(e.sch,t,n);if(e.sch=o,o._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Br=(e,t,r)=>{let l={original:{},popped:[]},a=r.sort((n,o)=>o-n);return C(e,(n,o)=>{if(o.path!=t)return n;switch(n.type){case x:let d=a.map(s=>[s,n.order[s]]).filter(([s,c])=>c);for(let[s,c]of d)l.popped.unshift({k:c,sch:n.fields[c],index:s}),delete n.fields[c];for(let s of a)n.order.splice(s,1);break;case S:break;case E:for(let s of a)l.popped.unshift({k:s,sch:n.schs.splice(s,1)[0],index:s});n.schs.length==0&&n.schs.splice(0,0,O(K));break;case N:for(let s of a)l.popped.unshift({k:s,sch:n.schs.splice(s,1)[0],index:s});n.schs.length==0&&n.schs.splice(0,0,O(K));break;default:}return n}),l},Fr=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),Ee=(e,t,r)=>{let l={original:{},inserted:[]},a=r.sort((o,d)=>o.index-d.index),n=(o,d)=>(o=Math.max(o,0),o=Math.min(o,d.length),o);return C(e,(o,d)=>{var s,c,p,u,_,y;if(d.path!=t)return o;switch(o.type){case x:for(let{k:m,sch:b,index:f}of a){for(m=m==0?"0":m,m=m||`${b()._tag||"key"}_${Math.floor(Date.now()/100)}`,m=`${m}`;o.fields[m];)m=`${m} \u2013`;f=n(f,o.order),o.fields[m]=O(b,(c=(s=e.put)==null?void 0:s.tag)==null?void 0:c[o.tag]),o.order.splice(f,0,m),l.inserted.push({k:m,sch:o.fields[m],index:f})}break;case S:break;case E:for(let{k:m,sch:b,index:f}of a)f=n(f,o.schs),o.schs.splice(f,0,O(b,(u=(p=e.put)==null?void 0:p.tag)==null?void 0:u[o.tag])),l.inserted.push({k:m,sch:o.schs[f],index:f});break;case N:for(let{k:m,sch:b,index:f}of a)f=n(f,o.schs),o.schs.splice(f,0,O(b,(y=(_=e.put)==null?void 0:_.tag)==null?void 0:y[o.tag])),l.inserted.push({k:m,sch:o.schs[f],index:f});default:}return o}),l},ge=(e,{dstPath:t,startIndex:r=0},l)=>{let a=(s,c,p)=>F(s,c,(u,_)=>(u._pinId=p,u)),n=Symbol(t);a(e,t,n);let o=we(e,l,{dstPath:t});return ze(e,{dstPin:n,startIndex:r},o)},we=(e,t,r={})=>{let l={},a=Fr(Object.keys(t));for(let n of a){let o=t[n],d=p=>{var u;return(u=o.find(_=>_.index==p))==null?void 0:u.newK};if(r.dstPath&&o.filter(u=>r.dstPath.startsWith(u.id)).length!=0)continue;let c=Br(e,n,o.map(p=>p.index)).popped.map(({k:p,sch:u,index:_})=>({k:d(_)||p,sch:()=>u}));l[n]=c}return l},ze=(e,{dstPin:t,dstPath:r,startIndex:l=0},a)=>{let n=(c,p)=>z(c,(u,_)=>u._pinId==p,(u,_)=>(u._pinned=_,u));l=Math.max(l,0);let o={},d=Object.values(a).flatMap(c=>c).map((c,p)=>({...c,index:l+p}));if(t){let c=n(e,t);c&&(r=c._pinned.path)}let s=Ee(e,r,d);return s.inserted.length!=0&&(o[r]=s.inserted),o},Ze=(e,{dstPath:t,startIndex:r=0},l)=>{let a=Qe(e,l,{dstPath:t,startIndex:r});return Xe(e,{dstPath:t},a)},Qe=(e,t,r={})=>Object.values(t).reduce((l,a)=>{let n=a.map(d=>d.id),o=[];z(e,(d,s)=>(n.includes(s.path)&&(d._meta=s,o.unshift(d)),o.length==n.length),(d,s)=>d);for(let d of a){if(r.dstPath&&r.dstPath.startsWith(d.id))continue;let s=o.find(c=>c._meta.path==d.id);s&&l.unshift({k:d.key,sch:()=>Ne(s),index:r.startIndex+l.length,id:d.id})}return l},[]),Xe=(e,{dstPath:t},r)=>{let l={},a=Ee(e,t,r);return a.inserted.length!=0&&(l[t]=a.inserted),l},$e=(e,t,r)=>F(e,t,(l,a)=>{let n=O(r,l._tag);switch(!0){case n.type==R:case n.type==M:case n.type!=l.type:let{title:o,description:d,rw:s,required:c,$anchor:p,key:u}=l;return Object.assign(n,{metadata:{title:o,description:d,rw:s,required:c},$anchor:p,key:u}),n;default:return l}}),Q=(e,t)=>z(e,(r,l)=>l.path==t,(r,l)=>(r._meta=l,r)),F=(e,t,r)=>z(e,(l,a)=>a.path==t,r),z=(e,t,r)=>{let l;return C(e,(a,n)=>t(a,n)?(l=r(a,n),l._halt=!0,l):a),l&&delete l._halt,l};var ne=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var Dt=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,Hr=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Yr=/<[a-z][^>]+$/i,Vr=/>[^<>]*$/,Jr=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,zr=/\s+$/,Mt=(e,t)=>0<t--&&(Yr.test(e[t])||!Vr.test(e[t])&&Mt(e,t)),Qr=(e,t,r)=>Hr.test(t)?e:`<${t}${r.replace(zr,"")}></${t}>`,Rt=(e,t,r)=>{let l=[],{length:a}=e;for(let o=1;o<a;o++){let d=e[o-1];l.push(Dt.test(d)&&Mt(e,o)?d.replace(Dt,(s,c,p)=>`${t}${o-1}=${p||'"'}${c}${p?"":'"'}`):`${d}<!--${t}${o-1}-->`)}l.push(e[a-1]);let n=l.join("").trim();return r?n:n.replace(Jr,Qr)};var{isArray:X}=Array,{indexOf:Ct,slice:ve}=[];var Xr=1,Lt=111,Zr=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},It=(e,t)=>e.nodeType===Lt?1/t<0?t?Zr(e):e.lastChild:t?e.valueOf():e.firstChild:e,Pt=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let l=ve.call(t,0),a=l[0],n=l[r-1];return{ELEMENT_NODE:Xr,nodeType:Lt,firstChild:a,lastChild:n,valueOf(){if(t.length!==r){let o=0;for(;o<r;)e.appendChild(l[o++])}return e}}};var jt=(e,t,r,l,a)=>{let n=r.length,o=t.length,d=n,s=0,c=0,p=null;for(;s<o||c<d;)if(o===s){let u=d<n?c?l(r[c-1],-0).nextSibling:l(r[d-c],0):a;for(;c<d;)e.insertBefore(l(r[c++],1),u)}else if(d===c)for(;s<o;)(!p||!p.has(t[s]))&&e.removeChild(l(t[s],-1)),s++;else if(t[s]===r[c])s++,c++;else if(t[o-1]===r[d-1])o--,d--;else if(t[s]===r[d-1]&&r[c]===t[o-1]){let u=l(t[--o],-1).nextSibling;e.insertBefore(l(r[c++],1),l(t[s++],-1).nextSibling),e.insertBefore(l(r[--d],1),u),t[o]=r[d]}else{if(!p){p=new Map;let u=c;for(;u<d;)p.set(r[u],u++)}if(p.has(t[s])){let u=p.get(t[s]);if(c<u&&u<d){let _=s,y=1;for(;++_<o&&_<d&&p.get(t[_])===u+y;)y++;if(y>u-c){let m=l(t[s],0);for(;c<u;)e.insertBefore(l(r[c++],1),m)}else e.replaceChild(l(r[c++],1),l(t[s++],-1))}else s++}else e.removeChild(l(t[s++],-1))}return r};var Ut=e=>t=>{for(let r in t){let l=r==="role"?r:`aria-${r}`,a=t[r];a==null?e.removeAttribute(l):e.setAttribute(l,a)}},Kt=(e,t)=>{let r,l=!0,a=document.createAttributeNS(null,t);return n=>{r!==n&&(r=n,r==null?l||(e.removeAttributeNode(a),l=!0):(a.value=n,l&&(e.setAttributeNodeNS(a),l=!1)))}},qt=(e,t,r)=>l=>{r!==!!l&&((r=!!l)?e.setAttribute(t,""):e.removeAttribute(t))},el=({dataset:e})=>t=>{for(let r in t){let l=t[r];l==null?delete e[r]:e[r]=l}},Gt=(e,t)=>{let r,l=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(l=l.toLowerCase()),a=>{let n=X(a)?a:[a,!1];r!==n[0]&&(r&&e.removeEventListener(l,r,n[1]),(r=n[0])&&e.addEventListener(l,r,n[1]))}},Wt=e=>t=>{typeof t=="function"?t(e):t.current=e},Bt=(e,t)=>t==="dataset"?el(e):r=>{e[t]=r},Ft=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var tl=function(e){"use strict";var t="fragment",r="template",l="content"in o(r),a=l?function(s){var c=o(r);return c.innerHTML=s,c.content}:function(s){var c=o(t),p=o(r),u=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(s)){var _=RegExp.$1;p.innerHTML="<table>"+s+"</table>",u=p.querySelectorAll(_)}else p.innerHTML=s,u=p.childNodes;return n(c,u),c};return function(c,p){return(p==="svg"?d:a)(c)};function n(s,c){for(var p=c.length;p--;)s.appendChild(c[0])}function o(s){return s===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",s)}function d(s){var c=o(t),p=o("div");return p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+s+"</svg>",n(c,p.firstChild.childNodes),c}}(document),et=tl;var Ht=({childNodes:e},t)=>e[t],ke=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(Ct.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:Yt,importNode:Se}=document;var Vt=Se.length!=1,Jt=Vt?(e,t,r)=>Se.call(document,et(e,t,r),!0):et,zt=Vt?e=>Yt.call(document,e,1|128,null,!1):e=>Yt.call(document,e,1|128);var ae=(e,t,r)=>jt(e.parentNode,t,r,It,e),rl=e=>{let t,r,l=[],a=n=>{switch(typeof n){case"string":case"number":case"boolean":t!==n&&(t=n,r?r.textContent=n:r=document.createTextNode(n),l=ae(e,l,[r]));break;case"object":case"undefined":if(n==null){t!=n&&(t=n,l=ae(e,l,[]));break}if(X(n)){t=n,n.length===0?l=ae(e,l,[]):typeof n[0]=="object"?l=ae(e,l,n):a(String(n));break}"ELEMENT_NODE"in n&&t!==n&&(t=n,l=ae(e,l,n.nodeType===11?ve.call(n.childNodes):[n]))}};return a},ll=(e,t)=>{switch(t[0]){case"?":return qt(e,t.slice(1),!1);case".":return Bt(e,t.slice(1));case"o":if(t[1]==="n")return Gt(e,t)}switch(t){case"ref":return Wt(e);case"aria":return Ut(e)}return Kt(e,t)};function Qt(e){let{type:t,path:r}=e,l=r.reduceRight(Ht,this);return t==="node"?rl(l):t==="attr"?ll(l,e.name):Ft(l)}var ie="is\xB5",Xt=ne(new WeakMap),nl=/^(?:plaintext|script|style|textarea|title|xmp)$/i,Z=()=>({stack:[],entry:null,wire:null}),il=(e,t)=>{let{content:r,updates:l}=al(e,t);return{type:e,template:t,content:r,updates:l,wire:null}},ol=(e,t)=>{let r=Rt(t,ie,e==="svg"),l=Jt(r,e),a=zt(l),n=[],o=t.length-1,d=0,s=`${ie}${d}`;for(;d<o;){let c=a.nextNode();if(!c)throw`bad template: ${r}`;if(c.nodeType===8)c.textContent===s&&(n.push({type:"node",path:ke(c)}),s=`${ie}${++d}`);else{for(;c.hasAttribute(s);)n.push({type:"attr",path:ke(c),name:c.getAttribute(s)}),c.removeAttribute(s),s=`${ie}${++d}`;nl.test(c.tagName)&&c.textContent.trim()===`<!--${s}-->`&&(c.textContent="",n.push({type:"text",path:ke(c)}),s=`${ie}${++d}`)}}return{content:l,nodes:n}},al=(e,t)=>{let{content:r,nodes:l}=Xt.get(t)||Xt.set(t,ol(e,t)),a=Se.call(document,r,!0),n=l.map(Qt,a);return{content:a,updates:n}},oe=(e,{type:t,template:r,values:l})=>{let{length:a}=l;Zt(e,l,a);let{entry:n}=e;(!n||n.template!==r||n.type!==t)&&(e.entry=n=il(t,r));let{content:o,updates:d,wire:s}=n;for(let c=0;c<a;c++)d[c](l[c]);return s||(n.wire=Pt(o))},Zt=({stack:e},t,r)=>{for(let l=0;l<r;l++){let a=t[l];a instanceof Oe?t[l]=oe(e[l]||(e[l]=Z()),a):X(a)?Zt(e[l]||(e[l]=Z()),a,a.length):e[l]=null}r<e.length&&e.splice(r)};function Oe(e,t,r){this.type=e,this.template=t,this.values=r}var{create:sl,defineProperties:cl}=Object,er=e=>{let t=ne(new WeakMap),r=l=>(a,...n)=>oe(l,{type:e,template:a,values:n});return cl((l,...a)=>new Oe(e,l,a),{for:{value(l,a){let n=t.get(l)||t.set(l,sl(null));return n[a]||(n[a]=r(Z()))}},node:{value:(l,...a)=>oe(Z(),{type:e,template:l,values:a}).valueOf()}})},tr=ne(new WeakMap),Ae=(e,t)=>{let r=typeof t=="function"?t():t,l=tr.get(e)||tr.set(e,Z()),a=r instanceof Oe?oe(l,r):r;return a!==l.wire&&(l.wire=a,e.textContent="",e.appendChild(a.valueOf())),e},h=er("html"),ta=er("svg");var se=(e,t)=>JSON.stringify(e)==JSON.stringify(t),De=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`};var rr=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),Me(e,"title",t),Me(e,"description",t),fl(e,"rw",["rw","r","w"],t),tt(e,"required",t),dl(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},dl=(e,t)=>{e.type==x?yl(e,t):e.type==S?Tl(e,t):e.type==E?_l(e,t):e.type==N?xl(e,t):e.type==I?pl(e,t):e.type==P?ml(e,t):e.type==j?ul(e,t):e.type==B&&hl(e,t)},pl=(e,t)=>{bl(e,"pattern",t),U(e,"min",t,{min:0}),U(e,"max",t,{min:0}),ce(e,t),Me(e,"default",t,Object.assign(lr(e,["min","max","pattern"]),{ignoreEmpty:!0}))},ul=(e,t)=>{tt(e,"default",t)},ml=(e,t)=>{Re(e,"min",t),Re(e,"max",t),U(e,"multipleOf",t),ce(e,t),Re(e,"default",t,lr(e,["min","max","multipleOf"]))},hl=(e,t)=>{Nl(e,"default",t)},yl=(e,t)=>{U(e,"min",t,{min:0}),U(e,"max",t,{min:0}),ce(e,t)},Tl=(e,t)=>{U(e,"min",t,{min:1}),U(e,"max",t,{min:1}),ce(e,t),tt(e,"unique",t)},_l=(e,t)=>{U(e,"min",t,{min:1}),U(e,"max",t,{min:1}),ce(e,t)},xl=(e,t)=>{},lr=(e,t=[])=>{let r={};for(let l of t)(e.errors[l]||[]).length==0&&(typeof e.changes[l]=="number"?(e.changes[l]||e.changes[l]==0)&&(r[l]=e.changes[l]):r[l]=e.changes[l]);return r},Me=(e,t,r,l={})=>{if(!r.hasOwnProperty(t)||l.ignoreEmpty&&r[t]=="")return;let a=r[t],n=2**18;(d=>new Blob([d]).size)(a)>n?v(e,t,`string size limit is ${Math.ceil(n/1024)} KB`):l.max&&a.length>l.max?v(e,t,`must be less than or equal ${l.max} length`):l.min&&a.length<l.min?v(e,t,`must be grater than or equal ${l.min} length`):l.pattern?new RegExp(l.pattern).test(a)||v(e,t,`must matche pattern ${l.pattern}`):e.changes[t]=a},tt=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let l=El(r[t]);l==null?v(e,t,"must be boolean"):e.changes[t]=l},Re=(e,t,r,l={})=>{if(!r.hasOwnProperty(t))return;let a=rt(r[t]);!a&&a!=0?v(e,t,"must be number"):l.min&&a<l.min?v(e,t,`must be greater than or equal ${l.min}`):l.max&&a>l.max?v(e,t,`must be less than than or equal ${l.max}`):l.multipleOf&&a%l.multipleOf!=0?v(e,t,`must be multiple of ${l.multipleOf}`):e.changes[t]=a},U=(e,t,r,l)=>{if(!r.hasOwnProperty(t))return;Re(e,t,r,l);let a=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?v(e,t,"must be integer number"):a>Number.MAX_SAFE_INTEGER?v(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):a<Number.MIN_SAFE_INTEGER&&v(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},bl=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(Me(e,t,r),(e.errors[t]||[]).length==0))try{let l=r[t];if(l=="")return;e.changes[t]=new RegExp(l)}catch(l){v(e,t,"invalid regex")}},ce=(e,t)=>{if(t.min&&t.max){let r=rt(t.min),l=rt(t.max);(r||r==0)&&(l||l==0)&&r>l&&(v(e,"min","min is greater than max"),v(e,"max","max is less than min"))}},Nl=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?v(e,t,"must be null"):e.changes[t]=r[t])},fl=(e,t,r,l)=>{!l.hasOwnProperty(t)||(r.includes(l[t])?e.changes[t]=l[t]:v(e,t,"value must be r, w, or rw"))},v=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},rt=e=>nr(e,"number"),El=e=>nr(e,"boolean");var nr=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=n=>["checkbox","radio"].includes(n.type)?n.checked:n.value,r=this.querySelector("form").elements,l={};for(let n=0;n<r.length;n++){let o=t(r[n]);!(r[n]instanceof HTMLTextAreaElement)&&o==""||(l[r[n].name]=o)}let a={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:l};this.dispatchEvent(new CustomEvent("sch-update",{detail:a,bubbles:!0}))}}});var Le=(e,t,r)=>{if(!(t._tag!=A&&t._tag!=null))try{Ae(e,h.for(t)`
    <p>${wl(t.rootKey,t.path)||"-"} : <span>${t.type}</span></p>
    <form data-path="${t.path}" data-file="${t.rootKey}">
      ${Ce(t,"title",{keyDisplay:"Title"})}
      ${Ce(t,"description",{keyDisplay:"Description"})}
      ${vl(t)}
      ${gl(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:"rw",keyDisplay:"Read / Write"})}
      ${$l(t,"default",{keyDisplay:"Default"})}
    </form>
  `)}catch(l){console.log(l)}},wl=(e,t)=>(t=t.substring(1,t.length-1).split("][").filter(r=>r!=""),t.splice(0,0,e),t.join(" / ")),de=(e,t,r,l={})=>{var a;return h`
  <label class="${l.readonly&&`meta-box ${t} readonly`||`meta-box ${t}`}">
    <p class="l">${l.keyDisplay||t} ${l.readonly&&h`<span>· readonly</span>`}</p>
    ${r}
    ${(a=Ie(e,t))==null?void 0:a.map(n=>h`<p class="err">${n}</p>`)}
  </label>
  `},Ce=(e,t,r={})=>de(e,t,h`
    <textarea name="${fe(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${Ie(e,t)&&"invalid"}" oninput="${De}">${ee(e,t)||r.value}</textarea>
  `,r),Pe=(e,t,r={})=>de(e,t,h`
    <input type="number" name="${fe(e,t)}" inputmode="decimal" step="any" min="${r.min}" max="${r.max}" value="${ee(e,t)||r.value}" ?readonly="${r.readonly}" class="${Ie(e,t)&&"invalid"}">
  `,r),q=(e,t,r={})=>de(e,t,h`
    <input type="number" name="${fe(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${ee(e,t)||r.value}" ?readonly="${r.readonly}" class="${Ie(e,t)&&"invalid"}">
  `,r),lt=(e,t,r={})=>de(e,t,h`
    <input type="checkbox" name="${fe(e,t)}" ?disabled="${r.readonly}" ?checked="${ee(e,t)||r.value}">
  `,r),gl=(e,t,r={})=>de(e,t,h`
    <select name="${fe(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([l,a])=>h`<option value="${l}" ?selected="${(ee(e,t)||r.selected)==l}">${a}</option>`)}
    </select>
  `,r),$l=(e,t,r={})=>{switch(e.type){case j:return lt(e,t,r);case P:return Pe(e,t,r);case I:return Ce(e,t,r);default:return""}},fe=(e,t)=>t,ee=(e,t)=>(e.metadata||{})[t],vl=e=>{let t;switch(e.type){case x:t=[q(e,"min",{keyDisplay:"Min Properties",value:Object.keys(e.fields).length,readonly:!0}),q(e,"max",{keyDisplay:"Max Properties",value:Object.keys(e.fields).length,readonly:!0})];break;case S:t=[q(e,"min",{keyDisplay:"Min Items",min:1,value:1}),q(e,"max",{keyDisplay:"Max Items",min:1}),lt(e,"unique",{keyDisplay:"Item uniqueness"})];break;case E:t=[q(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),q(e,"max",{keyDisplay:"Max Items",value:ee(e,"max")||e.schs.length})];break;case I:t=[q(e,"min",{keyDisplay:"Min Length",min:0}),q(e,"max",{keyDisplay:"Max Length",min:0}),Ce(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case P:t=[Pe(e,"min",{keyDisplay:"Min"}),Pe(e,"max",{keyDisplay:"Max"}),Pe(e,"multipleOf",{keyDisplay:"Multiple of",min:1})];break;case be:t=[];case j:t=[];case B:t=[];case N:t=[];case J:t=[];case R:t=[];case M:t=[];default:t=[]}return e._meta.parent.type==x&&![A,"file","project"].includes(e._tag)&&t.push(lt(e,"required",{keyDisplay:"Required"})),t};var Ie=(e,t)=>e.errors&&e.errors[t];var ar=(e,t,r={})=>{try{let l=t._models||t.order.reduce((n,o)=>(n[t.fields[o].$anchor]=o,n),{}),a={level:1,tab:0,models:l,rootTag:t._tag,rootKey:t.key};kl(e,{sch:t,ui:Object.assign(a,r.ui),path:t.path||"",key:t.key,parent:{type:t.type,_tag:t._tag}})}catch(l){console.log(l)}},kl=(e,t)=>Ae(document.querySelector(e),h`
  <theme>
    <ul role="tree" aria-multiselectable="true" class="text-sm" tabindex="-1">
      ${pe(t)}
    </ul>
  </theme>
  ${null}
`);var pe=e=>{switch(!0){case e.sch._tag==e.ui.rootTag:return Sl(e);case Et.includes(e.sch.type):return Ol(e);default:return Al(e)}},Sl=e=>h.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._tag}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${nt(e.key)}
    </dfn>
    <ul data-group="${or(e.sch)}" role="group">
      ${ir(e)}
    </ul>
  </li>`,Ol=e=>h.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._tag}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${sr(Object.assign(e,{key:nt(e.key)}))}
      ${cr(e)}
      ${dr(e)}
    </dfn>
    <ul data-group="${or(e.sch)}" role="group">
      ${ir(e)}
    </ul>
  </li>`,Al=e=>h.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._tag}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${sr(Object.assign(e,{key:nt(e.key)}))}
    ${cr(e)}
    ${dr(e)}
  </li>`,ir=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return h``;switch(!0){case[x].includes(e.sch.type):return Dl(e);case[E].includes(e.sch.type):return Ml(e);case[S].includes(e.sch.type):return Rl(e);case[N].includes(e.sch.type):return Cl(e);default:return h``}},Dl=e=>e.sch.order.map((t,r)=>pe({key:t,sch:e.sch.fields[t],parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[${t}]`})),Ml=e=>e.sch.schs.map((t,r)=>pe({key:r,sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Rl=e=>pe({key:0,sch:e.sch.sch,parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:0},path:`${e.path}[][${0}]`}),Cl=e=>e.sch.schs.map((t,r)=>pe({key:"",sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),je=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab}rem`,fr=(e,t,r)=>h`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="256" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${De}"
  >${r}</textarea>`,sr=e=>e.parent._tag==e.ui.rootTag?Ll(e):Il(e),Ll=e=>h`
  <span class="def" style="${je(e)}">
    ${Pl(e.sch,e.ui)}
  </span>
  <span class="k">${pr(e)}</span>
  <span class="s">=</span>
  `,Il=e=>{switch(!0){case e.parent.type==N:return h`
      <span class="" style="${je(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==S:return h`
      <span class="k" style="${je(e)}"></span>
      <span class="s">└</span>
      `;default:return h`
      <span class="k" style="${je(e)}">
        ${pr(e)}
      </span >
      <span class="s">:</span>
    `}},pr=e=>e.sch.uiMode=="editKey"?fr("key-edit",e.parent.path,e.key):h`${e.key}`,cr=e=>e.parent._tag==e.ui.rootTag?jl(e):Ul(e),jl=e=>e.ui.viewTypeRoot?e.ui.viewTypeRoot(e):h`<span class="t">${ur(e)}</span>`,Ul=e=>h`<span class="t">${ur(e)}</span>`,ur=e=>e.sch.uiMode=="editType"?fr("type-edit",e.parent.path,Kl(e.sch,e.ui)):h`${mr(e.sch,e.ui)}`,Kl=(e,t)=>{switch(!0){case e.type==M:return JSON.stringify(e.const);case e.type==R:return t.models[e.$ref];default:return e.type}},mr=(e,t)=>{let r;switch(!0){case(e.type==x&&se(e.fields,{})):r="{ any }";break;case e.type==x:r="{ \xA0 }";break;case e.type==S:r=h`[ ${mr(e.sch,t)} ]`;break;case e.type==E:r="( \xA0 )";break;case e.type==I:r="string";break;case e.type==P:r="number";break;case e.type==be:r="integer";break;case e.type==j:r="bool";break;case e.type==B:r="null";break;case e.type==N:r="||";break;case e.type==J:r="any";break;case(e.type==R&&!!t.models[e.$ref]):r=h`<span class="ref">${e._text=t.models[e.$ref]}</span>`;break;case e.type==R:r=h`<span class="ref notfound" title="Ref type">${`${e._text} (#404)`}</span>`;break;case e.type==M:r=h`<span class="value" title="Value type">${JSON.stringify(e.const)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},nt=e=>e,or=e=>{switch(!0){case[x].includes(e.type):return"keyed";case[E,N].includes(e.type):return"indexed";default:return"none"}},Pl=(e,t)=>{let r;switch(!0){case e.type==x:r="record";break;case e.type==S:r="list";break;case e.type==E:r="tuple";break;case e.type==N:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},dr=e=>{var r;let t;switch(!0){case(e.parent.type==x&&((r=e.sch.metadata)==null?void 0:r.required)):t=[h`<span class="m"> · required</span>`];break;default:t=[]}return t};var at={};_t(at,{clearClipboard:()=>ue,createWalker:()=>hr,findUnselectedNode:()=>Ke,reselectNodes:()=>qe,selectMultiNode:()=>re,selectMultiNodeTo:()=>Ue,selectNode:()=>k,selectedGroupedByParent:()=>H,toggleSelectNode:()=>_r});var L="aria-selected",hr=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.hasAttribute(L)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),e),k=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,yr(e),te(t),r.focus&&t.focus())},_r=(e,t)=>{e&&(e.tabIndex=-1),Tr(t)},re=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(L)=="true"?Tr(e):te(t),r.focus&&t.focus())},yr=e=>{for(let t of e.querySelectorAll(`[${L}='true']`))it(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},ot=(e,t,r,l={})=>{var o,d,s;let a=e._walker.currentNode,n=t();if(!!n){if(a==r)return(o=l.target)==null?void 0:o.call(null,r);(d=l.pre)==null||d.call(null,a,n),ot(e,t,r,l),(s=l.post)==null||s.call(null,a,n)}},Ue=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,ot(e,()=>e._walker.nextSibling(),r,{pre:(l,a)=>{re(l,a,{focus:!1})}}),e._walker.currentNode=r,te(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,te(r.parentNode.closest(`[${L}]`)),ot(e,()=>e._walker.previousSibling(),r,{pre:(l,a)=>{re(l,a,{focus:!1})}}),it(r.parentNode.closest(`[${L}]`)),e._walker.currentNode=r,te(r),r.focus();break}},te=e=>{!e||(e.setAttribute(L,!0),e.tabIndex=0)},it=e=>{!e||(e.setAttribute(L,!1),e.tabIndex=-1)},Tr=e=>(e==null?void 0:e.getAttribute(L))=="true"?it(e):te(e),Ke=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(L))=="true");return t},ql=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),qe=(e,t,r={})=>{yr(e);for(let l of ql(Object.keys(t))){let a=t[l];if(l==""?l=e.querySelector("[id][aria-level]"):l=e.querySelector(`[id='${CSS.escape(l)}'][aria-level]`),!l)continue;let n=parseInt(l.getAttribute("aria-level")),o=l.querySelectorAll(`[aria-level='${n+1}'][role='treeitem']`);for(let d=0;d<a.length;d++){let s=a[d].index,c=o[s];if(!c)return;c.classList.add("item-pasted"),r.direction&&c.classList.add(r.direction),re(null,c,{focus:d==a.length-1}),e._walker.currentNode=c}}},H=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${L}='true']`}`),l={};for(let a=0;a<r.length;a++){let n=r[a],o=n.parentNode.closest("[role='treeitem']");if(!o)break;n.index=n.index||parseInt(n.getAttribute("aria-posinset"))-1,l[o.id]=l[o.id]||[],l[o.id].push(n)}return l},ue=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var st={};_t(st,{anchorsModels:()=>pt,createProjectStore:()=>Gl,getFileStore:()=>We,handleProjectContext:()=>Fl,handleProjectRemote:()=>Wl,projectToStore:()=>Yl});var Y="new",G="removed",V="moved",me="order_changed",he="key_changed",ye="type_changed",xr=(e,t,r={})=>{let l={},a=[];C(t,(n,o)=>(n._meta=o,Object.assign(l,{[n.$anchor]:n}),delete n._visit,n)),C(e,(n,o)=>{var s;n._meta=o;let d=l[n.$anchor];if(d){let c=n._meta.parent,p=d._meta.parent;p.$anchor!=c.$anchor&&(n._diff={[V]:{oldParent:p,newParent:c}}),se(d.order,n.order)||(n._diff={[me]:{oldOrder:d.order,newOrder:n.order}}),d.type!=n.type&&Object.assign(n._diff||(n._diff={}),{[ye]:{oldType:d.type,newType:n.type,parent:c}}),d.key!=n.key&&Object.assign(n._diff||(n._diff={}),{[he]:{oldKey:d.key,newKey:n.key,parent:c}}),n._diff&&a.push(n),d._visit=!0}else o.path.startsWith((s=o.parent.prune)==null?void 0:s.added)||(n._diff={[Y]:{parent:o.parent}},a.push(n),Object.assign(o.parent,{prune:{added:o.path}}));return n});for(let n of Object.keys(l)){if(l[n]._visit)continue;let o=l[n]._meta,d=o.path;a.filter(c=>c._diff[G]&&d.startsWith(c._meta.path)).length==0&&(l[n]._diff={[G]:{parent:o.parent}},a.push(l[n]))}return a};var W="file",le="project",Gl=()=>Te({tag:le,allowedSchs:[br()],put:{pos:"append"}}),We=(e,t)=>{let r=Q(e,`[${t}]`);return r.schMetas=e.schMetas,r},Wl=(e,t,r,l)=>{if(!ft(r.name))return;let a=f=>{for(let T of Object.keys(e.fields))if(e.fields[T].fields[f])return{file:e.fields[T],fmodelDst:e.fields[T].fields[f]}},n=f=>z(e,(T,g)=>{if(T._tag==A&&g.path!="")return f.startsWith(g.path)},(T,g)=>(T._meta=g,T)),o=xr(e,t),d={};d.files=[],d.fmodels=[],d.subfmodels=[];for(let f of o)f._tag==le?d.project=f:f._tag==W?d.files.push(f):f._tag==A?d.fmodels.push(f):d.subfmodels.push(f);let s={},c={},p={};if(d.project){let{fields:f,...T}=w(d.project);s.project=T}for(let f of d.files){let{fields:T,...g}=w(f);if(c.files||(c.files={}),p.files||(p.files={}),s.files||(s.files={}),c.fmodels||(c.fmodels={}),p.fmodels||(p.fmodels={}),f._diff[Y]){c.files[f._meta.path]={...g,parentAnchor:f._diff[Y].parent.$anchor};for(let D of Object.keys(T))c.fmodels[f.fields[D]._meta.path]={...T[D],parentAnchor:g.$anchor}}if(f._diff[G]){p.files[f._meta.path]={$anchor:g.$anchor,parentAnchor:f._diff[G].parent.$anchor};for(let D of Object.keys(T))p.fmodels[f.fields[D]._meta.path]={$anchor:T[D].$anchor,parentAnchor:g.$anchor}}(f._diff[me]||f._diff[he])&&(s.files[f._meta.path]=g),f._diff[V]&&console.log("file cannot be moved to different parent"),f._diff[ye]&&console.log("file type is always record, cannot be changed")}for(let f of d.fmodels){let T=w(f);if(s.files||(s.files={}),c.fmodels||(c.fmodels={}),p.fmodels||(p.fmodels={}),s.fmodels||(s.fmodels={}),f._diff[Y]&&(c.fmodels[f._meta.path]={...T,parentAnchor:f._diff[Y].parent.$anchor}),f._diff[G]&&(p.fmodels[f._meta.path]={$anchor:T.$anchor,parentAnchor:f._diff[G].parent.$anchor}),(f._diff[me]||f._diff[he]||f._diff[ye])&&(s.fmodels[f._meta.path]={...T,parentAnchor:f._meta.parent.$anchor}),f._diff[V]){let{oldParent:g,newParent:D}=f._diff[V];switch(g._tag){case le:console.log("fmodel cannot be moved from project as direct child");break;case W:var u=e.fields[g.key],{fields:_,...y}=w(u);s.files[u._meta.path]=y,p.fmodels[f._meta.path]={$anchor:f.$anchor,parentAnchor:y.$anchor};break;case A:console.log("impossible for fmodel to have fmodel as parent");break;default:console.log("impossible for fmodel to be moved from unknown tag parent")}switch(D._tag){case le:console.log("fmodel cannot be moved to project as direct child");break;case W:var u=e.fields[D.key],{fields:_,...y}=w(u);s.files[u._meta.path]=y,c.fmodels[f._meta.path]={...T,parentAnchor:y.$anchor};break;case A:var m=a(D.key),y=w(m.file);c.fmodels[m.fmodelDst._meta.path]={...w(m.fmodelDst),parentAnchor:y.$anchor};break;default:var b=n(D.path),m=a(b.key),y=w(m.file);s.fmodels[b._meta.path]={...w(b),parentAnchor:y.$anchor}}}}for(let f of d.subfmodels){if(s.files||(s.files={}),c.fmodels||(c.fmodels={}),p.fmodels||(p.fmodels={}),s.fmodels||(s.fmodels={}),f._diff[Y]||f._diff[G]||f._diff[me]||f._diff[he]||f._diff[ye]){let T=n(f._meta.path),g=a(T.key),D=w(g.file);s.fmodels[T._meta.path]={...w(T),parentAnchor:D.$anchor}}if(f._diff[V]){let{oldParent:T,newParent:g}=f._diff[V];switch(T._tag){case le:console.log("subfmodel cannot be moved from project as direct child");break;case W:var u=e.fields[T.key],{fields:_,...y}=w(u);s.files[u._meta.path]=y,p.fmodels[f._meta.path]={$anchor:f.$anchor,parentAnchor:y.$anchor};break;case A:default:var b=n(T.path),m=a(b.key),y=w(m.file);s.fmodels[b._meta.path]={...w(b),parentAnchor:y.$anchor}}switch(g._tag){case le:console.log("subfmodel cannot be moved to project as direct child");break;case W:var b=n(f._meta.path),m=a(b.key),{fields:_,...y}=w(m.file);s.files[m.file._meta.path]=y,c.fmodels[f._meta.path]={...w(f),parentAnchor:y.$anchor};break;case A:default:var b=n(f._meta.path),m=a(b.key),y=w(m.file);s.fmodels[b._meta.path]={...w(b),parentAnchor:y.$anchor}}}}return console.log({changed:s,added:c,removed:p}),l({changed:s,added:c,removed:p})},Fl=(e,t,r,l)=>{if(r){if(t.closest("[id='project']"))switch(!0){case dt(l.name):Bl(e,r);break;case Ge(l.name):let a=We(e,r);document.querySelector("[id='fmodel'] [role='tree']")._render(a)}else if(t.closest("[id='fmodel']"))switch(!0){case Ge(l.name):let a=We(e,r);a._models=pt(e,a),document.querySelector("[id='fmodel'] [role='tree']")._render(a)}}},pt=(e,t)=>{let r={};for(let l of e.order){let a=e.fields[l];for(let n of a.order)r[a.fields[n].$anchor]=l!=t.key?`${l}.${n}`:n}return r},br=()=>Te({tag:W,addDefault:()=>Te({tag:A}),put:{tag:{[W]:A,[A]:void 0}}}),Hl=(e,t)=>{for(let r of e.fmodels)Object.assign(r.sch,{$anchor:r.anchor,type:r.type,key:r.key,is_entry:r.is_entry,_tag:A}),t.fields[r.key]=r.sch;return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,O(()=>t)},Yl=(e,t)=>{for(let r of e.files)t.fields[r.key]=Hl(r,br());return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,t.schMetas=e.allmeta,O(()=>t)},Bl=(e,t)=>{let r=We(e,t);if((r==null?void 0:r._tag)==W&&(r._models=pt(e,r),ct({store:r,target:"[id='fmodel']",metaSelector:"sch-meta"}),!window._treeClipboard)){let l=document.querySelector("[id='fmodel'] [role='tree']");l._aria.clearClipboard(l)}};var Nr=[wt,Ve,kt,St,Ot,K,gt,$t,vt,()=>Je('"json string"')],Te=(e={})=>{let t=O(Ve);return t._allowedSchs=e.allowedSchs||Nr.map(r=>r()),e.tag&&(t._tag=e.tag),e.addDefault&&(t._addSchDefault=t._allowedSchs.find(r=>r.type==e.addDefault().type)&&e.addDefault()),e.put&&(t.put=e.put),t};var dt=e=>[gr,$r,Er,wr,vr,kr,ut,mt,ht,_e].map(t=>t.name).includes(e),Ge=e=>[yt,_e,Tt,Be].map(t=>t.name).includes(e),ft=e=>[yt,_e,Tt,Be,mt,ht,Sr,Or,_e].map(t=>t.name).includes(e),Zl=()=>new Map([["shift-meta-ArrowUp",Vl],["shift-meta-ArrowDown",Jl],["shift-ArrowUp",zl],["shift-ArrowDown",Ql],["meta-ArrowUp",Er],["meta-ArrowDown",wr],["ArrowUp",gr],["ArrowDown",$r],["Home",vr],["End",kr],["shift-+",yt],["Enter",Xl],["shift-Enter",Ar],["Delete",_e],["meta-x",Dr],["meta-c",Mr],["meta-v",Be],["shift-alt-ArrowUp",mt],["shift-alt-ArrowDown",ht],["alt-ArrowUp",Sr],["alt-ArrowDown",Or],["Escape",({tree:e})=>ue(e)]]),tn=(e,t={})=>function(r){en(r,this,e,t)};async function en(e,t,r,l){if(e.target instanceof HTMLTextAreaElement)return rn(e,t,r);let a=Zl().get(Rr(e));if(!a||(l.denyCmds||[]).includes(a.name))return;switch(a({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t.renderSchMeta(),t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`));let n=t._walker.currentNode.closest("[data-tag='file']");t.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{file:n==null?void 0:n.key,path:t._walker.currentNode.id,command:a}}))}var ln=()=>new Map([["Enter",Tt]]),rn=(e,t,r)=>{let l=e.target,a=ln().get(Rr(e));if(!a)return;a({tree:t,store:r},l),t.renderSchMeta();let n=t._walker.currentNode.closest("[data-tag='file']");t.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{file:n==null?void 0:n.key,path:t._walker.currentNode.id,command:a}}))},an=e=>function(t){return nn(t,this,e)};function nn(e,t,r){let l=t._walker.currentNode,a=e.target.closest("[role='treeitem']"),n=!t.querySelector("textarea");if(!!a){if(e.shiftKey||e.metaKey)switch(l.compareDocumentPosition(a)){case Node.DOCUMENT_POSITION_CONTAINS:return k(t,a);case Node.DOCUMENT_POSITION_CONTAINED_BY:return k(t,l);default:if(a.parentNode.closest("[role='treeitem']")!=l.parentNode.closest("[role='treeitem']"))return k(t,a)}if(e.shiftKey)Ue(t,l,a);else if(e.metaKey)_r(l,t._walker.currentNode=a);else{let o=a.closest("[data-tag='file']");t._walker.currentNode=a,ut({tree:t},{notFocusIfTextArea:n}),t.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{file:o==null?void 0:o.key,path:a.id,command:ut}}))}t.renderSchMeta()}}var on=({tree:e,store:t})=>{let r=e.querySelectorAll("[id='fmodel'] [aria-selected='true']");if(r.length==1){let l=Q(t,r[0].id);l.displayKey=`${r[0].key}`,l.path=r[0].id,l.rootKey=e.querySelector(".root-item").key,l.metadata=t.schMetas[l.$anchor],Le(e._metaContainer,l,t)}},Rr=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:l,key:a})=>{let n=[];return e&&n.push("shift"),(t||l)&&n.push("meta"),r&&n.push("alt"),a&&n.push(a),n.join("-")},Vl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();Ue(e,t,r)},Jl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();Ue(e,t,r)},zl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();re(t,r)},Ql=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();re(t,r)},Er=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();k(e,t)},wr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();k(e,t)},gr=({tree:e})=>k(e,e._walker.previousNode()),$r=({tree:e})=>k(e,e._walker.nextNode()),vr=({tree:e})=>{for(;e._walker.parentNode(););k(e,e._walker.currentNode)},kr=({tree:e})=>{for(;e._walker.nextNode(););k(e,e._walker.currentNode)},ut=({tree:e},t={})=>k(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),yt=({tree:e,store:t})=>{var o;let r=e._walker.currentNode,l=Q(t,r.id),a,n=l._addSchDefault||l._allowedSchs&&l._allowedSchs[0]||t._allowedSchs&&t._allowedSchs[0];!n||(((o=l.put)==null?void 0:o.pos)=="prepend"?a=0:a=Number.MAX_SAFE_INTEGER,Ee(t,r.id,[{k:null,sch:()=>Ne(n),index:a}]),e._render(t),k(e,r))},Xl=({tree:e,store:t})=>{var l,a;((a=(l=e._walker.currentNode.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:a.group)=="keyed"&&Cr({tree:e,store:t,editMode:"editKey"})},Ar=({tree:e,store:t})=>{Cr({tree:e,store:t,editMode:"editType"})},Cr=({tree:e,store:t,editMode:r})=>{let l=e._walker.currentNode;F(t,l.id,(n,o)=>({...n,uiMode:r})),e._render(t);let a=e.querySelector("textarea");!a||(a._treeItem=l,a.onblur=n=>sn(e,t,a),a.focus())},sn=(e,t,r)=>{let l=F(t,r._treeItem.id,(a,n)=>Object.assign(a,{uiMode:"cancelled-edit"}));e._render(t),l&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),k(e,e._walker.currentNode))},Tt=({tree:e,store:t},r)=>{r.id=="key-edit"?Lr(e,t,r,dn):r.id=="type-edit"&&Lr(e,t,r,cn)},Lr=(e,t,r,l)=>{let a=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),k(e,r._treeItem,{focus:!1});let n=l(e,t,r)||a.id;F(t,n,(o,d)=>Object.assign(o,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(n)}']`),k(e,e._walker.currentNode)},cn=(e,t,r)=>{let l=t._allowedSchs.find(o=>o.type==r.value),a=Object.keys(t._models).find(o=>t._models[o]==r.value),n=Je(r.value);return l?$e(t,r._treeItem.id,()=>Ne(l)):a?$e(t,r._treeItem.id,()=>At(a)):n&&$e(t,r._treeItem.id,()=>n),e._walker.currentNode.id},dn=(e,t,r)=>{let l=H(e),a=r.dataset.parentPath;l[r.dataset.parentPath]=l[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>({id:c.id,newK:r.value,index:c.index}));let n=l[r.dataset.parentPath][0].index,d=ge(t,{dstPath:a,startIndex:n},l)[a][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${d}]`},_e=({tree:e,store:t})=>{let r=Ke(()=>e._walker.nextSibling())||Ke(()=>e._walker.previousSibling())||Ke(()=>e._walker.parentNode());we(t,H(e)),e._render(t),k(e,r)};var Dr=({store:e,tree:t})=>{ue(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-cutting");let r=H(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",storeKey:e.key,ops:l=>we(e,r,{dstPath:l}),selected:r}},Mr=({store:e,tree:t})=>{ue(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-copying");let r=H(t,{ops:".item-copying"});window._treeClipboard={type:"copy",storeKey:e.key,ops:l=>Qe(e,r,{dstPath:l,startIndex:0}),selected:r}},Be=({tree:e,store:t,srcStore:r})=>{let l=Q(t,e._walker.currentNode.id);if(!![x,N,E].includes(l.type)&&window._treeClipboard){let a=e._walker.currentNode.id,{type:n,storeKey:o,ops:d,selected:s}=window._treeClipboard,c=s,p={};if(t.key==o)switch(n){case"copy":p=Ze(t,{dstPath:a},c);break;case"cut":p=ge(t,{dstPath:a},c);break}else switch(n){case"copy":let u=d(a);p=Xe(t,{dstPath:a},u);break;case"cut":let _=d(a);p=ze(t,{dstPath:a},_);break}Object.keys(p).length!=0&&(e._render(t),ue(e),qe(e,p))}},mt=({tree:e,store:t})=>Ir({tree:e,store:t,direction:"up"},r=>r[0].index),ht=({tree:e,store:t})=>Ir({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),Ir=({tree:e,store:t,direction:r},l)=>{let a=H(e),n={};for(let o of Object.keys(a))n=Ze(t,{dstPath:o,startIndex:l(a[o])},{[o]:a[o]});Object.keys(n).length!=0&&(e._render(t),qe(e,n,{direction:r}))},Sr=({tree:e,store:t})=>Pr({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),Or=({tree:e,store:t})=>Pr({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),Pr=({tree:e,store:t,startIndex:r,direction:l})=>{let a=H(e),n={};for(let o of Object.keys(a)){let d=a[o].sort((s,c)=>s.index-c.index);n=ge(t,{dstPath:o,startIndex:r(d[0].index)},a)}Object.keys(n).length!=0&&(e._render(t),qe(e,n,{direction:l}))},jr=({store:e,target:t,metaSelector:r,opts:l})=>{e.render=o=>ar(t,o,l||{}),e.render(e),e.schMetas||(e.schMetas={});let a=document.querySelector(`${t} [role='tree']`),n=document.querySelector(r);if(a){a._aria=at,a._render=e.render,hr(a),a.onkeydown=tn(e,l.treeKeyDownOpts),a.onclick=an(e);let o=a._walker.nextNode();k(a,a._walker.nextNode()||o,{focus:l.focus}),r&&(a._metaContainer=n),a.renderSchMeta=()=>on({tree:a,store:e}),a.renderSchMeta()}},fn=({store:e,target:t,metaSelector:r})=>{jr({store:e,target:t,metaSelector:r,opts:{ui:{depthLimit:2,modelTypeText:(l,a)=>"file",typeText:(l,a)=>{if(l.type==x)return"record";if(l.type==M)return"value";if(l.type==E)return"tuple";if(l.type==N)return"union"},viewTypeRoot:l=>""},treeKeyDownOpts:{denyCmds:[Ar,Mr,Dr,Be].map(l=>l.name)},focus:!0}})},ct=({store:e,target:t,metaSelector:r})=>{jr({store:e,target:t,metaSelector:r,opts:{ui:{modelTypeText:(l,a)=>"type"}}})},pn=({store:e,detail:t,target:r})=>{let{path:l,attrs:a}=t,n=F(e,l,(o,d)=>rr(o,a));return e.render&&e.render(e),Object.assign(e.schMetas,{[n.$anchor]:n.metadata}),Le(r.closest("sch-meta"),n,e),n};export{st as Project,Nr as allSchs,Te as createStore,fn as initFileView,ct as initModelView,dt as isContextSwitchedCmd,ft as isDiffableCmd,Ge as isModelChangedCmd,pn as update};
/*! (c) Andrea Giammarchi - ISC */
