var Wr=Object.defineProperty;var _t=(e,t)=>{for(var r in t)Wr(e,r,{get:t[r],enumerable:!0})};var ve,Br=new Uint8Array(16);function Be(){if(!ve&&(ve=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!ve))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ve(Br)}var Et=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Fr(e){return typeof e=="string"&&Et.test(e)}var $t=Fr;var k=[];for(var Fe=0;Fe<256;++Fe)k.push((Fe+256).toString(16).substr(1));function Hr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase();if(!$t(r))throw TypeError("Stringified UUID is invalid");return r}var wt=Hr;function Yr(e,t,r){e=e||{};var l=e.random||(e.rng||Be)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=l[a];return t}return wt(l)}var He=Yr;var N="record",S="list",$="tuple",P="string",j="number",_e="integer",U="boolean",H="null",E="union",z="any",L="ref",M="value",kt=[N,$,S,E],C="fmodel";var K=()=>({type:z}),gt=()=>({type:P}),Ot=()=>({type:U}),St=()=>({type:j}),At=()=>({type:H}),Ye=()=>({type:N,fields:{},order:[]}),Dt=()=>({type:S,sch:A(K)}),Mt=()=>({type:$,schs:[A(K)]}),Lt=()=>({type:E,schs:[A(K)]}),Ct=e=>({type:L,$ref:e}),Ve=e=>{try{return e=JSON.parse(e),e==null||[P,j,U].includes(typeof e)?{type:M,const:e}:!1}catch(t){return!1}},A=(e,t={})=>{let r=e();return r.$anchor||(r.$anchor=He()),t.force&&(r.$anchor=He()),t.tag&&(r._tag=t.tag),r};var Ee=e=>{let t=JSON.parse(JSON.stringify(e));return R(t,(r,l)=>A(()=>r,{force:!0})),t},b=e=>R(JSON.parse(JSON.stringify(e)),(t,r)=>{let{type:l,$anchor:a,key:n,_tag:s,isEntry:d}=t,o={type:l,$anchor:a,key:n,_tag:s};switch(d&&Object.assign(o,{isEntry:d}),t.type){case N:let{fields:c,order:f}=t;return Object.assign(o,{fields:c,order:f});case $:case E:let{schs:p}=t;return Object.assign(o,{schs:p});case S:let{sch:m}=t;return Object.assign(o,{sch:m});case M:let{const:y}=t;return Object.assign(o,{const:y});case L:let{$ref:x}=t;return Object.assign(o,{$ref:x});default:return Object.assign(o,{})}}),R=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,e=t(e,r),e._halt)return e;let l=({_tag:a,type:n,$anchor:s,key:d},{path:o,level:c,parent:{prune:f}})=>({_tag:a,level:c,type:n,$anchor:s,key:d,path:o,prune:f});switch(!0){case[N].includes(e.type):let a=Object.keys(e.fields);for(let d=e.order.length-1;d>=0;d--){let o=e.order[d],c=e.fields[o],f={path:`${r.path}[${o}]`,level:r.level+1,index:d,parent:l(e,r)};if(c=R(c,t,f),c.key=o,e.fields[o]=c,c._halt)return Object.assign(e,{_halt:!0})}break;case[$,E].includes(e.type):for(let d=0;d<e.schs.length;d++){let o=e.schs[d],c={path:`${r.path}[][${d}]`,level:r.level+1,index:d,parent:l(e,r)};if(o=R(o,t,c),e.schs[d]=o,o._halt)return Object.assign(e,{_halt:!0})}break;case[S].includes(e.type):let n={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:l(e,r)},s=R(e.sch,t,n);if(e.sch=s,s._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Vr=(e,t,r)=>{let l={original:{},popped:[]},a=r.sort((n,s)=>s-n);return R(e,(n,s)=>{if(s.path!=t)return n;switch(n.type){case N:let d=a.map(o=>[o,n.order[o]]).filter(([o,c])=>c);for(let[o,c]of d)l.popped.unshift({k:c,sch:n.fields[c],index:o}),delete n.fields[c];for(let o of a)n.order.splice(o,1);break;case S:break;case $:for(let o of a)l.popped.unshift({k:o,sch:n.schs.splice(o,1)[0],index:o});n.schs.length==0&&n.schs.splice(0,0,A(K));break;case E:for(let o of a)l.popped.unshift({k:o,sch:n.schs.splice(o,1)[0],index:o});n.schs.length==0&&n.schs.splice(0,0,A(K));break;default:}return n}),l},Jr=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),$e=(e,t,r)=>{let l={original:{},inserted:[]},a=r.sort((s,d)=>s.index-d.index),n=(s,d)=>(s=Math.max(s,0),s=Math.min(s,d.length),s);return R(e,(s,d)=>{var o;if(d.path!=t)return s;switch(s.type){case N:let c=(o=e.taggedLevel)==null?void 0:o[d.level+1];for(let{k:f,sch:p,index:m}of a){for(f=f==0?"0":f,f=f||`${c||"key"}_${Math.floor(Date.now()/100)}`,f=`${f}`;s.fields[f];)f=`${f} \u2013`;m=n(m,s.order),s.fields[f]=A(p),s.order.splice(m,0,f),l.inserted.push({k:f,sch:s.fields[f],index:m})}break;case S:break;case $:for(let{k:f,sch:p,index:m}of a)m=n(m,s.schs),s.schs.splice(m,0,A(p)),l.inserted.push({k:f,sch:s.schs[m],index:m});break;case E:for(let{k:f,sch:p,index:m}of a)m=n(m,s.schs),s.schs.splice(m,0,A(p)),l.inserted.push({k:f,sch:s.schs[m],index:m});default:}return s}),l},ke=(e,{dstPath:t,startIndex:r=0},l)=>{let a=(o,c,f)=>G(o,c,(p,m)=>(p._pinId=f,p)),n=Symbol(t);a(e,t,n);let s=we(e,l,{dstPath:t});return Je(e,{dstPin:n,startIndex:r},s)},we=(e,t,r={})=>{let l={},a=Jr(Object.keys(t));for(let n of a){let s=t[n],d=f=>{var p;return(p=s.find(m=>m.index==f))==null?void 0:p.newK};if(r.dstPath&&s.filter(p=>r.dstPath.startsWith(p.id)).length!=0)continue;let c=Vr(e,n,s.map(f=>f.index)).popped.map(({k:f,sch:p,index:m})=>({k:d(m)||f,sch:()=>p}));l[n]=c}return l},Je=(e,{dstPin:t,dstPath:r,startIndex:l=0},a)=>{let n=(c,f)=>Q(c,(p,m)=>p._pinId==f,(p,m)=>(p._pinned=m,p));l=Math.max(l,0);let s={},d=Object.values(a).flatMap(c=>c).map((c,f)=>({...c,index:l+f}));if(t){let c=n(e,t);c&&(r=c._pinned.path)}let o=$e(e,r,d);return o.inserted.length!=0&&(s[r]=o.inserted),s},Xe=(e,{dstPath:t,startIndex:r=0},l)=>{let a=ze(e,l,{dstPath:t,startIndex:r});return Qe(e,{dstPath:t},a)},ze=(e,t,r={})=>Object.values(t).reduce((l,a)=>{let n=a.map(d=>d.id),s=[];Q(e,(d,o)=>(n.includes(o.path)&&(d._meta=o,s.unshift(d)),s.length==n.length),(d,o)=>d);for(let d of a){if(r.dstPath&&r.dstPath.startsWith(d.id))continue;let o=s.find(c=>c._meta.path==d.id);o&&l.unshift({k:d.key,sch:()=>Ee(o),index:r.startIndex+l.length,id:d.id})}return l},[]),Qe=(e,{dstPath:t},r)=>{let l={},a=$e(e,t,r);return a.inserted.length!=0&&(l[t]=a.inserted),l},ge=(e,t,r)=>G(e,t,(l,a)=>{let n=A(r);switch(!0){case n.type==L:case n.type==M:case n.type!=l.type:let{title:s,description:d,rw:o,required:c,$anchor:f,key:p}=l;return Object.assign(n,{metadata:{title:s,description:d,rw:o,required:c},$anchor:f,key:p}),n;default:return l}}),X=(e,t)=>Q(e,(r,l)=>l.path==t,(r,l)=>(r._meta=l,r)),G=(e,t,r)=>Q(e,(l,a)=>a.path==t,r),Q=(e,t,r)=>{let l;return R(e,(a,n)=>t(a,n)?(l=r(a,n),l._halt=!0,l):a),l&&delete l._halt,l};var ie=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var Rt=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,zr=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Qr=/<[a-z][^>]+$/i,Xr=/>[^<>]*$/,Zr=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,el=/\s+$/,It=(e,t)=>0<t--&&(Qr.test(e[t])||!Xr.test(e[t])&&It(e,t)),tl=(e,t,r)=>zr.test(t)?e:`<${t}${r.replace(el,"")}></${t}>`,Pt=(e,t,r)=>{let l=[],{length:a}=e;for(let s=1;s<a;s++){let d=e[s-1];l.push(Rt.test(d)&&It(e,s)?d.replace(Rt,(o,c,f)=>`${t}${s-1}=${f||'"'}${c}${f?"":'"'}`):`${d}<!--${t}${s-1}-->`)}l.push(e[a-1]);let n=l.join("").trim();return r?n:n.replace(Zr,tl)};var{isArray:Z}=Array,{indexOf:jt,slice:Oe}=[];var rl=1,Ut=111,ll=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},qt=(e,t)=>e.nodeType===Ut?1/t<0?t?ll(e):e.lastChild:t?e.valueOf():e.firstChild:e,Kt=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let l=Oe.call(t,0),a=l[0],n=l[r-1];return{ELEMENT_NODE:rl,nodeType:Ut,firstChild:a,lastChild:n,valueOf(){if(t.length!==r){let s=0;for(;s<r;)e.appendChild(l[s++])}return e}}};var Gt=(e,t,r,l,a)=>{let n=r.length,s=t.length,d=n,o=0,c=0,f=null;for(;o<s||c<d;)if(s===o){let p=d<n?c?l(r[c-1],-0).nextSibling:l(r[d-c],0):a;for(;c<d;)e.insertBefore(l(r[c++],1),p)}else if(d===c)for(;o<s;)(!f||!f.has(t[o]))&&e.removeChild(l(t[o],-1)),o++;else if(t[o]===r[c])o++,c++;else if(t[s-1]===r[d-1])s--,d--;else if(t[o]===r[d-1]&&r[c]===t[s-1]){let p=l(t[--s],-1).nextSibling;e.insertBefore(l(r[c++],1),l(t[o++],-1).nextSibling),e.insertBefore(l(r[--d],1),p),t[s]=r[d]}else{if(!f){f=new Map;let p=c;for(;p<d;)f.set(r[p],p++)}if(f.has(t[o])){let p=f.get(t[o]);if(c<p&&p<d){let m=o,y=1;for(;++m<s&&m<d&&f.get(t[m])===p+y;)y++;if(y>p-c){let x=l(t[o],0);for(;c<p;)e.insertBefore(l(r[c++],1),x)}else e.replaceChild(l(r[c++],1),l(t[o++],-1))}else o++}else e.removeChild(l(t[o++],-1))}return r};var Wt=e=>t=>{for(let r in t){let l=r==="role"?r:`aria-${r}`,a=t[r];a==null?e.removeAttribute(l):e.setAttribute(l,a)}},Bt=(e,t)=>{let r,l=!0,a=document.createAttributeNS(null,t);return n=>{r!==n&&(r=n,r==null?l||(e.removeAttributeNode(a),l=!0):(a.value=n,l&&(e.setAttributeNodeNS(a),l=!1)))}},Ft=(e,t,r)=>l=>{r!==!!l&&((r=!!l)?e.setAttribute(t,""):e.removeAttribute(t))},nl=({dataset:e})=>t=>{for(let r in t){let l=t[r];l==null?delete e[r]:e[r]=l}},Ht=(e,t)=>{let r,l=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(l=l.toLowerCase()),a=>{let n=Z(a)?a:[a,!1];r!==n[0]&&(r&&e.removeEventListener(l,r,n[1]),(r=n[0])&&e.addEventListener(l,r,n[1]))}},Yt=e=>t=>{typeof t=="function"?t(e):t.current=e},Vt=(e,t)=>t==="dataset"?nl(e):r=>{e[t]=r},Jt=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var il=function(e){"use strict";var t="fragment",r="template",l="content"in s(r),a=l?function(o){var c=s(r);return c.innerHTML=o,c.content}:function(o){var c=s(t),f=s(r),p=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(o)){var m=RegExp.$1;f.innerHTML="<table>"+o+"</table>",p=f.querySelectorAll(m)}else f.innerHTML=o,p=f.childNodes;return n(c,p),c};return function(c,f){return(f==="svg"?d:a)(c)};function n(o,c){for(var f=c.length;f--;)o.appendChild(c[0])}function s(o){return o===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",o)}function d(o){var c=s(t),f=s("div");return f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+o+"</svg>",n(c,f.firstChild.childNodes),c}}(document),Ze=il;var zt=({childNodes:e},t)=>e[t],Se=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(jt.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:Qt,importNode:Ae}=document;var Xt=Ae.length!=1,Zt=Xt?(e,t,r)=>Ae.call(document,Ze(e,t,r),!0):Ze,er=Xt?e=>Qt.call(document,e,1|128,null,!1):e=>Qt.call(document,e,1|128);var ae=(e,t,r)=>Gt(e.parentNode,t,r,qt,e),al=e=>{let t,r,l=[],a=n=>{switch(typeof n){case"string":case"number":case"boolean":t!==n&&(t=n,r?r.textContent=n:r=document.createTextNode(n),l=ae(e,l,[r]));break;case"object":case"undefined":if(n==null){t!=n&&(t=n,l=ae(e,l,[]));break}if(Z(n)){t=n,n.length===0?l=ae(e,l,[]):typeof n[0]=="object"?l=ae(e,l,n):a(String(n));break}"ELEMENT_NODE"in n&&t!==n&&(t=n,l=ae(e,l,n.nodeType===11?Oe.call(n.childNodes):[n]))}};return a},ol=(e,t)=>{switch(t[0]){case"?":return Ft(e,t.slice(1),!1);case".":return Vt(e,t.slice(1));case"o":if(t[1]==="n")return Ht(e,t)}switch(t){case"ref":return Yt(e);case"aria":return Wt(e)}return Bt(e,t)};function tr(e){let{type:t,path:r}=e,l=r.reduceRight(zt,this);return t==="node"?al(l):t==="attr"?ol(l,e.name):Jt(l)}var oe="is\xB5",rr=ie(new WeakMap),sl=/^(?:plaintext|script|style|textarea|title|xmp)$/i,ee=()=>({stack:[],entry:null,wire:null}),dl=(e,t)=>{let{content:r,updates:l}=cl(e,t);return{type:e,template:t,content:r,updates:l,wire:null}},fl=(e,t)=>{let r=Pt(t,oe,e==="svg"),l=Zt(r,e),a=er(l),n=[],s=t.length-1,d=0,o=`${oe}${d}`;for(;d<s;){let c=a.nextNode();if(!c)throw`bad template: ${r}`;if(c.nodeType===8)c.textContent===o&&(n.push({type:"node",path:Se(c)}),o=`${oe}${++d}`);else{for(;c.hasAttribute(o);)n.push({type:"attr",path:Se(c),name:c.getAttribute(o)}),c.removeAttribute(o),o=`${oe}${++d}`;sl.test(c.tagName)&&c.textContent.trim()===`<!--${o}-->`&&(c.textContent="",n.push({type:"text",path:Se(c)}),o=`${oe}${++d}`)}}return{content:l,nodes:n}},cl=(e,t)=>{let{content:r,nodes:l}=rr.get(t)||rr.set(t,fl(e,t)),a=Ae.call(document,r,!0),n=l.map(tr,a);return{content:a,updates:n}},se=(e,{type:t,template:r,values:l})=>{let{length:a}=l;lr(e,l,a);let{entry:n}=e;(!n||n.template!==r||n.type!==t)&&(e.entry=n=dl(t,r));let{content:s,updates:d,wire:o}=n;for(let c=0;c<a;c++)d[c](l[c]);return o||(n.wire=Kt(s))},lr=({stack:e},t,r)=>{for(let l=0;l<r;l++){let a=t[l];a instanceof De?t[l]=se(e[l]||(e[l]=ee()),a):Z(a)?lr(e[l]||(e[l]=ee()),a,a.length):e[l]=null}r<e.length&&e.splice(r)};function De(e,t,r){this.type=e,this.template=t,this.values=r}var{create:ul,defineProperties:pl}=Object,nr=e=>{let t=ie(new WeakMap),r=l=>(a,...n)=>se(l,{type:e,template:a,values:n});return pl((l,...a)=>new De(e,l,a),{for:{value(l,a){let n=t.get(l)||t.set(l,ul(null));return n[a]||(n[a]=r(ee()))}},node:{value:(l,...a)=>se(ee(),{type:e,template:l,values:a}).valueOf()}})},ir=ie(new WeakMap),Me=(e,t)=>{let r=typeof t=="function"?t():t,l=ir.get(e)||ir.set(e,ee()),a=r instanceof De?se(l,r):r;return a!==l.wire&&(l.wire=a,e.textContent="",e.appendChild(a.valueOf())),e},h=nr("html"),si=nr("svg");var ce=(e,t)=>JSON.stringify(e)==JSON.stringify(t),Le=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`};var ar=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),Ce(e,"title",t),Ce(e,"description",t),yl(e,"rw",["rw","r","w"],t),et(e,"required",t),ml(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},ml=(e,t)=>{e.type==N?Nl(e,t):e.type==S?vl(e,t):e.type==$?_l(e,t):e.type==E?El(e,t):e.type==P?hl(e,t):e.type==j?xl(e,t):e.type==U?Tl(e,t):e.type==H&&bl(e,t)},hl=(e,t)=>{$l(e,"pattern",t),q(e,"min",t,{min:0}),q(e,"max",t,{min:0}),de(e,t),Ce(e,"default",t,Object.assign(or(e,["min","max","pattern"]),{ignoreEmpty:!0}))},Tl=(e,t)=>{et(e,"default",t)},xl=(e,t)=>{Re(e,"min",t),Re(e,"max",t),q(e,"multipleOf",t),de(e,t),Re(e,"default",t,or(e,["min","max","multipleOf"]))},bl=(e,t)=>{wl(e,"default",t)},Nl=(e,t)=>{q(e,"min",t,{min:0}),q(e,"max",t,{min:0}),de(e,t)},vl=(e,t)=>{q(e,"min",t,{min:1}),q(e,"max",t,{min:1}),de(e,t),et(e,"unique",t)},_l=(e,t)=>{q(e,"min",t,{min:1}),q(e,"max",t,{min:1}),de(e,t)},El=(e,t)=>{},or=(e,t=[])=>{let r={};for(let l of t)(e.errors[l]||[]).length==0&&(typeof e.changes[l]=="number"?(e.changes[l]||e.changes[l]==0)&&(r[l]=e.changes[l]):r[l]=e.changes[l]);return r},Ce=(e,t,r,l={})=>{if(!r.hasOwnProperty(t)||l.ignoreEmpty&&r[t]=="")return;let a=r[t],n=2**18;(d=>new Blob([d]).size)(a)>n?g(e,t,`string size limit is ${Math.ceil(n/1024)} KB`):l.max&&a.length>l.max?g(e,t,`must be less than or equal ${l.max} length`):l.min&&a.length<l.min?g(e,t,`must be grater than or equal ${l.min} length`):l.pattern?new RegExp(l.pattern).test(a)||g(e,t,`must matche pattern ${l.pattern}`):e.changes[t]=a},et=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let l=kl(r[t]);l==null?g(e,t,"must be boolean"):e.changes[t]=l},Re=(e,t,r,l={})=>{if(!r.hasOwnProperty(t))return;let a=tt(r[t]);!a&&a!=0?g(e,t,"must be number"):l.min&&a<l.min?g(e,t,`must be greater than or equal ${l.min}`):l.max&&a>l.max?g(e,t,`must be less than than or equal ${l.max}`):l.multipleOf&&a%l.multipleOf!=0?g(e,t,`must be multiple of ${l.multipleOf}`):e.changes[t]=a},q=(e,t,r,l)=>{if(!r.hasOwnProperty(t))return;Re(e,t,r,l);let a=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?g(e,t,"must be integer number"):a>Number.MAX_SAFE_INTEGER?g(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):a<Number.MIN_SAFE_INTEGER&&g(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},$l=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(Ce(e,t,r),(e.errors[t]||[]).length==0))try{let l=r[t];if(l=="")return;e.changes[t]=new RegExp(l)}catch(l){g(e,t,"invalid regex")}},de=(e,t)=>{if(t.min&&t.max){let r=tt(t.min),l=tt(t.max);(r||r==0)&&(l||l==0)&&r>l&&(g(e,"min","min is greater than max"),g(e,"max","max is less than min"))}},wl=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?g(e,t,"must be null"):e.changes[t]=r[t])},yl=(e,t,r,l)=>{!l.hasOwnProperty(t)||(r.includes(l[t])?e.changes[t]=l[t]:g(e,t,"value must be r, w, or rw"))},g=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},tt=e=>sr(e,"number"),kl=e=>sr(e,"boolean");var sr=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=n=>["checkbox","radio"].includes(n.type)?n.checked:n.value,r=this.querySelector("form").elements,l={};for(let n=0;n<r.length;n++){let s=t(r[n]);!(r[n]instanceof HTMLTextAreaElement)&&s==""||(l[r[n].name]=s)}let a={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:l};this.dispatchEvent(new CustomEvent("sch-update",{detail:a,bubbles:!0}))}}});var Pe=(e,t,r)=>{try{Me(e,h.for(t)`
    <p>${gl(t.rootKey,t.path)||"-"} : <span>${t.type}</span></p>
    <form data-path="${t.path}" data-file="${t.rootKey}">
      ${Ie(t,"title",{keyDisplay:"Title"})}
      ${Ie(t,"description",{keyDisplay:"Description"})}
      ${Al(t)}
      ${Ol(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:"rw",keyDisplay:"Read / Write"})}
      ${Sl(t,"default",{keyDisplay:"Default",min:O(t,"min"),max:O(t,"max")})}
    </form>
  `)}catch(l){console.log(l)}},gl=(e,t)=>(t=t.substring(1,t.length-1).split("][").filter(r=>r!=""),t.splice(0,0,e),t.join(" / ")),fe=(e,t,r,l={})=>{var a;return h`
  <label class="${l.readonly&&`meta-box ${t} readonly`||`meta-box ${t}`}">
    <p class="l">${l.keyDisplay||t} ${l.readonly&&h`<span>· readonly</span>`}</p>
    ${r}
    ${(a=je(e,t))==null?void 0:a.map(n=>h`<p class="err">${n}</p>`)}
  </label>
  `},Ie=(e,t,r={})=>fe(e,t,h`
    <textarea name="${ue(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${je(e,t)&&"invalid"}" oninput="${Le}">${r.value||O(e,t)}</textarea>
  `,r),Ue=(e,t,r={})=>fe(e,t,h`
    <input type="number" name="${ue(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${r.min}" max="${r.max}" value="${r.value||O(e,t)}" ?readonly="${r.readonly}" class="${je(e,t)&&"invalid"}">
  `,r),W=(e,t,r={})=>fe(e,t,h`
    <input type="number" name="${ue(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${r.value||O(e,t)}" ?readonly="${r.readonly}" class="${je(e,t)&&"invalid"}">
  `,r),rt=(e,t,r={})=>fe(e,t,h`
    <input type="checkbox" name="${ue(e,t)}" ?disabled="${r.readonly}" ?checked="${r.value||O(e,t)}">
  `,r),Ol=(e,t,r={})=>fe(e,t,h`
    <select name="${ue(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([l,a])=>h`<option value="${l}" ?selected="${(r.selected||O(e,t))==l}">${a}</option>`)}
    </select>
  `,r),Sl=(e,t,r={})=>{switch(e.type){case U:return rt(e,t,r);case j:return Ue(e,t,r);case P:return Ie(e,t,r);default:return""}},ue=(e,t)=>t,O=(e,t)=>(e.metadata||{})[t],Al=e=>{let t;switch(e.type){case N:let r=0;for(let l of Object.keys(e.fields))O(e.fields[l],"required")&&r++;t=[W(e,"min",{keyDisplay:"Min Properties",value:r,readonly:!0}),W(e,"max",{keyDisplay:"Max Properties",value:Object.keys(e.fields).length,min:Math.max(O(e,"min")||0,0)})];break;case S:t=[W(e,"min",{keyDisplay:"Min Items",min:1,value:1,max:O(e,"max")}),W(e,"max",{keyDisplay:"Max Items",min:O(e,"min")}),rt(e,"unique",{keyDisplay:"Item uniqueness"})];break;case $:t=[W(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),W(e,"max",{keyDisplay:"Max Items",value:O(e,"max")||e.schs.length})];break;case P:t=[W(e,"min",{keyDisplay:"Min Length",min:0,max:O(e,"max")}),W(e,"max",{keyDisplay:"Max Length",min:Math.max(0,O(e,"min"))}),Ie(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case j:t=[Ue(e,"min",{keyDisplay:"Min",max:O(e,"max")}),Ue(e,"max",{keyDisplay:"Max",min:O(e,"min")}),Ue(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:O(e,"max")})];break;case _e:t=[];case U:t=[];case H:t=[];case E:t=[];case z:t=[];case L:t=[];case M:t=[];default:t=[]}return e._meta.parent.type==N&&e._meta.level>2&&t.push(rt(e,"required",{keyDisplay:"Required"})),t};var je=(e,t)=>e.errors&&e.errors[t];var cr=(e,t,r={})=>{try{let l=t._models||t.order.reduce((n,s)=>(n[t.fields[s].$anchor]=s,n),{}),a={level:1,tab:0,models:l,rootKey:t.key,taggedLevel:t.taggedLevel};a.rootLevel=a.level,Dl(e,{sch:t,ui:Object.assign(a,r.ui),path:t.path||"",key:t.key,parent:{type:t.type,level:a.level}})}catch(l){console.log(l)}},Dl=(e,t)=>Me(document.querySelector(e),h`
  <ul role="tree" aria-multiselectable="true" class="text-sm" tabindex="-1" aria-labelledby="${t.ui.taggedLevel[t.ui.level]+"_tree"}">
    ${pe(t)}
  </ul>
  ${null}
`);var pe=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Ml(e);case kt.includes(e.sch.type):return Ll(e);default:return Cl(e)}},Ml=e=>h.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h" id="${e.ui.taggedLevel[e.ui.level]+"_tree"}">
      ${lt(e.key)}
    </dfn>
    <ul data-group="${fr(e.sch)}" role="group">
      ${dr(e)}
    </ul>
  </li>`,Ll=e=>h.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${ur(Object.assign(e,{key:lt(e.key)}))}
      ${pr(e)}
      ${mr(e)}
    </dfn>
    <ul data-group="${fr(e.sch)}" role="group">
      ${dr(e)}
    </ul>
  </li>`,Cl=e=>h.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${ur(Object.assign(e,{key:lt(e.key)}))}
    ${pr(e)}
    ${mr(e)}
  </li>`,dr=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return h``;switch(!0){case[N].includes(e.sch.type):return Rl(e);case[$].includes(e.sch.type):return Il(e);case[S].includes(e.sch.type):return Pl(e);case[E].includes(e.sch.type):return jl(e);default:return h``}},Rl=e=>e.sch.order.map((t,r)=>pe({key:t,sch:e.sch.fields[t],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[${t}]`})),Il=e=>e.sch.schs.map((t,r)=>pe({key:r,sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Pl=e=>pe({key:0,sch:e.sch.sch,parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:0},path:`${e.path}[][${0}]`}),jl=e=>e.sch.schs.map((t,r)=>pe({key:"",sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),qe=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab}rem`,yr=(e,t,r)=>h`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="256" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${Le}"
  >${r}</textarea>`,ur=e=>e.ui.level==e.ui.rootLevel+1?Ul(e):ql(e),Ul=e=>h`
  <span class="def" style="${qe(e)}">
    ${Kl(e.sch,e.ui)}
  </span>
  <span class="k">${hr(e)}</span>
  <span class="s">=</span>
  `,ql=e=>{switch(!0){case e.parent.type==E:return h`
      <span class="" style="${qe(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==S:return h`
      <span class="k" style="${qe(e)}"></span>
      <span class="s">└</span>
      `;default:return h`
      <span class="k" style="${qe(e)}">
        ${hr(e)}
      </span >
      <span class="s">:</span>
    `}},hr=e=>e.sch.uiMode=="editKey"?yr("key-edit",e.parent.path,e.key):h`${e.key}`,pr=e=>e.ui.level==e.ui.rootLevel+1?Gl(e):Wl(e),Gl=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):h`<span class="t">${Tr(e)}</span>`,Wl=e=>h`<span class="t">${Tr(e)}</span>`,Tr=e=>e.sch.uiMode=="editType"?yr("type-edit",e.parent.path,Bl(e.sch,e.ui)):h`${xr(e.sch,e.ui)}`,Bl=(e,t)=>{switch(!0){case e.type==M:return JSON.stringify(e.const);case e.type==L:return t.models[e.$ref];default:return e.type}},xr=(e,t)=>{let r;switch(!0){case(e.type==N&&ce(e.fields,{})):r="{ any }";break;case e.type==N:r="{ \xA0 }";break;case e.type==S:r=h`[ ${xr(e.sch,t)} ]`;break;case e.type==$:r="( \xA0 )";break;case e.type==P:r="string";break;case e.type==j:r="number";break;case e.type==_e:r="integer";break;case e.type==U:r="bool";break;case e.type==H:r="null";break;case e.type==E:r="||";break;case e.type==z:r="any";break;case(e.type==L&&!!t.models[e.$ref]):r=h`<span class="ref">${e._text=t.models[e.$ref]}</span>`;break;case e.type==L:r=h`<span class="ref notfound" title="Ref type">${`${e._text} (#404)`}</span>`;break;case e.type==M:r=h`<span class="value" title="Value type">${JSON.stringify(e.const)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},lt=e=>e,fr=e=>{switch(!0){case[N].includes(e.type):return"keyed";case[$,E].includes(e.type):return"indexed";default:return"none"}},Kl=(e,t)=>{let r;switch(!0){case e.type==N:r="record";break;case e.type==S:r="list";break;case e.type==$:r="tuple";break;case e.type==E:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},mr=e=>{var r;let t;switch(!0){case(e.parent.type==N&&((r=e.sch.metadata)==null?void 0:r.required)):t=[h`<span class="m"> · required</span>`];break;default:t=[]}return t};var nt={};_t(nt,{clearClipboard:()=>le,createWalker:()=>br,findUnselectedNode:()=>Ge,reselectNodes:()=>me,selectMultiNode:()=>re,selectMultiNodeTo:()=>Ke,selectNode:()=>w,selectedGroupedByParent:()=>Y,toggleSelectNode:()=>_r});var I="aria-selected",br=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.hasAttribute(I)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),e),w=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,Nr(e),te(t),r.focus&&t.focus())},_r=(e,t)=>{e&&(e.tabIndex=-1),vr(t)},re=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(I)=="true"?vr(e):te(t),r.focus&&t.focus())},Nr=e=>{for(let t of e.querySelectorAll(`[${I}='true']`))it(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},at=(e,t,r,l={})=>{var s,d,o;let a=e._walker.currentNode,n=t();if(!!n){if(a==r)return(s=l.target)==null?void 0:s.call(null,r);(d=l.pre)==null||d.call(null,a,n),at(e,t,r,l),(o=l.post)==null||o.call(null,a,n)}},Ke=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,at(e,()=>e._walker.nextSibling(),r,{pre:(l,a)=>{re(l,a,{focus:!1})}}),e._walker.currentNode=r,te(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,te(r.parentNode.closest(`[${I}]`)),at(e,()=>e._walker.previousSibling(),r,{pre:(l,a)=>{re(l,a,{focus:!1})}}),it(r.parentNode.closest(`[${I}]`)),e._walker.currentNode=r,te(r),r.focus();break}},te=e=>{!e||(e.setAttribute(I,!0),e.tabIndex=0)},it=e=>{!e||(e.setAttribute(I,!1),e.tabIndex=-1)},vr=e=>(e==null?void 0:e.getAttribute(I))=="true"?it(e):te(e),Ge=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(I))=="true");return t},Fl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),me=(e,t,r={})=>{Nr(e);for(let l of Fl(Object.keys(t))){let a=t[l];if(l==""?l=e.querySelector("[id][aria-level]"):l=e.querySelector(`[id='${CSS.escape(l)}'][aria-level]`),!l)continue;let n=parseInt(l.getAttribute("aria-level")),s=l.querySelectorAll(`[aria-level='${n+1}'][role='treeitem']`);for(let d=0;d<a.length;d++){let o=a[d].index,c=s[o];if(!c)return;c.classList.add("item-pasted"),r.direction&&c.classList.add(r.direction),re(null,c,{focus:d==a.length-1}),e._walker.currentNode=c}}},Y=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${I}='true']`}`),l={};for(let a=0;a<r.length;a++){let n=r[a],s=n.parentNode.closest("[role='treeitem']");if(!s)break;n.index=n.index||parseInt(n.getAttribute("aria-posinset"))-1,l[s.id]=l[s.id]||[],l[s.id].push(n)}return l},le=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var st={};_t(st,{anchorsModels:()=>pt,createProjectStore:()=>Hl,getFileStore:()=>be,handleProjectContext:()=>zl,handleProjectRemote:()=>Yl,projectToStore:()=>Xl});var V="new",B="removed",J="moved",ye="order_changed",he="key_changed",Te="type_changed",ot="entry_changed",Er=(e,t,r={})=>{let l={},a=[];R(t,(n,s)=>(n._meta=s,Object.assign(l,{[n.$anchor]:n}),delete n._visit,n)),R(e,(n,s)=>{var o;n._meta=s;let d=l[n.$anchor];if(d){let c=n._meta.parent,f=d._meta.parent;f.$anchor!=c.$anchor&&(n._diff={[J]:{oldParent:f,newParent:c}}),ce(d.order,n.order)||(n._diff={[ye]:{oldOrder:d.order,newOrder:n.order}}),d.type!=n.type&&Object.assign(n._diff||(n._diff={}),{[Te]:{oldType:d.type,newType:n.type,parent:c}}),d.key!=n.key&&Object.assign(n._diff||(n._diff={}),{[he]:{oldKey:d.key,newKey:n.key,parent:c}}),d.isEntry!=n.isEntry&&Object.assign(n._diff||(n._diff={}),{[ot]:{oldIsEntry:d.isEntry,newIsEntry:n.isEntry,parent:c}}),n._diff&&a.push(n),d._visit=!0}else s.path.startsWith((o=s.parent.prune)==null?void 0:o.added)||(n._diff={[V]:{parent:s.parent}},a.push(n),Object.assign(s.parent,{prune:{added:s.path}}));return n});for(let n of Object.keys(l)){if(l[n]._visit)continue;let s=l[n]._meta,d=s.path;a.filter(c=>c._diff[B]&&d.startsWith(c._meta.path)).length==0&&(l[n]._diff={[B]:{parent:s.parent}},a.push(l[n]))}return a};var F="file",ne="project",Hl=()=>xe({taggedLevel:{1:ne,2:F,3:C},allowedSchs:[$r()],put:{pos:"prepend",onlyDst:{[F]:!0}}}),be=(e,t)=>{let r=X(e,`[${t}]`);return r.schMetas=e.schMetas,r},Yl=(e,t,r,l)=>{if(!ft(r.name))return;let a=u=>{for(let T of Object.keys(e.fields))if(e.fields[T].fields[u])return{file:e.fields[T],fmodelDst:e.fields[T].fields[u]}},n=u=>Q(e,(T,_)=>{if(e.taggedLevel[_.level]==C&&_.path!="")return u.startsWith(_.path)},(T,_)=>(T._meta=_,T)),s=Er(e,t),d={};d.files=[],d.fmodels=[],d.subfmodels=[];for(let u of s){let T=e.taggedLevel[u._meta.level];T==ne?d.project=u:T==F?d.files.push(u):T==C?d.fmodels.push(u):d.subfmodels.push(u)}let o={},c={},f={};if(d.project){let{fields:u,...T}=b(d.project);o.project=T}for(let u of d.files){let{fields:T,..._}=b(u);if(c.files||(c.files={}),f.files||(f.files={}),o.files||(o.files={}),c.fmodels||(c.fmodels={}),f.fmodels||(f.fmodels={}),u._diff[V]){c.files[u._meta.path]={..._,parentAnchor:u._diff[V].parent.$anchor};for(let D of Object.keys(T))c.fmodels[u.fields[D]._meta.path]={...T[D],parentAnchor:_.$anchor}}if(u._diff[B]){f.files[u._meta.path]={$anchor:_.$anchor,parentAnchor:u._diff[B].parent.$anchor};for(let D of Object.keys(T))f.fmodels[u.fields[D]._meta.path]={$anchor:T[D].$anchor,parentAnchor:_.$anchor}}(u._diff[ye]||u._diff[he])&&(o.files[u._meta.path]=_),u._diff[J]&&console.log("project does not permit as parent for moving items"),u._diff[Te]&&console.log("file type is always record, cannot be changed")}for(let u of d.fmodels){let T=b(u);if(o.files||(o.files={}),c.fmodels||(c.fmodels={}),f.fmodels||(f.fmodels={}),o.fmodels||(o.fmodels={}),u._diff[V]&&(c.fmodels[u._meta.path]={...T,parentAnchor:u._diff[V].parent.$anchor}),u._diff[B]&&(f.fmodels[u._meta.path]={$anchor:T.$anchor,parentAnchor:u._diff[B].parent.$anchor}),(u._diff[ye]||u._diff[he]||u._diff[Te]||u._diff[ot])&&(o.fmodels[u._meta.path]={...T,parentAnchor:u._meta.parent.$anchor}),u._diff[J]){let{oldParent:_,newParent:D}=u._diff[J];switch(e.taggedLevel[_.level]){case ne:console.log("fmodel cannot be moved from project as direct child");break;case F:var p=e.fields[_.key],{fields:m,...y}=b(p);o.files[p._meta.path]=y,f.fmodels[u._meta.path]={$anchor:u.$anchor,parentAnchor:y.$anchor};break;case C:var x=a(_.key),y=b(x.file);o.fmodels[x.fmodelDst._meta.path]={...b(x.fmodelDst),parentAnchor:y.$anchor};break;default:var v=n(_.path),x=a(v.key),y=b(x.file);o.fmodels[v._meta.path]={...b(v),parentAnchor:y.$anchor}}switch(e.taggedLevel[D.level]){case ne:console.log("fmodel cannot be moved to project as direct child");break;case F:var p=e.fields[D.key],{fields:m,...y}=b(p);o.files[p._meta.path]=y,c.fmodels[u._meta.path]={...T,parentAnchor:y.$anchor};break;case C:var x=a(D.key),y=b(x.file);o.fmodels[x.fmodelDst._meta.path]={...b(x.fmodelDst),parentAnchor:y.$anchor};break;default:var v=n(D.path),x=a(v.key),y=b(x.file);o.fmodels[v._meta.path]={...b(v),parentAnchor:y.$anchor}}}}for(let u of d.subfmodels){if(o.files||(o.files={}),c.fmodels||(c.fmodels={}),f.fmodels||(f.fmodels={}),o.fmodels||(o.fmodels={}),u._diff[V]||u._diff[B]||u._diff[ye]||u._diff[he]||u._diff[Te]){let T=n(u._meta.path),_=a(T.key),D=b(_.file);o.fmodels[T._meta.path]={...b(T),parentAnchor:D.$anchor}}if(u._diff[J]){let{oldParent:T,newParent:_}=u._diff[J];switch(e.taggedLevel[T.level]){case ne:console.log("subfmodel cannot be moved from project as direct child");break;case F:var p=e.fields[T.key],{fields:m,...y}=b(p);o.files[p._meta.path]=y,f.fmodels[u._meta.path]={$anchor:u.$anchor,parentAnchor:y.$anchor};break;case C:default:var v=n(T.path),x=a(v.key),y=b(x.file);o.fmodels[v._meta.path]={...b(v),parentAnchor:y.$anchor}}switch(e.taggedLevel[_.level]){case ne:console.log("subfmodel cannot be moved to project as direct child");break;case F:var v=n(u._meta.path),x=a(v.key),{fields:m,...y}=b(x.file);o.files[x.file._meta.path]=y,c.fmodels[u._meta.path]={...b(u),parentAnchor:y.$anchor};break;case C:default:var v=n(u._meta.path),x=a(v.key),y=b(x.file);o.fmodels[v._meta.path]={...b(v),parentAnchor:y.$anchor}}}}return console.log({changed:o,added:c,removed:f}),l({changed:o,added:c,removed:f})},zl=(e,t,r)=>{let l=t.closest("[data-tag='file']"),a=l==null?void 0:l.key;if(!!a){if(t.closest("[id='project']"))switch(!0){case dt(r.name):Vl(e,a);break;case We(r.name):let n=be(e,a);document.querySelector("[id='fmodel'] [role='tree']")._render(n);break}else if(t.closest("[id='fmodel']")){let n,s;switch(!0){case ut(r.name):if(n=be(e,a),t.dataset.tag!=C)return;Jl(e,(d,o)=>{o.path==`[${n.key}]${t.id}`?(e.entrypoints={},e.entrypoints[d.$anchor]={}):(delete d.isEntry,delete e.entrypoints[d.$anchor])}),s=document.querySelector("[id='fmodel'] [role='tree']"),s._render(n);break;case We(r.name):n=be(e,a),n._models=pt(e,n),s=document.querySelector("[id='fmodel'] [role='tree']"),s._render(n);break}}}},pt=(e,t)=>{let r={};for(let l of e.order){let a=e.fields[l];for(let n of a.order)r[a.fields[n].$anchor]=l!=t.key?`${l}.${n}`:n}return r},$r=()=>xe({taggedLevel:{1:F,2:C},addDefault:()=>xe(),entryable:[C]}),Ql=(e,t,r)=>{for(let l of e.fmodels)Object.assign(l.sch,{$anchor:l.anchor,type:l.type,key:l.key}),l.isEntry&&(l.sch.isEntry=l.isEntry,r.entrypoints[l.sch.$anchor]={}),t.fields[l.key]=l.sch;return t.key=e.key,t.order=e.order.filter(l=>t.fields[l]),t.$anchor=e.anchor,A(()=>t)},Xl=(e,t)=>{t.entrypoints={};for(let r of e.files)t.fields[r.key]=Ql(r,$r(),t);return t.key=e.key,t.order=e.order.filter(r=>t.fields[r]),t.$anchor=e.anchor,t.schMetas=e.allmeta,A(()=>t)},Vl=(e,t)=>{let r=be(e,t);if(r&&(r._models=pt(e,r),ct({store:r,target:"[id='fmodel']",metaSelector:"sch-meta"}),!window._treeClipboard)){let l=document.querySelector("[id='fmodel'] [role='tree']");l._aria.clearClipboard(l)}},Jl=(e,t)=>{for(let r of Object.keys(e.fields)){let l=e.fields[r];for(let a of Object.keys(l.fields)){let n=l.fields[a];t(n,{path:`[${l.key}][${n.key}]`})}}};var wr=[gt,Ye,Dt,Mt,Lt,K,Ot,St,At,()=>Ve('"json string"')],xe=(e={})=>{let t=A(Ye);return t.taggedLevel=e.taggedLevel,t.allowedSchs=e.allowedSchs||wr.map(r=>r()),e.tag&&(t._tag=e.tag),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.type==e.addDefault().type)&&e.addDefault()),e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),t};var dt=e=>[Or,Sr,kr,gr,Ar,Dr,mt,yt,ht,Ne].map(t=>t.name).includes(e),We=e=>[Tt,Ne,xt,bt].map(t=>t.name).includes(e),ft=e=>[Tt,Ne,xt,bt,yt,ht,Mr,Lr,Ne,Nt].map(t=>t.name).includes(e),ut=e=>[Nt].map(t=>t.name).includes(e),nn=()=>new Map([["shift-meta-ArrowUp",Zl],["shift-meta-ArrowDown",en],["shift-ArrowUp",tn],["shift-ArrowDown",rn],["meta-ArrowUp",kr],["meta-ArrowDown",gr],["ArrowUp",Or],["ArrowDown",Sr],["Home",Ar],["End",Dr],["shift-+",Tt],["Enter",ln],["shift-Enter",Cr],["Delete",Ne],["m",Nt],["meta-x",Rr],["meta-c",Ir],["meta-v",bt],["shift-alt-ArrowUp",yt],["shift-alt-ArrowDown",ht],["alt-ArrowUp",Mr],["alt-ArrowDown",Lr],["Escape",({tree:e})=>le(e)]]),on=(e,t={})=>function(r){an(r,this,e,t)};async function an(e,t,r,l){if(e.target instanceof HTMLTextAreaElement)return sn(e,t,r);let a=nn().get(Pr(e));if(!!a&&!(l.denyCmds||[]).includes(a.name)){switch(a({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t.renderSchMeta(),t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`)),r.currentNode=t._walker.currentNode,vt(t,t._walker.currentNode,a)}}var cn=()=>new Map([["Enter",xt]]),sn=(e,t,r)=>{let l=e.target,a=cn().get(Pr(e));!a||(a({tree:t,store:r},l),t.renderSchMeta(),vt(t,t._walker.currentNode,a))},fn=e=>function(t){return dn(t,this,e)};function dn(e,t,r){let l=t._walker.currentNode,a=e.target.closest("[role='treeitem']"),n=!t.querySelector("textarea");if(!!a){if(e.shiftKey||e.metaKey)switch(l.compareDocumentPosition(a)){case Node.DOCUMENT_POSITION_CONTAINS:return w(t,a);case Node.DOCUMENT_POSITION_CONTAINED_BY:return w(t,l);default:if(a.parentNode.closest("[role='treeitem']")!=l.parentNode.closest("[role='treeitem']"))return w(t,a)}e.shiftKey?Ke(t,l,a):e.metaKey?_r(l,t._walker.currentNode=a):(t._walker.currentNode=a,mt({tree:t},{notFocusIfTextArea:n}),r.currentNode=t._walker.currentNode,vt(t,a,mt)),t.renderSchMeta()}}var un=({tree:e,store:t})=>{let r=e.querySelectorAll("[id='fmodel'] [aria-selected='true']");if(r.length==1){let l=X(t,r[0].id);l.path=r[0].id,l.rootKey=e.querySelector(".root-item").key,l.metadata=t.schMetas[l.$anchor],Pe(e._metaContainer,l,t)}},Pr=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:l,key:a})=>{let n=[];return e&&n.push("shift"),(t||l)&&n.push("meta"),r&&n.push("alt"),a&&n.push(a),n.join("-")},vt=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}})),Zl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();Ke(e,t,r)},en=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();Ke(e,t,r)},tn=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();re(t,r)},rn=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();re(t,r)},kr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();w(e,t)},gr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();w(e,t)},Or=({tree:e})=>w(e,e._walker.previousNode()),Sr=({tree:e})=>w(e,e._walker.nextNode()),Ar=({tree:e})=>{for(;e._walker.parentNode(););w(e,e._walker.currentNode)},Dr=({tree:e})=>{for(;e._walker.nextNode(););w(e,e._walker.currentNode)},mt=({tree:e},t={})=>w(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),Tt=({tree:e,store:t})=>{var s;let r=e._walker.currentNode,l=X(t,r.id),a,n=l._addSchDefault||l.allowedSchs&&l.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!n||(((s=t.put)==null?void 0:s.pos)=="prepend"?a=0:a=Number.MAX_SAFE_INTEGER,$e(t,r.id,[{k:null,sch:()=>Ee(n),index:a}]),e._render(t),w(e,r))},ln=({tree:e,store:t})=>{var l,a;((a=(l=e._walker.currentNode.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:a.group)=="keyed"&&jr({tree:e,store:t,editMode:"editKey"})},Cr=({tree:e,store:t})=>{jr({tree:e,store:t,editMode:"editType"})},jr=({tree:e,store:t,editMode:r})=>{let l=e._walker.currentNode;G(t,l.id,(n,s)=>({...n,uiMode:r})),e._render(t);let a=e.querySelector("textarea");!a||(a._treeItem=l,a.onblur=n=>pn(e,t,a),a.focus())},pn=(e,t,r)=>{let l=G(t,r._treeItem.id,(a,n)=>Object.assign(a,{uiMode:"cancelled-edit"}));e._render(t),l&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),w(e,e._walker.currentNode))},xt=({tree:e,store:t},r)=>{r.id=="key-edit"?Ur(e,t,r,yn):r.id=="type-edit"&&Ur(e,t,r,mn)},Ur=(e,t,r,l)=>{let a=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),w(e,r._treeItem,{focus:!1});let n=l(e,t,r)||a.id;G(t,n,(s,d)=>Object.assign(s,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(n)}']`),w(e,e._walker.currentNode)},mn=(e,t,r)=>{let l=t.allowedSchs.find(s=>s.type==r.value),a=Object.keys(t._models).find(s=>t._models[s]==r.value),n=Ve(r.value);return l?ge(t,r._treeItem.id,()=>Ee(l)):a?ge(t,r._treeItem.id,()=>Ct(a)):n&&ge(t,r._treeItem.id,()=>n),e._walker.currentNode.id},yn=(e,t,r)=>{let l=Y(e),a=r.dataset.parentPath;l[r.dataset.parentPath]=l[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>({id:c.id,newK:r.value,index:c.index}));let n=l[r.dataset.parentPath][0].index,d=ke(t,{dstPath:a,startIndex:n},l)[a][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${d}]`},Ne=({tree:e,store:t})=>{let r=Ge(()=>e._walker.nextSibling())||Ge(()=>e._walker.previousSibling())||Ge(()=>e._walker.parentNode());we(t,Y(e)),e._render(t),w(e,r)},Nt=({tree:e,store:t})=>{var l;let r=e._walker.currentNode;!r||((l=t.entryable)==null?void 0:l.includes(r.dataset.tag))&&(G(t,r.id,(a,n)=>Object.assign(a,{isEntry:!0})),e._render(t),w(e,r))};var Rr=({store:e,tree:t})=>{le(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-cutting");let r=Y(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",storeKey:e.key,ops:l=>we(e,r,{dstPath:l}),selected:r}},Ir=({store:e,tree:t})=>{le(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-copying");let r=Y(t,{ops:".item-copying"});window._treeClipboard={type:"copy",storeKey:e.key,ops:l=>ze(e,r,{dstPath:l,startIndex:0}),selected:r}},bt=({tree:e,store:t,srcStore:r})=>{var a;let l=X(t,e._walker.currentNode.id);if(!![N,E,$].includes(l.type)&&!(((a=t.put)==null?void 0:a.onlyDst)&&!t.put.onlyDst[t.taggedLevel[l._meta.level]])&&window._treeClipboard){let n=e._walker.currentNode.id,{type:s,storeKey:d,ops:o,selected:c}=window._treeClipboard,f=c,p={};if(t.key==d)switch(s){case"copy":p=Xe(t,{dstPath:n},f);break;case"cut":p=ke(t,{dstPath:n},f);break}else switch(s){case"copy":let y=o(n);p=Qe(t,{dstPath:n},y);break;case"cut":let x=o(n);p=Je(t,{dstPath:n},x);break}let m=(y,x)=>{let v={};for(let u of Object.keys(x))u==l._meta.path?v[""]=x[u]:v[u]=x[u];y._render(l),le(y),me(y,v)};Object.keys(p).length!=0&&(l._tree?m(l._tree,p):(e._render(t),le(e),me(e,p)))}},yt=({tree:e,store:t})=>qr({tree:e,store:t,direction:"up"},r=>r[0].index),ht=({tree:e,store:t})=>qr({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),qr=({tree:e,store:t,direction:r},l)=>{let a=Y(e),n={};for(let s of Object.keys(a))n=Xe(t,{dstPath:s,startIndex:l(a[s])},{[s]:a[s]});Object.keys(n).length!=0&&(e._render(t),me(e,n,{direction:r}))},Mr=({tree:e,store:t})=>Kr({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),Lr=({tree:e,store:t})=>Kr({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),Kr=({tree:e,store:t,startIndex:r,direction:l})=>{let a=Y(e),n={};for(let s of Object.keys(a)){let d=a[s].sort((o,c)=>o.index-c.index);n=ke(t,{dstPath:s,startIndex:r(d[0].index)},a)}Object.keys(n).length!=0&&(e._render(t),me(e,n,{direction:l}))},Gr=({store:e,target:t,metaSelector:r,opts:l})=>{e.render=s=>cr(t,s,l||{}),e.render(e),e.schMetas||(e.schMetas={});let a=document.querySelector(`${t} [role='tree']`),n=document.querySelector(r);if(a){a._aria=nt,a._render=e.render,e._tree=a,br(a),a.onkeydown=on(e,l.treeKeyDownOpts),a.onclick=fn(e);let s=a._walker.nextNode(),d=e.currentNode||a._walker.nextNode()||s;return w(a,d,{focus:l.focus}),r&&(a._metaContainer=n),a.renderSchMeta=()=>un({tree:a,store:e}),a.renderSchMeta(),a}},hn=({store:e,target:t,metaSelector:r})=>{Gr({store:e,target:t,metaSelector:r,opts:{ui:{depthLimit:2,modelTypeText:(l,a)=>"file",typeText:(l,a)=>{if(l.type==N)return"record";if(l.type==M)return"value";if(l.type==$)return"tuple";if(l.type==E)return"union"},viewTypeTop:l=>""},treeKeyDownOpts:{denyCmds:[Cr,Ir,Rr].map(l=>l.name)},focus:!0}})},ct=({store:e,target:t,metaSelector:r})=>{Gr({store:e,target:t,metaSelector:r,opts:{ui:{modelTypeText:(l,a)=>l.isEntry?"entrypoint":"type"}}})},Tn=({store:e,detail:t,target:r})=>{let{path:l,attrs:a}=t,n=G(e,l,(s,d)=>ar(s,a));return e.render&&e.render(e),Object.assign(e.schMetas,{[n.$anchor]:n.metadata}),Pe(r.closest("sch-meta"),n,e),n};export{st as Project,wr as allSchs,xe as createTreeStore,hn as initFileView,ct as initModelView,dt as isContextSwitchedCmd,ft as isDiffableCmd,ut as isEntryChangedCmd,We as isModelChangedCmd,Tn as update};
/*! (c) Andrea Giammarchi - ISC */
