var Tl=Object.defineProperty;var Ht=(e,t)=>{for(var r in t)Tl(e,r,{get:t[r],enumerable:!0})};var Be,xl=new Uint8Array(16);function xt(){if(!Be&&(Be=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Be))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Be(xl)}var Yt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function bl(e){return typeof e=="string"&&Yt.test(e)}var Jt=bl;var $=[];for(var bt=0;bt<256;++bt)$.push((bt+256).toString(16).substr(1));function Nl(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=($[e[t+0]]+$[e[t+1]]+$[e[t+2]]+$[e[t+3]]+"-"+$[e[t+4]]+$[e[t+5]]+"-"+$[e[t+6]]+$[e[t+7]]+"-"+$[e[t+8]]+$[e[t+9]]+"-"+$[e[t+10]]+$[e[t+11]]+$[e[t+12]]+$[e[t+13]]+$[e[t+14]]+$[e[t+15]]).toLowerCase();if(!Jt(r))throw TypeError("Stringified UUID is invalid");return r}var zt=Nl;function El(e,t,r){e=e||{};var l=e.random||(e.rng||xt)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=l[n];return t}return zt(l)}var Nt=El;var E="record",k="list",A="tuple",K="string",q="number",He="integer",G="boolean",le="null",v="union",de="any",I="ref",W="value",Vt=[E,A,k,v],S="fmodel";var z=()=>({type:de}),Xt=()=>({type:K}),Qt=()=>({type:G}),Zt=()=>({type:q}),er=()=>({type:le}),Ye=()=>({type:E,fields:[]}),tr=()=>({type:k,sch:M(z)}),rr=()=>({type:A,schs:[M(z)]}),lr=()=>({type:v,schs:[M(z)]}),nr=e=>({type:I,$ref:e}),Je=e=>{try{return e=JSON.parse(e),e==null||[K,q,G].includes(typeof e)?{type:W,const:e}:!1}catch(t){return!1}},M=(e,t={})=>{let r=e();return r.$anchor||(r.$anchor=Nt()),t.force&&(r.$anchor=Nt()),r};var ze=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},{defineProperty:vl}=Object,ir=vl,F=(e,t,r)=>ir(e,t,{value:r,configurable:!0}),De=(e,t,r)=>ir(e,t,{value:r,configurable:!0,writable:!0});var Ve=e=>{let t=JSON.parse(JSON.stringify(e));return C(t,(r,l)=>M(()=>r,{force:!0})),t};var C=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,e=t(e,r),e._halt||e._pruned)return e;let l=({type:n,$anchor:a,key:o},{path:s,level:d,parent:{prune:c}})=>({level:d,type:n,$anchor:a,key:o,path:s,prune:c});switch(!0){case[E].includes(e.type):for(let o=e.fields.length-1;o>=0;o--){let s=e.fields[o],d=s.key,c={path:`${r.path}[${d}]`,level:r.level+1,index:o,parent:l(e,r)};if(s=C(s,t,c),s.index=o,e.fields[o]=s,s._halt)return Object.assign(e,{_halt:!0})}break;case[A,v].includes(e.type):for(let o=0;o<e.schs.length;o++){let s=e.schs[o],d={path:`${r.path}[][${o}]`,level:r.level+1,index:o,parent:l(e,r)};if(s=C(s,t,d),e.schs[o]=s,s._halt)return Object.assign(e,{_halt:!0})}break;case[k].includes(e.type):let n={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:l(e,r)},a=C(e.sch,t,n);if(e.sch=a,a._halt)return Object.assign(e,{_halt:!0});break;default:}return e},wl=(e,t,r)=>{let l={original:{},popped:[]},n=r.sort((a,o)=>o-a);return C(e,(a,o)=>{if(o.path!=t)return a;switch(a.type){case E:for(let s of n)l.popped.unshift({k:a.fields[s].key,sch:a.fields.splice(s,1)[0],index:s});break;case k:break;case A:for(let s of n)l.popped.unshift({k:s,sch:a.schs.splice(s,1)[0],index:s});a.schs.length==0&&a.schs.splice(0,0,M(z));break;case v:for(let s of n)l.popped.unshift({k:s,sch:a.schs.splice(s,1)[0],index:s});a.schs.length==0&&a.schs.splice(0,0,M(z));break;default:}return a}),l},gl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),Xe=(e,t,r)=>{let l={original:{},inserted:[]},n=r.sort((o,s)=>o.index-s.index),a=(o,s)=>(o=Math.max(o,0),o=Math.min(o,s.length),o);return C(e,(o,s)=>{var d;if(s.path!=t)return o;switch(o.type){case E:let c=(d=e.taggedLevel)==null?void 0:d[s.level+1];for(let{k:f,sch:u,index:m}of n){f=f==0?"0":f,f=f||`${c||"key"}_${Math.floor(Date.now()/100)}`,f=`${f}`;for(let h=0;h<o.fields.length;h++)if(o.fields[h].key==f)f=`${f} \u2013`;else continue;m=a(m,o.fields),o.fields.splice(m,0,M(u)),o.fields[m].key=f,l.inserted.push({k:o.fields[m].key,sch:o.fields[m],index:m})}break;case k:break;case A:for(let{k:f,sch:u,index:m}of n)m=a(m,o.schs),o.schs.splice(m,0,M(u)),l.inserted.push({k:f,sch:o.schs[m],index:m});break;case v:for(let{k:f,sch:u,index:m}of n)m=a(m,o.schs),o.schs.splice(m,0,M(u)),l.inserted.push({k:f,sch:o.schs[m],index:m});default:}return o}),l},Ze=(e,{dstPath:t,startIndex:r=0},l)=>{let n=(d,c,f)=>B(d,c,(u,m)=>(F(u,"_pinId",f),u)),a=Symbol(t);n(e,t,a);let o=Qe(e,l,{dstPath:t});return Et(e,{dstPin:a,startIndex:r},o)},Qe=(e,t,r={})=>{let l={},n=gl(Object.keys(t));for(let a of n){let o=t[a],s=f=>{var u;return(u=o.find(m=>m.index==f))==null?void 0:u.newK};if(r.dstPath&&o.filter(u=>r.dstPath.startsWith(u.id)).length!=0)continue;let c=wl(e,a,o.map(f=>f.index)).popped.map(({k:f,sch:u,index:m})=>({k:s(m)||f,sch:()=>u}));l[a]=c}return l},Et=(e,{dstPin:t,dstPath:r,startIndex:l=0},n)=>{let a=(c,f)=>fe(c,(u,m)=>u._pinId==f,(u,m)=>(F(u,"_pinned",m),u));l=Math.max(l,0);let o={},s=Object.values(n).flatMap(c=>c).map((c,f)=>({...c,index:l+f}));if(t){let c=a(e,t);c&&(r=c._pinned.path)}let d=Xe(e,r,s);return d.inserted.length!=0&&(o[r]=d.inserted),o},gt=(e,{dstPath:t,startIndex:r=0},l)=>{let n=vt(e,l,{dstPath:t,startIndex:r});return wt(e,{dstPath:t},n)},vt=(e,t,r={})=>Object.values(t).reduce((l,n)=>{let a=n.map(s=>s.id),o=[];fe(e,(s,d)=>(a.includes(d.path)&&(F(s,"_meta",d),o.unshift(s)),o.length==a.length),(s,d)=>s);for(let s of n){if(r.dstPath&&r.dstPath.startsWith(s.id))continue;let d=o.find(c=>c._meta.path==s.id);d&&l.unshift({k:s.key,sch:()=>Ve(d),index:r.startIndex+l.length,id:s.id})}return l},[]),wt=(e,{dstPath:t},r)=>{let l={},n=Xe(e,t,r);return n.inserted.length!=0&&(l[t]=n.inserted),l},et=(e,t,r)=>B(e,t,(l,n)=>{let a=M(r),{title:o,description:s,rw:d,required:c,$anchor:f,key:u}=l,m=a.type==I&&a.$ref!=l.$ref,h=a.type==W&&a.const!=l.const,w=a.type!=l.type;return a.$ref==f?l:w||h||m?Object.assign(a,{metadata:{title:o,description:s,rw:d,required:c},$anchor:f,key:u}):l}),ne=(e,t)=>fe(e,(r,l)=>l.path==t,(r,l)=>(F(r,"_meta",l),r)),B=(e,t,r)=>fe(e,(l,n)=>n.path==t,r),fe=(e,t,r)=>{let l;return C(e,(n,a)=>t(n,a)?(l=r(n,a),l._halt=!0,l):n),l&&delete l._halt,l};var At={};Ht(At,{clearClipboard:()=>H,collapseSelected:()=>Dt,createWalker:()=>or,expandSelected:()=>kt,findUnselectedNode:()=>Me,reselectNodes:()=>pe,selectMultiNode:()=>ie,selectMultiNodeTo:()=>Oe,selectNode:()=>b,selectedGroupedByParent:()=>V,toggleSelectNode:()=>cr});var L="aria-selected",tt="aria-expanded",or=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{var r;if(t.hasAttribute(L)){let l=(r=t.parentElement.closest(`[${tt}]`))==null?void 0:r.getAttribute(tt);return l&&l=="false"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}else return NodeFilter.FILTER_SKIP}},!1),e),b=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,ar(e),ue(t),r.focus&&t.focus())},cr=(e,t)=>{e&&(e.tabIndex=-1),sr(t)},ie=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(L)=="true"?sr(e):ue(t),r.focus&&t.focus())},ar=e=>{for(let t of e.querySelectorAll(`[${L}='true']`))_t(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},$t=(e,t,r,l={})=>{var o,s,d;let n=e._walker.currentNode,a=t();if(!!a){if(n==r)return(o=l.target)==null?void 0:o.call(null,r);(s=l.pre)==null||s.call(null,n,a),$t(e,t,r,l),(d=l.post)==null||d.call(null,n,a)}},Oe=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,$t(e,()=>e._walker.nextSibling(),r,{pre:(l,n)=>{ie(l,n,{focus:!1})}}),e._walker.currentNode=r,ue(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,ue(r.parentNode.closest(`[${L}]`)),$t(e,()=>e._walker.previousSibling(),r,{pre:(l,n)=>{ie(l,n,{focus:!1})}}),_t(r.parentNode.closest(`[${L}]`)),e._walker.currentNode=r,ue(r),r.focus();break}},ue=e=>{!e||(e.setAttribute(L,!0),e.tabIndex=0)},_t=e=>{!e||(e.setAttribute(L,!1),e.tabIndex=-1)},sr=e=>(e==null?void 0:e.getAttribute(L))=="true"?_t(e):ue(e),Me=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(L))=="true");return t},Al=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),pe=(e,t,r={})=>{ar(e);for(let l of Al(Object.keys(t))){let n=t[l];if(l==""?l=e.querySelector("[id][aria-level]"):l=e.querySelector(`[id='${CSS.escape(l)}'][aria-level]`),!l)continue;let a=parseInt(l.getAttribute("aria-level")),o=l.querySelectorAll(`[aria-level='${a+1}'][role='treeitem']`);for(let s=0;s<n.length;s++){let d=n[s].index,c=o[d];if(!c)return;c.classList.add("item-pasted"),r.direction&&c.classList.add(r.direction),ie(null,c,{focus:s==n.length-1}),e._walker.currentNode=c}}},V=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${L}='true']`}`),l={};for(let n=0;n<r.length;n++){let a=r[n],o=a.parentNode.closest("[role='treeitem']");if(!o)break;a.index=a.index||parseInt(a.getAttribute("aria-posinset"))-1,l[o.id]=l[o.id]||[],l[o.id].push(a)}return l},kt=e=>{let t=e.querySelectorAll(`[${L}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(tt,"true")},Dt=e=>{let t=e.querySelectorAll(`[${L}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(tt,"false")},H=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var Ot=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();Oe(e,t,r)},Mt=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();Oe(e,t,r)},St=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();ie(t,r)},Lt=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();ie(t,r)},me=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();b(e,t)},ye=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();b(e,t)},he=({tree:e})=>b(e,e._walker.previousNode()),Te=({tree:e})=>b(e,e._walker.nextNode()),xe=({tree:e})=>{for(;e._walker.parentNode(););b(e,e._walker.nextNode()),b(e,e._walker.parentNode())},be=({tree:e})=>{for(;e._walker.nextNode(););b(e,e._walker.currentNode)},Ne=({tree:e},t={})=>b(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),Ct=({tree:e},t={})=>b(e,e._walker.currentNode),Ee=({tree:e,store:t})=>{var o;let r=e._walker.currentNode,l=ne(t,r.id),n,a=l._addSchDefault||l.allowedSchs&&l.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!a||(((o=t.put)==null?void 0:o.pos)=="prepend"?n=0:n=Number.MAX_SAFE_INTEGER,Xe(t,r.id,[{k:null,sch:()=>Ve(a),index:n}]),e._render(t),b(e,r))},Se=({tree:e,store:t})=>{var l,n;((n=(l=e._walker.currentNode.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:n.group)=="keyed"&&dr({tree:e,store:t,editMode:"editKey"})},rt=({tree:e,store:t})=>{dr({tree:e,store:t,editMode:"editType"})},dr=({tree:e,store:t,editMode:r})=>{let l=e._walker.currentNode,n=B(t,l.id,(o,s)=>De(o,"uiMode",r));e._render(t);let a=e.querySelector("textarea");!a||(a._treeItem=l,a.onblur=o=>o.relatedTarget&&_l(e,t,a),a.focus())},_l=(e,t,r)=>{let l=B(t,r._treeItem.id,(n,a)=>Object.assign(n,{uiMode:"cancelled-edit"}));e._render(t),l&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),b(e,e._walker.currentNode))},ve=({tree:e,store:t},r)=>{r.id=="key-edit"?fr(e,t,r,kl):r.id=="type-edit"&&fr(e,t,r,$l)},fr=(e,t,r,l)=>{let n=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),b(e,r._treeItem,{focus:!1});let a=l(e,t,r)||n.id;B(t,a,(o,s)=>Object.assign(o,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(a)}']`),b(e,e._walker.currentNode)},$l=(e,t,r)=>{let l=t.allowedSchs.find(o=>o.type==r.value),n=t._models[r.value]&&r.value||Object.keys(t._models).find(o=>t._models[o].display==r.value),a=Je(r.value);return l?et(t,r._treeItem.id,()=>Ve(l)):n?et(t,r._treeItem.id,()=>nr(n)):a&&et(t,r._treeItem.id,()=>a),e._walker.currentNode.id},kl=(e,t,r)=>{let l=V(e),n=r.dataset.parentPath;l[r.dataset.parentPath]=l[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>({id:c.id,newK:r.value,index:c.index}));let a=l[r.dataset.parentPath][0].index,s=Ze(t,{dstPath:n,startIndex:a},l)[n][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${s}]`},X=({tree:e,store:t})=>{let r=Me(()=>e._walker.nextSibling())||Me(()=>e._walker.previousSibling())||Me(()=>e._walker.parentNode());Qe(t,V(e)),e._render(t),b(e,r)},we=({tree:e,store:t})=>{var l;let r=e._walker.currentNode;!r||((l=t.entryable)==null?void 0:l.includes(r.dataset.tag))&&(B(t,r.id,(n,a)=>Object.assign(n,{isEntry:!0})),e._render(t),b(e,r))};var ur=({store:e,tree:t})=>{H(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-cutting");let r=V(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",srcStoreKey:e.key,ops:l=>Qe(e,r,{dstPath:l}),selected:r}},pr=({store:e,tree:t})=>{if(document.getSelection().toString().length!=0)return;H(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-copying");let r=V(t,{ops:".item-copying"});window._treeClipboard={type:"copy",srcStoreKey:e.key,ops:l=>vt(e,r,{dstPath:l,startIndex:0}),selected:r}},oe=({tree:e,store:t,srcStore:r})=>{var n;let l=ne(t,e._walker.currentNode.id);if(!![E,v,A].includes(l.type)&&!(((n=t.put)==null?void 0:n.onlyDst)&&!t.put.onlyDst[t.taggedLevel[l._meta.level]])&&window._treeClipboard){let a=e._walker.currentNode.id,{type:o,srcStoreKey:s,ops:d,selected:c}=window._treeClipboard,f=c,u={};if(t.key==s)switch(o){case"copy":u=gt(t,{dstPath:a},f);break;case"cut":u=Ze(t,{dstPath:a},f);break}else switch(o){case"copy":let h=d("");u=wt(t,{dstPath:a},h);break;case"cut":let w=d("");u=Et(t,{dstPath:a},w);break}let m=(h,w)=>{let O={};for(let x of Object.keys(w))x==l._meta.path?O[""]=w[x]:O[x]=w[x];h._render(l),H(h),pe(h,O)};Object.keys(u).length!=0&&(l._tree?m(l._tree,u):(e._render(t),H(e),pe(e,u)))}},ae=({tree:e,store:t})=>mr({tree:e,store:t,direction:"up"},r=>r[0].index),se=({tree:e,store:t})=>mr({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),mr=({tree:e,store:t,direction:r},l)=>{let n=V(e),a={};for(let o of Object.keys(n))a=gt(t,{dstPath:o,startIndex:l(n[o])},{[o]:n[o]});Object.keys(a).length!=0&&(e._render(t),pe(e,a,{direction:r}))},Le=({tree:e,store:t})=>yr({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),Ce=({tree:e,store:t})=>yr({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),yr=({tree:e,store:t,startIndex:r,direction:l})=>{let n=V(e),a={};for(let o of Object.keys(n)){let s=n[o].sort((d,c)=>d.index-c.index);a=Ze(t,{dstPath:o,startIndex:r(s[0].index)},n)}Object.keys(a).length!=0&&(e._render(t),pe(e,a,{direction:l}))},hr=({tree:e})=>kt(e),Tr=({tree:e})=>Dt(e);var{defineProperties:Dl}=Object,Rt=({store:e,target:t,view:r,treeKeyDownCmds:l,textAreaKeyDownCmd:n,opts:a={}})=>{var s;Dl(e,{render:{value:function(d){r(d||this)},configurable:!0},currentNode:{writable:!0,configurable:!0},_tree:{writable:!0,configurable:!0}}),e.render();let o=document.querySelector(`${t} [role='tree']`);if(o){o._aria=At,o._render=r,e._tree=o,or(o),o.onkeydown=Ol(e,l,{textAreaKeyDownCmd:n}),o.onclick=Ml(e);let d=o.querySelector(`[id='${CSS.escape(a.selectId)}']`);if(d&&a.selectId!="")o._walker.currentNode=d,b(o,o._walker.currentNode,{focus:a.focus});else{let c=o._walker.nextNode(),f=((s=e.currentNode)==null?void 0:s.isConnected)&&e.currentNode||o._walker.nextNode()||c;b(o,f,{focus:a.focus})}return o._walker.currentNode.scrollIntoView({block:"center"}),o}},Ol=(e,t,r)=>function(l){Sl(l,this,e,t,r)};async function Sl(e,t,r,l=[],n={}){if(e.stopPropagation(),e.target instanceof HTMLTextAreaElement)return Ll(e,t,r,n.textAreaKeyDownCmd);let o=new Map(l).get(xr(e));if(!!o&&!(n.denyCmds||[]).includes(o.name)){switch(o({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`)),r.currentNode=t._walker.currentNode,It(t,t._walker.currentNode,o)}}var Ll=(e,t,r,l=[])=>{e.stopPropagation();let n=e.target,o=new Map(l).get(xr(e));!o||(o({tree:t,store:r},n),r.currentNode=t._walker.currentNode,It(t,t._walker.currentNode,o))},Ml=e=>function(t){return Cl(t,this,e)};function Cl(e,t,r){e.stopPropagation();let l=t._walker.currentNode,n=e.target.closest("[role='treeitem']"),a=!t.querySelector("textarea");if(!!n){if(e.shiftKey||e.metaKey)switch(l.compareDocumentPosition(n)){case Node.DOCUMENT_POSITION_CONTAINS:return b(t,n);case Node.DOCUMENT_POSITION_CONTAINED_BY:return b(t,l);default:if(n.parentNode.closest("[role='treeitem']")!=l.parentNode.closest("[role='treeitem']"))return b(t,n)}e.shiftKey?(l!=n&&document.getSelection().removeAllRanges(),Oe(t,l,n)):e.metaKey?cr(l,t._walker.currentNode=n):(t._walker.currentNode=n,Ne({tree:t},{notFocusIfTextArea:a}),r.currentNode=t._walker.currentNode,It(t,n,Ne))}}var xr=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:l,key:n})=>{let a=[];return e&&a.push("shift"),(t||l)&&a.push("meta"),r&&a.push("alt"),n&&a.push(n),a.join("-")},It=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}}));var Re=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var br=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,Rl=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Il=/<[a-z][^>]+$/i,Pl=/>[^<>]*$/,jl=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,Ul=/\s+$/,Nr=(e,t)=>0<t--&&(Il.test(e[t])||!Pl.test(e[t])&&Nr(e,t)),Kl=(e,t,r)=>Rl.test(t)?e:`<${t}${r.replace(Ul,"")}></${t}>`,Er=(e,t,r)=>{let l=[],{length:n}=e;for(let o=1;o<n;o++){let s=e[o-1];l.push(br.test(s)&&Nr(e,o)?s.replace(br,(d,c,f)=>`${t}${o-1}=${f||'"'}${c}${f?"":'"'}`):`${s}<!--${t}${o-1}-->`)}l.push(e[n-1]);let a=l.join("").trim();return r?a:a.replace(jl,Kl)};var{isArray:ge}=Array,{indexOf:vr,slice:lt}=[];var ql=1,wr=111,Gl=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},gr=(e,t)=>e.nodeType===wr?1/t<0?t?Gl(e):e.lastChild:t?e.valueOf():e.firstChild:e,Ar=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let l=lt.call(t,0),n=l[0],a=l[r-1];return{ELEMENT_NODE:ql,nodeType:wr,firstChild:n,lastChild:a,valueOf(){if(t.length!==r){let o=0;for(;o<r;)e.appendChild(l[o++])}return e}}};var _r=(e,t,r,l,n)=>{let a=r.length,o=t.length,s=a,d=0,c=0,f=null;for(;d<o||c<s;)if(o===d){let u=s<a?c?l(r[c-1],-0).nextSibling:l(r[s-c],0):n;for(;c<s;)e.insertBefore(l(r[c++],1),u)}else if(s===c)for(;d<o;)(!f||!f.has(t[d]))&&e.removeChild(l(t[d],-1)),d++;else if(t[d]===r[c])d++,c++;else if(t[o-1]===r[s-1])o--,s--;else if(t[d]===r[s-1]&&r[c]===t[o-1]){let u=l(t[--o],-1).nextSibling;e.insertBefore(l(r[c++],1),l(t[d++],-1).nextSibling),e.insertBefore(l(r[--s],1),u),t[o]=r[s]}else{if(!f){f=new Map;let u=c;for(;u<s;)f.set(r[u],u++)}if(f.has(t[d])){let u=f.get(t[d]);if(c<u&&u<s){let m=d,h=1;for(;++m<o&&m<s&&f.get(t[m])===u+h;)h++;if(h>u-c){let w=l(t[d],0);for(;c<u;)e.insertBefore(l(r[c++],1),w)}else e.replaceChild(l(r[c++],1),l(t[d++],-1))}else d++}else e.removeChild(l(t[d++],-1))}return r};var $r=e=>t=>{for(let r in t){let l=r==="role"?r:`aria-${r}`,n=t[r];n==null?e.removeAttribute(l):e.setAttribute(l,n)}},kr=(e,t)=>{let r,l=!0,n=document.createAttributeNS(null,t);return a=>{r!==a&&(r=a,r==null?l||(e.removeAttributeNode(n),l=!0):(n.value=a,l&&(e.setAttributeNodeNS(n),l=!1)))}},Dr=(e,t,r)=>l=>{r!==!!l&&((r=!!l)?e.setAttribute(t,""):e.removeAttribute(t))},Wl=({dataset:e})=>t=>{for(let r in t){let l=t[r];l==null?delete e[r]:e[r]=l}},Or=(e,t)=>{let r,l=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(l=l.toLowerCase()),n=>{let a=ge(n)?n:[n,!1];r!==a[0]&&(r&&e.removeEventListener(l,r,a[1]),(r=a[0])&&e.addEventListener(l,r,a[1]))}},Mr=e=>t=>{typeof t=="function"?t(e):t.current=e},Sr=(e,t)=>t==="dataset"?Wl(e):r=>{e[t]=r},Lr=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var Fl=function(e){"use strict";var t="fragment",r="template",l="content"in o(r),n=l?function(d){var c=o(r);return c.innerHTML=d,c.content}:function(d){var c=o(t),f=o(r),u=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(d)){var m=RegExp.$1;f.innerHTML="<table>"+d+"</table>",u=f.querySelectorAll(m)}else f.innerHTML=d,u=f.childNodes;return a(c,u),c};return function(c,f){return(f==="svg"?s:n)(c)};function a(d,c){for(var f=c.length;f--;)d.appendChild(c[0])}function o(d){return d===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",d)}function s(d){var c=o(t),f=o("div");return f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+d+"</svg>",a(c,f.firstChild.childNodes),c}}(document),Pt=Fl;var Cr=({childNodes:e},t)=>e[t],nt=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(vr.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:Rr,importNode:it}=document;var Ir=it.length!=1,Pr=Ir?(e,t,r)=>it.call(document,Pt(e,t,r),!0):Pt,jr=Ir?e=>Rr.call(document,e,1|128,null,!1):e=>Rr.call(document,e,1|128);var Ie=(e,t,r)=>_r(e.parentNode,t,r,gr,e),Bl=e=>{let t,r,l=[],n=a=>{switch(typeof a){case"string":case"number":case"boolean":t!==a&&(t=a,r?r.textContent=a:r=document.createTextNode(a),l=Ie(e,l,[r]));break;case"object":case"undefined":if(a==null){t!=a&&(t=a,l=Ie(e,l,[]));break}if(ge(a)){t=a,a.length===0?l=Ie(e,l,[]):typeof a[0]=="object"?l=Ie(e,l,a):n(String(a));break}"ELEMENT_NODE"in a&&t!==a&&(t=a,l=Ie(e,l,a.nodeType===11?lt.call(a.childNodes):[a]))}};return n},Hl=(e,t)=>{switch(t[0]){case"?":return Dr(e,t.slice(1),!1);case".":return Sr(e,t.slice(1));case"o":if(t[1]==="n")return Or(e,t)}switch(t){case"ref":return Mr(e);case"aria":return $r(e)}return kr(e,t)};function Ur(e){let{type:t,path:r}=e,l=r.reduceRight(Cr,this);return t==="node"?Bl(l):t==="attr"?Hl(l,e.name):Lr(l)}var Pe="is\xB5",Kr=Re(new WeakMap),Yl=/^(?:plaintext|script|style|textarea|title|xmp)$/i,Ae=()=>({stack:[],entry:null,wire:null}),zl=(e,t)=>{let{content:r,updates:l}=Jl(e,t);return{type:e,template:t,content:r,updates:l,wire:null}},Vl=(e,t)=>{let r=Er(t,Pe,e==="svg"),l=Pr(r,e),n=jr(l),a=[],o=t.length-1,s=0,d=`${Pe}${s}`;for(;s<o;){let c=n.nextNode();if(!c)throw`bad template: ${r}`;if(c.nodeType===8)c.textContent===d&&(a.push({type:"node",path:nt(c)}),d=`${Pe}${++s}`);else{for(;c.hasAttribute(d);)a.push({type:"attr",path:nt(c),name:c.getAttribute(d)}),c.removeAttribute(d),d=`${Pe}${++s}`;Yl.test(c.tagName)&&c.textContent.trim()===`<!--${d}-->`&&(c.textContent="",a.push({type:"text",path:nt(c)}),d=`${Pe}${++s}`)}}return{content:l,nodes:a}},Jl=(e,t)=>{let{content:r,nodes:l}=Kr.get(t)||Kr.set(t,Vl(e,t)),n=it.call(document,r,!0),a=l.map(Ur,n);return{content:n,updates:a}},je=(e,{type:t,template:r,values:l})=>{let{length:n}=l;qr(e,l,n);let{entry:a}=e;(!a||a.template!==r||a.type!==t)&&(e.entry=a=zl(t,r));let{content:o,updates:s,wire:d}=a;for(let c=0;c<n;c++)s[c](l[c]);return d||(a.wire=Ar(o))},qr=({stack:e},t,r)=>{for(let l=0;l<r;l++){let n=t[l];n instanceof ot?t[l]=je(e[l]||(e[l]=Ae()),n):ge(n)?qr(e[l]||(e[l]=Ae()),n,n.length):e[l]=null}r<e.length&&e.splice(r)};function ot(e,t,r){this.type=e,this.template=t,this.values=r}var{create:Xl,defineProperties:Ql}=Object,Gr=e=>{let t=Re(new WeakMap),r=l=>(n,...a)=>je(l,{type:e,template:n,values:a});return Ql((l,...n)=>new ot(e,l,n),{for:{value(l,n){let a=t.get(l)||t.set(l,Xl(null));return a[n]||(a[n]=r(Ae()))}},node:{value:(l,...n)=>je(Ae(),{type:e,template:l,values:n}).valueOf()}})},Wr=Re(new WeakMap),at=(e,t)=>{let r=typeof t=="function"?t():t,l=Wr.get(e)||Wr.set(e,Ae()),n=r instanceof ot?je(l,r):r;return n!==l.wire&&(l.wire=n,e.textContent="",e.appendChild(n.valueOf())),e},y=Gr("html"),Gi=Gr("svg");var st={};Ht(st,{ENTRY_MARKED:()=>_e,MOVED:()=>P,NEW:()=>Q,NEW_KEY:()=>te,NEW_ORDER:()=>ee,NEW_TYPE:()=>j,REMOVED:()=>Z,buildBaseIndices:()=>Zl,diff:()=>en});var Q="new",Z="removed",P="moved",ee="order_changed",te="key_changed",j="type_changed",_e="entry_changed",Zl=e=>{let t={};C(e,(r,l)=>(F(r,"_meta",l),Object.assign(t,{[r.$anchor]:r}),delete r._visit,r)),e._indices=t},en=(e,t,r={})=>{let l=[],n=t._indices;C(e,(o,s)=>{var c;Object.defineProperty(o,"_diff",{value:{},writable:!0,configurable:!0});let d=n[o.$anchor];if(d){let f=s.parent,u=d._meta.parent;u.$anchor!=f.$anchor&&Object.assign(o._diff||(o._diff={}),{[P]:{oldParent:u,newParent:f,oldPath:d._meta.path,newPath:s.path}}),d.index!=o.index&&Object.assign(o._diff||(o._diff={}),{[ee]:{oldOrder:d.index,newOrder:o.index}}),d.type!=o.type&&Object.assign(o._diff||(o._diff={}),{[j]:{oldType:d.type,newType:o.type,parent:f}}),d.$ref!=o.$ref&&Object.assign(o._diff||(o._diff={}),{[j]:{oldType:d.$ref,newType:o.$ref,parent:f}}),d.const!=o.const&&Object.assign(o._diff||(o._diff={}),{[j]:{oldType:d.const,newType:o.const,parent:f}}),d.key!=o.key&&Object.assign(o._diff||(o._diff={}),{[te]:{oldKey:d.key,newKey:o.key,parent:f}}),d.isEntry!=o.isEntry&&Object.assign(o._diff||(o._diff={}),{[_e]:{oldIsEntry:d.isEntry,newIsEntry:o.isEntry,parent:f}}),o._diff&&(Object.defineProperty(o._diff,"meta",{value:{level:s.level,path:s.path,parentAnchor:s.parent.$anchor}}),l.push(o)),d._visit=!0}else s.path.startsWith((c=s.parent.prune)==null?void 0:c.added)||(o._diff={[Q]:{parent:s.parent}},Object.defineProperty(o._diff,"meta",{value:{level:s.level,path:s.path,parentAnchor:s.parent.$anchor}}),l.push(o),Object.assign(s.parent,{prune:{added:s.path}}));return o});let a=[];return C(t,(o,s)=>(o._visit||(o._diff={[Z]:{parent:s.parent}},Object.defineProperty(o._diff,"meta",{value:{level:s.level,path:s.path,parentAnchor:s.parent.$anchor,parentMeta:s.parentMeta}}),a.push(o),o._pruned=!0),o)),l=l.concat(a),l};var Fr=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),ct(e,"title",t),ct(e,"description",t),rn(e,"rw",["rw","r","w"],t),jt(e,"required",t),tn(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},tn=(e,t)=>{e.type==E?sn(e,t):e.type==k?cn(e,t):e.type==A?dn(e,t):e.type==v?fn(e,t):e.type==K?ln(e,t):e.type==q?on(e,t):e.type==G?nn(e,t):e.type==le&&an(e,t)},ln=(e,t)=>{un(e,"pattern",t),Y(e,"min",t,{min:0}),Y(e,"max",t,{min:0}),Ue(e,t),ct(e,"default",t,Object.assign(Br(e,["min","max","pattern"]),{ignoreEmpty:!0}))},nn=(e,t)=>{jt(e,"default",t)},on=(e,t)=>{dt(e,"min",t),dt(e,"max",t),Y(e,"multipleOf",t),Ue(e,t),dt(e,"default",t,Br(e,["min","max","multipleOf"]))},an=(e,t)=>{pn(e,"default",t)},sn=(e,t)=>{Y(e,"min",t,{min:0}),Y(e,"max",t,{min:0}),Ue(e,t)},cn=(e,t)=>{Y(e,"min",t,{min:1}),Y(e,"max",t,{min:1}),Ue(e,t),jt(e,"unique",t)},dn=(e,t)=>{Y(e,"min",t,{min:1}),Y(e,"max",t,{min:1}),Ue(e,t)},fn=(e,t)=>{},Br=(e,t=[])=>{let r={};for(let l of t)(e.errors[l]||[]).length==0&&(typeof e.changes[l]=="number"?(e.changes[l]||e.changes[l]==0)&&(r[l]=e.changes[l]):r[l]=e.changes[l]);return r},ct=(e,t,r,l={})=>{if(!r.hasOwnProperty(t)||l.ignoreEmpty&&r[t]=="")return;let n=r[t],a=2**18;(s=>new Blob([s]).size)(n)>a?D(e,t,`string size limit is ${Math.ceil(a/1024)} KB`):l.max&&n.length>l.max?D(e,t,`must be less than or equal ${l.max} length`):l.min&&n.length<l.min?D(e,t,`must be grater than or equal ${l.min} length`):l.pattern?new RegExp(l.pattern).test(n)||D(e,t,`must matche pattern ${l.pattern}`):e.changes[t]=n},jt=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let l=mn(r[t]);l==null?D(e,t,"must be boolean"):e.changes[t]=l},dt=(e,t,r,l={})=>{if(!r.hasOwnProperty(t))return;let n=Ut(r[t]);!n&&n!=0?D(e,t,"must be number"):l.min&&n<l.min?D(e,t,`must be greater than or equal ${l.min}`):l.max&&n>l.max?D(e,t,`must be less than than or equal ${l.max}`):l.multipleOf&&n%l.multipleOf!=0?D(e,t,`must be multiple of ${l.multipleOf}`):e.changes[t]=n},Y=(e,t,r,l)=>{if(!r.hasOwnProperty(t))return;dt(e,t,r,l);let n=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?D(e,t,"must be integer number"):n>Number.MAX_SAFE_INTEGER?D(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):n<Number.MIN_SAFE_INTEGER&&D(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},un=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(ct(e,t,r),(e.errors[t]||[]).length==0))try{let l=r[t];if(l=="")return;e.changes[t]=new RegExp(l)}catch(l){D(e,t,"invalid regex")}},Ue=(e,t)=>{if(t.min&&t.max){let r=Ut(t.min),l=Ut(t.max);(r||r==0)&&(l||l==0)&&r>l&&(D(e,"min","min is greater than max"),D(e,"max","max is less than min"))}},pn=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?D(e,t,"must be null"):e.changes[t]=r[t])},rn=(e,t,r,l)=>{!l.hasOwnProperty(t)||(r.includes(l[t])?e.changes[t]=l[t]:D(e,t,"value must be r, w, or rw"))},D=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},Ut=e=>Hr(e,"number"),mn=e=>Hr(e,"boolean");var Hr=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=a=>["checkbox","radio"].includes(a.type)?a.checked:a.value,r=this.querySelector("form").elements,l={};for(let a=0;a<r.length;a++){let o=t(r[a]);!(r[a]instanceof HTMLTextAreaElement)&&o==""||(l[r[a].name]=o)}let n={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:l};this.dispatchEvent(new CustomEvent("sch-update",{detail:n,bubbles:!0}))}}});var Kt=(e,t,r)=>{try{at(e,y.for(t)`
    <p class="meta-def">${yn(t.rootKey,t.path)||"-"} : <span>${t.type}</span></p>
    <form data-path="${t.path}" data-file="${t.rootKey}" class="fbox">
      ${ft(t,"title",{keyDisplay:"Title"})}
      ${ft(t,"description",{keyDisplay:"Description"})}
      ${xn(t)}
      ${hn(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:_(t,"rw")||"rw",keyDisplay:"Read / Write"})}
      ${Tn(t,"default",{keyDisplay:"Default",min:_(t,"min"),max:_(t,"max")})}
    </form>
  `)}catch(l){console.log(l),location.reload()}},yn=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(l=>l!=""),t.splice(0,0,e);let r=y`<span style="color: var(--meta-def-color);">${t[0]} :: ${t[1]}</span>`;return t=t.slice(2).flatMap(l=>[y`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(l)]),t.splice(0,0,r),t},Ke=(e,t,r,l={})=>{var n;return y`
  <label class="${l.readonly&&`box-label ${t} readonly`||`box-label ${t}`}">
    <p class="l">${l.keyDisplay||t} ${l.readonly&&y`<span>· readonly</span>`}</p>
    ${r}
    ${(n=ut(e,t))==null?void 0:n.map(a=>y`<p class="err">${a}</p>`)}
  </label>
  `},ft=(e,t,r={})=>Ke(e,t,y`
    <textarea name="${qe(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${ut(e,t)&&"invalid"}" oninput="${ze}">${r.value||_(e,t)}</textarea>
  `,r),pt=(e,t,r={})=>Ke(e,t,y`
    <input type="number" name="${qe(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${r.min}" max="${r.max}" value="${r.value||_(e,t)}" ?readonly="${r.readonly}" class="${ut(e,t)&&"invalid"}">
  `,r),re=(e,t,r={})=>Ke(e,t,y`
    <input type="number" name="${qe(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${r.value||_(e,t)}" ?readonly="${r.readonly}" class="${ut(e,t)&&"invalid"}">
  `,r),qt=(e,t,r={})=>Ke(e,t,y`
    <input type="checkbox" name="${qe(e,t)}" ?disabled="${r.readonly}" ?checked="${r.value||_(e,t)}">
  `,r),hn=(e,t,r={})=>Ke(e,t,y`
    <select name="${qe(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([l,n])=>y`<option value="${l}" ?selected="${(r.selected||_(e,t))==l}">${n}</option>`)}
    </select>
  `,r),Tn=(e,t,r={})=>{switch(e.type){case G:return qt(e,t,r);case q:return pt(e,t,r);case K:return ft(e,t,r);default:return""}},qe=(e,t)=>t,_=(e,t)=>(e.metadata||{})[t],xn=e=>{let t;switch(e.type){case E:let a=0;for(let o of e.fields)_(o,"required")&&a++;t=[re(e,"min",{keyDisplay:"Min Properties",value:a,readonly:!0}),re(e,"max",{keyDisplay:"Max Properties",value:e.fields.length,min:Math.max(_(e,"min")||0,0)})];break;case k:t=[re(e,"min",{keyDisplay:"Min Items",min:1,value:1,max:_(e,"max")}),re(e,"max",{keyDisplay:"Max Items",min:_(e,"min")}),qt(e,"unique",{keyDisplay:"Item uniqueness"})];break;case A:t=[re(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),re(e,"max",{keyDisplay:"Max Items",value:_(e,"max")||e.schs.length})];break;case K:t=[re(e,"min",{keyDisplay:"Min Length",min:0,max:_(e,"max")}),re(e,"max",{keyDisplay:"Max Length",min:Math.max(0,_(e,"min"))}),ft(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case q:t=[pt(e,"min",{keyDisplay:"Min",max:_(e,"max")}),pt(e,"max",{keyDisplay:"Max",min:_(e,"min")}),pt(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:_(e,"max")})];break;case He:t=[];case G:t=[];case le:t=[];case v:t=[];case de:t=[];case I:t=[];case W:t=[];default:t=[]}let r=e._meta.parent.type==E,l=e._meta.level>2,n=!e.isKeyPattern;return r&&l&&n&&t.push(qt(e,"required",{keyDisplay:"Required"})),t};var ut=(e,t)=>e.errors&&e.errors[t];var Gt=(e,t,r={})=>{var l;try{let n={level:1,tab:((l=r.ui)==null?void 0:l.tab)||0,models:t._models||{},schMetas:t.schMetas,rootKey:t.key,taggedLevel:t.taggedLevel};n.rootLevel=n.level,Object.assign(n,r.ui),r.ui.lineClass&&Object.assign(n,{tab:r.ui.tab+2}),bn(e,{sch:t,ui:n,path:t.path||"",key:t.key,parent:t})}catch(n){console.log(n)}},bn=(e,t)=>at(document.querySelector(e),y`
  <ul role="tree" aria-multiselectable="true" class="${t.ui.lineClass+" text-sm"}" aria-labelledby="${t.ui.taggedLevel[t.ui.level]+"_tree"}">
    ${Ge(t)}
  </ul>
`),Yr=e=>{if(!e)return"";for(let t of Object.keys(e))switch(t){case Q:return"N";case Z:return"R";case P:return"M";case ee:return"";case te:return"C";case j:return"C";case _e:return"C"}},Ge=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Nn(e);case[k].includes(e.sch.type):return Object.assign(e.ui,{expanded:!1}),Jr(e);case Vt.includes(e.sch.type):return Object.assign(e.ui,{expanded:!0}),Jr(e);default:return En(e)}},Nn=e=>y.for(e.parent,e.path)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" id="${e.ui.taggedLevel[e.ui.level]+"_tree"}">
      ${Wt(e.key)}
    </dfn>
    <ul data-group="${Vr(e.sch)}" role="group">
      ${zr(e)}
    </ul>
  </li>`,Jr=e=>y.for(e.parent,e.path)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" .dataset="${{diff:Yr(e.sch._diff),groupSize:vn(e.sch)}}">
      ${Xr(Object.assign(e,{key:Wt(e.key)}))}
      ${Qr(e)}
      ${Zr(e)}
    </dfn>
    <ul data-group="${Vr(e.sch)}" role="group">
      ${zr(e)}
    </ul>
  </li>`,En=e=>y.for(e.parent,e.path)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level],diff:Yr(e.sch._diff)}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${Xr(Object.assign(e,{key:Wt(e.key)}))}
    ${Qr(e)}
    ${Zr(e)}
  </li>`,zr=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return y``;switch(!0){case[E].includes(e.sch.type):return wn(e);case[A].includes(e.sch.type):return gn(e);case[k].includes(e.sch.type):return An(e);case[v].includes(e.sch.type):return _n(e);default:return y``}},wn=e=>{let t=[];for(let r=0;r<e.sch.fields.length;r++)t.push(Ge({key:e.sch.fields[r].key,sch:e.sch.fields[r],parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[${e.sch.fields[r].key}]`}));return t},gn=e=>{let t=[];for(let r=0;r<e.sch.schs.length;r++)t.push(Ge({key:r,sch:e.sch.schs[r],parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`}));return t},An=e=>Ge({key:0,sch:e.sch.sch,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:0,parentPath:e.path},path:`${e.path}[][${0}]`}),_n=e=>{let t=[];for(let r=0;r<e.sch.schs.length;r++)t.push(Ge({key:"",sch:e.sch.schs[r],parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`}));return t},mt=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab-1}rem`,el=(e,t,r)=>y`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${ze}"
  >${r}</textarea>`,Xr=e=>e.ui.level==e.ui.rootLevel+1?$n(e):kn(e),$n=e=>y`
  <span class="def" style="${mt(e)}">
    ${Dn(e.sch,e.ui)}
  </span>
  <span class="k">${tl(e)}</span>
  <span class="s">=</span>
  `,kn=e=>{switch(!0){case e.parent.type==v:return y`
      <span class="" style="${mt(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==k:return y`
      <span class="k" style="${mt(e)}"></span>
      <span class="s">└</span>
      `;default:return y`
      <span class="k" style="${mt(e)}">
        ${tl(e)}
      </span >
      <span class="s">:</span>
    `}},tl=e=>e.sch.uiMode=="editKey"?el("key-edit",e.ui.parentPath,e.key):y`${e.key}`,Qr=e=>e.ui.level==e.ui.rootLevel+1?On(e):Mn(e),On=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):y`<span class="t">${rl(e)}</span>`,Mn=e=>y`<span class="t">${rl(e)}</span>`,rl=e=>e.sch.uiMode=="editType"?y`<combo-box id="type_search" list="typesearch">
      ${el("type-edit",e.ui.parentPath,Ft(e.sch,e.ui))}
    </combo-box>`:y`${ll(e.sch,e.ui)}`,Ft=(e,t)=>{switch(!0){case e.type==W:return JSON.stringify(e.const);case e.type==I:return t.models[e.$ref].display;default:return e.type}},ll=(e,t)=>{let r;switch(!0){case(e.type==E&&e.fields.length==0):r="{ any }";break;case e.type==E:r="{ \xA0 }";break;case e.type==k:r=y`[ ${ll(e.sch,t)} ]`;break;case e.type==A:r="( \xA0 )";break;case e.type==K:r="string";break;case e.type==q:r="number";break;case e.type==He:r="integer";break;case e.type==G:r="bool";break;case e.type==le:r="null";break;case e.type==v:r="||";break;case e.type==de:r="any";break;case(e.type==I&&!!t.models[e.$ref]):r=y`<span class="ref">${e._text=Ft(e,t)}</span>`;break;case e.type==I:r=y`<span class="ref notfound" title="Ref type">${`${e._text||"reference"} (#404)`}</span>`;break;case e.type==W:r=y`<span class="value" title="Value type">${Ft(e,t)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},Wt=e=>e,Vr=e=>{switch(!0){case[E].includes(e.type):return"keyed";case[A,v].includes(e.type):return"indexed";default:return"none"}},vn=e=>{switch(!0){case[E].includes(e.type):return e.fields.length;case[A,v].includes(e.type):return e.schs.length;case[k].includes(e.type):return 1;default:return 0}},Dn=(e,t)=>{let r;switch(!0){case e.type==E:r="record";break;case e.type==k:r="list";break;case e.type==A:r="tuple";break;case e.type==v:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},Zr=e=>{let t=e.ui.schMetas[e.sch.$anchor],r;switch(!0){case(e.parent.type==E&&(t==null?void 0:t.required)):r=[y`<span class="m"> · required</span>`];break;default:r=[]}return r};var nl=({store:e,target:t,select:r})=>{Rt({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",Ot],["shift-meta-ArrowDown",Mt],["shift-ArrowUp",St],["shift-ArrowDown",Lt],["meta-ArrowUp",me],["meta-ArrowDown",ye],["ArrowUp",he],["ArrowDown",Te],["Home",xe],["End",be],["shift-+",Ee],["Enter",Se],["Delete",X],["m",we],["meta-v",oe],["shift-alt-ArrowUp",ae],["shift-alt-ArrowDown",se],["alt-ArrowUp",Le],["alt-ArrowDown",Ce],["Escape",({tree:l})=>H(l)]],textAreaKeyDownCmd:[["Enter",ve],["Escape",Ct]],view:l=>Gt(t,l||e,{ui:{depthLimit:2,tab:.25,modelTypeText:(n,a)=>"file",typeText:(n,a)=>{if(n.type==T.RECORD)return"record";if(n.type==T.VALUE)return"value";if(n.type==T.TUPLE)return"tuple";if(n.type==T.UNION)return"union"},viewTypeTop:n=>""}}),opts:{focus:!0,selectId:r}})},yt=({store:e,target:t,select:r})=>{Rt({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",Ot],["shift-meta-ArrowDown",Mt],["shift-ArrowUp",St],["shift-ArrowDown",Lt],["meta-ArrowUp",me],["meta-ArrowDown",ye],["ArrowUp",he],["ArrowDown",Te],["Home",xe],["End",be],["shift-+",Ee],["Enter",Se],["shift-Enter",rt],["Delete",X],["m",we],["meta-x",ur],["meta-c",pr],["meta-v",oe],["shift-alt-ArrowUp",ae],["shift-alt-ArrowDown",se],["alt-ArrowUp",Le],["alt-ArrowDown",Ce],["ArrowRight",hr],["ArrowLeft",Tr],["Escape",({tree:l})=>H(l)]],textAreaKeyDownCmd:[["Enter",ve],["Escape",Ct]],view:l=>Gt(t,l||e,{ui:{lineClass:"setnu",tab:1,modelTypeText:(n,a)=>n.isEntry?"entrypoint":"type"}}),opts:{selectId:r}})},ht=({store:e,target:t,treeTarget:r})=>{let l=document.querySelector(t),n=document.querySelector(`${r} [role='tree']`);!l||!n||(Object.defineProperty(e,"renderSchMeta",{value:function(a){Sn({tree:n,store:a||this,metaForm:l})},configurable:!0}),e.renderSchMeta())},Sn=({tree:e,store:t,metaForm:r})=>{let l=e.querySelectorAll("[role='treeitem'][aria-selected='true']");if(l.length==1){let n=ne(t,l[0].id);n&&(n.path=l[0].id,n.rootKey=e.querySelector(".root-item").key,n.metadata=t.schMetas[n.$anchor],Kt(r,n,t))}};var J="file",$e="project",ol=(e,t)=>{Object.assign(t,e);for(let r=0;r<e.fields.length;r++)t.fields[r]=Ln(e.fields[r],il(),t);return De(t,"schMetas",{}),M(()=>t)},Ln=(e,t,r)=>(Object.assign(t,e),M(()=>t)),sl=()=>al({taggedLevel:{1:$e,2:J,3:S},allowedSchs:[il],put:{pos:"prepend",onlyDst:{[J]:!0}}}),il=()=>al({taggedLevel:{1:J,2:S},addDefault:Ye,entryable:[S],put:{pos:"prepend"}}),al=(e={})=>{let t=M(Ye);return t.allowedSchs=(e.allowedSchs||Cn).map(r=>r()),t.taggedLevel=e.taggedLevel,e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.type==e.addDefault().type)&&e.addDefault()),t},ce=(e,t)=>{let r=ne(e,`[${t}]`);return r&&De(r,"schMetas",e.schMetas),r},We=e=>{let t={};return Bt(e,(r,l)=>{t[r.$anchor]={display:[l.file.key,r.key].join(" :: "),file:l.file.key,fmodel:r.key}}),t},Bt=(e,t)=>{for(let r of e.fields)for(let l=0;l<r.fields.length;l++)r.fields[l]=t(r.fields[l],{path:`[${r.key}][${r.fields[l].key}]`,file:r})||r.fields[l]},Cn=[Xt,Ye,tr,rr,lr,z,Qt,Zt,er,()=>Je('"json string"')];var cl=(e,t,r,l)=>{let n=t.closest("[data-tag='file']"),a=n==null?void 0:n.key;t.closest("[id='project']")?Rn(e,a,r,l):t.closest("[id='fmodel']")&&In(e,a,t,r,l)},Rn=(e,t,r,l)=>{switch(!0){case(t&&Pn(r.name)):Fe(e,t),e.render();break;case(t&&dl(r.name)):Fe(e,t),e.render();break;case(t&&jn(r.name)):Fe(e,t),e.render();break;default:e.render()}},In=(e,t,r,l,n)=>{let a;switch(!0){case Kn(l.name):if(r.dataset.tag!=S)return;Bt(e,(o,s)=>(s.path!=`[${t}]${r.id}`&&o.isEntry&&delete o.isEntry,o)),a=ce(e,t),a.render();break;case dl(l.name):a=ce(e,t),a._models=We(e),a.render();break;case Un(l.name):a=ce(e,t),a.render(),a.renderSchMeta()}},Fe=(e,t,r=null)=>{let l=ce(e,t);if(l&&(l._models=We(e),yt({store:l,target:"[id='fmodel']",select:r}),ht({store:l,target:"[id='fsch']",treeTarget:"[id='fmodel']"}),!window._treeClipboard)){let n=document.querySelector("[id='fmodel'] [role='tree']");n._aria.clearClipboard(n)}},fl={update:({store:e,detail:t})=>{let{path:r,attrs:l}=t,n=B(e,r,(a,o)=>Fr(a,l));return e.render&&e.render(e),Object.assign(e.schMetas,{[n.$anchor]:n.metadata}),e.renderSchMeta&&e.renderSchMeta(e),n}},Un=e=>[he,Te,me,ye,xe,be,Ne].map(t=>t.name).includes(e),Pn=e=>[he,Te,me,ye,xe,be,Ne,ae,se,X].map(t=>t.name).includes(e),dl=e=>[Ee,X,ve,oe].map(t=>t.name).includes(e),ul=e=>[Ee,X,ve,oe,ae,se,Le,Ce,X,we].map(t=>t.name).includes(e),Kn=e=>[we,oe,ae,se].map(t=>t.name).includes(e),jn=e=>[Se,rt].map(t=>t.name).includes(e);var pl=(e,t)=>{let r=x=>{for(let p of e.fields)for(let N of p.fields)if(x==N.key)return{file:p,fmodelDst:fmodel}},l=x=>fe(e,(p,N)=>{if(e.taggedLevel[N.level]==S&&N.path!="")return x.startsWith(N.path)},(p,N)=>(F(p,"_meta",N),p)),n=({$anchor:x,key:p,index:N,type:g})=>({$anchor:x,key:p,index:N,type:g}),a=x=>n(x),o=x=>x,s=e._diffToRemote,d={};d.files=[],d.fmodels=[],d.subfmodels=[];for(let x of s){let p=e.taggedLevel[x._diff.meta.level];p==$e?d.project=x:p==J?d.files.push(x):p==S?d.fmodels.push(x):d.subfmodels.push(x)}let c={},f={},u={};d.project&&(c.project=a(d.project));for(let x=0;x<d.files.length;x++){let p=d.files[x],N=n(p),g=p._diff.meta.path;if(f.files||(f.files={}),u.files||(u.files={}),c.files||(c.files={}),f.fmodels||(f.fmodels={}),u.fmodels||(u.fmodels={}),p._diff[Q]){f.files[g]=N;for(let U of p.fields)f.fmodels[`[${p.key}][${U.key}]`]={...o(U),parentAnchor:N.$anchor}}p._diff[Z]&&(u.files[g]={$anchor:N.$anchor}),(p._diff[ee]||p._diff[te])&&(c.files[g]=N),p._diff[P]&&console.log("project does not permit as parent for moving items"),p._diff[j]&&console.log("file type is always record, cannot be changed")}for(let x=0;x<d.fmodels.length;x++){let p=d.fmodels[x],N=o(p),g=p._diff.meta.path,U=p._diff.meta.parentAnchor;if(c.files||(c.files={}),f.fmodels||(f.fmodels={}),u.fmodels||(u.fmodels={}),c.fmodels||(c.fmodels={}),p._diff[Q]&&(f.fmodels[g]={...N,parentAnchor:U}),p._diff[Z]&&(u.fmodels[g]={$anchor:N.$anchor,parentAnchor:U}),(p._diff[ee]||p._diff[te]||p._diff[j]||p._diff[_e])&&(c.fmodels[g]={...N,parentAnchor:U}),p._diff[P]){let{oldParent:R,newParent:ke,oldPath:ml,newPath:yl}=p._diff[P];switch(e.taggedLevel[R.level]){case $e:console.log("fmodel was not possible to be a file");break;case J:var m=e.fields.find(hl=>hl.key==R.key),h=n(m);c.files[R.path]=h,u.fmodels[ml]={$anchor:p.$anchor,parentAnchor:h.$anchor};break;case S:var w=r(R.key),h=w.file;c.fmodels[R.path]={...o(w.fmodelDst),parentAnchor:h.$anchor};break;default:var O=l(R.path),w=r(O.key),h=w.file;c.fmodels[O._meta.path]={...o(O),parentAnchor:h.$anchor}}switch(e.taggedLevel[ke.level]){case J:var m=e.fields.find(Tt=>Tt.key==ke.key),h=n(m);c.files[ke.path]=h,f.fmodels[yl]={...N,parentAnchor:h.$anchor};break;default:console.log("fmodel parent can only be file tag")}}}for(let x=0;x<d.subfmodels.length;x++){let p=d.subfmodels[x],N=p._diff.meta.path;if(c.files||(c.files={}),f.fmodels||(f.fmodels={}),u.fmodels||(u.fmodels={}),c.fmodels||(c.fmodels={}),p._diff[Q]||p._diff[Z]||p._diff[ee]||p._diff[te]||p._diff[j]){let g=l(N),R=r(g.key).file;c.fmodels[g._meta.path]={...o(g),parentAnchor:R.$anchor}}if(p._diff[P]){let{oldParent:g,newParent:U,oldPath:R,newPath:ke}=p._diff[P];switch(e.taggedLevel[g.level]){case $e:console.log("subfmodel was not possible to be a file");break;case J:var m=e.fields.find(Tt=>Tt.key==g.key),h=n(m);c.files[g.path]=h,u.fmodels[R]={$anchor:p.$anchor,parentAnchor:h.$anchor};break;case S:default:var O=l(g.path),w=r(O.key),h=n(w.file);c.fmodels[O._meta.path]={...o(O),parentAnchor:h.$anchor}}switch(e.taggedLevel[U.level]){case $e:console.log("subfmodel parent can only be fmodel or subfmodel");break;case J:console.log("subfmodel parent can only be fmodel or subfmodel");break;case S:default:var O=l(ke),w=r(O.key),h=w.file;c.fmodels[O._meta.path]={...o(O),parentAnchor:h.$anchor}}}}return console.log({changed:c,added:f,removed:u}),t({changed:c,added:f,removed:u})};var qn={createProjectStore:sl,getFileStore:ce,anchorsModels:We,projectToStore:ol,controller:cl,changeFile:Fe,taggedDiff:pl,isDiffableCmd:ul,SchMeta:fl};export{st as Diff,yt as FmodelTree,qn as Project,nl as ProjectTree,ht as SchMetaForm};
/*! (c) Andrea Giammarchi - ISC */
