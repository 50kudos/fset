var Wr=Object.defineProperty;var Et=(e,t)=>{for(var r in t)Wr(e,r,{get:t[r],enumerable:!0})};var Ne,Br=new Uint8Array(16);function Fe(){if(!Ne&&(Ne=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Ne))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ne(Br)}var _t=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Fr(e){return typeof e=="string"&&_t.test(e)}var $t=Fr;var k=[];for(var He=0;He<256;++He)k.push((He+256).toString(16).substr(1));function Hr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase();if(!$t(r))throw TypeError("Stringified UUID is invalid");return r}var wt=Hr;function Yr(e,t,r){e=e||{};var l=e.random||(e.rng||Fe)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=l[a];return t}return wt(l)}var Ye=Yr;var N="record",O="list",_="tuple",I="string",P="number",ve="integer",j="boolean",B="null",E="union",J="any",M="ref",D="value",kt=[N,_,O,E],R="fmodel";var K=()=>({type:J}),gt=()=>({type:I}),Ot=()=>({type:j}),St=()=>({type:P}),At=()=>({type:B}),Ve=()=>({type:N,fields:{},order:[]}),Dt=()=>({type:O,sch:S(K)}),Mt=()=>({type:_,schs:[S(K)]}),Rt=()=>({type:E,schs:[S(K)]}),Lt=e=>({type:M,$ref:e}),Je=e=>{try{return e=JSON.parse(e),e==null||[I,P,j].includes(typeof e)?{type:D,const:e}:!1}catch(t){return!1}},S=(e,t={})=>{let r=e();return r.$anchor||(r.$anchor=Ye()),t.force&&(r.$anchor=Ye()),t.tag&&(r._tag=t.tag),r};var Ee=e=>{let t=JSON.parse(JSON.stringify(e));return L(t,(r,l)=>S(()=>r,{force:!0})),t},x=e=>L(JSON.parse(JSON.stringify(e)),(t,r)=>{let{type:l,$anchor:a,key:n,_tag:s,isEntry:d}=t,o={type:l,$anchor:a,key:n,_tag:s};switch(d&&Object.assign(o,{isEntry:d}),t.type){case N:let{fields:c,order:f}=t;return Object.assign(o,{fields:c,order:f});case _:case E:let{schs:p}=t;return Object.assign(o,{schs:p});case O:let{sch:m}=t;return Object.assign(o,{sch:m});case D:let{const:T}=t;return Object.assign(o,{const:T});case M:let{$ref:b}=t;return Object.assign(o,{$ref:b});default:return Object.assign(o,{})}}),L=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,e=t(e,r),e._halt)return e;let l=({_tag:a,type:n,$anchor:s,key:d},{path:o,level:c,parent:{prune:f}})=>({_tag:a,level:c,type:n,$anchor:s,key:d,path:o,prune:f});switch(!0){case[N].includes(e.type):let a=Object.keys(e.fields);for(let d=e.order.length-1;d>=0;d--){let o=e.order[d],c=e.fields[o],f={path:`${r.path}[${o}]`,level:r.level+1,index:d,parent:l(e,r)};if(c=L(c,t,f),c.key=o,e.fields[o]=c,c._halt)return Object.assign(e,{_halt:!0})}break;case[_,E].includes(e.type):for(let d=0;d<e.schs.length;d++){let o=e.schs[d],c={path:`${r.path}[][${d}]`,level:r.level+1,index:d,parent:l(e,r)};if(o=L(o,t,c),e.schs[d]=o,o._halt)return Object.assign(e,{_halt:!0})}break;case[O].includes(e.type):let n={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:l(e,r)},s=L(e.sch,t,n);if(e.sch=s,s._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Vr=(e,t,r)=>{let l={original:{},popped:[]},a=r.sort((n,s)=>s-n);return L(e,(n,s)=>{if(s.path!=t)return n;switch(n.type){case N:let d=a.map(o=>[o,n.order[o]]).filter(([o,c])=>c);for(let[o,c]of d)l.popped.unshift({k:c,sch:n.fields[c],index:o}),delete n.fields[c];for(let o of a)n.order.splice(o,1);break;case O:break;case _:for(let o of a)l.popped.unshift({k:o,sch:n.schs.splice(o,1)[0],index:o});n.schs.length==0&&n.schs.splice(0,0,S(K));break;case E:for(let o of a)l.popped.unshift({k:o,sch:n.schs.splice(o,1)[0],index:o});n.schs.length==0&&n.schs.splice(0,0,S(K));break;default:}return n}),l},Jr=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),_e=(e,t,r)=>{let l={original:{},inserted:[]},a=r.sort((s,d)=>s.index-d.index),n=(s,d)=>(s=Math.max(s,0),s=Math.min(s,d.length),s);return L(e,(s,d)=>{var o;if(d.path!=t)return s;switch(s.type){case N:let c=(o=e.taggedLevel)==null?void 0:o[d.level+1];for(let{k:f,sch:p,index:m}of a){for(f=f==0?"0":f,f=f||`${c||"key"}_${Math.floor(Date.now()/100)}`,f=`${f}`;s.fields[f];)f=`${f} \u2013`;m=n(m,s.order),s.fields[f]=S(p),s.order.splice(m,0,f),l.inserted.push({k:f,sch:s.fields[f],index:m})}break;case O:break;case _:for(let{k:f,sch:p,index:m}of a)m=n(m,s.schs),s.schs.splice(m,0,S(p)),l.inserted.push({k:f,sch:s.schs[m],index:m});break;case E:for(let{k:f,sch:p,index:m}of a)m=n(m,s.schs),s.schs.splice(m,0,S(p)),l.inserted.push({k:f,sch:s.schs[m],index:m});default:}return s}),l},we=(e,{dstPath:t,startIndex:r=0},l)=>{let a=(o,c,f)=>q(o,c,(p,m)=>(p._pinId=f,p)),n=Symbol(t);a(e,t,n);let s=$e(e,l,{dstPath:t});return ze(e,{dstPin:n,startIndex:r},s)},$e=(e,t,r={})=>{let l={},a=Jr(Object.keys(t));for(let n of a){let s=t[n],d=f=>{var p;return(p=s.find(m=>m.index==f))==null?void 0:p.newK};if(r.dstPath&&s.filter(p=>r.dstPath.startsWith(p.id)).length!=0)continue;let c=Vr(e,n,s.map(f=>f.index)).popped.map(({k:f,sch:p,index:m})=>({k:d(m)||f,sch:()=>p}));l[n]=c}return l},ze=(e,{dstPin:t,dstPath:r,startIndex:l=0},a)=>{let n=(c,f)=>z(c,(p,m)=>p._pinId==f,(p,m)=>(p._pinned=m,p));l=Math.max(l,0);let s={},d=Object.values(a).flatMap(c=>c).map((c,f)=>({...c,index:l+f}));if(t){let c=n(e,t);c&&(r=c._pinned.path)}let o=_e(e,r,d);return o.inserted.length!=0&&(s[r]=o.inserted),s},Ze=(e,{dstPath:t,startIndex:r=0},l)=>{let a=Qe(e,l,{dstPath:t,startIndex:r});return Xe(e,{dstPath:t},a)},Qe=(e,t,r={})=>Object.values(t).reduce((l,a)=>{let n=a.map(d=>d.id),s=[];z(e,(d,o)=>(n.includes(o.path)&&(d._meta=o,s.unshift(d)),s.length==n.length),(d,o)=>d);for(let d of a){if(r.dstPath&&r.dstPath.startsWith(d.id))continue;let o=s.find(c=>c._meta.path==d.id);o&&l.unshift({k:d.key,sch:()=>Ee(o),index:r.startIndex+l.length,id:d.id})}return l},[]),Xe=(e,{dstPath:t},r)=>{let l={},a=_e(e,t,r);return a.inserted.length!=0&&(l[t]=a.inserted),l},ke=(e,t,r)=>q(e,t,(l,a)=>{let n=S(r);switch(!0){case n.type==M:case n.type==D:case n.type!=l.type:let{title:s,description:d,rw:o,required:c,$anchor:f,key:p}=l;return Object.assign(n,{metadata:{title:s,description:d,rw:o,required:c},$anchor:f,key:p}),n;default:return l}}),Q=(e,t)=>z(e,(r,l)=>l.path==t,(r,l)=>(r._meta=l,r)),q=(e,t,r)=>z(e,(l,a)=>a.path==t,r),z=(e,t,r)=>{let l;return L(e,(a,n)=>t(a,n)?(l=r(a,n),l._halt=!0,l):a),l&&delete l._halt,l};var ne=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var Ct=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,zr=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Qr=/<[a-z][^>]+$/i,Xr=/>[^<>]*$/,Zr=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,el=/\s+$/,It=(e,t)=>0<t--&&(Qr.test(e[t])||!Xr.test(e[t])&&It(e,t)),tl=(e,t,r)=>zr.test(t)?e:`<${t}${r.replace(el,"")}></${t}>`,Pt=(e,t,r)=>{let l=[],{length:a}=e;for(let s=1;s<a;s++){let d=e[s-1];l.push(Ct.test(d)&&It(e,s)?d.replace(Ct,(o,c,f)=>`${t}${s-1}=${f||'"'}${c}${f?"":'"'}`):`${d}<!--${t}${s-1}-->`)}l.push(e[a-1]);let n=l.join("").trim();return r?n:n.replace(Zr,tl)};var{isArray:X}=Array,{indexOf:jt,slice:ge}=[];var rl=1,Ut=111,ll=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},Kt=(e,t)=>e.nodeType===Ut?1/t<0?t?ll(e):e.lastChild:t?e.valueOf():e.firstChild:e,qt=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let l=ge.call(t,0),a=l[0],n=l[r-1];return{ELEMENT_NODE:rl,nodeType:Ut,firstChild:a,lastChild:n,valueOf(){if(t.length!==r){let s=0;for(;s<r;)e.appendChild(l[s++])}return e}}};var Gt=(e,t,r,l,a)=>{let n=r.length,s=t.length,d=n,o=0,c=0,f=null;for(;o<s||c<d;)if(s===o){let p=d<n?c?l(r[c-1],-0).nextSibling:l(r[d-c],0):a;for(;c<d;)e.insertBefore(l(r[c++],1),p)}else if(d===c)for(;o<s;)(!f||!f.has(t[o]))&&e.removeChild(l(t[o],-1)),o++;else if(t[o]===r[c])o++,c++;else if(t[s-1]===r[d-1])s--,d--;else if(t[o]===r[d-1]&&r[c]===t[s-1]){let p=l(t[--s],-1).nextSibling;e.insertBefore(l(r[c++],1),l(t[o++],-1).nextSibling),e.insertBefore(l(r[--d],1),p),t[s]=r[d]}else{if(!f){f=new Map;let p=c;for(;p<d;)f.set(r[p],p++)}if(f.has(t[o])){let p=f.get(t[o]);if(c<p&&p<d){let m=o,T=1;for(;++m<s&&m<d&&f.get(t[m])===p+T;)T++;if(T>p-c){let b=l(t[o],0);for(;c<p;)e.insertBefore(l(r[c++],1),b)}else e.replaceChild(l(r[c++],1),l(t[o++],-1))}else o++}else e.removeChild(l(t[o++],-1))}return r};var Wt=e=>t=>{for(let r in t){let l=r==="role"?r:`aria-${r}`,a=t[r];a==null?e.removeAttribute(l):e.setAttribute(l,a)}},Bt=(e,t)=>{let r,l=!0,a=document.createAttributeNS(null,t);return n=>{r!==n&&(r=n,r==null?l||(e.removeAttributeNode(a),l=!0):(a.value=n,l&&(e.setAttributeNodeNS(a),l=!1)))}},Ft=(e,t,r)=>l=>{r!==!!l&&((r=!!l)?e.setAttribute(t,""):e.removeAttribute(t))},nl=({dataset:e})=>t=>{for(let r in t){let l=t[r];l==null?delete e[r]:e[r]=l}},Ht=(e,t)=>{let r,l=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(l=l.toLowerCase()),a=>{let n=X(a)?a:[a,!1];r!==n[0]&&(r&&e.removeEventListener(l,r,n[1]),(r=n[0])&&e.addEventListener(l,r,n[1]))}},Yt=e=>t=>{typeof t=="function"?t(e):t.current=e},Vt=(e,t)=>t==="dataset"?nl(e):r=>{e[t]=r},Jt=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var il=function(e){"use strict";var t="fragment",r="template",l="content"in s(r),a=l?function(o){var c=s(r);return c.innerHTML=o,c.content}:function(o){var c=s(t),f=s(r),p=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(o)){var m=RegExp.$1;f.innerHTML="<table>"+o+"</table>",p=f.querySelectorAll(m)}else f.innerHTML=o,p=f.childNodes;return n(c,p),c};return function(c,f){return(f==="svg"?d:a)(c)};function n(o,c){for(var f=c.length;f--;)o.appendChild(c[0])}function s(o){return o===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",o)}function d(o){var c=s(t),f=s("div");return f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+o+"</svg>",n(c,f.firstChild.childNodes),c}}(document),et=il;var zt=({childNodes:e},t)=>e[t],Oe=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(jt.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:Qt,importNode:Se}=document;var Xt=Se.length!=1,Zt=Xt?(e,t,r)=>Se.call(document,et(e,t,r),!0):et,er=Xt?e=>Qt.call(document,e,1|128,null,!1):e=>Qt.call(document,e,1|128);var ie=(e,t,r)=>Gt(e.parentNode,t,r,Kt,e),al=e=>{let t,r,l=[],a=n=>{switch(typeof n){case"string":case"number":case"boolean":t!==n&&(t=n,r?r.textContent=n:r=document.createTextNode(n),l=ie(e,l,[r]));break;case"object":case"undefined":if(n==null){t!=n&&(t=n,l=ie(e,l,[]));break}if(X(n)){t=n,n.length===0?l=ie(e,l,[]):typeof n[0]=="object"?l=ie(e,l,n):a(String(n));break}"ELEMENT_NODE"in n&&t!==n&&(t=n,l=ie(e,l,n.nodeType===11?ge.call(n.childNodes):[n]))}};return a},ol=(e,t)=>{switch(t[0]){case"?":return Ft(e,t.slice(1),!1);case".":return Vt(e,t.slice(1));case"o":if(t[1]==="n")return Ht(e,t)}switch(t){case"ref":return Yt(e);case"aria":return Wt(e)}return Bt(e,t)};function tr(e){let{type:t,path:r}=e,l=r.reduceRight(zt,this);return t==="node"?al(l):t==="attr"?ol(l,e.name):Jt(l)}var ae="is\xB5",rr=ne(new WeakMap),sl=/^(?:plaintext|script|style|textarea|title|xmp)$/i,Z=()=>({stack:[],entry:null,wire:null}),dl=(e,t)=>{let{content:r,updates:l}=cl(e,t);return{type:e,template:t,content:r,updates:l,wire:null}},fl=(e,t)=>{let r=Pt(t,ae,e==="svg"),l=Zt(r,e),a=er(l),n=[],s=t.length-1,d=0,o=`${ae}${d}`;for(;d<s;){let c=a.nextNode();if(!c)throw`bad template: ${r}`;if(c.nodeType===8)c.textContent===o&&(n.push({type:"node",path:Oe(c)}),o=`${ae}${++d}`);else{for(;c.hasAttribute(o);)n.push({type:"attr",path:Oe(c),name:c.getAttribute(o)}),c.removeAttribute(o),o=`${ae}${++d}`;sl.test(c.tagName)&&c.textContent.trim()===`<!--${o}-->`&&(c.textContent="",n.push({type:"text",path:Oe(c)}),o=`${ae}${++d}`)}}return{content:l,nodes:n}},cl=(e,t)=>{let{content:r,nodes:l}=rr.get(t)||rr.set(t,fl(e,t)),a=Se.call(document,r,!0),n=l.map(tr,a);return{content:a,updates:n}},oe=(e,{type:t,template:r,values:l})=>{let{length:a}=l;lr(e,l,a);let{entry:n}=e;(!n||n.template!==r||n.type!==t)&&(e.entry=n=dl(t,r));let{content:s,updates:d,wire:o}=n;for(let c=0;c<a;c++)d[c](l[c]);return o||(n.wire=qt(s))},lr=({stack:e},t,r)=>{for(let l=0;l<r;l++){let a=t[l];a instanceof Ae?t[l]=oe(e[l]||(e[l]=Z()),a):X(a)?lr(e[l]||(e[l]=Z()),a,a.length):e[l]=null}r<e.length&&e.splice(r)};function Ae(e,t,r){this.type=e,this.template=t,this.values=r}var{create:ul,defineProperties:pl}=Object,nr=e=>{let t=ne(new WeakMap),r=l=>(a,...n)=>oe(l,{type:e,template:a,values:n});return pl((l,...a)=>new Ae(e,l,a),{for:{value(l,a){let n=t.get(l)||t.set(l,ul(null));return n[a]||(n[a]=r(Z()))}},node:{value:(l,...a)=>oe(Z(),{type:e,template:l,values:a}).valueOf()}})},ir=ne(new WeakMap),De=(e,t)=>{let r=typeof t=="function"?t():t,l=ir.get(e)||ir.set(e,Z()),a=r instanceof Ae?oe(l,r):r;return a!==l.wire&&(l.wire=a,e.textContent="",e.appendChild(a.valueOf())),e},y=nr("html"),si=nr("svg");var se=(e,t)=>JSON.stringify(e)==JSON.stringify(t),Me=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`};var ar=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),Re(e,"title",t),Re(e,"description",t),yl(e,"rw",["rw","r","w"],t),tt(e,"required",t),ml(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},ml=(e,t)=>{e.type==N?Nl(e,t):e.type==O?vl(e,t):e.type==_?El(e,t):e.type==E?_l(e,t):e.type==I?hl(e,t):e.type==P?xl(e,t):e.type==j?Tl(e,t):e.type==B&&bl(e,t)},hl=(e,t)=>{$l(e,"pattern",t),U(e,"min",t,{min:0}),U(e,"max",t,{min:0}),ce(e,t),Re(e,"default",t,Object.assign(or(e,["min","max","pattern"]),{ignoreEmpty:!0}))},Tl=(e,t)=>{tt(e,"default",t)},xl=(e,t)=>{Le(e,"min",t),Le(e,"max",t),U(e,"multipleOf",t),ce(e,t),Le(e,"default",t,or(e,["min","max","multipleOf"]))},bl=(e,t)=>{wl(e,"default",t)},Nl=(e,t)=>{U(e,"min",t,{min:0}),U(e,"max",t,{min:0}),ce(e,t)},vl=(e,t)=>{U(e,"min",t,{min:1}),U(e,"max",t,{min:1}),ce(e,t),tt(e,"unique",t)},El=(e,t)=>{U(e,"min",t,{min:1}),U(e,"max",t,{min:1}),ce(e,t)},_l=(e,t)=>{},or=(e,t=[])=>{let r={};for(let l of t)(e.errors[l]||[]).length==0&&(typeof e.changes[l]=="number"?(e.changes[l]||e.changes[l]==0)&&(r[l]=e.changes[l]):r[l]=e.changes[l]);return r},Re=(e,t,r,l={})=>{if(!r.hasOwnProperty(t)||l.ignoreEmpty&&r[t]=="")return;let a=r[t],n=2**18;(d=>new Blob([d]).size)(a)>n?g(e,t,`string size limit is ${Math.ceil(n/1024)} KB`):l.max&&a.length>l.max?g(e,t,`must be less than or equal ${l.max} length`):l.min&&a.length<l.min?g(e,t,`must be grater than or equal ${l.min} length`):l.pattern?new RegExp(l.pattern).test(a)||g(e,t,`must matche pattern ${l.pattern}`):e.changes[t]=a},tt=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let l=kl(r[t]);l==null?g(e,t,"must be boolean"):e.changes[t]=l},Le=(e,t,r,l={})=>{if(!r.hasOwnProperty(t))return;let a=rt(r[t]);!a&&a!=0?g(e,t,"must be number"):l.min&&a<l.min?g(e,t,`must be greater than or equal ${l.min}`):l.max&&a>l.max?g(e,t,`must be less than than or equal ${l.max}`):l.multipleOf&&a%l.multipleOf!=0?g(e,t,`must be multiple of ${l.multipleOf}`):e.changes[t]=a},U=(e,t,r,l)=>{if(!r.hasOwnProperty(t))return;Le(e,t,r,l);let a=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?g(e,t,"must be integer number"):a>Number.MAX_SAFE_INTEGER?g(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):a<Number.MIN_SAFE_INTEGER&&g(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},$l=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(Re(e,t,r),(e.errors[t]||[]).length==0))try{let l=r[t];if(l=="")return;e.changes[t]=new RegExp(l)}catch(l){g(e,t,"invalid regex")}},ce=(e,t)=>{if(t.min&&t.max){let r=rt(t.min),l=rt(t.max);(r||r==0)&&(l||l==0)&&r>l&&(g(e,"min","min is greater than max"),g(e,"max","max is less than min"))}},wl=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?g(e,t,"must be null"):e.changes[t]=r[t])},yl=(e,t,r,l)=>{!l.hasOwnProperty(t)||(r.includes(l[t])?e.changes[t]=l[t]:g(e,t,"value must be r, w, or rw"))},g=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},rt=e=>sr(e,"number"),kl=e=>sr(e,"boolean");var sr=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=n=>["checkbox","radio"].includes(n.type)?n.checked:n.value,r=this.querySelector("form").elements,l={};for(let n=0;n<r.length;n++){let s=t(r[n]);!(r[n]instanceof HTMLTextAreaElement)&&s==""||(l[r[n].name]=s)}let a={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:l};this.dispatchEvent(new CustomEvent("sch-update",{detail:a,bubbles:!0}))}}});var Ie=(e,t,r)=>{try{De(e,y.for(t)`
    <p>${gl(t.rootKey,t.path)||"-"} : <span>${t.type}</span></p>
    <form data-path="${t.path}" data-file="${t.rootKey}">
      ${Ce(t,"title",{keyDisplay:"Title"})}
      ${Ce(t,"description",{keyDisplay:"Description"})}
      ${Al(t)}
      ${Ol(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:"rw",keyDisplay:"Read / Write"})}
      ${Sl(t,"default",{keyDisplay:"Default"})}
    </form>
  `)}catch(l){console.log(l)}},gl=(e,t)=>(t=t.substring(1,t.length-1).split("][").filter(r=>r!=""),t.splice(0,0,e),t.join(" / ")),de=(e,t,r,l={})=>{var a;return y`
  <label class="${l.readonly&&`meta-box ${t} readonly`||`meta-box ${t}`}">
    <p class="l">${l.keyDisplay||t} ${l.readonly&&y`<span>· readonly</span>`}</p>
    ${r}
    ${(a=Pe(e,t))==null?void 0:a.map(n=>y`<p class="err">${n}</p>`)}
  </label>
  `},Ce=(e,t,r={})=>de(e,t,y`
    <textarea name="${fe(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${Pe(e,t)&&"invalid"}" oninput="${Me}">${ee(e,t)||r.value}</textarea>
  `,r),je=(e,t,r={})=>de(e,t,y`
    <input type="number" name="${fe(e,t)}" inputmode="decimal" step="any" min="${r.min}" max="${r.max}" value="${ee(e,t)||r.value}" ?readonly="${r.readonly}" class="${Pe(e,t)&&"invalid"}">
  `,r),G=(e,t,r={})=>de(e,t,y`
    <input type="number" name="${fe(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${ee(e,t)||r.value}" ?readonly="${r.readonly}" class="${Pe(e,t)&&"invalid"}">
  `,r),lt=(e,t,r={})=>de(e,t,y`
    <input type="checkbox" name="${fe(e,t)}" ?disabled="${r.readonly}" ?checked="${ee(e,t)||r.value}">
  `,r),Ol=(e,t,r={})=>de(e,t,y`
    <select name="${fe(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([l,a])=>y`<option value="${l}" ?selected="${(ee(e,t)||r.selected)==l}">${a}</option>`)}
    </select>
  `,r),Sl=(e,t,r={})=>{switch(e.type){case j:return lt(e,t,r);case P:return je(e,t,r);case I:return Ce(e,t,r);default:return""}},fe=(e,t)=>t,ee=(e,t)=>(e.metadata||{})[t],Al=e=>{let t;switch(e.type){case N:t=[G(e,"min",{keyDisplay:"Min Properties",value:Object.keys(e.fields).length,readonly:!0}),G(e,"max",{keyDisplay:"Max Properties",value:Object.keys(e.fields).length,readonly:!0})];break;case O:t=[G(e,"min",{keyDisplay:"Min Items",min:1,value:1}),G(e,"max",{keyDisplay:"Max Items",min:1}),lt(e,"unique",{keyDisplay:"Item uniqueness"})];break;case _:t=[G(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),G(e,"max",{keyDisplay:"Max Items",value:ee(e,"max")||e.schs.length})];break;case I:t=[G(e,"min",{keyDisplay:"Min Length",min:0}),G(e,"max",{keyDisplay:"Max Length",min:0}),Ce(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case P:t=[je(e,"min",{keyDisplay:"Min"}),je(e,"max",{keyDisplay:"Max"}),je(e,"multipleOf",{keyDisplay:"Multiple of",min:1})];break;case ve:t=[];case j:t=[];case B:t=[];case E:t=[];case J:t=[];case M:t=[];case D:t=[];default:t=[]}return e._meta.parent.type==N&&e._meta.level>2&&t.push(lt(e,"required",{keyDisplay:"Required"})),t};var Pe=(e,t)=>e.errors&&e.errors[t];var cr=(e,t,r={})=>{try{let l=t._models||t.order.reduce((n,s)=>(n[t.fields[s].$anchor]=s,n),{}),a={level:1,tab:0,models:l,rootKey:t.key,taggedLevel:t.taggedLevel};a.rootLevel=a.level,Dl(e,{sch:t,ui:Object.assign(a,r.ui),path:t.path||"",key:t.key,parent:{type:t.type,level:a.level}})}catch(l){console.log(l)}},Dl=(e,t)=>De(document.querySelector(e),y`
  <theme>
    <ul role="tree" aria-multiselectable="true" class="text-sm" tabindex="-1">
      ${ue(t)}
    </ul>
  </theme>
  ${null}
`);var ue=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Ml(e);case kt.includes(e.sch.type):return Rl(e);default:return Ll(e)}},Ml=e=>y.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${nt(e.key)}
    </dfn>
    <ul data-group="${fr(e.sch)}" role="group">
      ${dr(e)}
    </ul>
  </li>`,Rl=e=>y.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${ur(Object.assign(e,{key:nt(e.key)}))}
      ${pr(e)}
      ${mr(e)}
    </dfn>
    <ul data-group="${fr(e.sch)}" role="group">
      ${dr(e)}
    </ul>
  </li>`,Ll=e=>y.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${ur(Object.assign(e,{key:nt(e.key)}))}
    ${pr(e)}
    ${mr(e)}
  </li>`,dr=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return y``;switch(!0){case[N].includes(e.sch.type):return Cl(e);case[_].includes(e.sch.type):return Il(e);case[O].includes(e.sch.type):return Pl(e);case[E].includes(e.sch.type):return jl(e);default:return y``}},Cl=e=>e.sch.order.map((t,r)=>ue({key:t,sch:e.sch.fields[t],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[${t}]`})),Il=e=>e.sch.schs.map((t,r)=>ue({key:r,sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Pl=e=>ue({key:0,sch:e.sch.sch,parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:0},path:`${e.path}[][${0}]`}),jl=e=>e.sch.schs.map((t,r)=>ue({key:"",sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Ue=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab}rem`,yr=(e,t,r)=>y`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="256" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${Me}"
  >${r}</textarea>`,ur=e=>e.ui.level==e.ui.rootLevel+1?Ul(e):Kl(e),Ul=e=>y`
  <span class="def" style="${Ue(e)}">
    ${ql(e.sch,e.ui)}
  </span>
  <span class="k">${hr(e)}</span>
  <span class="s">=</span>
  `,Kl=e=>{switch(!0){case e.parent.type==E:return y`
      <span class="" style="${Ue(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==O:return y`
      <span class="k" style="${Ue(e)}"></span>
      <span class="s">└</span>
      `;default:return y`
      <span class="k" style="${Ue(e)}">
        ${hr(e)}
      </span >
      <span class="s">:</span>
    `}},hr=e=>e.sch.uiMode=="editKey"?yr("key-edit",e.parent.path,e.key):y`${e.key}`,pr=e=>e.ui.level==e.ui.rootLevel+1?Gl(e):Wl(e),Gl=e=>e.ui.viewTypeRoot?e.ui.viewTypeRoot(e):y`<span class="t">${Tr(e)}</span>`,Wl=e=>y`<span class="t">${Tr(e)}</span>`,Tr=e=>e.sch.uiMode=="editType"?yr("type-edit",e.parent.path,Bl(e.sch,e.ui)):y`${xr(e.sch,e.ui)}`,Bl=(e,t)=>{switch(!0){case e.type==D:return JSON.stringify(e.const);case e.type==M:return t.models[e.$ref];default:return e.type}},xr=(e,t)=>{let r;switch(!0){case(e.type==N&&se(e.fields,{})):r="{ any }";break;case e.type==N:r="{ \xA0 }";break;case e.type==O:r=y`[ ${xr(e.sch,t)} ]`;break;case e.type==_:r="( \xA0 )";break;case e.type==I:r="string";break;case e.type==P:r="number";break;case e.type==ve:r="integer";break;case e.type==j:r="bool";break;case e.type==B:r="null";break;case e.type==E:r="||";break;case e.type==J:r="any";break;case(e.type==M&&!!t.models[e.$ref]):r=y`<span class="ref">${e._text=t.models[e.$ref]}</span>`;break;case e.type==M:r=y`<span class="ref notfound" title="Ref type">${`${e._text} (#404)`}</span>`;break;case e.type==D:r=y`<span class="value" title="Value type">${JSON.stringify(e.const)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},nt=e=>e,fr=e=>{switch(!0){case[N].includes(e.type):return"keyed";case[_,E].includes(e.type):return"indexed";default:return"none"}},ql=(e,t)=>{let r;switch(!0){case e.type==N:r="record";break;case e.type==O:r="list";break;case e.type==_:r="tuple";break;case e.type==E:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},mr=e=>{var r;let t;switch(!0){case(e.parent.type==N&&((r=e.sch.metadata)==null?void 0:r.required)):t=[y`<span class="m"> · required</span>`];break;default:t=[]}return t};var it={};Et(it,{clearClipboard:()=>pe,createWalker:()=>br,findUnselectedNode:()=>qe,reselectNodes:()=>Ge,selectMultiNode:()=>re,selectMultiNodeTo:()=>Ke,selectNode:()=>$,selectedGroupedByParent:()=>F,toggleSelectNode:()=>Er});var C="aria-selected",br=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.hasAttribute(C)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),e),$=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,Nr(e),te(t),r.focus&&t.focus())},Er=(e,t)=>{e&&(e.tabIndex=-1),vr(t)},re=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(C)=="true"?vr(e):te(t),r.focus&&t.focus())},Nr=e=>{for(let t of e.querySelectorAll(`[${C}='true']`))at(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},ot=(e,t,r,l={})=>{var s,d,o;let a=e._walker.currentNode,n=t();if(!!n){if(a==r)return(s=l.target)==null?void 0:s.call(null,r);(d=l.pre)==null||d.call(null,a,n),ot(e,t,r,l),(o=l.post)==null||o.call(null,a,n)}},Ke=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,ot(e,()=>e._walker.nextSibling(),r,{pre:(l,a)=>{re(l,a,{focus:!1})}}),e._walker.currentNode=r,te(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,te(r.parentNode.closest(`[${C}]`)),ot(e,()=>e._walker.previousSibling(),r,{pre:(l,a)=>{re(l,a,{focus:!1})}}),at(r.parentNode.closest(`[${C}]`)),e._walker.currentNode=r,te(r),r.focus();break}},te=e=>{!e||(e.setAttribute(C,!0),e.tabIndex=0)},at=e=>{!e||(e.setAttribute(C,!1),e.tabIndex=-1)},vr=e=>(e==null?void 0:e.getAttribute(C))=="true"?at(e):te(e),qe=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(C))=="true");return t},Fl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),Ge=(e,t,r={})=>{Nr(e);for(let l of Fl(Object.keys(t))){let a=t[l];if(l==""?l=e.querySelector("[id][aria-level]"):l=e.querySelector(`[id='${CSS.escape(l)}'][aria-level]`),!l)continue;let n=parseInt(l.getAttribute("aria-level")),s=l.querySelectorAll(`[aria-level='${n+1}'][role='treeitem']`);for(let d=0;d<a.length;d++){let o=a[d].index,c=s[o];if(!c)return;c.classList.add("item-pasted"),r.direction&&c.classList.add(r.direction),re(null,c,{focus:d==a.length-1}),e._walker.currentNode=c}}},F=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${C}='true']`}`),l={};for(let a=0;a<r.length;a++){let n=r[a],s=n.parentNode.closest("[role='treeitem']");if(!s)break;n.index=n.index||parseInt(n.getAttribute("aria-posinset"))-1,l[s.id]=l[s.id]||[],l[s.id].push(n)}return l},pe=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var ct={};Et(ct,{anchorsModels:()=>mt,createProjectStore:()=>Hl,getFileStore:()=>xe,handleProjectContext:()=>zl,handleProjectRemote:()=>Yl,projectToStore:()=>Xl});var H="new",W="removed",Y="moved",me="order_changed",ye="key_changed",he="type_changed",st="entry_changed",_r=(e,t,r={})=>{let l={},a=[];L(t,(n,s)=>(n._meta=s,Object.assign(l,{[n.$anchor]:n}),delete n._visit,n)),L(e,(n,s)=>{var o;n._meta=s;let d=l[n.$anchor];if(d){let c=n._meta.parent,f=d._meta.parent;f.$anchor!=c.$anchor&&(n._diff={[Y]:{oldParent:f,newParent:c}}),se(d.order,n.order)||(n._diff={[me]:{oldOrder:d.order,newOrder:n.order}}),d.type!=n.type&&Object.assign(n._diff||(n._diff={}),{[he]:{oldType:d.type,newType:n.type,parent:c}}),d.key!=n.key&&Object.assign(n._diff||(n._diff={}),{[ye]:{oldKey:d.key,newKey:n.key,parent:c}}),d.isEntry!=n.isEntry&&Object.assign(n._diff||(n._diff={}),{[st]:{oldIsEntry:d.isEntry,newIsEntry:n.isEntry,parent:c}}),n._diff&&a.push(n),d._visit=!0}else s.path.startsWith((o=s.parent.prune)==null?void 0:o.added)||(n._diff={[H]:{parent:s.parent}},a.push(n),Object.assign(s.parent,{prune:{added:s.path}}));return n});for(let n of Object.keys(l)){if(l[n]._visit)continue;let s=l[n]._meta,d=s.path;a.filter(c=>c._diff[W]&&d.startsWith(c._meta.path)).length==0&&(l[n]._diff={[W]:{parent:s.parent}},a.push(l[n]))}return a};var V="file",le="project",Hl=()=>Te({taggedLevel:{1:le,2:V,3:R},allowedSchs:[$r()],put:{pos:"append"}}),xe=(e,t)=>{let r=Q(e,`[${t}]`);return r.schMetas=e.schMetas,r},Yl=(e,t,r,l)=>{if(!ut(r.name))return;let a=u=>{for(let h of Object.keys(e.fields))if(e.fields[h].fields[u])return{file:e.fields[h],fmodelDst:e.fields[h].fields[u]}},n=u=>z(e,(h,v)=>{if(e.taggedLevel[v.level]==R&&v.path!="")return u.startsWith(v.path)},(h,v)=>(h._meta=v,h)),s=_r(e,t),d={};d.files=[],d.fmodels=[],d.subfmodels=[];for(let u of s){let h=e.taggedLevel[u._meta.level];h==le?d.project=u:h==V?d.files.push(u):h==R?d.fmodels.push(u):d.subfmodels.push(u)}let o={},c={},f={};if(d.project){let{fields:u,...h}=x(d.project);o.project=h}for(let u of d.files){let{fields:h,...v}=x(u);if(c.files||(c.files={}),f.files||(f.files={}),o.files||(o.files={}),c.fmodels||(c.fmodels={}),f.fmodels||(f.fmodels={}),u._diff[H]){c.files[u._meta.path]={...v,parentAnchor:u._diff[H].parent.$anchor};for(let A of Object.keys(h))c.fmodels[u.fields[A]._meta.path]={...h[A],parentAnchor:v.$anchor}}if(u._diff[W]){f.files[u._meta.path]={$anchor:v.$anchor,parentAnchor:u._diff[W].parent.$anchor};for(let A of Object.keys(h))f.fmodels[u.fields[A]._meta.path]={$anchor:h[A].$anchor,parentAnchor:v.$anchor}}(u._diff[me]||u._diff[ye])&&(o.files[u._meta.path]=v),u._diff[Y]&&console.log("file cannot be moved to different parent"),u._diff[he]&&console.log("file type is always record, cannot be changed")}for(let u of d.fmodels){let h=x(u);if(o.files||(o.files={}),c.fmodels||(c.fmodels={}),f.fmodels||(f.fmodels={}),o.fmodels||(o.fmodels={}),u._diff[H]&&(c.fmodels[u._meta.path]={...h,parentAnchor:u._diff[H].parent.$anchor}),u._diff[W]&&(f.fmodels[u._meta.path]={$anchor:h.$anchor,parentAnchor:u._diff[W].parent.$anchor}),(u._diff[me]||u._diff[ye]||u._diff[he]||u._diff[st])&&(o.fmodels[u._meta.path]={...h,parentAnchor:u._meta.parent.$anchor}),u._diff[Y]){let{oldParent:v,newParent:A}=u._diff[Y];switch(e.taggedLevel[v.level]){case le:console.log("fmodel cannot be moved from project as direct child");break;case V:var p=e.fields[v.key],{fields:m,...T}=x(p);o.files[p._meta.path]=T,f.fmodels[u._meta.path]={$anchor:u.$anchor,parentAnchor:T.$anchor};break;case R:var b=a(v.key),T=x(b.file);o.fmodels[b.fmodelDst._meta.path]={...x(b.fmodelDst),parentAnchor:T.$anchor};break;default:var w=n(v.path),b=a(w.key),T=x(b.file);o.fmodels[w._meta.path]={...x(w),parentAnchor:T.$anchor}}switch(e.taggedLevel[A.level]){case le:console.log("fmodel cannot be moved to project as direct child");break;case V:var p=e.fields[A.key],{fields:m,...T}=x(p);o.files[p._meta.path]=T,c.fmodels[u._meta.path]={...h,parentAnchor:T.$anchor};break;case R:var b=a(A.key),T=x(b.file);o.fmodels[b.fmodelDst._meta.path]={...x(b.fmodelDst),parentAnchor:T.$anchor};break;default:var w=n(A.path),b=a(w.key),T=x(b.file);o.fmodels[w._meta.path]={...x(w),parentAnchor:T.$anchor}}}}for(let u of d.subfmodels){if(o.files||(o.files={}),c.fmodels||(c.fmodels={}),f.fmodels||(f.fmodels={}),o.fmodels||(o.fmodels={}),u._diff[H]||u._diff[W]||u._diff[me]||u._diff[ye]||u._diff[he]){let h=n(u._meta.path),v=a(h.key),A=x(v.file);o.fmodels[h._meta.path]={...x(h),parentAnchor:A.$anchor}}if(u._diff[Y]){let{oldParent:h,newParent:v}=u._diff[Y];switch(e.taggedLevel[h.level]){case le:console.log("subfmodel cannot be moved from project as direct child");break;case V:var p=e.fields[h.key],{fields:m,...T}=x(p);o.files[p._meta.path]=T,f.fmodels[u._meta.path]={$anchor:u.$anchor,parentAnchor:T.$anchor};break;case R:default:var w=n(h.path),b=a(w.key),T=x(b.file);o.fmodels[w._meta.path]={...x(w),parentAnchor:T.$anchor}}switch(e.taggedLevel[v.level]){case le:console.log("subfmodel cannot be moved to project as direct child");break;case V:var w=n(u._meta.path),b=a(w.key),{fields:m,...T}=x(b.file);o.files[b.file._meta.path]=T,c.fmodels[u._meta.path]={...x(u),parentAnchor:T.$anchor};break;case R:default:var w=n(u._meta.path),b=a(w.key),T=x(b.file);o.fmodels[w._meta.path]={...x(w),parentAnchor:T.$anchor}}}}return console.log({changed:o,added:c,removed:f}),l({changed:o,added:c,removed:f})},zl=(e,t,r)=>{let l=t.closest("[data-tag='file']"),a=l==null?void 0:l.key;if(!!a){if(t.closest("[id='project']"))switch(!0){case ft(r.name):Vl(e,a);break;case We(r.name):let n=xe(e,a);document.querySelector("[id='fmodel'] [role='tree']")._render(n);break}else if(t.closest("[id='fmodel']")){let n,s;switch(!0){case pt(r.name):if(n=xe(e,a),t.dataset.tag!=R)return;Jl(e,(d,o)=>{o.path==`[${n.key}]${t.id}`?(e.entrypoints={},e.entrypoints[d.$anchor]={}):(delete d.isEntry,delete e.entrypoints[d.$anchor])}),s=document.querySelector("[id='fmodel'] [role='tree']"),s._render(n);break;case We(r.name):n=xe(e,a),n._models=mt(e,n),s=document.querySelector("[id='fmodel'] [role='tree']"),s._render(n);break}}}},mt=(e,t)=>{let r={};for(let l of e.order){let a=e.fields[l];for(let n of a.order)r[a.fields[n].$anchor]=l!=t.key?`${l}.${n}`:n}return r},$r=()=>Te({taggedLevel:{1:V,2:R},addDefault:()=>Te(),entryable:[R]}),Ql=(e,t,r)=>{for(let l of e.fmodels)Object.assign(l.sch,{$anchor:l.anchor,type:l.type,key:l.key}),l.isEntry&&(l.sch.isEntry=l.isEntry,r.entrypoints[l.sch.$anchor]={}),t.fields[l.key]=l.sch;return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,S(()=>t)},Xl=(e,t)=>{t.entrypoints={};for(let r of e.files)t.fields[r.key]=Ql(r,$r(),t);return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,t.schMetas=e.allmeta,S(()=>t)},Vl=(e,t)=>{let r=xe(e,t);if(r&&(r._models=mt(e,r),dt({store:r,target:"[id='fmodel']",metaSelector:"sch-meta"}),!window._treeClipboard)){let l=document.querySelector("[id='fmodel'] [role='tree']");l._aria.clearClipboard(l)}},Jl=(e,t)=>{for(let r of Object.keys(e.fields)){let l=e.fields[r];for(let a of Object.keys(l.fields)){let n=l.fields[a];t(n,{path:`[${l.key}][${n.key}]`})}}};var wr=[gt,Ve,Dt,Mt,Rt,K,Ot,St,At,()=>Je('"json string"')],Te=(e={})=>{let t=S(Ve);return t.taggedLevel=e.taggedLevel,t.allowedSchs=e.allowedSchs||wr.map(r=>r()),e.tag&&(t._tag=e.tag),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.type==e.addDefault().type)&&e.addDefault()),e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),t};var ft=e=>[Or,Sr,kr,gr,Ar,Dr,yt,ht,Tt,be].map(t=>t.name).includes(e),We=e=>[xt,be,bt,Be].map(t=>t.name).includes(e),ut=e=>[xt,be,bt,Be,ht,Tt,Mr,Rr,be,Nt].map(t=>t.name).includes(e),pt=e=>[Nt].map(t=>t.name).includes(e),nn=()=>new Map([["shift-meta-ArrowUp",Zl],["shift-meta-ArrowDown",en],["shift-ArrowUp",tn],["shift-ArrowDown",rn],["meta-ArrowUp",kr],["meta-ArrowDown",gr],["ArrowUp",Or],["ArrowDown",Sr],["Home",Ar],["End",Dr],["shift-+",xt],["Enter",ln],["shift-Enter",Lr],["Delete",be],["m",Nt],["meta-x",Cr],["meta-c",Ir],["meta-v",Be],["shift-alt-ArrowUp",ht],["shift-alt-ArrowDown",Tt],["alt-ArrowUp",Mr],["alt-ArrowDown",Rr],["Escape",({tree:e})=>pe(e)]]),on=(e,t={})=>function(r){an(r,this,e,t)};async function an(e,t,r,l){if(e.target instanceof HTMLTextAreaElement)return sn(e,t,r);let a=nn().get(Pr(e));if(!!a&&!(l.denyCmds||[]).includes(a.name)){switch(a({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t.renderSchMeta(),t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`)),r.currentNode=t._walker.currentNode,vt(t,t._walker.currentNode,a)}}var cn=()=>new Map([["Enter",bt]]),sn=(e,t,r)=>{let l=e.target,a=cn().get(Pr(e));!a||(a({tree:t,store:r},l),t.renderSchMeta(),vt(t,t._walker.currentNode,a))},fn=e=>function(t){return dn(t,this,e)};function dn(e,t,r){let l=t._walker.currentNode,a=e.target.closest("[role='treeitem']"),n=!t.querySelector("textarea");if(!!a){if(e.shiftKey||e.metaKey)switch(l.compareDocumentPosition(a)){case Node.DOCUMENT_POSITION_CONTAINS:return $(t,a);case Node.DOCUMENT_POSITION_CONTAINED_BY:return $(t,l);default:if(a.parentNode.closest("[role='treeitem']")!=l.parentNode.closest("[role='treeitem']"))return $(t,a)}e.shiftKey?Ke(t,l,a):e.metaKey?Er(l,t._walker.currentNode=a):(t._walker.currentNode=a,yt({tree:t},{notFocusIfTextArea:n}),r.currentNode=t._walker.currentNode,vt(t,a,yt)),t.renderSchMeta()}}var un=({tree:e,store:t})=>{let r=e.querySelectorAll("[id='fmodel'] [aria-selected='true']");if(r.length==1){let l=Q(t,r[0].id);l.path=r[0].id,l.rootKey=e.querySelector(".root-item").key,l.metadata=t.schMetas[l.$anchor],Ie(e._metaContainer,l,t)}},Pr=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:l,key:a})=>{let n=[];return e&&n.push("shift"),(t||l)&&n.push("meta"),r&&n.push("alt"),a&&n.push(a),n.join("-")},vt=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}})),Zl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();Ke(e,t,r)},en=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();Ke(e,t,r)},tn=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();re(t,r)},rn=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();re(t,r)},kr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();$(e,t)},gr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();$(e,t)},Or=({tree:e})=>$(e,e._walker.previousNode()),Sr=({tree:e})=>$(e,e._walker.nextNode()),Ar=({tree:e})=>{for(;e._walker.parentNode(););$(e,e._walker.currentNode)},Dr=({tree:e})=>{for(;e._walker.nextNode(););$(e,e._walker.currentNode)},yt=({tree:e},t={})=>$(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),xt=({tree:e,store:t})=>{var s;let r=e._walker.currentNode,l=Q(t,r.id),a,n=l._addSchDefault||l.allowedSchs&&l.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!n||(((s=l.put)==null?void 0:s.pos)=="prepend"?a=0:a=Number.MAX_SAFE_INTEGER,_e(t,r.id,[{k:null,sch:()=>Ee(n),index:a}]),e._render(t),$(e,r))},ln=({tree:e,store:t})=>{var l,a;((a=(l=e._walker.currentNode.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:a.group)=="keyed"&&jr({tree:e,store:t,editMode:"editKey"})},Lr=({tree:e,store:t})=>{jr({tree:e,store:t,editMode:"editType"})},jr=({tree:e,store:t,editMode:r})=>{let l=e._walker.currentNode;q(t,l.id,(n,s)=>({...n,uiMode:r})),e._render(t);let a=e.querySelector("textarea");!a||(a._treeItem=l,a.onblur=n=>pn(e,t,a),a.focus())},pn=(e,t,r)=>{let l=q(t,r._treeItem.id,(a,n)=>Object.assign(a,{uiMode:"cancelled-edit"}));e._render(t),l&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),$(e,e._walker.currentNode))},bt=({tree:e,store:t},r)=>{r.id=="key-edit"?Ur(e,t,r,yn):r.id=="type-edit"&&Ur(e,t,r,mn)},Ur=(e,t,r,l)=>{let a=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),$(e,r._treeItem,{focus:!1});let n=l(e,t,r)||a.id;q(t,n,(s,d)=>Object.assign(s,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(n)}']`),$(e,e._walker.currentNode)},mn=(e,t,r)=>{let l=t.allowedSchs.find(s=>s.type==r.value),a=Object.keys(t._models).find(s=>t._models[s]==r.value),n=Je(r.value);return l?ke(t,r._treeItem.id,()=>Ee(l)):a?ke(t,r._treeItem.id,()=>Lt(a)):n&&ke(t,r._treeItem.id,()=>n),e._walker.currentNode.id},yn=(e,t,r)=>{let l=F(e),a=r.dataset.parentPath;l[r.dataset.parentPath]=l[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>({id:c.id,newK:r.value,index:c.index}));let n=l[r.dataset.parentPath][0].index,d=we(t,{dstPath:a,startIndex:n},l)[a][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${d}]`},be=({tree:e,store:t})=>{let r=qe(()=>e._walker.nextSibling())||qe(()=>e._walker.previousSibling())||qe(()=>e._walker.parentNode());$e(t,F(e)),e._render(t),$(e,r)},Nt=({tree:e,store:t})=>{var l;let r=e._walker.currentNode;!r||((l=t.entryable)==null?void 0:l.includes(r.dataset.tag))&&(q(t,r.id,(a,n)=>Object.assign(a,{isEntry:!0})),e._render(t),$(e,r))};var Cr=({store:e,tree:t})=>{pe(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-cutting");let r=F(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",storeKey:e.key,ops:l=>$e(e,r,{dstPath:l}),selected:r}},Ir=({store:e,tree:t})=>{pe(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-copying");let r=F(t,{ops:".item-copying"});window._treeClipboard={type:"copy",storeKey:e.key,ops:l=>Qe(e,r,{dstPath:l,startIndex:0}),selected:r}},Be=({tree:e,store:t,srcStore:r})=>{let l=Q(t,e._walker.currentNode.id);if(!![N,E,_].includes(l.type)&&window._treeClipboard){let a=e._walker.currentNode.id,{type:n,storeKey:s,ops:d,selected:o}=window._treeClipboard,c=o,f={};if(t.key==s)switch(n){case"copy":f=Ze(t,{dstPath:a},c);break;case"cut":f=we(t,{dstPath:a},c);break}else switch(n){case"copy":let p=d(a);f=Xe(t,{dstPath:a},p);break;case"cut":let m=d(a);f=ze(t,{dstPath:a},m);break}Object.keys(f).length!=0&&(e._render(t),pe(e),Ge(e,f))}},ht=({tree:e,store:t})=>Kr({tree:e,store:t,direction:"up"},r=>r[0].index),Tt=({tree:e,store:t})=>Kr({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),Kr=({tree:e,store:t,direction:r},l)=>{let a=F(e),n={};for(let s of Object.keys(a))n=Ze(t,{dstPath:s,startIndex:l(a[s])},{[s]:a[s]});Object.keys(n).length!=0&&(e._render(t),Ge(e,n,{direction:r}))},Mr=({tree:e,store:t})=>qr({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),Rr=({tree:e,store:t})=>qr({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),qr=({tree:e,store:t,startIndex:r,direction:l})=>{let a=F(e),n={};for(let s of Object.keys(a)){let d=a[s].sort((o,c)=>o.index-c.index);n=we(t,{dstPath:s,startIndex:r(d[0].index)},a)}Object.keys(n).length!=0&&(e._render(t),Ge(e,n,{direction:l}))},Gr=({store:e,target:t,metaSelector:r,opts:l})=>{e.render=s=>cr(t,s,l||{}),e.render(e),e.schMetas||(e.schMetas={});let a=document.querySelector(`${t} [role='tree']`),n=document.querySelector(r);if(a){a._aria=it,a._render=e.render,br(a),a.onkeydown=on(e,l.treeKeyDownOpts),a.onclick=fn(e);let s=a._walker.nextNode(),d=e.currentNode||a._walker.nextNode()||s;return $(a,d,{focus:l.focus}),r&&(a._metaContainer=n),a.renderSchMeta=()=>un({tree:a,store:e}),a.renderSchMeta(),a}},hn=({store:e,target:t,metaSelector:r})=>{Gr({store:e,target:t,metaSelector:r,opts:{ui:{depthLimit:2,modelTypeText:(l,a)=>"file",typeText:(l,a)=>{if(l.type==N)return"record";if(l.type==D)return"value";if(l.type==_)return"tuple";if(l.type==E)return"union"},viewTypeRoot:l=>""},treeKeyDownOpts:{denyCmds:[Lr,Ir,Cr,Be].map(l=>l.name)},focus:!0}})},dt=({store:e,target:t,metaSelector:r})=>{Gr({store:e,target:t,metaSelector:r,opts:{ui:{modelTypeText:(l,a)=>l.isEntry?"entrypoint":"type"}}})},Tn=({store:e,detail:t,target:r})=>{let{path:l,attrs:a}=t,n=q(e,l,(s,d)=>ar(s,a));return e.render&&e.render(e),Object.assign(e.schMetas,{[n.$anchor]:n.metadata}),Ie(r.closest("sch-meta"),n,e),n};export{ct as Project,wr as allSchs,Te as createStore,hn as initFileView,dt as initModelView,ft as isContextSwitchedCmd,ut as isDiffableCmd,pt as isEntryChangedCmd,We as isModelChangedCmd,Tn as update};
/*! (c) Andrea Giammarchi - ISC */
