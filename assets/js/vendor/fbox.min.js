var rl=Object.defineProperty;var Ut=(e,t)=>{for(var r in t)rl(e,r,{get:t[r],enumerable:!0})};var We,ll=new Uint8Array(16);function dt(){if(!We&&(We=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!We))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return We(ll)}var Pt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function nl(e){return typeof e=="string"&&Pt.test(e)}var jt=nl;var g=[];for(var ft=0;ft<256;++ft)g.push((ft+256).toString(16).substr(1));function ol(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(g[e[t+0]]+g[e[t+1]]+g[e[t+2]]+g[e[t+3]]+"-"+g[e[t+4]]+g[e[t+5]]+"-"+g[e[t+6]]+g[e[t+7]]+"-"+g[e[t+8]]+g[e[t+9]]+"-"+g[e[t+10]]+g[e[t+11]]+g[e[t+12]]+g[e[t+13]]+g[e[t+14]]+g[e[t+15]]).toLowerCase();if(!jt(r))throw TypeError("Stringified UUID is invalid");return r}var Kt=ol;function il(e,t,r){e=e||{};var l=e.random||(e.rng||dt)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=l[o];return t}return Kt(l)}var pt=il;var v="record",O="list",A="tuple",W="string",G="number",Ge="integer",q="boolean",re="null",w="union",ae="any",L="ref",U="value",Wt=[v,A,O,w],R="fmodel";var J=()=>({type:ae}),Gt=()=>({type:W}),qt=()=>({type:q}),Ft=()=>({type:G}),Bt=()=>({type:re}),ut=()=>({type:v,fields:{},order:[]}),Ht=()=>({type:O,sch:S(J)}),Yt=()=>({type:A,schs:[S(J)]}),Jt=()=>({type:w,schs:[S(J)]}),zt=e=>({type:L,$ref:e}),qe=e=>{try{return e=JSON.parse(e),e==null||[W,G,q].includes(typeof e)?{type:U,const:e}:!1}catch(t){return!1}},S=(e,t={})=>{let r=e();return r.$anchor||(r.$anchor=pt()),t.force&&(r.$anchor=pt()),t.tag&&(r._tag=t.tag),r};var Fe=e=>{let t=JSON.parse(JSON.stringify(e));return C(t,(r,l)=>S(()=>r,{force:!0})),t},Vt=e=>C(JSON.parse(JSON.stringify(e)),(t,r)=>{let{type:l,$anchor:o,key:n,_tag:a,isEntry:c,parentAnchor:d}=t,s={type:l,$anchor:o,key:n,_tag:a,parentAnchor:d};switch(c&&Object.assign(s,{isEntry:c}),t.type){case v:let{fields:f,order:p}=t;return Object.assign(s,{fields:f,order:p});case A:case w:let{schs:m}=t;return Object.assign(s,{schs:m});case O:let{sch:b}=t;return Object.assign(s,{sch:b});case U:let{const:h}=t;return Object.assign(s,{const:h});case L:let{$ref:N}=t;return Object.assign(s,{$ref:N});default:return Object.assign(s,{})}}),C=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,e=t(e,r),e._halt)return e;let l=({_tag:o,type:n,$anchor:a,key:c},{path:d,level:s,parent:{prune:f}})=>({_tag:o,level:s,type:n,$anchor:a,key:c,path:d,prune:f});switch(!0){case[v].includes(e.type):let o=Object.keys(e.fields);for(let c=e.order.length-1;c>=0;c--){let d=e.order[c],s=e.fields[d],f={path:`${r.path}[${d}]`,level:r.level+1,index:c,parent:l(e,r)};if(s=C(s,t,f),s.key=d,e.fields[d]=s,s._halt)return Object.assign(e,{_halt:!0})}break;case[A,w].includes(e.type):for(let c=0;c<e.schs.length;c++){let d=e.schs[c],s={path:`${r.path}[][${c}]`,level:r.level+1,index:c,parent:l(e,r)};if(d=C(d,t,s),e.schs[c]=d,d._halt)return Object.assign(e,{_halt:!0})}break;case[O].includes(e.type):let n={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:l(e,r)},a=C(e.sch,t,n);if(e.sch=a,a._halt)return Object.assign(e,{_halt:!0});break;default:}return e},al=(e,t,r)=>{let l={original:{},popped:[]},o=r.sort((n,a)=>a-n);return C(e,(n,a)=>{if(a.path!=t)return n;switch(n.type){case v:let c=o.map(d=>[d,n.order[d]]).filter(([d,s])=>s);for(let[d,s]of c)l.popped.unshift({k:s,sch:n.fields[s],index:d}),delete n.fields[s];for(let d of o)n.order.splice(d,1);break;case O:break;case A:for(let d of o)l.popped.unshift({k:d,sch:n.schs.splice(d,1)[0],index:d});n.schs.length==0&&n.schs.splice(0,0,S(J));break;case w:for(let d of o)l.popped.unshift({k:d,sch:n.schs.splice(d,1)[0],index:d});n.schs.length==0&&n.schs.splice(0,0,S(J));break;default:}return n}),l},sl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),Be=(e,t,r)=>{let l={original:{},inserted:[]},o=r.sort((a,c)=>a.index-c.index),n=(a,c)=>(a=Math.max(a,0),a=Math.min(a,c.length),a);return C(e,(a,c)=>{var d;if(c.path!=t)return a;switch(a.type){case v:let s=(d=e.taggedLevel)==null?void 0:d[c.level+1];for(let{k:f,sch:p,index:m}of o){for(f=f==0?"0":f,f=f||`${s||"key"}_${Math.floor(Date.now()/100)}`,f=`${f}`;a.fields[f];)f=`${f} \u2013`;m=n(m,a.order),a.fields[f]=S(p),a.order.splice(m,0,f),l.inserted.push({k:f,sch:a.fields[f],index:m})}break;case O:break;case A:for(let{k:f,sch:p,index:m}of o)m=n(m,a.schs),a.schs.splice(m,0,S(p)),l.inserted.push({k:f,sch:a.schs[m],index:m});break;case w:for(let{k:f,sch:p,index:m}of o)m=n(m,a.schs),a.schs.splice(m,0,S(p)),l.inserted.push({k:f,sch:a.schs[m],index:m});default:}return a}),l},Ye=(e,{dstPath:t,startIndex:r=0},l)=>{let o=(d,s,f)=>F(d,s,(p,m)=>(p._pinId=f,p)),n=Symbol(t);o(e,t,n);let a=He(e,l,{dstPath:t});return mt(e,{dstPin:n,startIndex:r},a)},He=(e,t,r={})=>{let l={},o=sl(Object.keys(t));for(let n of o){let a=t[n],c=f=>{var p;return(p=a.find(m=>m.index==f))==null?void 0:p.newK};if(r.dstPath&&a.filter(p=>r.dstPath.startsWith(p.id)).length!=0)continue;let s=al(e,n,a.map(f=>f.index)).popped.map(({k:f,sch:p,index:m})=>({k:c(m)||f,sch:()=>p}));l[n]=s}return l},mt=(e,{dstPin:t,dstPath:r,startIndex:l=0},o)=>{let n=(s,f)=>se(s,(p,m)=>p._pinId==f,(p,m)=>(p._pinned=m,p));l=Math.max(l,0);let a={},c=Object.values(o).flatMap(s=>s).map((s,f)=>({...s,index:l+f}));if(t){let s=n(e,t);s&&(r=s._pinned.path)}let d=Be(e,r,c);return d.inserted.length!=0&&(a[r]=d.inserted),a},Tt=(e,{dstPath:t,startIndex:r=0},l)=>{let o=yt(e,l,{dstPath:t,startIndex:r});return ht(e,{dstPath:t},o)},yt=(e,t,r={})=>Object.values(t).reduce((l,o)=>{let n=o.map(c=>c.id),a=[];se(e,(c,d)=>(n.includes(d.path)&&(c._meta=d,a.unshift(c)),a.length==n.length),(c,d)=>c);for(let c of o){if(r.dstPath&&r.dstPath.startsWith(c.id))continue;let d=a.find(s=>s._meta.path==c.id);d&&l.unshift({k:c.key,sch:()=>Fe(d),index:r.startIndex+l.length,id:c.id})}return l},[]),ht=(e,{dstPath:t},r)=>{let l={},o=Be(e,t,r);return o.inserted.length!=0&&(l[t]=o.inserted),l},Je=(e,t,r)=>F(e,t,(l,o)=>{let n=S(r);switch(!0){case n.type==L:case n.type==U:case n.type!=l.type:let{title:a,description:c,rw:d,required:s,$anchor:f,key:p}=l;return Object.assign(n,{metadata:{title:a,description:c,rw:d,required:s},$anchor:f,key:p}),n;default:return l}}),le=(e,t)=>se(e,(r,l)=>l.path==t,(r,l)=>(r._meta=l,r)),F=(e,t,r)=>se(e,(l,o)=>o.path==t,r),se=(e,t,r)=>{let l;return C(e,(o,n)=>t(o,n)?(l=r(o,n),l._halt=!0,l):o),l&&delete l._halt,l};var xt={};Ut(xt,{clearClipboard:()=>B,createWalker:()=>Qt,findUnselectedNode:()=>_e,reselectNodes:()=>de,selectMultiNode:()=>ne,selectMultiNodeTo:()=>Ne,selectNode:()=>$,selectedGroupedByParent:()=>z,toggleSelectNode:()=>er});var P="aria-selected",Qt=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.hasAttribute(P)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),e),$=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,Xt(e),ce(t),r.focus&&t.focus())},er=(e,t)=>{e&&(e.tabIndex=-1),Zt(t)},ne=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(P)=="true"?Zt(e):ce(t),r.focus&&t.focus())},Xt=e=>{for(let t of e.querySelectorAll(`[${P}='true']`))Et(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},Nt=(e,t,r,l={})=>{var a,c,d;let o=e._walker.currentNode,n=t();if(!!n){if(o==r)return(a=l.target)==null?void 0:a.call(null,r);(c=l.pre)==null||c.call(null,o,n),Nt(e,t,r,l),(d=l.post)==null||d.call(null,o,n)}},Ne=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,Nt(e,()=>e._walker.nextSibling(),r,{pre:(l,o)=>{ne(l,o,{focus:!1})}}),e._walker.currentNode=r,ce(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,ce(r.parentNode.closest(`[${P}]`)),Nt(e,()=>e._walker.previousSibling(),r,{pre:(l,o)=>{ne(l,o,{focus:!1})}}),Et(r.parentNode.closest(`[${P}]`)),e._walker.currentNode=r,ce(r),r.focus();break}},ce=e=>{!e||(e.setAttribute(P,!0),e.tabIndex=0)},Et=e=>{!e||(e.setAttribute(P,!1),e.tabIndex=-1)},Zt=e=>(e==null?void 0:e.getAttribute(P))=="true"?Et(e):ce(e),_e=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(P))=="true");return t},cl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),de=(e,t,r={})=>{Xt(e);for(let l of cl(Object.keys(t))){let o=t[l];if(l==""?l=e.querySelector("[id][aria-level]"):l=e.querySelector(`[id='${CSS.escape(l)}'][aria-level]`),!l)continue;let n=parseInt(l.getAttribute("aria-level")),a=l.querySelectorAll(`[aria-level='${n+1}'][role='treeitem']`);for(let c=0;c<o.length;c++){let d=o[c].index,s=a[d];if(!s)return;s.classList.add("item-pasted"),r.direction&&s.classList.add(r.direction),ne(null,s,{focus:c==o.length-1}),e._walker.currentNode=s}}},z=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${P}='true']`}`),l={};for(let o=0;o<r.length;o++){let n=r[o],a=n.parentNode.closest("[role='treeitem']");if(!a)break;n.index=n.index||parseInt(n.getAttribute("aria-posinset"))-1,l[a.id]=l[a.id]||[],l[a.id].push(n)}return l},B=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var _t=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();Ne(e,t,r)},bt=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();Ne(e,t,r)},vt=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();ne(t,r)},wt=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();ne(t,r)},be=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();$(e,t)},ve=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();$(e,t)},we=({tree:e})=>$(e,e._walker.previousNode()),$e=({tree:e})=>$(e,e._walker.nextNode()),Ae=({tree:e})=>{for(;e._walker.parentNode(););$(e,e._walker.currentNode)},ge=({tree:e})=>{for(;e._walker.nextNode(););$(e,e._walker.currentNode)},ke=({tree:e},t={})=>$(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),fe=({tree:e,store:t})=>{var a;let r=e._walker.currentNode,l=le(t,r.id),o,n=l._addSchDefault||l.allowedSchs&&l.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!n||(((a=t.put)==null?void 0:a.pos)=="prepend"?o=0:o=Number.MAX_SAFE_INTEGER,Be(t,r.id,[{k:null,sch:()=>Fe(n),index:o}]),e._render(t),$(e,r))},$t=({tree:e,store:t})=>{var l,o;((o=(l=e._walker.currentNode.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:o.group)=="keyed"&&tr({tree:e,store:t,editMode:"editKey"})},rr=({tree:e,store:t})=>{tr({tree:e,store:t,editMode:"editType"})},tr=({tree:e,store:t,editMode:r})=>{let l=e._walker.currentNode;F(t,l.id,(n,a)=>({...n,uiMode:r})),e._render(t);let o=e.querySelector("textarea");!o||(o._treeItem=l,o.onblur=n=>n.relatedTarget&&dl(e,t,o),o.focus())},dl=(e,t,r)=>{let l=F(t,r._treeItem.id,(o,n)=>Object.assign(o,{uiMode:"cancelled-edit"}));e._render(t),l&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),$(e,e._walker.currentNode))},pe=({tree:e,store:t},r)=>{r.id=="key-edit"?lr(e,t,r,pl):r.id=="type-edit"&&lr(e,t,r,fl)},lr=(e,t,r,l)=>{let o=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),$(e,r._treeItem,{focus:!1});let n=l(e,t,r)||o.id;F(t,n,(a,c)=>Object.assign(a,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(n)}']`),$(e,e._walker.currentNode)},fl=(e,t,r)=>{let l=t.allowedSchs.find(a=>a.type==r.value),o=Object.keys(t._models).find(a=>t._models[a]==r.value),n=qe(r.value);return l?Je(t,r._treeItem.id,()=>Fe(l)):o?Je(t,r._treeItem.id,()=>zt(o)):n&&Je(t,r._treeItem.id,()=>n),e._walker.currentNode.id},pl=(e,t,r)=>{let l=z(e),o=r.dataset.parentPath;l[r.dataset.parentPath]=l[r.dataset.parentPath].filter(s=>s.id==r._treeItem.id).map(s=>({id:s.id,newK:r.value,index:s.index}));let n=l[r.dataset.parentPath][0].index,c=Ye(t,{dstPath:o,startIndex:n},l)[o][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${c}]`},V=({tree:e,store:t})=>{let r=_e(()=>e._walker.nextSibling())||_e(()=>e._walker.previousSibling())||_e(()=>e._walker.parentNode());He(t,z(e)),e._render(t),$(e,r)},ue=({tree:e,store:t})=>{var l;let r=e._walker.currentNode;!r||((l=t.entryable)==null?void 0:l.includes(r.dataset.tag))&&(F(t,r.id,(o,n)=>Object.assign(o,{isEntry:!0})),e._render(t),$(e,r))};var nr=({store:e,tree:t})=>{B(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-cutting");let r=z(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",storeKey:e.key,ops:l=>He(e,r,{dstPath:l}),selected:r}},or=({store:e,tree:t})=>{B(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-copying");let r=z(t,{ops:".item-copying"});window._treeClipboard={type:"copy",storeKey:e.key,ops:l=>yt(e,r,{dstPath:l,startIndex:0}),selected:r}},me=({tree:e,store:t,srcStore:r})=>{var o;let l=le(t,e._walker.currentNode.id);if(!![v,w,A].includes(l.type)&&!(((o=t.put)==null?void 0:o.onlyDst)&&!t.put.onlyDst[t.taggedLevel[l._meta.level]])&&window._treeClipboard){let n=e._walker.currentNode.id,{type:a,storeKey:c,ops:d,selected:s}=window._treeClipboard,f=s,p={};if(t.key==c)switch(a){case"copy":p=Tt(t,{dstPath:n},f);break;case"cut":p=Ye(t,{dstPath:n},f);break}else switch(a){case"copy":let b=d(n);p=ht(t,{dstPath:n},b);break;case"cut":let h=d(n);p=mt(t,{dstPath:n},h);break}let m=(b,h)=>{let N={};for(let _ of Object.keys(h))_==l._meta.path?N[""]=h[_]:N[_]=h[_];b._render(l),B(b),de(b,N)};Object.keys(p).length!=0&&(l._tree?m(l._tree,p):(e._render(t),B(e),de(e,p)))}},ye=({tree:e,store:t})=>ir({tree:e,store:t,direction:"up"},r=>r[0].index),he=({tree:e,store:t})=>ir({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),ir=({tree:e,store:t,direction:r},l)=>{let o=z(e),n={};for(let a of Object.keys(o))n=Tt(t,{dstPath:a,startIndex:l(o[a])},{[a]:o[a]});Object.keys(n).length!=0&&(e._render(t),de(e,n,{direction:r}))},De=({tree:e,store:t})=>ar({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),Oe=({tree:e,store:t})=>ar({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),ar=({tree:e,store:t,startIndex:r,direction:l})=>{let o=z(e),n={};for(let a of Object.keys(o)){let c=o[a].sort((d,s)=>d.index-s.index);n=Ye(t,{dstPath:a,startIndex:r(c[0].index)},o)}Object.keys(n).length!=0&&(e._render(t),de(e,n,{direction:l}))};var At=({store:e,target:t,view:r,treeKeyDownCmds:l,textAreaKeyDownCmd:o,opts:n={}})=>{e.render=function(c){r(c||this)},e.render(),e.schMetas||(e.schMetas={});let a=document.querySelector(`${t} [role='tree']`);if(a){a._aria=xt,a._render=r,e._tree=a,Qt(a),a.onkeydown=ul(e,l,{textAreaKeyDownCmd:o}),a.onclick=ml(e);let c=a._walker.nextNode(),d=e.currentNode||a._walker.nextNode()||c;return $(a,d,{focus:n.focus}),a}},ul=(e,t,r)=>function(l){yl(l,this,e,t,r)};async function yl(e,t,r,l=[],o={}){if(e.target instanceof HTMLTextAreaElement)return hl(e,t,r,o.textAreaKeyDownCmd);let a=new Map(l).get(sr(e));if(!!a&&!(o.denyCmds||[]).includes(a.name)){switch(a({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`)),r.currentNode=t._walker.currentNode,gt(t,t._walker.currentNode,a)}}var hl=(e,t,r,l=[])=>{let o=e.target,a=new Map(l).get(sr(e));!a||(a({tree:t,store:r},o),gt(t,t._walker.currentNode,a))},ml=e=>function(t){return Tl(t,this,e)};function Tl(e,t,r){let l=t._walker.currentNode,o=e.target.closest("[role='treeitem']"),n=!t.querySelector("textarea");if(!!o){if(e.shiftKey||e.metaKey)switch(l.compareDocumentPosition(o)){case Node.DOCUMENT_POSITION_CONTAINS:return $(t,o);case Node.DOCUMENT_POSITION_CONTAINED_BY:return $(t,l);default:if(o.parentNode.closest("[role='treeitem']")!=l.parentNode.closest("[role='treeitem']"))return $(t,o)}e.shiftKey?Ne(t,l,o):e.metaKey?er(l,t._walker.currentNode=o):(t._walker.currentNode=o,ke({tree:t},{notFocusIfTextArea:n}),r.currentNode=t._walker.currentNode,gt(t,o,ke))}}var sr=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:l,key:o})=>{let n=[];return e&&n.push("shift"),(t||l)&&n.push("meta"),r&&n.push("alt"),o&&n.push(o),n.join("-")},gt=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}}));var Me=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var cr=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,xl=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,El=/<[a-z][^>]+$/i,Nl=/>[^<>]*$/,_l=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,bl=/\s+$/,dr=(e,t)=>0<t--&&(El.test(e[t])||!Nl.test(e[t])&&dr(e,t)),vl=(e,t,r)=>xl.test(t)?e:`<${t}${r.replace(bl,"")}></${t}>`,fr=(e,t,r)=>{let l=[],{length:o}=e;for(let a=1;a<o;a++){let c=e[a-1];l.push(cr.test(c)&&dr(e,a)?c.replace(cr,(d,s,f)=>`${t}${a-1}=${f||'"'}${s}${f?"":'"'}`):`${c}<!--${t}${a-1}-->`)}l.push(e[o-1]);let n=l.join("").trim();return r?n:n.replace(_l,vl)};var{isArray:Te}=Array,{indexOf:pr,slice:ze}=[];var wl=1,ur=111,$l=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},mr=(e,t)=>e.nodeType===ur?1/t<0?t?$l(e):e.lastChild:t?e.valueOf():e.firstChild:e,yr=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let l=ze.call(t,0),o=l[0],n=l[r-1];return{ELEMENT_NODE:wl,nodeType:ur,firstChild:o,lastChild:n,valueOf(){if(t.length!==r){let a=0;for(;a<r;)e.appendChild(l[a++])}return e}}};var hr=(e,t,r,l,o)=>{let n=r.length,a=t.length,c=n,d=0,s=0,f=null;for(;d<a||s<c;)if(a===d){let p=c<n?s?l(r[s-1],-0).nextSibling:l(r[c-s],0):o;for(;s<c;)e.insertBefore(l(r[s++],1),p)}else if(c===s)for(;d<a;)(!f||!f.has(t[d]))&&e.removeChild(l(t[d],-1)),d++;else if(t[d]===r[s])d++,s++;else if(t[a-1]===r[c-1])a--,c--;else if(t[d]===r[c-1]&&r[s]===t[a-1]){let p=l(t[--a],-1).nextSibling;e.insertBefore(l(r[s++],1),l(t[d++],-1).nextSibling),e.insertBefore(l(r[--c],1),p),t[a]=r[c]}else{if(!f){f=new Map;let p=s;for(;p<c;)f.set(r[p],p++)}if(f.has(t[d])){let p=f.get(t[d]);if(s<p&&p<c){let m=d,b=1;for(;++m<a&&m<c&&f.get(t[m])===p+b;)b++;if(b>p-s){let h=l(t[d],0);for(;s<p;)e.insertBefore(l(r[s++],1),h)}else e.replaceChild(l(r[s++],1),l(t[d++],-1))}else d++}else e.removeChild(l(t[d++],-1))}return r};var Tr=e=>t=>{for(let r in t){let l=r==="role"?r:`aria-${r}`,o=t[r];o==null?e.removeAttribute(l):e.setAttribute(l,o)}},xr=(e,t)=>{let r,l=!0,o=document.createAttributeNS(null,t);return n=>{r!==n&&(r=n,r==null?l||(e.removeAttributeNode(o),l=!0):(o.value=n,l&&(e.setAttributeNodeNS(o),l=!1)))}},Er=(e,t,r)=>l=>{r!==!!l&&((r=!!l)?e.setAttribute(t,""):e.removeAttribute(t))},Al=({dataset:e})=>t=>{for(let r in t){let l=t[r];l==null?delete e[r]:e[r]=l}},Nr=(e,t)=>{let r,l=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(l=l.toLowerCase()),o=>{let n=Te(o)?o:[o,!1];r!==n[0]&&(r&&e.removeEventListener(l,r,n[1]),(r=n[0])&&e.addEventListener(l,r,n[1]))}},_r=e=>t=>{typeof t=="function"?t(e):t.current=e},br=(e,t)=>t==="dataset"?Al(e):r=>{e[t]=r},vr=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var gl=function(e){"use strict";var t="fragment",r="template",l="content"in a(r),o=l?function(d){var s=a(r);return s.innerHTML=d,s.content}:function(d){var s=a(t),f=a(r),p=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(d)){var m=RegExp.$1;f.innerHTML="<table>"+d+"</table>",p=f.querySelectorAll(m)}else f.innerHTML=d,p=f.childNodes;return n(s,p),s};return function(s,f){return(f==="svg"?c:o)(s)};function n(d,s){for(var f=s.length;f--;)d.appendChild(s[0])}function a(d){return d===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",d)}function c(d){var s=a(t),f=a("div");return f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+d+"</svg>",n(s,f.firstChild.childNodes),s}}(document),kt=gl;var wr=({childNodes:e},t)=>e[t],Ve=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(pr.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:$r,importNode:Qe}=document;var Ar=Qe.length!=1,gr=Ar?(e,t,r)=>Qe.call(document,kt(e,t,r),!0):kt,kr=Ar?e=>$r.call(document,e,1|128,null,!1):e=>$r.call(document,e,1|128);var Se=(e,t,r)=>hr(e.parentNode,t,r,mr,e),kl=e=>{let t,r,l=[],o=n=>{switch(typeof n){case"string":case"number":case"boolean":t!==n&&(t=n,r?r.textContent=n:r=document.createTextNode(n),l=Se(e,l,[r]));break;case"object":case"undefined":if(n==null){t!=n&&(t=n,l=Se(e,l,[]));break}if(Te(n)){t=n,n.length===0?l=Se(e,l,[]):typeof n[0]=="object"?l=Se(e,l,n):o(String(n));break}"ELEMENT_NODE"in n&&t!==n&&(t=n,l=Se(e,l,n.nodeType===11?ze.call(n.childNodes):[n]))}};return o},Dl=(e,t)=>{switch(t[0]){case"?":return Er(e,t.slice(1),!1);case".":return br(e,t.slice(1));case"o":if(t[1]==="n")return Nr(e,t)}switch(t){case"ref":return _r(e);case"aria":return Tr(e)}return xr(e,t)};function Dr(e){let{type:t,path:r}=e,l=r.reduceRight(wr,this);return t==="node"?kl(l):t==="attr"?Dl(l,e.name):vr(l)}var Re="is\xB5",Or=Me(new WeakMap),Ol=/^(?:plaintext|script|style|textarea|title|xmp)$/i,xe=()=>({stack:[],entry:null,wire:null}),Sl=(e,t)=>{let{content:r,updates:l}=Ml(e,t);return{type:e,template:t,content:r,updates:l,wire:null}},Rl=(e,t)=>{let r=fr(t,Re,e==="svg"),l=gr(r,e),o=kr(l),n=[],a=t.length-1,c=0,d=`${Re}${c}`;for(;c<a;){let s=o.nextNode();if(!s)throw`bad template: ${r}`;if(s.nodeType===8)s.textContent===d&&(n.push({type:"node",path:Ve(s)}),d=`${Re}${++c}`);else{for(;s.hasAttribute(d);)n.push({type:"attr",path:Ve(s),name:s.getAttribute(d)}),s.removeAttribute(d),d=`${Re}${++c}`;Ol.test(s.tagName)&&s.textContent.trim()===`<!--${d}-->`&&(s.textContent="",n.push({type:"text",path:Ve(s)}),d=`${Re}${++c}`)}}return{content:l,nodes:n}},Ml=(e,t)=>{let{content:r,nodes:l}=Or.get(t)||Or.set(t,Rl(e,t)),o=Qe.call(document,r,!0),n=l.map(Dr,o);return{content:o,updates:n}},Le=(e,{type:t,template:r,values:l})=>{let{length:o}=l;Mr(e,l,o);let{entry:n}=e;(!n||n.template!==r||n.type!==t)&&(e.entry=n=Sl(t,r));let{content:a,updates:c,wire:d}=n;for(let s=0;s<o;s++)c[s](l[s]);return d||(n.wire=yr(a))},Mr=({stack:e},t,r)=>{for(let l=0;l<r;l++){let o=t[l];o instanceof Xe?t[l]=Le(e[l]||(e[l]=xe()),o):Te(o)?Mr(e[l]||(e[l]=xe()),o,o.length):e[l]=null}r<e.length&&e.splice(r)};function Xe(e,t,r){this.type=e,this.template=t,this.values=r}var{create:Ll,defineProperties:Cl}=Object,Sr=e=>{let t=Me(new WeakMap),r=l=>(o,...n)=>Le(l,{type:e,template:o,values:n});return Cl((l,...o)=>new Xe(e,l,o),{for:{value(l,o){let n=t.get(l)||t.set(l,Ll(null));return n[o]||(n[o]=r(xe()))}},node:{value:(l,...o)=>Le(xe(),{type:e,template:l,values:o}).valueOf()}})},Rr=Me(new WeakMap),Ze=(e,t)=>{let r=typeof t=="function"?t():t,l=Rr.get(e)||Rr.set(e,xe()),o=r instanceof Xe?Le(l,r):r;return o!==l.wire&&(l.wire=o,e.textContent="",e.appendChild(o.valueOf())),e},y=Sr("html"),bo=Sr("svg");var tt={};Ut(tt,{ENTRY_MARKED:()=>Ee,MOVED:()=>K,NEW:()=>j,NEW_KEY:()=>X,NEW_ORDER:()=>Q,NEW_TYPE:()=>Z,REMOVED:()=>I,diff:()=>Il});var Ce=(e,t)=>JSON.stringify(e)==JSON.stringify(t),et=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`};var j="new",I="removed",K="moved",Q="order_changed",X="key_changed",Z="type_changed",Ee="entry_changed",Il=(e,t,r={})=>{let l={},o=[];C(t,(n,a)=>(n._meta=a,Object.assign(l,{[n.$anchor]:n}),delete n._visit,n)),C(e,(n,a)=>{var d;delete n._diff,n._meta=a;let c=l[n.$anchor];if(c){let s=n._meta.parent,f=c._meta.parent;f.$anchor!=s.$anchor&&(n._diff={[K]:{oldParent:f,newParent:s}}),Ce(c.order,n.order)||(n._diff={[Q]:{oldOrder:c.order,newOrder:n.order}}),c.type!=n.type&&Object.assign(n._diff||(n._diff={}),{[Z]:{oldType:c.type,newType:n.type,parent:s}}),c.key!=n.key&&Object.assign(n._diff||(n._diff={}),{[X]:{oldKey:c.key,newKey:n.key,parent:s}}),c.isEntry!=n.isEntry&&Object.assign(n._diff||(n._diff={}),{[Ee]:{oldIsEntry:c.isEntry,newIsEntry:n.isEntry,parent:s}}),n._diff&&o.push(n),c._visit=!0}else a.path.startsWith((d=a.parent.prune)==null?void 0:d.added)||(n._diff={[j]:{parent:a.parent}},o.push(n),Object.assign(a.parent,{prune:{added:a.path}}));return n});for(let n of Object.keys(l)){if(l[n]._visit)continue;let a=l[n]._meta,c=a.path;o.filter(s=>s._diff[I]&&c.startsWith(s._meta.path)).length==0&&(l[n]._diff={[I]:{parent:a.parent}},o.push(l[n]))}return o};var Lr=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),rt(e,"title",t),rt(e,"description",t),Pl(e,"rw",["rw","r","w"],t),Dt(e,"required",t),Ul(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},Ul=(e,t)=>{e.type==v?ql(e,t):e.type==O?Fl(e,t):e.type==A?Bl(e,t):e.type==w?Hl(e,t):e.type==W?jl(e,t):e.type==G?Wl(e,t):e.type==q?Kl(e,t):e.type==re&&Gl(e,t)},jl=(e,t)=>{Yl(e,"pattern",t),H(e,"min",t,{min:0}),H(e,"max",t,{min:0}),Ie(e,t),rt(e,"default",t,Object.assign(Cr(e,["min","max","pattern"]),{ignoreEmpty:!0}))},Kl=(e,t)=>{Dt(e,"default",t)},Wl=(e,t)=>{lt(e,"min",t),lt(e,"max",t),H(e,"multipleOf",t),Ie(e,t),lt(e,"default",t,Cr(e,["min","max","multipleOf"]))},Gl=(e,t)=>{Jl(e,"default",t)},ql=(e,t)=>{H(e,"min",t,{min:0}),H(e,"max",t,{min:0}),Ie(e,t)},Fl=(e,t)=>{H(e,"min",t,{min:1}),H(e,"max",t,{min:1}),Ie(e,t),Dt(e,"unique",t)},Bl=(e,t)=>{H(e,"min",t,{min:1}),H(e,"max",t,{min:1}),Ie(e,t)},Hl=(e,t)=>{},Cr=(e,t=[])=>{let r={};for(let l of t)(e.errors[l]||[]).length==0&&(typeof e.changes[l]=="number"?(e.changes[l]||e.changes[l]==0)&&(r[l]=e.changes[l]):r[l]=e.changes[l]);return r},rt=(e,t,r,l={})=>{if(!r.hasOwnProperty(t)||l.ignoreEmpty&&r[t]=="")return;let o=r[t],n=2**18;(c=>new Blob([c]).size)(o)>n?k(e,t,`string size limit is ${Math.ceil(n/1024)} KB`):l.max&&o.length>l.max?k(e,t,`must be less than or equal ${l.max} length`):l.min&&o.length<l.min?k(e,t,`must be grater than or equal ${l.min} length`):l.pattern?new RegExp(l.pattern).test(o)||k(e,t,`must matche pattern ${l.pattern}`):e.changes[t]=o},Dt=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let l=zl(r[t]);l==null?k(e,t,"must be boolean"):e.changes[t]=l},lt=(e,t,r,l={})=>{if(!r.hasOwnProperty(t))return;let o=Ot(r[t]);!o&&o!=0?k(e,t,"must be number"):l.min&&o<l.min?k(e,t,`must be greater than or equal ${l.min}`):l.max&&o>l.max?k(e,t,`must be less than than or equal ${l.max}`):l.multipleOf&&o%l.multipleOf!=0?k(e,t,`must be multiple of ${l.multipleOf}`):e.changes[t]=o},H=(e,t,r,l)=>{if(!r.hasOwnProperty(t))return;lt(e,t,r,l);let o=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?k(e,t,"must be integer number"):o>Number.MAX_SAFE_INTEGER?k(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):o<Number.MIN_SAFE_INTEGER&&k(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},Yl=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(rt(e,t,r),(e.errors[t]||[]).length==0))try{let l=r[t];if(l=="")return;e.changes[t]=new RegExp(l)}catch(l){k(e,t,"invalid regex")}},Ie=(e,t)=>{if(t.min&&t.max){let r=Ot(t.min),l=Ot(t.max);(r||r==0)&&(l||l==0)&&r>l&&(k(e,"min","min is greater than max"),k(e,"max","max is less than min"))}},Jl=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?k(e,t,"must be null"):e.changes[t]=r[t])},Pl=(e,t,r,l)=>{!l.hasOwnProperty(t)||(r.includes(l[t])?e.changes[t]=l[t]:k(e,t,"value must be r, w, or rw"))},k=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},Ot=e=>Ir(e,"number"),zl=e=>Ir(e,"boolean");var Ir=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=n=>["checkbox","radio"].includes(n.type)?n.checked:n.value,r=this.querySelector("form").elements,l={};for(let n=0;n<r.length;n++){let a=t(r[n]);!(r[n]instanceof HTMLTextAreaElement)&&a==""||(l[r[n].name]=a)}let o={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:l};this.dispatchEvent(new CustomEvent("sch-update",{detail:o,bubbles:!0}))}}});var Mt=(e,t,r)=>{try{Ze(e,y.for(t)`
    <p class="meta-def">${Vl(t.rootKey,t.path)||"-"} : <span>${t.type}</span></p>
    <form data-path="${t.path}" data-file="${t.rootKey}">
      ${nt(t,"title",{keyDisplay:"Title"})}
      ${nt(t,"description",{keyDisplay:"Description"})}
      ${Zl(t)}
      ${Ql(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:"rw",keyDisplay:"Read / Write"})}
      ${Xl(t,"default",{keyDisplay:"Default",min:D(t,"min"),max:D(t,"max")})}
    </form>
  `)}catch(l){console.log(l)}},Vl=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(l=>l!=""),t.splice(0,0,e);let r=y`<span style="color: var(--meta-def-color);">${t[0]}.${t[1]}</span>`;return t=t.slice(2).flatMap(l=>[y`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(l)]),t.splice(0,0,r),t},Ue=(e,t,r,l={})=>{var o;return y`
  <label class="${l.readonly&&`meta-box ${t} readonly`||`meta-box ${t}`}">
    <p class="l">${l.keyDisplay||t} ${l.readonly&&y`<span>· readonly</span>`}</p>
    ${r}
    ${(o=ot(e,t))==null?void 0:o.map(n=>y`<p class="err">${n}</p>`)}
  </label>
  `},nt=(e,t,r={})=>Ue(e,t,y`
    <textarea name="${Pe(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${ot(e,t)&&"invalid"}" oninput="${et}">${r.value||D(e,t)}</textarea>
  `,r),it=(e,t,r={})=>Ue(e,t,y`
    <input type="number" name="${Pe(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${r.min}" max="${r.max}" value="${r.value||D(e,t)}" ?readonly="${r.readonly}" class="${ot(e,t)&&"invalid"}">
  `,r),ee=(e,t,r={})=>Ue(e,t,y`
    <input type="number" name="${Pe(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${r.value||D(e,t)}" ?readonly="${r.readonly}" class="${ot(e,t)&&"invalid"}">
  `,r),St=(e,t,r={})=>Ue(e,t,y`
    <input type="checkbox" name="${Pe(e,t)}" ?disabled="${r.readonly}" ?checked="${r.value||D(e,t)}">
  `,r),Ql=(e,t,r={})=>Ue(e,t,y`
    <select name="${Pe(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([l,o])=>y`<option value="${l}" ?selected="${(r.selected||D(e,t))==l}">${o}</option>`)}
    </select>
  `,r),Xl=(e,t,r={})=>{switch(e.type){case q:return St(e,t,r);case G:return it(e,t,r);case W:return nt(e,t,r);default:return""}},Pe=(e,t)=>t,D=(e,t)=>(e.metadata||{})[t],Zl=e=>{let t;switch(e.type){case v:let r=0;for(let l of Object.keys(e.fields))D(e.fields[l],"required")&&r++;t=[ee(e,"min",{keyDisplay:"Min Properties",value:r,readonly:!0}),ee(e,"max",{keyDisplay:"Max Properties",value:Object.keys(e.fields).length,min:Math.max(D(e,"min")||0,0)})];break;case O:t=[ee(e,"min",{keyDisplay:"Min Items",min:1,value:1,max:D(e,"max")}),ee(e,"max",{keyDisplay:"Max Items",min:D(e,"min")}),St(e,"unique",{keyDisplay:"Item uniqueness"})];break;case A:t=[ee(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),ee(e,"max",{keyDisplay:"Max Items",value:D(e,"max")||e.schs.length})];break;case W:t=[ee(e,"min",{keyDisplay:"Min Length",min:0,max:D(e,"max")}),ee(e,"max",{keyDisplay:"Max Length",min:Math.max(0,D(e,"min"))}),nt(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case G:t=[it(e,"min",{keyDisplay:"Min",max:D(e,"max")}),it(e,"max",{keyDisplay:"Max",min:D(e,"min")}),it(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:D(e,"max")})];break;case Ge:t=[];case q:t=[];case re:t=[];case w:t=[];case ae:t=[];case L:t=[];case U:t=[];default:t=[]}return e._meta.parent.type==v&&e._meta.level>2&&t.push(St(e,"required",{keyDisplay:"Required"})),t};var ot=(e,t)=>e.errors&&e.errors[t];var Rt=(e,t,r={})=>{try{let l=t._models||t.order.reduce((n,a)=>(n[t.fields[a].$anchor]=a,n),{}),o={level:1,tab:0,models:l,schMetas:t.schMetas,rootKey:t.key,taggedLevel:t.taggedLevel};o.rootLevel=o.level,en(e,{sch:t,ui:Object.assign(o,r.ui),path:t.path||"",key:t.key,parent:{type:t.type,level:o.level}})}catch(l){console.log(l)}},en=(e,t)=>Ze(document.querySelector(e),y`
  <ul role="tree" aria-multiselectable="true" class="text-sm" tabindex="-1" aria-labelledby="${t.ui.taggedLevel[t.ui.level]+"_tree"}">
    ${je(t)}
  </ul>
  ${null}
`);var Ur=e=>{if(!e)return"";for(let t of Object.keys(e))switch(t){case j:return"N";case I:return"R";case K:return"M";case Q:return"C";case X:return"C";case Z:return"C";case Ee:return"C"}},je=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return tn(e);case Wt.includes(e.sch.type):return rn(e);default:return ln(e)}},tn=e=>y.for(e.sch,`${e.path}`)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h" id="${e.ui.taggedLevel[e.ui.level]+"_tree"}">
      ${Lt(e.key)}
    </dfn>
    <ul data-group="${jr(e.sch)}" role="group">
      ${Pr(e)}
    </ul>
  </li>`,rn=e=>y.for(e.sch,`${e.path}`)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h" .dataset="${{diff:Ur(e.sch._diff)}}">
      ${Kr(Object.assign(e,{key:Lt(e.key)}))}
      ${Wr(e)}
      ${Gr(e)}
    </dfn>
    <ul data-group="${jr(e.sch)}" role="group">
      ${Pr(e)}
    </ul>
  </li>`,ln=e=>y.for(e.sch,`${e.path}`)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level],diff:Ur(e.sch._diff)}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${Kr(Object.assign(e,{key:Lt(e.key)}))}
    ${Wr(e)}
    ${Gr(e)}
  </li>`,Pr=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return y``;switch(!0){case[v].includes(e.sch.type):return nn(e);case[A].includes(e.sch.type):return on(e);case[O].includes(e.sch.type):return an(e);case[w].includes(e.sch.type):return sn(e);default:return y``}},nn=e=>e.sch.order.map((t,r)=>je({key:t,sch:e.sch.fields[t],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[${t}]`})),on=e=>e.sch.schs.map((t,r)=>je({key:r,sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),an=e=>je({key:0,sch:e.sch.sch,parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:0},path:`${e.path}[][${0}]`}),sn=e=>e.sch.schs.map((t,r)=>je({key:"",sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),at=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab}rem`,qr=(e,t,r)=>y`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${et}"
  >${r}</textarea>`,Kr=e=>e.ui.level==e.ui.rootLevel+1?cn(e):dn(e),cn=e=>y`
  <span class="def" style="${at(e)}">
    ${fn(e.sch,e.ui)}
  </span>
  <span class="k">${Fr(e)}</span>
  <span class="s">=</span>
  `,dn=e=>{switch(!0){case e.parent.type==w:return y`
      <span class="" style="${at(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==O:return y`
      <span class="k" style="${at(e)}"></span>
      <span class="s">└</span>
      `;default:return y`
      <span class="k" style="${at(e)}">
        ${Fr(e)}
      </span >
      <span class="s">:</span>
    `}},Fr=e=>e.sch.uiMode=="editKey"?qr("key-edit",e.parent.path,e.key):y`${e.key}`,Wr=e=>e.ui.level==e.ui.rootLevel+1?pn(e):un(e),pn=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):y`<span class="t">${Br(e)}</span>`,un=e=>y`<span class="t">${Br(e)}</span>`,Br=e=>e.sch.uiMode=="editType"?qr("type-edit",e.parent.path,mn(e.sch,e.ui)):y`${Hr(e.sch,e.ui)}`,mn=(e,t)=>{switch(!0){case e.type==U:return JSON.stringify(e.const);case e.type==L:return t.models[e.$ref];default:return e.type}},Hr=(e,t)=>{let r;switch(!0){case(e.type==v&&Ce(e.fields,{})):r="{ any }";break;case e.type==v:r="{ \xA0 }";break;case e.type==O:r=y`[ ${Hr(e.sch,t)} ]`;break;case e.type==A:r="( \xA0 )";break;case e.type==W:r="string";break;case e.type==G:r="number";break;case e.type==Ge:r="integer";break;case e.type==q:r="bool";break;case e.type==re:r="null";break;case e.type==w:r="||";break;case e.type==ae:r="any";break;case(e.type==L&&!!t.models[e.$ref]):r=y`<span class="ref">${e._text=t.models[e.$ref]}</span>`;break;case e.type==L:r=y`<span class="ref notfound" title="Ref type">${`${e._text} (#404)`}</span>`;break;case e.type==U:r=y`<span class="value" title="Value type">${JSON.stringify(e.const)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},Lt=e=>e,jr=e=>{switch(!0){case[v].includes(e.type):return"keyed";case[A,w].includes(e.type):return"indexed";default:return"none"}},fn=(e,t)=>{let r;switch(!0){case e.type==v:r="record";break;case e.type==O:r="list";break;case e.type==A:r="tuple";break;case e.type==w:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},Gr=e=>{let t=e.ui.schMetas[e.sch.$anchor],r;switch(!0){case(e.parent.type==v&&(t==null?void 0:t.required)):r=[y`<span class="m"> · required</span>`];break;default:r=[]}return r};var Yr=({store:e,target:t})=>{At({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",_t],["shift-meta-ArrowDown",bt],["shift-ArrowUp",vt],["shift-ArrowDown",wt],["meta-ArrowUp",be],["meta-ArrowDown",ve],["ArrowUp",we],["ArrowDown",$e],["Home",Ae],["End",ge],["shift-+",fe],["Enter",$t],["Delete",V],["m",ue],["meta-v",me],["shift-alt-ArrowUp",ye],["shift-alt-ArrowDown",he],["alt-ArrowUp",De],["alt-ArrowDown",Oe],["Escape",({tree:r})=>B(r)]],textAreaKeyDownCmd:[["Enter",pe]],view:r=>Rt(t,r||e,{ui:{depthLimit:2,modelTypeText:(l,o)=>"file",typeText:(l,o)=>{if(l.type==T.RECORD)return"record";if(l.type==T.VALUE)return"value";if(l.type==T.TUPLE)return"tuple";if(l.type==T.UNION)return"union"},viewTypeTop:l=>""}}),opts:{focus:!0}})},st=({store:e,target:t})=>{At({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",_t],["shift-meta-ArrowDown",bt],["shift-ArrowUp",vt],["shift-ArrowDown",wt],["meta-ArrowUp",be],["meta-ArrowDown",ve],["ArrowUp",we],["ArrowDown",$e],["Home",Ae],["End",ge],["shift-+",fe],["Enter",$t],["shift-Enter",rr],["Delete",V],["m",ue],["meta-x",nr],["meta-c",or],["meta-v",me],["shift-alt-ArrowUp",ye],["shift-alt-ArrowDown",he],["alt-ArrowUp",De],["alt-ArrowDown",Oe],["Escape",({tree:r})=>B(r)]],textAreaKeyDownCmd:[["Enter",pe]],view:r=>Rt(t,r||e,{ui:{modelTypeText:(l,o)=>l.isEntry?"entrypoint":"type"}})})},ct=({store:e,target:t,treeTarget:r})=>{let l=document.querySelector(t),o=document.querySelector(`${r} [role='tree']`);if(!l||!o)return;let n=({tree:a,store:c})=>{let d=a.querySelectorAll("[role='treeitem'][aria-selected='true']");if(d.length==1){let s=le(c,d[0].id);s.path=d[0].id,s.rootKey=a.querySelector(".root-item").key,s.metadata=c.schMetas[s.$anchor],Mt(l,s,c)}};o._renderSchMeta=a=>n({tree:o,store:a||e}),o._renderSchMeta(),e.renderSchMeta=function(a){o._renderSchMeta(a||this)}};var Y="file",oe="project",zr=(e,t)=>{t.entrypoints={};for(let r of e.files)t.fields[r.key]=yn(r,Jr(),t);return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,t.schMetas=e.allmeta||{},S(()=>t)},yn=(e,t,r)=>{for(let l of e.fmodels)Object.assign(l.sch,{$anchor:l.anchor,type:l.type,key:l.key,isEntry:l.is_entry}),l.sch.isEntry&&(r.entrypoints[l.sch.$anchor]={}),t.fields[l.key]=l.sch;return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,S(()=>t)},Vr=()=>Ct({taggedLevel:{1:oe,2:Y,3:R},allowedSchs:[Jr()],put:{pos:"prepend",onlyDst:{[Y]:!0}}}),Jr=()=>Ct({taggedLevel:{1:Y,2:R},addDefault:()=>Ct(),entryable:[R]}),Ct=(e={})=>{let t=S(ut);return t.taggedLevel=e.taggedLevel,t.allowedSchs=e.allowedSchs||hn.map(r=>r()),e.tag&&(t._tag=e.tag),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.type==e.addDefault().type)&&e.addDefault()),e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),t},te=(e,t)=>{let r=le(e,`[${t}]`);return r.schMetas=e.schMetas,r},Ke=(e,t)=>{let r={};for(let l of e.order){let o=e.fields[l];for(let n of o.order)r[o.fields[n].$anchor]=l!=t.key?`${l}.${n}`:n}return r},hn=[Gt,ut,Ht,Yt,Jt,J,qt,Ft,Bt,()=>qe('"json string"')];var Qr=(e,t,r,l)=>{let o=t.closest("[data-tag='file']"),n=o==null?void 0:o.key;t.closest("[id='project']")?Tn(e,n,r,l):t.closest("[id='fmodel']")&&xn(e,n,t,r,l)},Tn=(e,t,r,l)=>{switch(!0){case(t&&Nn(r.name)):e._diffToRemote=l(),En(e,t),e.render();break;case(t&&Xr(r.name)):e._diffToRemote=l(),te(e,t).render();break;default:e._diffToRemote=l(),e.render()}},xn=(e,t,r,l,o)=>{let n;switch(!0){case bn(l.name):if(r.dataset.tag!=R)return;_n(e,(a,c)=>(c.path==`[${t}]${r.id}`?(e.entrypoints={},e.entrypoints[a.$anchor]={}):a.isEntry&&(delete a.isEntry,delete e.entrypoints[a.$anchor]),a)),e._diffToRemote=o(),n=te(e,t),n.render();break;case Xr(l.name):e._diffToRemote=o(),n=te(e,t),n._models=Ke(e,n),n.render();break;default:e._diffToRemote=o(),n=te(e,t),n.render(),n.renderSchMeta()}},En=(e,t)=>{let r=te(e,t);if(r&&(r._models=Ke(e,r),st({store:r,target:"[id='fmodel']"}),ct({store:r,target:"[id='fsch']",treeTarget:"[id='fmodel']"}),!window._treeClipboard)){let l=document.querySelector("[id='fmodel'] [role='tree']");l._aria.clearClipboard(l)}},Zr={update:({store:e,detail:t})=>{let{path:r,attrs:l}=t,o=F(e,r,(n,a)=>Lr(n,l));return e.render&&e.render(e),Object.assign(e.schMetas,{[o.$anchor]:o.metadata}),e.renderSchMeta&&e.renderSchMeta(e),o}},_n=(e,t)=>{for(let r of Object.keys(e.fields)){let l=e.fields[r];for(let o of Object.keys(l.fields)){let n=l.fields[o];l.fields[o]=t(n,{path:`[${l.key}][${n.key}]`})}}},Nn=e=>[we,$e,be,ve,Ae,ge,ke,ye,he,V].map(t=>t.name).includes(e),Xr=e=>[fe,V,pe,me].map(t=>t.name).includes(e),el=e=>[fe,V,pe,me,ye,he,De,Oe,V,ue].map(t=>t.name).includes(e),bn=e=>[ue].map(t=>t.name).includes(e);var tl=(e,t,r)=>{if(!el(t.name))return;let l=x=>{for(let u of Object.keys(e.fields))if(e.fields[u].fields[x])return{file:e.fields[u],fmodelDst:e.fields[u].fields[x]}},o=x=>se(e,(u,E)=>{if(e.taggedLevel[E.level]==R&&E.path!="")return x.startsWith(E.path)},(u,E)=>(u._meta=E,u)),n=({$anchor:x,key:u,order:E,type:M})=>({$anchor:x,key:u,order:E,type:M}),a=x=>n(x),c=x=>x,d=e._diffToRemote,s={};s.files=[],s.fmodels=[],s.subfmodels=[];for(let x of d){let u=e.taggedLevel[x._meta.level];u==oe?s.project=x:u==Y?s.files.push(x):u==R?s.fmodels.push(x):s.subfmodels.push(x)}let f={},p={},m={};s.project&&(f.project=a(s.project));for(let x=0;x<s.files.length;x++){let u=s.files[x],E=n(u);if(p.files||(p.files={}),m.files||(m.files={}),f.files||(f.files={}),p.fmodels||(p.fmodels={}),m.fmodels||(m.fmodels={}),u._diff[j]){p.files[u._meta.path]={...E,parentAnchor:u._diff[j].parent.$anchor};for(let M of Object.keys(u.fields))p.fmodels[`[${u.key}][${M}]`]={...c(u.fields[M]),parentAnchor:E.$anchor}}if(u._diff[I]){m.files[u._meta.path]={$anchor:E.$anchor,parentAnchor:u._diff[I].parent.$anchor};for(let M of Object.keys(u.fields))m.fmodels[`[${u.key}][${M}]`]={$anchor:u.fields[M].$anchor,parentAnchor:E.$anchor}}(u._diff[Q]||u._diff[X])&&(f.files[u._meta.path]=E),u._diff[K]&&console.log("project does not permit as parent for moving items"),u._diff[Z]&&console.log("file type is always record, cannot be changed")}for(let x=0;x<s.fmodels.length;x++){let u=s.fmodels[x],E=c(u);if(f.files||(f.files={}),p.fmodels||(p.fmodels={}),m.fmodels||(m.fmodels={}),f.fmodels||(f.fmodels={}),u._diff[j]&&(p.fmodels[u._meta.path]={...E,parentAnchor:u._diff[j].parent.$anchor}),u._diff[I]&&(m.fmodels[u._meta.path]={$anchor:E.$anchor,parentAnchor:u._diff[I].parent.$anchor}),(u._diff[Q]||u._diff[X]||u._diff[Z]||u._diff[Ee])&&(f.fmodels[u._meta.path]={...E,parentAnchor:u._meta.parent.$anchor}),u._diff[K]){let{oldParent:M,newParent:ie}=u._diff[K];switch(e.taggedLevel[M.level]){case oe:console.log("fmodel cannot be moved from project as direct child");break;case Y:var b=e.fields[M.key],h=n(b);f.files[b._meta.path]=h,m.fmodels[u._meta.path]={$anchor:u.$anchor,parentAnchor:h.$anchor};break;case R:var N=l(M.key),h=N.file;f.fmodels[N.fmodelDst._meta.path]={...c(N.fmodelDst),parentAnchor:h.$anchor};break;default:var _=o(M.path),N=l(_.key),h=N.file;f.fmodels[_._meta.path]={...c(_),parentAnchor:h.$anchor}}switch(e.taggedLevel[ie.level]){case oe:console.log("fmodel cannot be moved to project as direct child");break;case Y:var b=e.fields[ie.key],h=n(b);f.files[b._meta.path]=h,p.fmodels[u._meta.path]={...E,parentAnchor:h.$anchor};break;case R:var N=l(ie.key),h=N.file;f.fmodels[N.fmodelDst._meta.path]={...c(N.fmodelDst),parentAnchor:h.$anchor};break;default:var _=o(ie.path),N=l(_.key),h=N.file;f.fmodels[_._meta.path]={...c(_),parentAnchor:h.$anchor}}}}for(let x=0;x<s.subfmodels.length;x++){let u=s.subfmodels[x];if(f.files||(f.files={}),p.fmodels||(p.fmodels={}),m.fmodels||(m.fmodels={}),f.fmodels||(f.fmodels={}),u._diff[j]||u._diff[I]||u._diff[Q]||u._diff[X]||u._diff[Z]){let E=o(u._meta.path),ie=l(E.key).file;f.fmodels[E._meta.path]={...c(E),parentAnchor:ie.$anchor}}if(u._diff[K]){let{oldParent:E,newParent:M}=u._diff[K];switch(e.taggedLevel[E.level]){case oe:console.log("subfmodel cannot be moved from project as direct child");break;case Y:var b=e.fields[E.key],h=n(b);f.files[b._meta.path]=h,m.fmodels[u._meta.path]={$anchor:u.$anchor,parentAnchor:h.$anchor};break;case R:default:var _=o(E.path),N=l(_.key),h=n(N.file);f.fmodels[_._meta.path]={...c(_),parentAnchor:h.$anchor}}switch(e.taggedLevel[M.level]){case oe:console.log("subfmodel cannot be moved to project as direct child");break;case Y:var _=o(u._meta.path),N=l(_.key),h=n(b);f.files[N.file._meta.path]=h,p.fmodels[u._meta.path]={...c(u),parentAnchor:h.$anchor};break;case R:default:var _=o(u._meta.path),N=l(_.key),h=N.file;f.fmodels[_._meta.path]={...c(_),parentAnchor:h.$anchor}}}}let It=x=>{if(!x)return;let u=Object.keys(x);for(let E=0;E<u.length;E++)x[u[E]]=Vt(x[u[E]])};return It(p.fmodels),It(f.fmodels),delete e._diffToRemote,console.log({changed:f,added:p,removed:m}),r({changed:f,added:p,removed:m})};var vn={createProjectStore:Vr,getFileStore:te,anchorsModels:Ke,projectToStore:zr,controller:Qr,taggedDiff:tl,SchMeta:Zr};export{tt as Diff,st as FmodelTree,vn as Project,Yr as ProjectTree,ct as SchMetaForm};
/*! (c) Andrea Giammarchi - ISC */
