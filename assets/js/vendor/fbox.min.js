var Vl=Object.defineProperty;var Zr=(e,t)=>{for(var r in t)Vl(e,r,{get:t[r],enumerable:!0})};var Ot,Fl=new Uint8Array(16);function cr(){if(!Ot&&(Ot=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Ot))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ot(Fl)}var en=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Gl(e){return typeof e=="string"&&en.test(e)}var tn=Gl;var O=[];for(var dr=0;dr<256;++dr)O.push((dr+256).toString(16).substr(1));function ql(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(O[e[t+0]]+O[e[t+1]]+O[e[t+2]]+O[e[t+3]]+"-"+O[e[t+4]]+O[e[t+5]]+"-"+O[e[t+6]]+O[e[t+7]]+"-"+O[e[t+8]]+O[e[t+9]]+"-"+O[e[t+10]]+O[e[t+11]]+O[e[t+12]]+O[e[t+13]]+O[e[t+14]]+O[e[t+15]]).toLowerCase();if(!tn(r))throw TypeError("Stringified UUID is invalid");return r}var rn=ql;function Kl(e,t,r){e=e||{};var n=e.random||(e.rng||cr)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var l=0;l<16;++l)t[r+l]=n[l];return t}return rn(n)}var ur=Kl;var R=10,K=11,me=12,U=13,B=14,V=15,C=16,he=17,Z=18,ee=19,te=20,re=21,ne=22,le=23;var Te=24,ye=25;var xe=26,Ee=27,z=28,_e=29,et=30,Dt=31,F="fmodel",$e=()=>({t:et}),It=()=>({t:he}),nn=()=>({t:xe}),ln=()=>({t:Z}),an=()=>({t:te}),on=()=>({t:ne}),sn=()=>({t:ee}),cn=()=>({t:re}),dn=()=>({t:le}),un=()=>({t:Te}),fn=()=>({t:ye}),pn=()=>({t:Dt}),mn=()=>({t:Ee}),J=()=>({t:R,fields:[]}),hn=()=>({t:K,schs:[A(()=>Ae(null)),A(J)]}),Tn=()=>({t:U,sch:A($e)}),yn=()=>({t:B,schs:[A($e)]}),xn=()=>({t:V,schs:[A($e)]}),_n=()=>({t:C,fields:[{...A(J),key:"tag_a"}],tagname:"tag",allowedSchs:[J()],keyPrefix:"tag"}),bn=()=>({t:me,schs:[A(It),A($e)]}),Ae=(e,t)=>Object.assign({t:z,$r:e},t),Mt=e=>{try{return e=JSON.parse(e),e==null||["string","number","boolean"].includes(typeof e)?{t:_e,v:e}:!1}catch(t){return!1}},A=(e,t={})=>{let r=e();return r.$a||(r.$a=ur()),t.force&&(r.$a=ur()),r},Se=e=>Bl[e],Bl={[R]:"record",[K]:"e_record",[me]:"dict",[U]:"list",[B]:"tuple",[V]:"union",[C]:"tagged_union",[he]:"string",[Z]:"int8",[ee]:"uint8",[te]:"int16",[re]:"uint16",[ne]:"int32",[le]:"uint32",[Te]:"float32",[ye]:"float64",[xe]:"boolean",[Ee]:"nil",[z]:"ref",[_e]:"value",[et]:"any",[Dt]:"timestamp"},Pt=e=>Wl[e],Wl={[Z]:{min:-128,max:127},[te]:{min:-32768,max:32767},[ne]:{min:-2147483648,max:2147483647},[ee]:{min:0,max:255},[re]:{min:0,max:65535},[le]:{min:0,max:4294967295}};var tt=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},wn=e=>{tt(e),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},{defineProperty:Hl}=Object,Nn=Hl,N=(e,t,r)=>Nn(e,t,{value:r,configurable:!0}),Rt=(e,t,r)=>Nn(e,t,{value:r,configurable:!0,writable:!0}),fr=function(e,t,r){var n=null;return function(){n&&clearTimeout(n);var l=arguments;n=setTimeout(function(){n=null,e.apply(r,l)},t)}},Ct=(e,t)=>{for(let r=0;r<e.length;r++)if(t(e[r]))return e[r]},be=(e,t)=>{for(let r=0;r<e.length;r++)t(e[r],r)},rt=(e,t,r)=>{for(let n=0;n<e.length;n++)t(r,e[n]);return r};var Lt=(e,t)=>{let r=JSON.parse(JSON.stringify(e));return D(r,(n,l)=>A(()=>n,{force:!0})),r},gn=e=>JSON.parse(JSON.stringify(e)),pr=({t:e,$a:t,key:r},{path:n,lpath:l,level:i})=>({t:e,$a:t,key:r,level:i,path:n,lpath:l}),mr=(e,t)=>{let r=e.slice(0);return r.push(t),r},D=(e,t,r={path:"",lpath:[e],level:1,parent:{}})=>{if(delete e._halt,delete e._pruned,e=t(e,r),e._halt||e._pruned)return e;switch(!0){case e.hasOwnProperty("fields"):be(e.fields,(i,a)=>{let o=i.key,s={path:`${r.path}[${o}]`,level:r.level+1,index:a,parent:pr(e,r),lpath:mr(r.lpath,i)};if(i=D(i,t,s),e.fields[a]=i,i._halt)return Object.assign(e,{_halt:!0})});break;case e.hasOwnProperty("schs"):be(e.schs,(i,a)=>{let o={path:`${r.path}[][${a}]`,level:r.level+1,index:a,parent:pr(e,r),lpath:mr(r.lpath,i)};if(i=D(i,t,o),e.schs[a]=i,i._halt)return Object.assign(e,{_halt:!0})});break;case e.hasOwnProperty("sch"):let n=e.sch,l={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:pr(e,r),lpath:mr(r.lpath,n)};if(n=D(e.sch,t,l),e.sch=n,n._halt)return Object.assign(e,{_halt:!0});break;default:}return e},hr=(e,t,r)=>{let n={original:{},popped:[]};return D(e,(l,i)=>{if(typeof t=="function"&&!t.call(null,l,i))return l;if(typeof t!="function"&&i.path!=t)return l;{typeof t=="string"&&(l._halt=!0),typeof r=="function"&&(r=r.call(null,l,i));let a=r.sort((o,s)=>s-o);switch(!0){case l.hasOwnProperty("fields"):for(let o of a)n.popped.unshift({k:l.fields[o].key,sch:l.fields.splice(o,1)[0],index:o});break;case l.hasOwnProperty("sch"):break;case l.hasOwnProperty("schs"):for(let o of a)n.popped.unshift({k:o,sch:l.schs.splice(o,1)[0],index:o});l.schs.length==0&&l.schs.splice(0,0,A($e));break;default:}return l}}),n},Yl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),nt=(e,t,r)=>{let n={original:{},inserted:[]},l=(i,a)=>(i=Math.max(i,0),i=Math.min(i,a),i);return D(e,(i,a)=>{var o;if(typeof t=="function"&&!t.call(null,i,a))return i;if(typeof t!="function"&&a.path!=t)return i;{typeof t=="string"&&(i._halt=!0),typeof r=="function"&&(r=r.call(null,i,a));let s=r.sort((c,p)=>c.index-p.index);switch(!0){case i.hasOwnProperty("fields"):let c=(o=e.taggedLevel)==null?void 0:o[a.level+1],p=[],{keys:u,anchors:x}=rt(i.fields,(f,m)=>(Object.assign(f.keys,{[m.key]:!0}),Object.assign(f.anchors,{[m.$a]:!0}),f),{keys:{},anchors:{}});for(let{k:f,sch:m,index:d}of s){if(x[m().$a])continue;for(f=f==0?"0":f,f=f||`${c||i.keyPrefix||"key"}_${Math.floor(Date.now()/100)}`,f=`${f}`;u[f];)f=`${f} \u2013`;u[f]=!0,d=l(d,i.fields.length+p.length);let h=A(m);h.key=f,h.index=d,p.push(h),n.inserted.push({k:h.key,sch:h,index:d})}s.length!=0&&i.fields.splice(s[0].index,0,...p);break;case i.hasOwnProperty("sch"):break;case i.hasOwnProperty("schs"):for(let{k:f,sch:m,index:d}of s){d=l(d,i.schs.length);let h=A(m);h.index=d,i.schs.splice(d,0,h),n.inserted.push({k:f,sch:i.schs[d],index:d})}break;default:}return i}}),n},Ut=(e,{isRefConstraint:t,dstPath:r,dstLevel:n,dstStore:l,startIndex:i=0},a)=>{let o=(u,x,f)=>we(u,x,(m,d)=>(N(m,"_pinId",f),m)),s=Symbol(r);o(e,r,s);let c=jt(e,a,{dstPath:r,dstLevel:n,dstStore:l,isRefConstraint:t});return Tr(e,{dstPin:s,startIndex:i},c)},jt=(e,t,r={})=>{let n={},l=Yl(Object.keys(t));r.isRefConstraint==null&&(r.isRefConstraint=!0);let i=r.dstStore||e;for(let a of l){let o=t[a],s=m=>{var d;return(d=o.find(h=>h.index==m))==null?void 0:d.newK},c=m=>{var d;return((d=m.sch)==null?void 0:d.referrers)&&m.sch.referrers.length!=0&&r.isRefConstraint},p=r.dstLevel!=i.refParentLevel;if(r.dstPath&&Ct(o,d=>r.dstPath.startsWith(d.id)))continue;let u=rt(o,(m,d)=>(c(d)&&p?m.refed.push(d):m.indices.push(d.index),m),{indices:[],refed:[]});r.isRefConstraint&&be(u.refed,m=>m.setAttribute("data-err","ref"));let f=hr(e,a,u.indices).popped.map(({k:m,sch:d,index:h})=>({k:s(h)||m,sch:()=>d}));n[a]=f}return n},Tr=(e,{dstPin:t,dstPath:r,startIndex:n=0},l)=>{let i=(c,p)=>Oe(c,(u,x)=>u._pinId==p,(u,x)=>(N(u,"_pinned",x),u));n=Math.max(n,0);let a={},o=Object.values(l).flatMap(c=>c).map((c,p)=>Object.assign(c,{index:n+p}));if(t){let c=i(e,t);c&&(r=c._pinned.path)}let s=nt(e,r,o);return s.inserted.length!=0&&(a[r]=s.inserted),a},_r=(e,{dstPath:t,startIndex:r=0},n)=>{let l=yr(e,n,{dstPath:t,startIndex:r});return xr(e,{dstPath:t},l)},yr=(e,t,r={})=>rt(Object.values(t),(n,l)=>{let i=l.map(o=>o.id),a=[];Oe(e,(o,s)=>(i.includes(s.path)&&(N(o,"_meta",s),a.unshift(o)),a.length==i.length),(o,s)=>o);for(let o of l){if(r.dstPath&&r.dstPath.startsWith(o.id))continue;let s=a.find(c=>c._meta.path==o.id);s&&n.unshift({k:o.key,sch:()=>Lt(s,e),index:r.startIndex+n.length,id:o.id})}return n},[]),xr=(e,{dstPath:t},r)=>{let n={},l=nt(e,t,r);return l.inserted.length!=0&&(n[t]=l.inserted),n},Vt=(e,t,r)=>we(e,t,(n,l)=>{let i=A(r),{title:a,description:o,rw:s,required:c,$a:p,key:u}=n,x=i.t==z&&i.$r!=n.$r,f=i.t==_e&&i.v!=n.v,m=i.t!=n.t;return i.$r==p?n:m||f||x?Object.assign(i,{metadata:{title:a,description:o,rw:s,required:c},$a:p,key:u}):n}),W=(e,t)=>Oe(e,(r,n)=>n.path==t,(r,n)=>(N(r,"_meta",n),r)),we=(e,t,r)=>Oe(e,(n,l)=>l.path==t,r),Oe=(e,t,r)=>{let n;return D(e,(l,i)=>t(l,i)?(n=r(l,i),n._halt=!0,n):l),n&&delete n._halt,n};var br={};Zr(br,{clearClipboard:()=>Ie,collapseSelected:()=>gr,createWalker:()=>vn,ensureNodeConnected:()=>Gt,expandSelected:()=>Nr,findUnselectedNode:()=>ht,reselectNodes:()=>it,selectMultiNode:()=>Be,selectMultiNodeTo:()=>mt,selectNode:()=>$,selectedGroupedByParent:()=>De,toggleSelectNode:()=>$n});var H="aria-selected",Ft="aria-expanded",vn=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{var r;if(t.hasAttribute(H)){let n=(r=t.parentElement.closest(`[${Ft}]`))==null?void 0:r.getAttribute(Ft);return n&&n=="false"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}else return NodeFilter.FILTER_SKIP}},!1),e),$=(e,t,r={focus:!0})=>{t=Gt(e,t),!!t&&(e._walker.currentNode=t,kn(e),lt(t),r.focus&&t.focus())},$n=(e,t)=>{e&&(e.tabIndex=-1),En(t)},Be=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(H)=="true"?En(e):lt(t),r.focus&&t.focus())},kn=(e,t={})=>{t=Object.assign({sync:!0},t);for(let r of e.querySelectorAll(`[${H}='true']`))t.sync?qt(r):fr(qt,0)(r)},wr=(e,t,r,n={})=>{var a,o,s;let l=e._walker.currentNode,i=t();if(!!i){if(l==r)return(a=n.target)==null?void 0:a.call(null,r);(o=n.pre)==null||o.call(null,l,i),wr(e,t,r,n),(s=n.post)==null||s.call(null,l,i)}},mt=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,wr(e,()=>e._walker.nextSibling(),r,{pre:(n,l)=>{Be(n,l,{focus:!1})}}),e._walker.currentNode=r,lt(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,lt(r.parentNode.closest(`[${H}]`)),wr(e,()=>e._walker.previousSibling(),r,{pre:(n,l)=>{Be(n,l,{focus:!1})}}),qt(r.parentNode.closest(`[${H}]`)),e._walker.currentNode=r,lt(r),r.focus();break}},lt=e=>{!e||(e.setAttribute(H,!0),e.tabIndex=0)},qt=e=>{!e||(e.setAttribute(H,!1),e.tabIndex=-1)},En=e=>(e==null?void 0:e.getAttribute(H))=="true"?qt(e):lt(e),ht=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(H))=="true");return t},zl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),it=(e,t,r={})=>{kn(e,r);for(let n of zl(Object.keys(t))){let l=t[n];if(n==""?n=e.querySelector("[id][aria-level]"):n=e.querySelector(`[id='${CSS.escape(n)}'][aria-level]`),!n)continue;let i=parseInt(n.getAttribute("aria-level")),a=n.querySelectorAll(`[aria-level='${i+1}'][role='treeitem']`);for(let o=0;o<l.length;o++){let s=l[o].index,c=a[s];if(!c)return;r.direction&&c.classList.add(r.direction),Be(a[s-1],c,{focus:!1}),e._walker.currentNode=c}r=Object.assign({sync:!0},r),r.sync?e._walker.currentNode.focus():fr(()=>e._walker.currentNode.focus())()}},De=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${H}='true']`}`),n={};for(let l=0;l<r.length;l++){let i=r[l],a=i.parentNode.closest("[role='treeitem']");if(!a)break;i.index=i.index||parseInt(i.getAttribute("aria-posinset"))-1,n[a.id]=n[a.id]||[],n[a.id].push(i)}return n},Nr=e=>{let t=e.querySelectorAll(`[${H}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(Ft,"true")},gr=e=>{let t=e.querySelectorAll(`[${H}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(Ft,"false")},Ie=e=>{be(e.querySelectorAll(".item-cutting, .item-copying, [data-err]"),t=>{t.classList.remove("item-cutting","item-copying"),t.removeAttribute("data-err")}),window._treeClipboard=null},Gt=(e,t)=>t&&!t.isConnected?t.id?e.querySelector(`[id='${CSS.escape(t.id)}']`):e.querySelector("[id]"):t;var Jl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();mt(e,t,r)},Xl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();mt(e,t,r)},Ql=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();Be(t,r)},Zl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();Be(t,r)},ei=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();$(e,t)},ti=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();$(e,t)},ri=({tree:e})=>$(e,e._walker.previousNode()),ni=({tree:e})=>$(e,e._walker.nextNode()),li=({tree:e})=>{for(;e._walker.parentNode(););$(e,e._walker.nextNode()),$(e,e._walker.parentNode())},ii=({tree:e})=>{for(;e._walker.nextNode(););$(e,e._walker.currentNode)},Tt=({tree:e},t={})=>$(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),yt=({tree:e,store:t},r)=>An(e,t,r),Kt={selectMultiNodeUpTo:Jl,selectMultiNodeDownTo:Xl,selectMultiNodeUp:Ql,selectMultiNodeDown:Zl,selectUpEnd:ei,selectDownEnd:ti,selectUp:ri,selectDown:ni,selectRoot:li,selectLast:ii},ie=({tree:e,store:t})=>{var a,o;let r=e._walker.currentNode,n=W(t,r.id),l,i=((a=vr(e,t))==null?void 0:a[0])||n._addSchDefault||n.allowedSchs&&n.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!i||(((o=t.put)==null?void 0:o.pos)=="prepend"?l=0:l=Number.MAX_SAFE_INTEGER,nt(t,r.id,[{k:null,sch:()=>Lt(i),index:l}]),e._render(t),$(e,r))},at=({tree:e,store:t})=>{var l,i;let r=e._walker.currentNode;if(((i=(l=r.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:i.group)=="keyed"){let a=r.querySelector(".k").getBoundingClientRect();Sn({tree:e,store:t,editMode:"editKey",textRect:a})}},ot=({tree:e,store:t})=>{let r=e._walker.currentNode.querySelector(".t").getBoundingClientRect(),n=vr(e,t)||t.allowedSchs;Sn({tree:e,store:t,editMode:"editType",textRect:r,opts:{allowedTs:n}})},Sn=({tree:e,store:t,editMode:r,textRect:n,opts:l={}})=>{let i=e._walker.currentNode,a=we(t,i.id,(c,p)=>N(c,"uiMode",r));e._render(t);let o=e.querySelector("textarea");if(!o)return;let s=window.getComputedStyle(o);o.style.minWidth=n.width+"px",o.style.minHeight=n.height+"px",o._treeItem=i,o.opts=l,o.onblur=c=>c.relatedTarget&&c.relatedTarget.id!=o._treeItem.id&&An(e,t,o),o.focus()},An=(e,t,r)=>{let n=we(t,r._treeItem.id,(l,i)=>N(l,"uiMode","cancelled-edit"));e._render(t),n&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),$(e,e._walker.currentNode))},Ne=({tree:e,store:t},r)=>{r.id=="key-edit"?On(e,t,r,oi):r.id=="type-edit"&&On(e,t,r,ai)},On=(e,t,r,n)=>{let l=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),$(e,r._treeItem,{focus:!1});let i=n(e,t,r)||l.id;we(t,i,(a,o)=>N(a,"uiMode","editted")),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(i)}']`),$(e,e._walker.currentNode)},ai=(e,t,r)=>{let n=vr(e,t)||t.allowedSchs,l=n.find(o=>Se(o.t)==r.value),i=t._models[r.value]&&r.value||Object.keys(t._models).find(o=>{let s=t._models[o];return t._models[o].display==r.value?n.find(p=>{if(p.t==Ae(null).t)return p.to?p.to.t==s.sch.t:!0}):!1}),a=Mt(r.value);return l?Vt(t,r._treeItem.id,()=>Lt(l)):i?Vt(t,r._treeItem.id,()=>Ae(i)):a&&Vt(t,r._treeItem.id,()=>a),e._walker.currentNode.id},oi=(e,t,r)=>{let n=De(e),l=r.dataset.parentPath;n[r.dataset.parentPath]=n[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>Object.assign(c,{newK:r.value}));let i=n[r.dataset.parentPath][0].index,o=Ut(t,{dstPath:l,startIndex:i},n)[l][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${o}]`},Y=({tree:e,store:t})=>{let r=ht(()=>e._walker.nextSibling())||ht(()=>e._walker.previousSibling())||ht(()=>e._walker.parentNode());jt(t,De(e)),e._render(t),$(e,r)},xt=({tree:e,store:t})=>{var n;let r=e._walker.currentNode;!r||((n=t.entryable)==null?void 0:n.includes(r.dataset.tag))&&(we(t,r.id,(l,i)=>Object.assign(l,{isEntry:!0})),e._render(t),$(e,r))};var We=({store:e,tree:t})=>{Ie(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-cutting");let r=De(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",srcStore:e,ops:({dstPath:n,dstLevel:l,dstStore:i})=>jt(e,r,{dstPath:n,dstLevel:l,dstStore:i}),selected:r}},He=({store:e,tree:t})=>{if(document.getSelection().toString().length!=0)return;Ie(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-copying");let r=De(t,{ops:".item-copying"});window._treeClipboard={type:"copy",srcStore:e,ops:({dstPath:n})=>yr(e,r,{dstPath:n,startIndex:0}),selected:r}},ae=({tree:e,store:t,srcStore:r})=>{var l;let n=W(t,e._walker.currentNode.id);if(!!(n.hasOwnProperty("fields")||n.hasOwnProperty("schs")||n.hasOwnProperty("sch"))&&!(((l=t.put)==null?void 0:l.onlyDst)&&!t.put.onlyDst[t.taggedLevel[n._meta.level]])&&window._treeClipboard){let i=e._walker.currentNode.id,{type:a,srcStore:o,ops:s,selected:c}=window._treeClipboard,p=c,u={};if(t.key==o.key)switch(a){case"copy":u=_r(t,{dstPath:i},p);break;case"cut":u=Ut(t,{dstPath:i,dstLevel:n._meta.level,dstStore:t},p);break}else switch(a){case"copy":let f=s({dstPath:""});u=xr(t,{dstPath:i},f);break;case"cut":let m=s({dstPath:"",dstLevel:n._meta.level,dstStore:t});u=Tr(t,{dstPath:i},m);break}let x=(f,m)=>{let d={};for(let h of Object.keys(m))h==n._meta.path?d[""]=m[h]:d[h]=m[h];f._render(n),Ie(f),it(f,d)};Object.keys(u).length!=0&&(n._tree?x(n._tree,u):(e._render(t),Ie(e),it(e,u)))}},ge=({tree:e,store:t})=>Dn({tree:e,store:t,direction:""},r=>r[0].index),ve=({tree:e,store:t})=>Dn({tree:e,store:t,direction:""},r=>r[r.length-1].index+1),Dn=({tree:e,store:t,direction:r},n)=>{let l=De(e),i={};for(let a of Object.keys(l))i=_r(t,{dstPath:a,startIndex:n(l[a])},{[a]:l[a]});Object.keys(i).length!=0&&(e._render(t),it(e,i,{direction:r,sync:!!e.sync}))},oe=({tree:e,store:t})=>In({tree:e,store:t,startIndex:r=>r-1,direction:""}),se=({tree:e,store:t})=>In({tree:e,store:t,startIndex:r=>r+1,direction:""}),In=({tree:e,store:t,startIndex:r,direction:n})=>{let l=De(e),i={};for(let a of Object.keys(l)){let o=l[a].sort((s,c)=>s.index-c.index);i=Ut(t,{dstPath:a,startIndex:r(o[0].index),isRefConstraint:!1},l)}Object.keys(i).length!=0&&(e._render(t),it(e,i))},vr=(e,t)=>{var o,s,c;let r=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!r)return;let n=W(t,r.id),l=e._walker.currentNode,i=W(t,l.id),a=(p,u)=>{if(!p)return!1;let x=!0;for(let f of u)x=x&&p[f[0]]==f[1];return x};for(let p of t.rulesTable||[])if(a(n,p.selector)){if((s=(o=p.rules)==null?void 0:o.nthChild)==null?void 0:s[i._meta.index])return p.rules.nthChild[i._meta.index].allowedSchs;if((c=p.rules.children)==null?void 0:c.allowedSchs)return p.rules.children.allowedSchs}return null},Bt=({tree:e})=>Nr(e),Wt=({tree:e})=>gr(e);var{defineProperties:si}=Object,kr=({store:e,target:t,view:r,treeKeyDownCmds:n,textAreaKeyDownCmd:l,opts:i={}})=>{si(e,{render:{value:function(o){r(o||this)},configurable:!0},currentNode:{writable:!0,configurable:!0},_tree:{writable:!0,configurable:!0}}),e.render();let a=document.querySelector(`${t} [role='tree']`);if(a){a._aria=br,a._render=r,e._tree=a,vn(a),a.onkeydown=ci(e,n,{textAreaKeyDownCmd:l}),a.onclick=di(e);let o=a.querySelector(`[id='${CSS.escape(i.selectId)}']`);if(o&&i.selectId!="")a._walker.currentNode=o,$(a,a._walker.currentNode,{focus:i.focus});else{e.currentNode=Gt(a,e.currentNode);let s=a._walker.nextNode(),c=e.currentNode||a._walker.nextNode()||s;$(a,c,{focus:i.focus})}return a._walker.currentNode.scrollIntoView({block:"center"}),a}},ci=(e,t,r)=>function(n){ui(n,this,e,t,r)};async function ui(e,t,r,n=[],l={}){if(e.stopPropagation(),e.target instanceof HTMLTextAreaElement)return pi(e,t,r,l.textAreaKeyDownCmd);switch(e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}let a=new Map(n).get(Mn(e));!a||(l.denyCmds||[]).includes(a.name)||fi(t,r,a)||(a({tree:t,store:r}),t._walker.currentNode=Gt(t,t._walker.currentNode),$(t._walker.currentNode),r.currentNode=t._walker.currentNode,Er(t,t._walker.currentNode,a))}var fi=(e,t,r)=>{var s,c,p,u,x,f,m;let n=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!n)return;let l=W(t,n.id),i=e._walker.currentNode,a=W(t,i.id),o=(d,h)=>{if(!d)return!1;let v=!0;for(let S of h)v=v&&d[S[0]]==S[1];return v};for(let d of t.rulesTable||[])if(o(l,d.selector)&&(((p=(c=(s=d.rules)==null?void 0:s.nthChild)==null?void 0:c[a._meta.index])==null?void 0:p.exceptActions)&&d.rules.nthChild[a._meta.index].exceptActions.map(h=>h.name).includes(r.name)||((u=d.rules.children)==null?void 0:u.onlyActions)&&!d.rules.children.onlyActions.map(h=>h.name).includes(r.name)||((x=d.rules.children)==null?void 0:x.exceptActions)&&d.rules.children.exceptActions.map(h=>h.name).includes(r.name))||o(a,d.selector)&&(((f=d.rules.self)==null?void 0:f.onlyActions)&&!d.rules.self.onlyActions.map(h=>h.name).includes(r.name)||((m=d.rules.self)==null?void 0:m.exceptActions)&&d.rules.self.exceptActions.map(h=>h.name).includes(r.name)))return!0;return!1},pi=(e,t,r,n=[])=>{e.stopPropagation();let l=e.target,a=new Map(n).get(Mn(e));!a||(a({tree:t,store:r},l),r.currentNode=t._walker.currentNode,Er(t,t._walker.currentNode,a))},di=e=>function(t){return mi(t,this,e)};function mi(e,t,r){e.stopPropagation();let n=t._walker.currentNode,l=e.target.closest("[role='treeitem']"),i=!t.querySelector("textarea");if(!!l){if(e.shiftKey||e.metaKey)switch(n.compareDocumentPosition(l)){case Node.DOCUMENT_POSITION_CONTAINS:return $(t,l);case Node.DOCUMENT_POSITION_CONTAINED_BY:return $(t,n);default:if(l.parentNode.closest("[role='treeitem']")!=n.parentNode.closest("[role='treeitem']"))return $(t,l)}e.shiftKey?(n!=l&&document.getSelection().removeAllRanges(),mt(t,n,l)):e.metaKey?$n(n,t._walker.currentNode=l):(t._walker.currentNode=l,Tt({tree:t},{notFocusIfTextArea:i}),r.currentNode=t._walker.currentNode,Er(t,l,Tt))}}var Mn=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:n,key:l})=>{let i=[];return e&&i.push("shift"),(t||n)&&i.push("meta"),r&&i.push("alt"),l&&i.push(l),i.join("-")},Er=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}}));var Pn=new WeakMap,_t=e=>(...t)=>{let r=e(...t);return Pn.set(r,!0),r},Ye=e=>typeof e=="function"&&Pn.has(e);var $r=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,Ht=(e,t,r=null,n=null)=>{for(;t!==r;){let l=t.nextSibling;e.insertBefore(t,n),t=l}},ze=(e,t,r=null)=>{for(;t!==r;){let n=t.nextSibling;e.removeChild(t),t=n}};var G={},ce={};var de=`{{lit-${String(Math.random()).slice(2)}}}`,Ar=`<!--${de}-->`,Rn=new RegExp(`${de}|${Ar}`),st="$lit$",Yt=class{constructor(t,r){this.parts=[],this.element=r;let n=[],l=[],i=document.createTreeWalker(r.content,133,null,!1),a=0,o=-1,s=0,{strings:c,values:{length:p}}=t;for(;s<p;){let u=i.nextNode();if(u===null){i.currentNode=l.pop();continue}if(o++,u.nodeType===1){if(u.hasAttributes()){let x=u.attributes,{length:f}=x,m=0;for(let d=0;d<f;d++)Cn(x[d].name,st)&&m++;for(;m-- >0;){let d=c[s],h=zt.exec(d)[2],v=h.toLowerCase()+st,S=u.getAttribute(v);u.removeAttribute(v);let P=S.split(Rn);this.parts.push({type:"attribute",index:o,name:h,strings:P}),s+=P.length-1}}u.tagName==="TEMPLATE"&&(l.push(u),i.currentNode=u.content)}else if(u.nodeType===3){let x=u.data;if(x.indexOf(de)>=0){let f=u.parentNode,m=x.split(Rn),d=m.length-1;for(let h=0;h<d;h++){let v,S=m[h];if(S==="")v=q();else{let P=zt.exec(S);P!==null&&Cn(P[2],st)&&(S=S.slice(0,P.index)+P[1]+P[2].slice(0,-st.length)+P[3]),v=document.createTextNode(S)}f.insertBefore(v,u),this.parts.push({type:"node",index:++o})}m[d]===""?(f.insertBefore(q(),u),n.push(u)):u.data=m[d],s+=d}}else if(u.nodeType===8)if(u.data===de){let x=u.parentNode;(u.previousSibling===null||o===a)&&(o++,x.insertBefore(q(),u)),a=o,this.parts.push({type:"node",index:o}),u.nextSibling===null?u.data="":(n.push(u),o--),s++}else{let x=-1;for(;(x=u.data.indexOf(de,x+1))!==-1;)this.parts.push({type:"node",index:-1}),s++}}for(let u of n)u.parentNode.removeChild(u)}},Cn=(e,t)=>{let r=e.length-t.length;return r>=0&&e.slice(r)===t},Sr=e=>e.index!==-1,q=()=>document.createComment(""),zt=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;var bt=class{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(let n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(let n of this.__parts)n!==void 0&&n.commit()}_clone(){let t=$r?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,l=document.createTreeWalker(t,133,null,!1),i=0,a=0,o,s=l.nextNode();for(;i<n.length;){if(o=n[i],!Sr(o)){this.__parts.push(void 0),i++;continue}for(;a<o.index;)a++,s.nodeName==="TEMPLATE"&&(r.push(s),l.currentNode=s.content),(s=l.nextNode())===null&&(l.currentNode=r.pop(),s=l.nextNode());if(o.type==="node"){let c=this.processor.handleTextExpression(this.options);c.insertAfterNode(s.previousSibling),this.__parts.push(c)}else this.__parts.push(...this.processor.handleAttributeExpressions(s,o.name,o.strings,this.options));i++}return $r&&(document.adoptNode(t),customElements.upgrade(t)),t}};var Ln=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),hi=` ${de} `,ct=class{constructor(t,r,n,l){this.strings=t,this.values=r,this.type=n,this.processor=l}getHTML(){let t=this.strings.length-1,r="",n=!1;for(let l=0;l<t;l++){let i=this.strings[l],a=i.lastIndexOf("<!--");n=(a>-1||n)&&i.indexOf("-->",a+1)===-1;let o=zt.exec(i);o===null?r+=i+(n?hi:Ar):r+=i.substr(0,o.index)+o[1]+o[2]+st+o[3]+de}return r+=this.strings[t],r}getTemplateElement(){let t=document.createElement("template"),r=this.getHTML();return Ln!==void 0&&(r=Ln.createHTML(r)),t.innerHTML=r,t}};var Jt=e=>e===null||!(typeof e=="object"||typeof e=="function"),Xt=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]),wt=class{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let l=0;l<n.length-1;l++)this.parts[l]=this._createPart()}_createPart(){return new dt(this)}_getValue(){let t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){let i=n[0].value;if(typeof i=="symbol")return String(i);if(typeof i=="string"||!Xt(i))return i}let l="";for(let i=0;i<r;i++){l+=t[i];let a=n[i];if(a!==void 0){let o=a.value;if(Jt(o)||!Xt(o))l+=typeof o=="string"?o:String(o);else for(let s of o)l+=typeof s=="string"?s:String(s)}}return l+=t[r],l}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}},dt=class{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==G&&(!Jt(t)||t!==this.value)&&(this.value=t,Ye(t)||(this.committer.dirty=!0))}commit(){for(;Ye(this.value);){let t=this.value;this.value=G,t(this)}this.value!==G&&this.committer.commit()}},X=class{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(q()),this.endNode=t.appendChild(q())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=q()),t.__insert(this.endNode=q())}insertAfterPart(t){t.__insert(this.startNode=q()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;Ye(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=G,r(this)}let t=this.__pendingValue;t!==G&&(Jt(t)?t!==this.value&&this.__commitText(t):t instanceof ct?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):Xt(t)?this.__commitIterable(t):t===ce?(this.value=ce,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){let r=this.startNode.nextSibling;t=t==null?"":t;let n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){let r=this.options.templateFactory(t);if(this.value instanceof bt&&this.value.template===r)this.value.update(t.values);else{let n=new bt(r,t.processor,this.options),l=n._clone();n.update(t.values),this.__commitNode(l),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());let r=this.value,n=0,l;for(let i of t)l=r[n],l===void 0&&(l=new X(this.options),r.push(l),n===0?l.appendIntoPart(this):l.insertAfterPart(r[n-1])),l.setValue(i),l.commit(),n++;n<r.length&&(r.length=n,this.clear(l&&l.endNode))}clear(t=this.startNode){ze(this.startNode.parentNode,t.nextSibling,this.endNode)}},Qt=class{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;Ye(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=G,r(this)}if(this.__pendingValue===G)return;let t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=G}},Zt=class extends wt{constructor(t,r,n){super(t,r,n);this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new Or(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}},Or=class extends dt{},jn=!1;(()=>{try{let e={get capture(){return jn=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();var er=class{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=l=>this.handleEvent(l)}setValue(t){this.__pendingValue=t}commit(){for(;Ye(this.__pendingValue);){let i=this.__pendingValue;this.__pendingValue=G,i(this)}if(this.__pendingValue===G)return;let t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),l=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),l&&(this.__options=Ti(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=G}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}},Ti=e=>e&&(jn?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);var Dr=class{handleAttributeExpressions(t,r,n,l){let i=r[0];return i==="."?new Zt(t,r.slice(1),n).parts:i==="@"?[new er(t,r.slice(1),l.eventContext)]:i==="?"?[new Qt(t,r.slice(1),n)]:new wt(t,r,n).parts}handleTextExpression(t){return new X(t)}},Ir=new Dr;function Pr(e){let t=Mr.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},Mr.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;let n=e.strings.join(de);return r=t.keyString.get(n),r===void 0&&(r=new Yt(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}var Mr=new Map;var Rr=new WeakMap,Je=(e,t,r)=>{let n=Rr.get(t);n===void 0&&(ze(t,t.firstChild),Rr.set(t,n=new X(Object.assign({templateFactory:Pr},r))),n.appendInto(t)),n.setValue(e),n.commit()};typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");var _=(e,...t)=>new ct(e,t,"html",Ir);var Un=(e,t)=>{let r=e.startNode.parentNode,n=t===void 0?e.endNode:t.startNode,l=r.insertBefore(q(),n);r.insertBefore(q(),n);let i=new X(e.options);return i.insertAfterNode(l),i},Xe=(e,t)=>(e.setValue(t),e.commit(),e),Cr=(e,t,r)=>{let n=e.startNode.parentNode,l=r?r.startNode:e.endNode,i=t.endNode.nextSibling;i!==l&&Ht(n,t.startNode,i,l)},Lr=e=>{ze(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},Vn=(e,t,r)=>{let n=new Map;for(let l=t;l<=r;l++)n.set(e[l],l);return n},Fn=new WeakMap,Gn=new WeakMap,Me=_t((e,t,r)=>{let n;return r===void 0?r=t:t!==void 0&&(n=t),l=>{if(!(l instanceof X))throw new Error("repeat can only be used in text bindings");let i=Fn.get(l)||[],a=Gn.get(l)||[],o=[],s=[],c=[],p=0;for(let v of e)c[p]=n?n(v,p):p,s[p]=r(v,p),p++;let u,x,f=0,m=i.length-1,d=0,h=s.length-1;for(;f<=m&&d<=h;)if(i[f]===null)f++;else if(i[m]===null)m--;else if(a[f]===c[d])o[d]=Xe(i[f],s[d]),f++,d++;else if(a[m]===c[h])o[h]=Xe(i[m],s[h]),m--,h--;else if(a[f]===c[h])o[h]=Xe(i[f],s[h]),Cr(l,i[f],o[h+1]),f++,h--;else if(a[m]===c[d])o[d]=Xe(i[m],s[d]),Cr(l,i[m],i[f]),m--,d++;else if(u===void 0&&(u=Vn(c,d,h),x=Vn(a,f,m)),!u.has(a[f]))Lr(i[f]),f++;else if(!u.has(a[m]))Lr(i[m]),m--;else{let v=x.get(c[d]),S=v!==void 0?i[v]:null;if(S===null){let P=Un(l,i[f]);Xe(P,s[d]),o[d]=P}else o[d]=Xe(S,s[d]),Cr(l,S,i[f]),i[v]=null;d++}for(;d<=h;){let v=Un(l,o[h+1]);Xe(v,s[d]),o[d++]=v}for(;f<=m;){let v=i[f++];v!==null&&Lr(v)}Fn.set(l,o),Gn.set(l,c)}});var jr=new WeakMap,j=_t(e=>t=>{let r=jr.get(t);if(e===void 0&&t instanceof dt){if(r!==void 0||!jr.has(t)){let n=t.committer.name;t.committer.element.removeAttribute(n)}}else e!==r&&t.setValue(e);jr.set(t,e)});var tr={};Zr(tr,{ENTRY_MARKED:()=>pt,MOVED:()=>ue,NEW:()=>Re,NEW_KEY:()=>je,NEW_ORDER:()=>Le,NEW_TYPE:()=>fe,REMOVED:()=>Ce,buildBaseIndices:()=>Ur,diff:()=>wi,mergeToBase:()=>Ni,mergeToCurrent:()=>gi});var Q="file",ut="project",qn=(e,t)=>(Object.assign(t,e),t.fields=[],A(()=>t)),Kn=(e,t)=>D(e,(r,n)=>(t[r.$a]&&(r.metadata=t[r.$a]),r)),Bn=(e,t)=>{Ur(e);let r=e._indices;for(let n of e.fields)for(let l of n.fields)if(t[l.$a]){let i=rt(t[l.$a],(a,o)=>(r[o]&&a.push(r[o]),a),[]);i.length!=0?N(l,"referrers",i):delete l.referrers}else delete l.referrers},ft=(e,t,r)=>(t||(t=Wn()),Object.assign(t,e),A(()=>t)),Yn=()=>Hn({taggedLevel:{1:ut,2:Q,3:F},refParentLevel:2,allowedSchs:[Wn],put:{pos:"prepend",onlyDst:{[Q]:!0}}}),Wn=()=>Hn({taggedLevel:{1:Q,2:F},refParentLevel:1,addDefault:J,entryable:[F],put:{pos:"prepend"},rulesTable:Vr}),Hn=(e={})=>{let t=A(J);return t.allowedSchs=(e.allowedSchs||Fr).map(r=>r()),t.taggedLevel=e.taggedLevel,e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.t==e.addDefault().t)&&e.addDefault()),e.rulesTable&&(t.rulesTable=e.rulesTable),e.refParentLevel&&(t.refParentLevel=e.refParentLevel),t},Nt=(e,t)=>W(e,`[${t}]`)||e._currentFileStore,Pe=e=>{let t={};return Gr(e,(r,n)=>{t[r.$a]={display:[n.file.key,r.key].join(" :: "),file:n.file.key,fmodel:r.key,sch:r}}),t},Gr=(e,t)=>{for(let r of e.fields)for(let n=0;n<r.fields.length;n++)r.fields[n]=t(r.fields[n],{path:`[${r.key}][${r.fields[n].key}]`,file:r})||r.fields[n]},Fr=[It,J,Tn,yn,xn,$e,nn,mn,()=>Mt('"json string"'),ln,an,on,sn,cn,dn,un,fn,pn,_n,bn,hn,()=>Ae(null)],xi={selector:[["t",me]],rules:{self:{exceptActions:[ie,ae]},children:{exceptActions:[We,He,ge,ve,Y,oe,se]},nthChild:[{allowedSchs:[It()]}]}},_i={selector:[["t",K]],rules:{self:{exceptActions:[ie,ae]},children:{exceptActions:[We,He,ge,ve,Y,oe,se]},nthChild:[{allowedSchs:[Ae(null,{to:J()})]},{allowedSchs:[J()],exceptActions:[ot,Ne]}]}},bi={selector:[["t",C]],rules:{children:{min:1,allowedSchs:[J(),Ae(null,{to:J()})]}}},Vr=[xi,bi,_i];var Re="new",Ce="removed",ue="moved",Le="order_changed",je="key_changed",fe="type_changed",pt="entry_changed",Ur=e=>{let t={};return D(e,(r,n)=>(N(r,"_meta",n),Object.assign(t,{[r.$a]:r}),delete r._visit,delete r._pruned,r)),N(e,"_indices",t),e},wi=(e,t,r={})=>{let n=[],l=t._indices;D(e,(a,o)=>{delete a._diff;let s={},c=l[a.$a];if(c){let p=o.parent,u=c._meta.parent;u.$a!=p.$a&&Object.assign(s,{[ue]:{oldParent:u,newParent:p,oldPath:c._meta.path,newPath:o.path}}),c._meta.index!=o.index&&u.$a==p.$a&&Object.assign(s,{[Le]:{oldOrder:c.index,newOrder:a.index}}),c.t!=a.t&&Object.assign(s,{[fe]:{oldType:c.t,newType:a.t,parent:p}}),c.$r!=a.$r&&Object.assign(s,{[fe]:{oldType:c.$r,newType:a.$r,parent:p}}),c.v!=a.v&&Object.assign(s,{[fe]:{oldType:c.v,newType:a.v,parent:p}}),c.key!=a.key&&Object.assign(s,{[je]:{oldKey:c.key,newKey:a.key,parent:p}}),c.isEntry!=a.isEntry&&Object.assign(s,{[pt]:{oldIsEntry:c.isEntry,newIsEntry:a.isEntry,parent:p}}),Object.keys(s).length!=0&&(N(a,"_diff",Object.assign(s,{meta:qr(o)})),n.push(a)),N(c,"_visit",!0)}else N(a,"_diff",{[Re]:{parent:o.parent},meta:qr(o)}),n.push(a);return a});let i=[];return D(t,(a,o)=>(a._visit||(N(a,"_diff",{[Ce]:{parent:o.parent},meta:qr(o)}),i.push(a),N(a,"_pruned",!0)),delete a._visit,a)),n=n.concat(i),n},qr=({level:e,path:t,lpath:r,parent:n})=>({level:e,path:t,lpath:r,pa:n.$a}),Ni=(e,t)=>(e._indices||(e._indices={}),Jn(e,t.removed),Xn(e,t.added),zn(e,t.changed),Qn(e,t.reorder),e),gi=(e,t)=>(e._indices||(e._indices={}),Jn(e,t.removed),Xn(e,t.added),zn(e,t.changed),Qn(e,t.reorder),e),zn=(e,{fmodels:t,files:r})=>{Zn(e,r,(n,l)=>{let{key:i,index:a}=l;return Object.assign(n,{key:i,index:a})}),Zn(e,t,(n,l)=>(n.referrers&&N(l,"referrers",n.referrers),l))},Zn=(e,t,r=n=>n)=>{let n={};for(let a of t)n[a.$a]=!0;let l={},i={};for(let a of t)D(a,(o,s)=>(l[o.$a]=o,i[o.$a]=o,o));D(e,(a,o)=>{if(Object.keys(l).length==0&&(a._halt=!0),l[a.$a]){if(e._indices[a.$a]){let s=e._indices[a.$a].metadata;s&&Rt(l[a.$a],"metadata",s)}n[a.$a]?a=r(a,l[a.$a]):a=l[a.$a],delete l[a.$a]}return a}),Kr(e,i)},Jn=(e,{fmodels:t,files:r})=>{el(e,r,n=>ft(n)),el(e,t)},el=(e,t)=>{var l;let r={};for(let i of t)r[l=i.pa]||(r[l]=[]),r[i.pa].push(i.$a);let n=(i,a)=>a.reduce((o,s,c)=>(r[i.$a].includes(s.$a)&&o.push(c),o),[]);if(hr(e,(i,a)=>(Object.keys(r).length==0&&(i._halt=!0),r[i.$a]),(i,a)=>{let o=[];switch(!0){case i.hasOwnProperty("fields"):o=n(i,i.fields);break;case i.hasOwnProperty("schs"):o=n(i,i.schs);break}return delete r[i.$a],o}),e._indices)for(let i of t)delete e._indices[i.$a]},Xn=(e,{fmodels:t,files:r})=>{tl(e,r,n=>ft(n)),tl(e,t)},tl=(e,t,r=n=>n)=>{var i;let n={};for(let a of t)n[i=a.pa]||(n[i]=[]),n[a.pa].push({k:a.key,sch:()=>gn(r(a)),index:a.index});nt(e,(a,o)=>(Object.keys(n).length==0&&(a._halt=!0),n[a.$a]),(a,o)=>{let s=n[a.$a];return delete n[a.$a],s});let l={};for(let a of t)D(a,(o,s)=>(l[o.$a]=o,o));Kr(e,l)},Qn=(e,{fmodels:t,files:r})=>{rl(e,r,n=>ft(n)),rl(e,t)},rl=(e,t)=>{var i;let r={};for(let a of t){let{$a:o,index:s}=a;r[i=a.pa]||(r[i]=[]),r[a.pa].push({$a:o,index:s})}let n=(a,o)=>{let s={};for(let c of o)s[c.$a]=c;return r[a.$a].sort((c,p)=>c.index-p.index).map(c=>s[c.$a])};Oe(e,(a,o)=>(Object.keys(r).length==0&&(a._halt=!0),r[a.$a]),(a,o)=>{switch(!0){case a.hasOwnProperty("fields"):a.fields=n(a,a.fields);break;case a.hasOwnProperty("schs"):a.schs=n(a,a.schs);break}return delete r[a.$a],a});let l={};for(let a of t)l[a.$a]=a;Kr(e,l)},Kr=(e,t)=>D(e,(r,n)=>(Object.keys(t).length==0&&(r._halt=!0),t[r.$a]&&(N(r,"_visit",!0),N(r,"_meta",n),e._indices[r.$a]=r,delete r._diff,delete t[r.$a]),r));var nl=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),gt(e,"title",t),gt(e,"description",t),ki(e,"rw",["rw","r","w"],t),rr(e,"required",t),rr(e,"isKeyPattern",t),vi(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},vi=(e,t)=>{let r=Pt(e.t)||{};switch(e.t){case R:Si(e,t);break;case U:Oi(e,t);break;case B:Di(e,t);break;case V:Ii(e,t);break;case C:Mi(e,t);break;case he:Ei(e,t);break;case Z:case te:case ne:case ee:case re:case le:ll(e,t,{min:r.min,max:r.max});break;case Te:case ye:ll(e,t);break;case xe:$i(e,t);break;case Ee:Ai(e,t);break}},Ei=(e,t)=>{Pi(e,"pattern",t),ke(e,"min",t,{min:0}),ke(e,"max",t,{min:0}),vt(e,t),gt(e,"default",t,Object.assign(il(e,["min","max","pattern"]),{ignoreEmpty:!0}))},$i=(e,t)=>{rr(e,"default",t)},ll=(e,t,r)=>{nr(e,"min",t,r),nr(e,"max",t,r),ke(e,"multipleOf",t),vt(e,t),nr(e,"default",t,il(e,["min","max","multipleOf"]))},Ai=(e,t)=>{Ri(e,"default",t)},Si=(e,t)=>{ke(e,"min",t,{min:0}),ke(e,"max",t,{min:0}),vt(e,t)},Oi=(e,t)=>{ke(e,"min",t,{min:1}),ke(e,"max",t,{min:1}),vt(e,t),rr(e,"unique",t)},Di=(e,t)=>{ke(e,"min",t,{min:1}),ke(e,"max",t,{min:1}),vt(e,t)},Ii=(e,t)=>{},Mi=(e,t)=>{gt(e,"tagname",t,{min:1})},il=(e,t=[])=>{let r={};for(let n of t)(e.errors[n]||[]).length==0&&(typeof e.changes[n]=="number"?(e.changes[n]||e.changes[n]==0)&&(r[n]=e.changes[n]):r[n]=e.changes[n]);return r},gt=(e,t,r,n={})=>{if(!r.hasOwnProperty(t)||n.ignoreEmpty&&r[t]=="")return;let l=r[t],i=2**18;(o=>new Blob([o]).size)(l)>i?M(e,t,`string size limit is ${Math.ceil(i/1024)} KB`):n.max&&l.length>n.max?M(e,t,`must be less than or equal ${n.max} length`):n.min&&l.length<n.min?M(e,t,`must be grater than or equal ${n.min} length`):n.pattern?new RegExp(n.pattern).test(l)||M(e,t,`must matche pattern ${n.pattern}`):e.changes[t]=l},rr=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let n=!!r[t];e.changes[t]=n},nr=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return;let l=Br(r[t]);!l&&l!=0?M(e,t,"must be number"):n.min&&l<n.min?M(e,t,`must be greater than or equal ${n.min}`):n.max&&l>n.max?M(e,t,`must be less than than or equal ${n.max}`):n.multipleOf&&l%n.multipleOf!=0?M(e,t,`must be multiple of ${n.multipleOf}`):e.changes[t]=l},ke=(e,t,r,n)=>{if(!r.hasOwnProperty(t))return;nr(e,t,r,n);let l=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?M(e,t,"must be integer number"):l>Number.MAX_SAFE_INTEGER?M(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):l<Number.MIN_SAFE_INTEGER&&M(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},Pi=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(gt(e,t,r),(e.errors[t]||[]).length==0))try{let n=r[t];if(n=="")return;e.changes[t]=new RegExp(n)}catch(n){M(e,t,"invalid regex")}},vt=(e,t)=>{if(t.min&&t.max){let r=Br(t.min),n=Br(t.max);(r||r==0)&&(n||n==0)&&r>n&&(M(e,"min","min is greater than max"),M(e,"max","max is less than min"))}},Ri=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?M(e,t,"must be null"):e.changes[t]=r[t])},ki=(e,t,r,n)=>{!n.hasOwnProperty(t)||(r.includes(n[t])?e.changes[t]=n[t]:M(e,t,"value must be r, w, or rw"))},M=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},Br=e=>Ci(e,"number");var Ci=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=i=>["checkbox","radio"].includes(i.type)?i.checked:i.value,r=this.querySelector("form").elements,n={};for(let i=0;i<r.length;i++){let a=t(r[i]);!(r[i]instanceof HTMLTextAreaElement)&&a==""||(n[r[i].name]=a)}let l={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:n};this.dispatchEvent(new CustomEvent("sch-update",{detail:l,bubbles:!0}))}}});customElements.define("autosize-text",class extends HTMLElement{static get observedAttributes(){return["data-value"]}attributeChangedCallback(e,t,r){this.autosize(r)}connectedCallback(){this.autosize.bind(this)()}autosize(e){for(let t of this.getElementsByTagName("textarea"))e||(e=t.value),e&&(t.value=e,tt({target:t}))}});var al=e=>Je(Me([{$a:"nothing"}],t=>t.$a,t=>ce),document.querySelector(e)),Wr=(e,t,r)=>{try{let n=t.referrers||[];Je(Me([t],l=>l.$a,l=>_`
    <p class="meta-def">${ji(r.key,l._meta.path)||"-"}</p>
    <p>${Se(l.t)}</p>
    <form data-path="${l._meta.path}" data-file="${r.key}" class="fbox">
      ${kt(l,"title",{keyDisplay:"Title"})}
      ${kt(l,"description",{keyDisplay:"Description"})}
      ${Fi(l)}
      ${Ui(l,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:g(l,"rw","rw"),keyDisplay:"Read / Write"})}
      ${Vi(l,"default",{keyDisplay:"Default",min:g(l,"min"),max:g(l,"max")})}
    </form>
    ${Li(n)}
  `),document.querySelector(e))}catch(n){console.log(n)}},Li=e=>e.length!=0?_`
    <p>Referrers</p>
      <ul>
        ${e.map(t=>_`<li>${t._meta.lpath.slice(1).map(r=>r.key).join(" / ")}</li>`)}
      </ul>
    `:ce,ji=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(n=>n!=""),t.splice(0,0,e);let r=_`<span style="color: var(--meta-def-color);">${t[0]} :: ${t[1]}</span>`;return t=t.slice(2).flatMap(n=>[_`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(n)]),t.splice(0,0,r),t},Et=(e,t,r,n={})=>{var l;return _`
  <label class="${n.readonly&&`box-label ${t} readonly`||`box-label ${t}`}">
    <p class="l">${n.keyDisplay||t}</p>
    ${r}
    ${(l=lr(e,t))==null?void 0:l.map(i=>_`<p class="err">${i}</p>`)}
  </label>
  `},kt=(e,t,r={})=>Et(e,t,_`
    <autosize-text data-value="${g(e,t)||""}">
      <textarea name="${$t(e,t)}" maxlength="${j(r.maxlength)}" minlength="${j(r.minlength)}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${j(lr(e,t)&&"invalid")}" @input="${tt}">${r.value||g(e,t,"")}</textarea>
    </autosize-text>
  `,r),Qe=(e,t,r={})=>Et(e,t,_`
    <input type="number" name="${$t(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${j(r.min)}" max="${j(r.max)}" value="${j(r.value||g(e,t))}" ?readonly="${r.readonly}" class="${j(lr(e,t)&&"invalid")}">
  `,r),Ue=(e,t,r={})=>Et(e,t,_`
    <input type="number" name="${$t(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${j(r.min)}" max="${j(r.max)}" value="${j(r.value||g(e,t))}" ?readonly="${r.readonly}" class="${j(lr(e,t)&&"invalid")}">
  `,r),Ve=(e,t,r={})=>Et(e,t,_`
    <input type="checkbox" name="${$t(e,t)}" ?disabled="${r.readonly}" ?checked="${!!g(e,t)}" .checked="${!!g(e,t)}">
  `,r),Ui=(e,t,r={})=>Et(e,t,_`
    <select name="${$t(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([n,l])=>_`<option value="${n}" ?selected="${(r.selected||g(e,t))==n}">${l}</option>`)}
    </select>
  `,r),Vi=(e,t,r={})=>{switch(e.t){case xe:return Ve(e,t,r);case Z:case te:case ne:case ee:case re:case le:case Te:case ye:return Qe(e,t,r);case he:return kt(e,t,r);default:return""}},$t=(e,t)=>t,g=(e,t,r)=>(e.metadata||{})[t]||r,Fi=e=>{let t,r=Pt(e.t)||{};switch(e.t){case R:let i=0;for(let a of e.fields)g(a,"required")&&i++;t=[Ue(e,"min",{keyDisplay:"Min Properties",value:i,readonly:!0}),Ue(e,"max",{keyDisplay:"Max Properties",value:e.fields.length,min:Math.max(g(e,"min",0),0)})];break;case U:t=[Ue(e,"min",{keyDisplay:"Min Items",min:1,value:1,max:g(e,"max")}),Ue(e,"max",{keyDisplay:"Max Items",min:g(e,"min")}),Ve(e,"unique",{keyDisplay:"Item uniqueness"})];break;case B:t=[Ue(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),Ue(e,"max",{keyDisplay:"Max Items",value:g(e,"max",e.schs.length)})];break;case C:t=[kt(e,"tagname",{keyDisplay:"Tag name",value:e.tagname})];break;case he:t=[Ue(e,"min",{keyDisplay:"Min Length",min:0,max:g(e,"max")}),Ue(e,"max",{keyDisplay:"Max Length",min:Math.max(0,g(e,"min"))}),kt(e,"pattern",{keyDisplay:"String Pattern",maxlength:256})];break;case Z:case te:case ne:case ee:case re:case le:t=[Qe(e,"min",{keyDisplay:"Min",min:r.min,max:Math.min(g(e,"max",r.max),r.max)}),Qe(e,"max",{keyDisplay:"Max",min:Math.max(g(e,"min",r.min),r.min),max:r.max}),Qe(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:Math.min(g(e,"max",r.max),r.max)})];break;case Te:case ye:t=[Qe(e,"min",{keyDisplay:"Min",max:g(e,"max")}),Qe(e,"max",{keyDisplay:"Max",min:g(e,"min")}),Qe(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:g(e,"max")})];break;case xe:t=[];case Ee:t=[];case V:t=[];case et:t=[];case z:t=[];case _e:t=[];default:t=[]}let n=e._meta.parent.t==R,l=e._meta.level>2;if(n&&l)switch(!0){case(!g(e,"isKeyPattern")&&!g(e,"required")):t.push(Ve(e,"required",{keyDisplay:"Required"})),t.push(Ve(e,"isKeyPattern",{keyDisplay:"Pattern Key"}));break;case g(e,"isKeyPattern"):t.push(Ve(e,"required",{keyDisplay:"Required",readonly:!0})),t.push(Ve(e,"isKeyPattern",{keyDisplay:"Pattern Key"}));break;case g(e,"required"):t.push(Ve(e,"required",{keyDisplay:"Required"})),t.push(Ve(e,"isKeyPattern",{keyDisplay:"Pattern Key",readonly:!0}));break}return t},lr=(e,t)=>e.errors&&e.errors[t];var ol=e=>Je(_`<ul role="tree"></ul>`,document.querySelector(e)),Hr=(e,t,r={})=>{var n;try{let l={level:1,tab:((n=r.ui)==null?void 0:n.tab)||0,models:t._models||{},taggedLevel:t.taggedLevel};l.rootLevel=l.level,Object.assign(l,r.ui),r.ui.lineClass&&Object.assign(l,{tab:r.ui.tab+2}),Gi(e,{sch:t,ui:l,path:t.path||"",key:t.key,parent:t})}catch(l){console.log(l)}},Gi=(e,t)=>Je(_`
  <ul role="tree" aria-multiselectable="true" class="${`${t.ui.lineClass||""} text-sm`}" aria-labelledby="${Yr(t.ui)+"_tree"}">
    ${At(t)}
  </ul>
  `,document.querySelector(e)),zr=e=>j(Yr(e)),Yr=e=>e.taggedLevel[e.level],sl=e=>{let t;if(!e)return"";for(let r of Object.keys(e))switch(r){case Re:t="N";break;case Ce:t="R";break;case ue:t="M";break;case Le:t="O";break;case je:t="C";break;case fe:t="C";break;case pt:t="C";break}return t||""},At=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Object.assign(e.ui,{expanded:!0}),qi(e);case[U].includes(e.sch.t):return e.sch.sch.hasOwnProperty("fields")||e.sch.sch.hasOwnProperty("schs")?Object.assign(e.ui,{expanded:!0}):Object.assign(e.ui,{expanded:!1}),cl(e);case(e.sch.hasOwnProperty("fields")||e.sch.hasOwnProperty("schs")):return Object.assign(e.ui,{expanded:!0}),cl(e);default:return Ki(e)}},qi=e=>_`
  <li id="${e.path}" data-tag="${zr(e.ui)}" .key="${e.key}" .index="${0}" .sch=${e.sch} aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" id="${Yr(e.ui)}_tree">
      ${Jr(e.key)}
    </dfn>
    <ul data-group="${ul(e.sch)}" role="group" tabindex="-1">
      ${dl(e)}
    </ul>
  </li>`,cl=e=>_`
  <li id="${e.path}" data-tag="${zr(e.ui)}" .key="${e.key}" .index="${e.ui.index}" .sch=${e.sch} aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" data-diff="${sl(e.sch._diff)}" data-group-size="${Bi(e.sch)}">
      ${fl(Object.assign(e,{key:Jr(e.key)}))}
      ${pl(e)}
    </dfn>
    <ul data-group="${ul(e.sch)}" role="group">
      ${dl(e)}
    </ul>
  </li>`,Ki=e=>_`
  <li id="${e.path}" data-tag="${zr(e.ui)}" data-diff="${sl(e.sch._diff)}" .key="${e.key}" .index="${e.ui.index}" .sch=${e.sch} aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${fl(Object.assign(e,{key:Jr(e.key)}))}
    ${pl(e)}
  </li>`,dl=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return ce;switch(!0){case[R,C].includes(e.sch.t):return Wi(e);case[B,me,K].includes(e.sch.t):return Hi(e);case[U].includes(e.sch.t):return Yi(e);case[V].includes(e.sch.t):return zi(e);default:return ce}},Wi=e=>Me(e.sch.fields,t=>t.$a,(t,r)=>At({key:t.key,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[${t.key}]`})),Hi=e=>Me(e.sch.schs,t=>t.$a,(t,r)=>At({key:r,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),Yi=e=>Me([e.sch.sch],t=>t.$a,(t,r)=>At({key:r,sch:e.sch.sch,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),zi=e=>Me(e.sch.schs,t=>t.$a,(t,r)=>At({key:"",sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),pe=(e,t=0)=>`padding-left: ${(e.ui.level-1)*2+e.ui.tab-1+t}ch`,ml=(e,t,r)=>_`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  @input="${tt}"
  @focus="${wn}"
  >${r}</textarea>`,fl=e=>e.ui.level==e.ui.rootLevel+1?Ji(e):Xi(e),Ji=e=>_`
  <span class="def" style="${pe(e)}">
    ${Qi(e.sch,e.ui)}
  </span>
  <span class="k">${ir(e)}</span>
  <span class="s">=</span>
  `,Xi=e=>{var t,r;switch(!0){case e.parent.t==V:return _`
      <span class="s" style="${pe(e,1)}">|</span>
      `;case(e.parent.t==me&&e.sch.$a==e.parent.schs[0].$a):return _`
      <span class="s" style="${pe(e)}">k</span>
      `;case(e.parent.t==me&&e.sch.$a==e.parent.schs[1].$a):return _`
      <span class="s" style="${pe(e)}">v</span>
      `;case(e.parent.t==K&&e.sch.$a==e.parent.schs[0].$a):return _`
      <span class="s" style="${pe(e)}">extends</span>
      `;case(e.parent.t==K&&e.sch.$a==e.parent.schs[1].$a):return _`
      <span class="s" style="${pe(e)}">record</span>
      `;case e.parent.t==U:return _`
      <span class="s" style="${pe(e)}">└</span>
      `;case e.parent.t==R:return _`
      <span class="k" style="${pe(e,1)}" data-required="${!!((t=e.sch.metadata)==null?void 0:t.required)}" data-is-pattern="${!!((r=e.sch.metadata)==null?void 0:r.isKeyPattern)}">
        ${ir(e)}
      </span>
      <span class="s">:</span>
    `;case e.parent.t==C:return _`
      <span class="s" style="${pe(e,.5)}">|</span>
      <span class="k tag">
        ${ir(e)}
      </span>
      <span class="s">·</span>
    `;default:return _`
      <span class="k" style="${pe(e,1)}">
        ${ir(e)}
      </span >
      <span class="s">:</span>
    `}},ir=e=>e.sch.uiMode=="editKey"?ml("key-edit",e.ui.parentPath,e.key):_`${e.key}`,pl=e=>e.ui.level==e.ui.rootLevel+1?Zi(e):ea(e),Zi=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):_`<span class="t">${hl(e)}</span>`,ea=e=>_`<span class="t">${hl(e)}</span>`,hl=e=>e.sch.uiMode=="editType"?_`<combo-box id="type_search" list="typesearch">
      ${ml("type-edit",e.ui.parentPath,Xr(e.sch,e.ui))}
    </combo-box>`:_`${Tl(e.sch,e.ui)}`,Xr=(e,t)=>{var r;switch(!0){case e.t==_e:return JSON.stringify(e.v);case e.t==z:return(r=t.models[e.$r])==null?void 0:r.display;default:return Se(e.t)}},Tl=(e,t)=>{let r,n=e.metadata;switch(!0){case(e.t==R&&e.fields.length==0):r="{ any }";break;case e.t==R:r="{ \xA0 }";break;case e.t==K:r="e { }";break;case e.t==U:r=_`[\xa0 ${Tl(e.sch,t)} \xa0]`;break;case e.t==B:r="( \xA0 )";break;case e.t==me:r="dict";break;case e.t==V:r="||";break;case e.t==C:r=`|| ${(n==null?void 0:n.tagname)||e.tagname}`;break;case e.t==he:r="string";break;case e.t==Z:r="int_8";break;case e.t==te:r="int_16";break;case e.t==ne:r="int_32";break;case e.t==ee:r="uint_8";break;case e.t==re:r="uint_16";break;case e.t==le:r="uint_32";break;case e.t==Te:r="float_32";break;case e.t==ye:r="float_64";break;case e.t==Dt:r="timestamp";break;case e.t==xe:r="bool";break;case e.t==Ee:r="null";break;case e.t==et:r="any";break;case(e.t==z&&!!t.models[e.$r]):Rt(e,"_text",Xr(e,t)),r=_`<span class="ref">${e._text}</span >`;break;case(e.t==z&&e.$r==null):r=_`<span class="ref notfound" title="Ref type">nothing</span>`;break;case e.t==z:r=_`<span class="ref notfound" title="Ref type">${`${e._text||e.$r} (#404)`}</span>`;break;case e.t==_e:r=_`<span class="value" title="Value type">${Xr(e,t)}</span>`;break;default:r="# UNDEFINED_TYPE #"}return t.tText&&(r=t.tText(e,t)||r),r},Jr=e=>e,ul=e=>{switch(!0){case[R,C].includes(e.t):return"keyed";case[B,V,K].includes(e.t):return"indexed";default:return"none"}},Bi=e=>{switch(!0){case[R,C].includes(e.t):return e.fields.length;case[B,V,K].includes(e.t):return e.schs.length;case[U].includes(e.t):return 1;default:return 0}},Qi=(e,t)=>{let r;switch(!0){case e.t==R:r="record";break;case e.t==U:r="list";break;case e.t==B:r="tuple";break;case e.t==V:r="union";break;case e.t==C:r="tagged union";break;case e.t==K:r="extensible union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r};var{selectMultiNodeUpTo:yl,selectMultiNodeDownTo:xl,selectMultiNodeUp:_l,selectMultiNodeDown:bl,selectUpEnd:wl,selectDownEnd:Nl,selectUp:gl,selectDown:vl,selectRoot:kl,selectLast:El}=Kt,$l=({store:e,target:t,select:r,focus:n=!0})=>{kr({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",yl],["shift-meta-ArrowDown",xl],["shift-ArrowUp",_l],["shift-ArrowDown",bl],["meta-ArrowUp",wl],["meta-ArrowDown",Nl],["ArrowUp",gl],["ArrowDown",vl],["Home",kl],["End",El],["shift-+",ie],["Enter",at],["Delete",Y],["meta-v",ae],["alt-ArrowUp",oe],["alt-ArrowDown",se]],textAreaKeyDownCmd:[["Enter",Ne],["Escape",yt]],view:l=>Hr(t,l||e,{ui:{depthLimit:2,tab:0,modelTypeText:(i,a)=>"modu",typeText:(i,a)=>{if(i.t==T.RECORD)return"record";if(i.t==T.VALUE)return"value";if(i.t==T.TUPLE)return"tuple";if(i.t==T.UNION)return"union"},viewTypeTop:i=>""}}),opts:{focus:n,selectId:r}})},ar=({store:e,target:t,select:r,focus:n,nothing:l=!1})=>{kr({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",yl],["shift-meta-ArrowDown",xl],["shift-ArrowUp",_l],["shift-ArrowDown",bl],["meta-ArrowUp",wl],["meta-ArrowDown",Nl],["ArrowUp",gl],["ArrowDown",vl],["Home",kl],["End",El],["shift-+",ie],["Enter",at],["shift-Enter",ot],["Delete",Y],["m",xt],["meta-x",We],["meta-c",He],["meta-v",ae],["shift-alt-ArrowUp",ge],["shift-alt-ArrowDown",ve],["alt-ArrowUp",oe],["alt-ArrowDown",se],["ArrowRight",Bt],["ArrowLeft",Wt],["Escape",({tree:i})=>Ie(i)]],textAreaKeyDownCmd:[["Enter",Ne],["Escape",yt]],view:i=>Hr(t,i||e,{ui:{lineClass:"setnu",tab:3,modelTypeText:(a,o)=>a.isEntry?"entrypoint":"type"}}),opts:{focus:n,selectId:r}})},or=({store:e,target:t,treeTarget:r})=>{let n=document.querySelector(t),l=document.querySelector(`${r} [role='tree']`);!n||!l||(N(e,"renderSchMeta",function(i){ta({tree:l,store:i||this,metaForm:t})}),e.renderSchMeta())},ta=({tree:e,store:t,metaForm:r})=>{let n=e.querySelectorAll("[role='treeitem'][aria-selected='true']");if(n.length==1){let l=W(t,n[0].id);l&&Wr(r,l,t)}},Al=e=>ol(e),Sl=e=>al(e);var{selectMultiNodeUpTo:Ol,selectMultiNodeDownTo:Dl,selectMultiNodeUp:Il,selectMultiNodeDown:Ml,selectUpEnd:ra,selectDownEnd:na,selectUp:la,selectDown:ia,selectRoot:Pl,selectLast:aa}=Kt,Rl=(e,t,r,n)=>{let l=t.closest("[data-tag='file']"),i=l==null?void 0:l.key;t.closest("[id='project']")?oa(e,i,r,n):t.closest("[id='fmodel']")&&sa(e,i,t,r,n)},oa=(e,t,r,n)=>{switch(r){case at:case oe:case se:case Ol:case Dl:case Il:case Ml:case Pl:break;case ie:case Y:case ge:case ve:case Ne:case Tt:case ra:case na:case la:case ia:case aa:Qr(e,t);break;case ae:e.render();break}},sa=(e,t,r,n,l)=>{switch(n){case Pl:case Ol:case Dl:case Il:case Ml:case oe:case se:case Bt:case Wt:case yt:case at:case ot:case We:case He:return}let i=Nt(e,t);switch(r.dataset.tag){case Q:switch(n){case ie:case Y:case ae:i._models=Pe(e),e.render();break}break;case F:switch(n){case xt:Cl(r,e,t),i.render();break;case Y:i._models=Pe(e),e.render();break;case ge:case ve:Cl(r,e,t),i._models=Pe(e),i.render(),e.render();break;case Ne:i._models=Pe(e),i.render()}break}i.renderSchMeta()},Qr=(e,t,r=null,n=!1)=>{let l=Nt(e,t);if(l){if(N(e,"_currentFileStore",l),l._models=Pe(e),ar({store:l,target:"[id='fmodel']",select:r,focus:n}),or({store:l,target:"[id='fsch']",treeTarget:"[id='fmodel']"}),!window._treeClipboard){let i=document.querySelector("[id='fmodel'] [role='tree']");i._aria.clearClipboard(i)}}else if(e.fields.length==0){let i=document.querySelector("[id='fmodel'] [role='tree']");Al("[id='fmodel']"),Sl("[id='fsch']")}},Cl=(e,t,r)=>{e.dataset.tag==F&&Gr(t,(n,l)=>(l.path!=`[${r}]${e.id}`&&n.isEntry&&delete n.isEntry,n))},Ll={update:({store:e,detail:t})=>{let{path:r,attrs:n}=t,l=we(e,r,(i,a)=>nl(i,n));return l&&(e.render&&e.render(e),e.renderSchMeta&&e.renderSchMeta(e)),l}},jl=e=>[ie,Y,Ne,ae,ge,ve,oe,se,Y,xt].map(t=>t.name).includes(e);var{assign:Fe}=Object,Ul=(e,t)=>{var m,d,h,v,S,P;let r={},n=b=>{if(r[b])return r[b];for(let y of e.fields)for(let w of y.fields)if(r[w.key]={file:y,fmodelOf:w},w.key==b)return r[b]},l={},i=b=>l[b]?l[b]:Oe(e,(y,w)=>{if(e.taggedLevel[w.level]==F&&w.path!="")return b.startsWith(w.path)?(l[b]=y,!0):!1},(y,w)=>(N(y,"_meta",w),y)),a=({$a:b,key:y,index:w,t:k})=>({$a:b,key:y,index:w,t:k}),o=b=>a(b),s=e._diffToRemote;if(!s)return;let c={};c.files=[],c.fmodels=[],c.subfmodels=[];for(let b of s){let y=e.taggedLevel[b._diff.meta.level];y==ut?c.project=b:y==Q?c.files.push(b):y==F?c.fmodels.push(b):c.subfmodels.push(b)}let p={},u={},x={},f={};u.files||(u.files={}),u.fmodels||(u.fmodels={}),x.files||(x.files={}),x.fmodels||(x.fmodels={}),p.files||(p.files={}),p.fmodels||(p.fmodels={}),f.files||(f.files={}),f.fmodels||(f.fmodels={}),c.project&&(p.project=o(c.project));for(let b=0;b<c.files.length;b++){let y=c.files[b],w=a(y),k=y._diff.meta.path;if(y._diff[Re]){u.files[k]=w;for(let E of y.fields)u.fmodels[`[${y.key}][${E.key}]`]=Fe(E,{pa:w.$a})}else y._diff[Ce]?x.files[k]={$a:w.$a}:y._diff[Le]?be(e.fields,(E,I)=>{f.files[`[${E.key}]`]=a(Object.assign(E,{index:I}))}):y._diff[ue]?console.log("project does not permit as parent for moving items"):(y._diff[je]&&(p.files[k]=w),y._diff[fe]&&console.log("file type is always record, cannot be changed"))}for(let b=0;b<c.fmodels.length;b++){let y=c.fmodels[b],w=y._diff.meta.path,k=y._diff.meta.pa;if(y._diff[Re])u.fmodels[w]=Fe(y,{pa:k});else if(y._diff[Ce])x.fmodels[w]={$a:y.$a,pa:k};else if(y._diff[je]||y._diff[fe]||y._diff[pt])p.fmodels[w]=Fe(y,{pa:k});else if(y._diff[Le]){let E=y._diff.meta.lpath[1];f.fmodels[`[${E.key}][${y.key}]`]||be(E.fields,(I,L)=>{f.fmodels[`[${E.key}][${I.key}]`]={$a:I.$a,t:I.t,key:I.key,index:L,pa:E.$a}})}else if(y._diff[ue]){let{oldParent:E,newParent:I,oldPath:L,newPath:Ge}=y._diff[ue],qe,Ze,St,Ke,sr;switch(e.taggedLevel[E.level]){case ut:console.log("fmodel was not possible to be a file");break;case Q:Ke=E,x.fmodels[L]={$a:y.$a,pa:Ke.$a};break;case F:default:Ke=E.lpath[1],sr=E.lpath[2]||E,St=`[${Ke.key}][${sr.key}]`,Ze=((m=e._indices)==null?void 0:m[sr.$a])||i(St),p.fmodels[St]=Fe(Ze,{pa:Ke.$a})}switch(e.taggedLevel[I.level]){case Q:qe=I,Ze=y,u.fmodels[Ge]=Fe(Ze,{pa:qe.$a});break;default:console.log("fmodel parent can only be file tag")}}}for(let b=0;b<c.subfmodels.length;b++){let y,w,k,E,I,L=c.subfmodels[b];if(L._diff[Re]||L._diff[Ce]||L._diff[Le]||L._diff[je]||L._diff[fe])E=L._diff.meta.lpath[1],I=L._diff.meta.lpath[2],k=`[${E.key}][${I.key}]`,!u.fmodels[k]&&!x.fmodels[k]&&(w=((d=e._indices)==null?void 0:d[I.$a])||i(k),(h=p.fmodels)[k]||(h[k]=Fe(w,{pa:E.$a})));else if(L._diff[ue]){let{oldParent:Ge,newParent:qe,oldPath:Ze,newPath:St}=L._diff[ue];switch(e.taggedLevel[Ge.level]){case ut:console.log("subfmodel was not possible to be a file");break;case Q:E=Ge,x.fmodels[Ze]={$a:L.$a,pa:E.$a};break;case F:default:E=Ge.lpath[1],I=Ge.lpath[2]||Ge,k=`[${E.key}][${I.key}]`,w=((v=e._indices)==null?void 0:v[I.$a])||i(k),(S=p.fmodels)[k]||(S[k]=Fe(w,{pa:E.$a}))}switch(e.taggedLevel[qe.level]){case ut:console.log("subfmodel parent can only be fmodel or subfmodel");break;case Q:console.log("subfmodel parent can only be fmodel or subfmodel");break;case F:default:y=qe.lpath[1],w=qe.lpath[2]||Ct(y.fields,Ke=>qe.key==Ke.key),k=`[${y.key}][${w.key}]`,(P=p.fmodels)[k]||(P[k]=Fe(w,{pa:y.$a}))}}}return console.log({added:u,changed:p,removed:x,reorder:f,type:"diff_to_persist"}),t({changed:p,added:u,removed:x,reorder:f})};var ca={createProjectStore:Yn,getFileStore:Nt,anchorsModels:Pe,projectToStore:qn,fileToStore:ft,controller:Rl,mergeSchMetas:Kn,mergeReferrers:Bn,changeFile:Qr,taggedDiff:Ul,isDiffableCmd:jl,SchMeta:Ll,allSchs:Fr,rulesTable:Vr};export{tr as Diff,ar as FmodelTree,ca as Project,$l as ProjectTree,or as SchMetaForm,Se as tstr};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
