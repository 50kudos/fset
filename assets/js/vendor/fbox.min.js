var vr=Object.defineProperty;var Xe=(e,t)=>{for(var r in t)vr(e,r,{get:t[r],enumerable:!0})};var V,Sr=new Uint8Array(16);function Ee(){if(!V&&(V=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!V))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return V(Sr)}var Qe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function $r(e){return typeof e=="string"&&Qe.test(e)}var Ve=$r;var T=[];for(var ke=0;ke<256;++ke)T.push((ke+256).toString(16).substr(1));function Er(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(T[e[t+0]]+T[e[t+1]]+T[e[t+2]]+T[e[t+3]]+"-"+T[e[t+4]]+T[e[t+5]]+"-"+T[e[t+6]]+T[e[t+7]]+"-"+T[e[t+8]]+T[e[t+9]]+"-"+T[e[t+10]]+T[e[t+11]]+T[e[t+12]]+T[e[t+13]]+T[e[t+14]]+T[e[t+15]]).toLowerCase();if(!Ve(r))throw TypeError("Stringified UUID is invalid");return r}var Ze=Er;function kr(e,t,r){e=e||{};var n=e.random||(e.rng||Ee)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var l=0;l<16;++l)t[r+l]=n[l];return t}return Ze(n)}var _e=kr;var m="record",v="list",h="tuple",k="string",_="number",Z="integer",g="boolean",M="null",y="union",D="any",$="ref",S="value",et=[m,h,v,y],tt="fmodel",O=()=>({type:D}),rt=()=>({type:k}),nt=()=>({type:g}),lt=()=>({type:_}),ot=()=>({type:M}),K=()=>({type:m,fields:{},order:[]}),it=()=>({type:v,sch:w(O)}),at=()=>({type:h,schs:[w(O)]}),ct=()=>({type:y,schs:[w(O)]}),st=e=>({type:$,$ref:e}),ge=e=>{try{return e=JSON.parse(e),e==null||[k,_,g].includes(typeof e)?{type:S,const:e}:!1}catch(t){return!1}},w=(e,t,r={force:!1})=>{let n=e();return n.$anchor||(n.$anchor=_e()),r.force&&(n.$anchor=_e()),n};var ee=e=>{let t=JSON.parse(JSON.stringify(e));return I(t,(r,n)=>w(()=>r,null,{force:!0})),t},I=(e,t,r={path:"",level:1,parent:{}})=>{if(e._halt=!1,e=t(e,r),e._halt)return e;switch(!0){case[m].includes(e.type):let n=Object.keys(e.fields);for(let a=n.length-1;a>=0;a--){let d=n[a],c=e.fields[d],s={path:`${r.path}[${d}]`,level:r.level+1,parent:{_box:e._box,type:e.type}};if(c=I(c,t,s),c.key=d,e.fields[d]=c,c._halt)return Object.assign(e,{_halt:!0})}break;case[h,y].includes(e.type):for(let a=0;a<e.schs.length;a++){let d=e.schs[a],c={path:`${r.path}[][${a}]`,level:r.level+1,parent:{_box:e._box,type:e.type}};if(d=I(d,t,c),e.schs[a]=d,d._halt)return Object.assign(e,{_halt:!0})}break;case[v].includes(e.type):let l={path:`${r.path}[][0]`,level:r.level+1,parent:{_box:e._box,type:e.type}},o=I(e.sch,t,l);if(e.sch=o,o._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Ae=(e,t,r)=>{let n={original:{},popped:[]},l=r.sort((o,a)=>a-o);return I(e,(o,a)=>{if(a.path!=t)return o;switch(o.type){case m:let d=l.map(c=>[c,o.order[c]]).filter(([c,s])=>s);for(let[c,s]of d)n.popped.unshift({k:s,sch:o.fields[s],index:c}),delete o.fields[s];for(let c of l)o.order.splice(c,1);break;case v:break;case h:for(let c of l)n.popped.unshift({k:c,sch:o.schs.splice(c,1)[0],index:c});o.schs.length==0&&o.schs.splice(0,0,w(O));break;case y:for(let c of l)n.popped.unshift({k:c,sch:o.schs.splice(c,1)[0],index:c});o.schs.length==0&&o.schs.splice(0,0,w(O));break;default:}return o}),n},_r=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),te=(e,t,r)=>{let n={original:{},inserted:[]},l=r.sort((a,d)=>a.index-d.index),o=(a,d)=>(a=Math.max(a,0),a=Math.min(a,d.length),a);return I(e,(a,d)=>{if(d.path!=t)return a;switch(a.type){case m:for(let{k:c,sch:s,index:u}of l){for(c=c==0?"0":c,c=c||`key_${Math.floor(Date.now()/100)}`,c=`${c}`;a.fields[c];)c=`${c} \u2013`;u=o(u,a.order),a.fields[c]=w(s,a._box),a.order.splice(u,0,c),n.inserted.push({k:c,sch:a.fields[c],index:u})}break;case v:break;case h:for(let{k:c,sch:s,index:u}of l)u=o(u,a.schs),a.schs.splice(u,0,w(s,a._box)),n.inserted.push({k:c,sch:a.schs[u],index:u});break;case y:for(let{k:c,sch:s,index:u}of l)u=o(u,a.schs),a.schs.splice(u,0,w(s,a._box)),n.inserted.push({k:c,sch:a.schs[u],index:u});default:}return a}),n},re=(e,{dstPath:t,startIndex:r=0},n)=>{let l=(c,s,u)=>R(c,s,(p,N)=>(p._pinId=u,p)),o=Symbol(t);l(e,t,o);let a=Oe(e,n,{dstPath:t});return Ce(e,{dstPin:o,startIndex:r},a)},Oe=(e,t,r={})=>{let n={},l=_r(Object.keys(t));for(let o of l){let a=t[o],d=u=>{var p;return(p=a.find(N=>N.index==u))==null?void 0:p.newK};if(r.dstPath&&a.filter(p=>r.dstPath.startsWith(p.id)).length!=0)continue;let s=Ae(e,o,a.map(u=>u.index)).popped.map(({k:u,sch:p,index:N})=>({k:d(N)||u,sch:()=>p}));n[o]=s}return n},Ce=(e,{dstPin:t,dstPath:r,startIndex:n=0},l)=>{let o=(s,u)=>ne(s,(p,N)=>p._pinId==u,(p,N)=>(p._pinned=N,p));n=Math.max(n,0);let a={},d=Object.values(l).flatMap(s=>s).map((s,u)=>({...s,index:n+u}));if(t){let s=o(e,t);s&&(r=s._pinned.path)}let c=te(e,r,d);return c.inserted.length!=0&&(a[r]=c.inserted),a},Re=(e,{dstPath:t,startIndex:r=0},n)=>{let l=Me(e,n,{dstPath:t,startIndex:r});return Ie(e,{dstPath:t},l)},Me=(e,t,r={})=>Object.values(t).reduce((n,l)=>{let o=l.map(d=>d.id),a=[];ne(e,(d,c)=>(o.includes(c.path)&&(d._meta=c,a.unshift(d)),a.length==o.length),(d,c)=>d);for(let d of l){if(r.dstPath&&r.dstPath.startsWith(d.id))continue;let c=a.find(s=>s._meta.path==d.id);c&&n.unshift({k:d.key,sch:()=>ee(c),index:r.startIndex+n.length,id:d.id})}return n},[]),Ie=(e,{dstPath:t},r)=>{let n={},l=te(e,t,r);return l.inserted.length!=0&&(n[t]=l.inserted),n},le=(e,t,r)=>R(e,t,(n,l)=>{let o=w(r,l.parent._box);switch(!0){case o.type==$:case o.type==S:case o.type!=n.type:let{title:a,description:d,rw:c,required:s,$anchor:u}=n;return Object.assign(o,{title:a,description:d,rw:c,required:s,$anchor:u}),o;default:return n}}),P=(e,t)=>ne(e,(r,n)=>n.path==t,(r,n)=>(r._meta=n,r)),R=(e,t,r)=>ne(e,(n,l)=>l.path==t,r),ne=(e,t,r)=>{let n;return I(e,(l,o)=>t(l,o)?(n=r(l,o),n._halt=!0,n):l),n&&(n._halt=!1),n};var G=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var dt=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,gr=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Ar=/<[a-z][^>]+$/i,Or=/>[^<>]*$/,Cr=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,Mr=/\s+$/,ut=(e,t)=>0<t--&&(Ar.test(e[t])||!Or.test(e[t])&&ut(e,t)),Ir=(e,t,r)=>gr.test(t)?e:`<${t}${r.replace(Mr,"")}></${t}>`,pt=(e,t,r)=>{let n=[],{length:l}=e;for(let a=1;a<l;a++){let d=e[a-1];n.push(dt.test(d)&&ut(e,a)?d.replace(dt,(c,s,u)=>`${t}${a-1}=${u||'"'}${s}${u?"":'"'}`):`${d}<!--${t}${a-1}-->`)}n.push(e[l-1]);let o=n.join("").trim();return r?o:o.replace(Cr,Ir)};var{isArray:U}=Array,{indexOf:ft,slice:oe}=[];var Rr=1,mt=111,Lr=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},yt=(e,t)=>e.nodeType===mt?1/t<0?t?Lr(e):e.lastChild:t?e.valueOf():e.firstChild:e,ht=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let n=oe.call(t,0),l=n[0],o=n[r-1];return{ELEMENT_NODE:Rr,nodeType:mt,firstChild:l,lastChild:o,valueOf(){if(t.length!==r){let a=0;for(;a<r;)e.appendChild(n[a++])}return e}}};var Tt=(e,t,r,n,l)=>{let o=r.length,a=t.length,d=o,c=0,s=0,u=null;for(;c<a||s<d;)if(a===c){let p=d<o?s?n(r[s-1],-0).nextSibling:n(r[d-s],0):l;for(;s<d;)e.insertBefore(n(r[s++],1),p)}else if(d===s)for(;c<a;)(!u||!u.has(t[c]))&&e.removeChild(n(t[c],-1)),c++;else if(t[c]===r[s])c++,s++;else if(t[a-1]===r[d-1])a--,d--;else if(t[c]===r[d-1]&&r[s]===t[a-1]){let p=n(t[--a],-1).nextSibling;e.insertBefore(n(r[s++],1),n(t[c++],-1).nextSibling),e.insertBefore(n(r[--d],1),p),t[a]=r[d]}else{if(!u){u=new Map;let p=s;for(;p<d;)u.set(r[p],p++)}if(u.has(t[c])){let p=u.get(t[c]);if(s<p&&p<d){let N=c,$e=1;for(;++N<a&&N<d&&u.get(t[N])===p+$e;)$e++;if($e>p-s){let Nr=n(t[c],0);for(;s<p;)e.insertBefore(n(r[s++],1),Nr)}else e.replaceChild(n(r[s++],1),n(t[c++],-1))}else c++}else e.removeChild(n(t[c++],-1))}return r};var xt=e=>t=>{for(let r in t){let n=r==="role"?r:`aria-${r}`,l=t[r];l==null?e.removeAttribute(n):e.setAttribute(n,l)}},bt=(e,t)=>{let r,n=!0,l=document.createAttributeNS(null,t);return o=>{r!==o&&(r=o,r==null?n||(e.removeAttributeNode(l),n=!0):(l.value=o,n&&(e.setAttributeNodeNS(l),n=!1)))}},wt=(e,t,r)=>n=>{r!==!!n&&((r=!!n)?e.setAttribute(t,""):e.removeAttribute(t))},Dr=({dataset:e})=>t=>{for(let r in t){let n=t[r];n==null?delete e[r]:e[r]=n}},Nt=(e,t)=>{let r,n=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(n=n.toLowerCase()),l=>{let o=U(l)?l:[l,!1];r!==o[0]&&(r&&e.removeEventListener(n,r,o[1]),(r=o[0])&&e.addEventListener(n,r,o[1]))}},vt=e=>t=>{typeof t=="function"?t(e):t.current=e},St=(e,t)=>t==="dataset"?Dr(e):r=>{e[t]=r},$t=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var Pr=function(e){"use strict";var t="fragment",r="template",n="content"in a(r),l=n?function(c){var s=a(r);return s.innerHTML=c,s.content}:function(c){var s=a(t),u=a(r),p=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(c)){var N=RegExp.$1;u.innerHTML="<table>"+c+"</table>",p=u.querySelectorAll(N)}else u.innerHTML=c,p=u.childNodes;return o(s,p),s};return function(s,u){return(u==="svg"?d:l)(s)};function o(c,s){for(var u=s.length;u--;)c.appendChild(s[0])}function a(c){return c===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",c)}function d(c){var s=a(t),u=a("div");return u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+c+"</svg>",o(s,u.firstChild.childNodes),s}}(document),Le=Pr;var Et=({childNodes:e},t)=>e[t],ie=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(ft.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:kt,importNode:ae}=document;var _t=ae.length!=1,gt=_t?(e,t,r)=>ae.call(document,Le(e,t,r),!0):Le,At=_t?e=>kt.call(document,e,1|128,null,!1):e=>kt.call(document,e,1|128);var H=(e,t,r)=>Tt(e.parentNode,t,r,yt,e),Ur=e=>{let t,r,n=[],l=o=>{switch(typeof o){case"string":case"number":case"boolean":t!==o&&(t=o,r?r.textContent=o:r=document.createTextNode(o),n=H(e,n,[r]));break;case"object":case"undefined":if(o==null){t!=o&&(t=o,n=H(e,n,[]));break}if(U(o)){t=o,o.length===0?n=H(e,n,[]):typeof o[0]=="object"?n=H(e,n,o):l(String(o));break}"ELEMENT_NODE"in o&&t!==o&&(t=o,n=H(e,n,o.nodeType===11?oe.call(o.childNodes):[o]))}};return l},jr=(e,t)=>{switch(t[0]){case"?":return wt(e,t.slice(1),!1);case".":return St(e,t.slice(1));case"o":if(t[1]==="n")return Nt(e,t)}switch(t){case"ref":return vt(e);case"aria":return xt(e)}return bt(e,t)};function Ot(e){let{type:t,path:r}=e,n=r.reduceRight(Et,this);return t==="node"?Ur(n):t==="attr"?jr(n,e.name):$t(n)}var W="is\xB5",Ct=G(new WeakMap),qr=/^(?:plaintext|script|style|textarea|title|xmp)$/i,j=()=>({stack:[],entry:null,wire:null}),Kr=(e,t)=>{let{content:r,updates:n}=Br(e,t);return{type:e,template:t,content:r,updates:n,wire:null}},Gr=(e,t)=>{let r=pt(t,W,e==="svg"),n=gt(r,e),l=At(n),o=[],a=t.length-1,d=0,c=`${W}${d}`;for(;d<a;){let s=l.nextNode();if(!s)throw`bad template: ${r}`;if(s.nodeType===8)s.textContent===c&&(o.push({type:"node",path:ie(s)}),c=`${W}${++d}`);else{for(;s.hasAttribute(c);)o.push({type:"attr",path:ie(s),name:s.getAttribute(c)}),s.removeAttribute(c),c=`${W}${++d}`;qr.test(s.tagName)&&s.textContent.trim()===`<!--${c}-->`&&(s.textContent="",o.push({type:"text",path:ie(s)}),c=`${W}${++d}`)}}return{content:n,nodes:o}},Br=(e,t)=>{let{content:r,nodes:n}=Ct.get(t)||Ct.set(t,Gr(e,t)),l=ae.call(document,r,!0),o=n.map(Ot,l);return{content:l,updates:o}},z=(e,{type:t,template:r,values:n})=>{let{length:l}=n;Mt(e,n,l);let{entry:o}=e;(!o||o.template!==r||o.type!==t)&&(e.entry=o=Kr(t,r));let{content:a,updates:d,wire:c}=o;for(let s=0;s<l;s++)d[s](n[s]);return c||(o.wire=ht(a))},Mt=({stack:e},t,r)=>{for(let n=0;n<r;n++){let l=t[n];l instanceof ce?t[n]=z(e[n]||(e[n]=j()),l):U(l)?Mt(e[n]||(e[n]=j()),l,l.length):e[n]=null}r<e.length&&e.splice(r)};function ce(e,t,r){this.type=e,this.template=t,this.values=r}var{create:Hr,defineProperties:Wr}=Object,It=e=>{let t=G(new WeakMap),r=n=>(l,...o)=>z(n,{type:e,template:l,values:o});return Wr((n,...l)=>new ce(e,n,l),{for:{value(n,l){let o=t.get(n)||t.set(n,Hr(null));return o[l]||(o[l]=r(j()))}},node:{value:(n,...l)=>z(j(),{type:e,template:n,values:l}).valueOf()}})},Rt=G(new WeakMap),se=(e,t)=>{let r=typeof t=="function"?t():t,n=Rt.get(e)||Rt.set(e,j()),l=r instanceof ce?z(n,r):r;return l!==n.wire&&(n.wire=l,e.textContent="",e.appendChild(l.valueOf())),e},f=It("html"),jl=It("svg");var De=(e,t)=>JSON.stringify(e)==JSON.stringify(t),de=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`};var Lt=(e,t)=>{e.errors={},e.changes={},ue(e,"title",t),ue(e,"description",t),Jr(e,"rw",["rw","r","w"],t),Pe(e,"required",t),zr(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e[r]=e.changes[r]);return e},zr=(e,t)=>{e.type==m?Vr(e,t):e.type==v?Zr(e,t):e.type==h?en(e,t):e.type==y?tn(e,t):e.type==k?Fr(e,t):e.type==_?Xr(e,t):e.type==g?Yr(e,t):e.type==M&&Qr(e,t)},Fr=(e,t)=>{rn(e,"pattern",t),A(e,"min",t,{min:0}),A(e,"max",t,{min:0}),J(e,t),ue(e,"default",t,Object.assign(Dt(e,["min","max","pattern"]),{ignoreEmpty:!0}))},Yr=(e,t)=>{Pe(e,"default",t)},Xr=(e,t)=>{pe(e,"min",t),pe(e,"max",t),A(e,"multipleOf",t),J(e,t),pe(e,"default",t,Dt(e,["min","max","multipleOf"]))},Qr=(e,t)=>{nn(e,"default",t)},Vr=(e,t)=>{A(e,"min",t,{min:0}),A(e,"max",t,{min:0}),J(e,t)},Zr=(e,t)=>{A(e,"min",t,{min:1}),A(e,"max",t,{min:1}),J(e,t),Pe(e,"unique",t)},en=(e,t)=>{A(e,"min",t,{min:1}),A(e,"max",t,{min:1}),J(e,t)},tn=(e,t)=>{},Dt=(e,t=[])=>{let r={};for(let n of t)(e.errors[n]||[]).length==0&&(typeof e.changes[n]=="number"?(e.changes[n]||e.changes[n]==0)&&(r[n]=e.changes[n]):r[n]=e.changes[n]);return r},ue=(e,t,r,n={})=>{if(!r.hasOwnProperty(t)||n.ignoreEmpty&&r[t]=="")return;let l=r[t],o=2**18;(d=>new Blob([d]).size)(l)>o?x(e,t,`string size limit is ${Math.ceil(o/1024)} KB`):n.max&&l.length>n.max?x(e,t,`must be less than or equal ${n.max} length`):n.min&&l.length<n.min?x(e,t,`must be grater than or equal ${n.min} length`):n.pattern?new RegExp(n.pattern).test(l)||x(e,t,`must matche pattern ${n.pattern}`):e.changes[t]=l},Pe=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let n=ln(r[t]);n==null?x(e,t,"must be boolean"):e.changes[t]=n},pe=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return;let l=Ue(r[t]);!l&&l!=0?x(e,t,"must be number"):n.min&&l<n.min?x(e,t,`must be greater than or equal ${n.min}`):n.max&&l>n.max?x(e,t,`must be less than than or equal ${n.max}`):n.multipleOf&&l%n.multipleOf!=0?x(e,t,`must be multiple of ${n.multipleOf}`):e.changes[t]=l},A=(e,t,r,n)=>{if(!r.hasOwnProperty(t))return;pe(e,t,r,n);let l=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?x(e,t,"must be integer number"):l>Number.MAX_SAFE_INTEGER?x(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):l<Number.MIN_SAFE_INTEGER&&x(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},rn=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(ue(e,t,r),(e.errors[t]||[]).length==0))try{let n=r[t];if(n=="")return;e.changes[t]=new RegExp(n)}catch(n){x(e,t,"invalid regex")}},J=(e,t)=>{if(t.min&&t.max){let r=Ue(t.min),n=Ue(t.max);(r||r==0)&&(n||n==0)&&r>n&&(x(e,"min","min is greater than max"),x(e,"max","max is less than min"))}},nn=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?x(e,t,"must be null"):e.changes[t]=r[t])},Jr=(e,t,r,n)=>{!n.hasOwnProperty(t)||(r.includes(n[t])?e.changes[t]=n[t]:x(e,t,"value must be r, w, or rw"))},x=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},Ue=e=>Pt(e,"number"),ln=e=>Pt(e,"boolean");var Pt=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=o=>["checkbox","radio"].includes(o.type)?o.checked:o.value,r=this.querySelector("form").elements,n={};for(let o=0;o<r.length;o++){let a=t(r[o]);!(r[o]instanceof HTMLTextAreaElement)&&a==""||(n[r[o].name]=a)}let l={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:n};this.dispatchEvent(new CustomEvent("sch-update",{detail:l,bubbles:!0}))}}});var me=(e,t,r)=>{try{se(e,f.for(t)`
    <p>${t.key||"-"}</p>
    <form data-path="${t.path}" data-file="${t.rootKey}">
      ${fe(t,"title",{keyDisplay:"Title"})}
      ${fe(t,"description",{keyDisplay:"Description"})}
      ${cn(t)}
      ${on(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:"rw",keyDisplay:"Read / Write"})}
      ${an(t,"default",{keyDisplay:"Default"})}
    </form>
  `)}catch(n){}},F=(e,t,r,n={})=>{var l;return f`
  <label class="${n.readonly&&`meta-box ${t} readonly`||`meta-box ${t}`}">
    <p class="l">${n.keyDisplay||t} ${n.readonly&&f`<span>· readonly</span>`}</p>
    ${r}
    ${(l=ye(e,t))==null?void 0:l.map(o=>f`<p class="err">${o}</p>`)}
  </label>
  `},fe=(e,t,r={})=>F(e,t,f`
    <textarea name="${Y(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${ye(e,t)&&"invalid"}" oninput="${de}">${e[t]||r.value}</textarea>
  `,r),he=(e,t,r={})=>F(e,t,f`
    <input type="number" name="${Y(e,t)}" inputmode="decimal" step="any" min="${r.min}" max="${r.max}" value="${e[t]||r.value}" ?readonly="${r.readonly}" class="${ye(e,t)&&"invalid"}">
  `,r),C=(e,t,r={})=>F(e,t,f`
    <input type="number" name="${Y(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${e[t]||r.value}" ?readonly="${r.readonly}" class="${ye(e,t)&&"invalid"}">
  `,r),je=(e,t,r={})=>F(e,t,f`
    <input type="checkbox" name="${Y(e,t)}" ?disabled="${r.readonly}" ?checked="${e[t]||r.value}">
  `,r),on=(e,t,r={})=>F(e,t,f`
    <select name="${Y(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([n,l])=>f`<option value="${n}" ?selected="${(e[t]||r.selected)==n}">${l}</option>`)}
    </select>
  `,r),an=(e,t,r={})=>{switch(e.type){case g:return je(e,t,r);case _:return he(e,t,r);case k:return fe(e,t,r);default:return""}},Y=(e,t)=>t,cn=e=>{let t;switch(!0){case e.type==m:t=[C(e,"min",{keyDisplay:"Min Properties",value:Object.keys(e.fields).length,readonly:!0}),C(e,"max",{keyDisplay:"Max Properties",value:Object.keys(e.fields).length,readonly:!0})];break;case e.type==v:t=[C(e,"min",{keyDisplay:"Min Items",min:1,value:1}),C(e,"max",{keyDisplay:"Max Items",min:1}),je(e,"unique",{keyDisplay:"Item uniqueness"})];break;case e.type==h:t=[C(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),C(e,"max",{keyDisplay:"Max Items",value:e.max||e.schs.length})];break;case e.type==k:t=[C(e,"min",{keyDisplay:"Min Length",min:0}),C(e,"max",{keyDisplay:"Max Length",min:0}),fe(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case e.type==_:t=[he(e,"min",{keyDisplay:"Min"}),he(e,"max",{keyDisplay:"Max"}),he(e,"multipleOf",{keyDisplay:"Multiple of",min:1})];break;case e.type==Z:t=[];case e.type==g:t=[];case e.type==M:t=[];case e.type==y:t=[];case e.type==D:t=[];case e.type==$:t=[];case e.type==S:t=[];default:t=[]}return e._meta.parent.type==m&&e._meta.parent._box!="file"&&t.push(je(e,"required",{keyDisplay:"Required"})),t};var ye=(e,t)=>e.errors&&e.errors[t];var Ut=(e,t,r={})=>{try{let n=t._models||t.order.reduce((o,a)=>(o[t.fields[a].$anchor]=a,o),{}),l={level:1,tab:0,models:n,rootBox:t._box,rootKey:t.key};sn(e,{sch:t,ui:Object.assign(l,r.ui),path:t.path||"",key:t.key,parent:{type:t.type,_box:t._box}})}catch(n){console.log(n)}},sn=(e,t)=>se(document.querySelector(e),f`
  <theme>
    <ul role="tree" aria-multiselectable="true" class="text-sm" tabindex="-1">
      ${X(t)}
    </ul>
  </theme>
  ${null}
`);var X=e=>{switch(!0){case e.sch._box==e.ui.rootBox:return dn(e);case et.includes(e.sch.type):return un(e);default:return pn(e)}},dn=e=>f.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._box}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${qe(e.key)}
    </dfn>
    <ul data-group="${qt(e.sch)}" role="group">
      ${jt(e)}
    </ul>
  </li>`,un=e=>f.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._box}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${Bt(Object.assign(e,{key:qe(e.key)}))}
      ${Kt(e)}
      ${Gt(e)}
    </dfn>
    <ul data-group="${qt(e.sch)}" role="group">
      ${jt(e)}
    </ul>
  </li>`,pn=e=>f.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._box}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${Bt(Object.assign(e,{key:qe(e.key)}))}
    ${Kt(e)}
    ${Gt(e)}
  </li>`,jt=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return f``;switch(!0){case[m].includes(e.sch.type):return fn(e);case[h].includes(e.sch.type):return mn(e);case[v].includes(e.sch.type):return yn(e);case[y].includes(e.sch.type):return hn(e);default:return f``}},fn=e=>e.sch.order.map((t,r)=>X({key:t,sch:e.sch.fields[t],parent:{type:e.sch.type,path:e.path,_box:e.sch._box},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[${t}]`})),mn=e=>e.sch.schs.map((t,r)=>X({key:r,sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path,_box:e.sch._box},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),yn=e=>X({key:0,sch:e.sch.sch,parent:{type:e.sch.type,path:e.path,_box:e.sch._box},ui:{...e.ui,level:e.ui.level+1,index:0},path:`${e.path}[][${0}]`}),hn=e=>e.sch.schs.map((t,r)=>X({key:"",sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path,_box:e.sch._box},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Te=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab}rem`,Ht=(e,t,r)=>f`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="256" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${de}"
  >${r}</textarea>`,Bt=e=>e.parent._box==e.ui.rootBox?Tn(e):xn(e),Tn=e=>f`
  <span class="def" style="${Te(e)}">
    ${bn(e.sch,e.ui)}
  </span>
  <span class="k">${Wt(e)}</span>
  <span class="s">=</span>
  `,xn=e=>{switch(!0){case e.parent.type==y:return f`
      <span class="" style="${Te(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==v:return f`
      <span class="k" style="${Te(e)}"></span>
      <span class="s">└</span>
      `;default:return f`
      <span class="k" style="${Te(e)}">
        ${Wt(e)}
      </span >
      <span class="s">:</span>
    `}},Wt=e=>e.sch.uiMode=="editKey"?Ht("key-edit",e.parent.path,e.key):f`${e.key}`,Kt=e=>e.parent._box==e.ui.rootBox?wn(e):Nn(e),wn=e=>e.ui.viewTypeRoot?e.ui.viewTypeRoot(e):f`<span class="t">${zt(e)}</span>`,Nn=e=>f`<span class="t">${zt(e)}</span>`,zt=e=>e.sch.uiMode=="editType"?Ht("type-edit",e.parent.path,vn(e.sch,e.ui)):f`${Jt(e.sch,e.ui)}`,vn=(e,t)=>{switch(!0){case e.type==S:return JSON.stringify(e.const);case e.type==$:return t.models[e.$ref];default:return e.type}},Jt=(e,t)=>{let r;switch(!0){case(e.type==m&&De(e.fields,{})):r="{ any }";break;case e.type==m:r="{ \xA0 }";break;case e.type==v:r=f`[ ${Jt(e.sch,t)} ]`;break;case e.type==h:r="( \xA0 )";break;case e.type==k:r="string";break;case e.type==_:r="number";break;case e.type==Z:r="integer";break;case e.type==g:r="bool";break;case e.type==M:r="null";break;case e.type==y:r="||";break;case e.type==D:r="any";break;case(e.type==$&&!!t.models[e.$ref]):r=f`<span class="ref">${e._text=t.models[e.$ref]}</span>`;break;case e.type==$:r=f`<span class="ref notfound" title="Ref type">${`${e._text} (#404)`}</span>`;break;case e.type==S:r=f`<span class="value" title="Value type">${JSON.stringify(e.const)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},qe=e=>e,qt=e=>{switch(!0){case[m].includes(e.type):return"keyed";case[h,y].includes(e.type):return"indexed";default:return"none"}},bn=(e,t)=>{let r;switch(!0){case e.type==m:r="record";break;case e.type==v:r="list";break;case e.type==h:r="tuple";break;case e.type==y:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},Gt=e=>{let t;switch(!0){case(e.parent.type==m&&e.sch.required):t=[f`<span class="m"> · required</span>`];break;default:t=[]}return t};var Be={};Xe(Be,{clearClipboard:()=>Q,createWalker:()=>Ft,findUnselectedNode:()=>be,reselectNodes:()=>we,selectMultiNode:()=>B,selectMultiNodeTo:()=>xe,selectNode:()=>b,selectedGroupedByParent:()=>L,toggleSelectNode:()=>Qt});var E="aria-selected",Ft=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.hasAttribute(E)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),e),b=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,Yt(e),q(t),r.focus&&t.focus())},Qt=(e,t)=>{e&&(e.tabIndex=-1),Xt(t)},B=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(E)=="true"?Xt(e):q(t),r.focus&&t.focus())},Yt=e=>{for(let t of e.querySelectorAll(`[${E}='true']`))Ke(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},Ge=(e,t,r,n={})=>{var a,d,c;let l=e._walker.currentNode,o=t();if(!!o){if(l==r)return(a=n.target)==null?void 0:a.call(null,r);(d=n.pre)==null||d.call(null,l,o),Ge(e,t,r,n),(c=n.post)==null||c.call(null,l,o)}},xe=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,Ge(e,()=>e._walker.nextSibling(),r,{pre:(n,l)=>{B(n,l,{focus:!1})}}),e._walker.currentNode=r,q(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,q(r.parentNode.closest(`[${E}]`)),Ge(e,()=>e._walker.previousSibling(),r,{pre:(n,l)=>{B(n,l,{focus:!1})}}),Ke(r.parentNode.closest(`[${E}]`)),e._walker.currentNode=r,q(r),r.focus();break}},q=e=>{!e||(e.setAttribute(E,!0),e.tabIndex=0)},Ke=e=>{!e||(e.setAttribute(E,!1),e.tabIndex=-1)},Xt=e=>(e==null?void 0:e.getAttribute(E))=="true"?Ke(e):q(e),be=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(E))=="true");return t},Sn=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),we=(e,t,r={})=>{Yt(e);for(let n of Sn(Object.keys(t))){let l=t[n];if(n==""?n=e.querySelector("[id][aria-level]"):n=e.querySelector(`[id='${CSS.escape(n)}'][aria-level]`),!n)continue;let o=parseInt(n.getAttribute("aria-level")),a=n.querySelectorAll(`[aria-level='${o+1}'][role='treeitem']`);for(let d=0;d<l.length;d++){let c=l[d].index,s=a[c];if(!s)return;s.classList.add("item-pasted"),r.direction&&s.classList.add(r.direction),B(null,s,{focus:d==l.length-1}),e._walker.currentNode=s}}},L=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${E}='true']`}`),n={};for(let l=0;l<r.length;l++){let o=r[l],a=o.parentNode.closest("[role='treeitem']");if(!a)break;o.index=o.index||parseInt(o.getAttribute("aria-posinset"))-1,n[a.id]=n[a.id]||[],n[a.id].push(o)}return n},Q=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var He={};Xe(He,{anchorsModels:()=>Je,createProjectStore:()=>En,getFileStore:()=>Se,handleProjectContext:()=>_n,projectToStore:()=>An});var Vt="file",$n="project",En=()=>Ne({tag:$n,allowedSchs:[Zt()],put:{pos:"append"}}),Se=(e,t)=>P(e,`[${t}]`),_n=(e,t,r,n)=>{if(t.closest("[id='project']")&&r!="")switch(!0){case ze(n.name):kn(e,r);break;case ve(n.name):let l=Se(e,r);document.querySelector("[id='fmodel'] [role='tree']")._render(l)}else if(t.closest("[id='fmodel']"))switch(!0){case ve(n.name):let l=Se(e,r);l._models=Je(e,l),document.querySelector("[id='fmodel'] [role='tree']")._render(l)}},Je=(e,t)=>{let r={};for(let n of e.order){let l=e.fields[n];for(let o of l.order)r[l.fields[o].$anchor]=n!=t.key?`${n}.${o}`:o}return r},Zt=()=>Ne({tag:Vt,addDefault:K}),gn=(e,t)=>{for(let r of e.fmodels)t.fields[r.key]=r.sch;return t.key=e.key,t.order=e.order,t.$anchor=project.anchor,w(()=>t)},An=(e,t)=>{for(let r of e.files)t.fields[r.key]=gn(r,Zt());return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,w(()=>t)},kn=(e,t)=>{let r=Se(e,t);if((r==null?void 0:r._box)==Vt&&(r._models=Je(e,r),We({store:r,target:"[id='fmodel']",metaSelector:"sch-meta"}),!window._treeClipboard)){let n=document.querySelector("[id='fmodel'] [role='tree']");n._aria.clearClipboard(n)}};var er=[rt,K,it,at,ct,O,nt,lt,ot,()=>ge('"json string"')],Ne=(e={})=>{let t=w(K);return t._box=e.tag||tt,t._allowedSchs=e.allowedSchs||er.map(r=>r()),e.addDefault&&(t._addSchDefault=t._allowedSchs.find(r=>r.type==e.addDefault().type)),e.put&&(t.put=e.put),t};var ze=e=>[nr,lr,tr,rr,or,ir,Fe,ar,cr,Ye].map(t=>t.name).includes(e),ve=e=>[sr,Ye,dr].map(t=>t.name).includes(e),Pn=()=>new Map([["shift-meta-ArrowUp",On],["shift-meta-ArrowDown",Cn],["shift-ArrowUp",Mn],["shift-ArrowDown",In],["meta-ArrowUp",tr],["meta-ArrowDown",rr],["ArrowUp",nr],["ArrowDown",lr],["Home",or],["End",ir],["shift-+",sr],["Enter",Rn],["shift-Enter",ur],["Delete",Ye],["meta-x",pr],["meta-c",fr],["meta-v",mr],["shift-alt-ArrowUp",ar],["shift-alt-ArrowDown",cr],["alt-ArrowUp",Ln],["alt-ArrowDown",Dn],["Escape",({tree:e})=>Q(e)]]),jn=(e,t={})=>function(r){Un(r,this,e,t)};async function Un(e,t,r,n){if(e.target instanceof HTMLTextAreaElement)return qn(e,t,r);let l=Pn().get(yr(e));if(!l||(n.denyCmds||[]).includes(l.name))return;switch(l({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t.renderSchMeta(),t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`));let o=t._walker.currentNode.closest("[data-tag='file']");o&&t.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{file:o.key,path:t._walker.currentNode.id,command:l}}))}var Bn=()=>new Map([["Enter",dr]]),qn=(e,t,r)=>{let n=e.target,l=Bn().get(yr(e));if(!l)return;l({tree:t,store:r},n),t.renderSchMeta();let o=t._walker.currentNode.closest("[data-tag='file']");o&&t.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{file:o.key,path:t._walker.currentNode.id,command:l}}))},Gn=e=>function(t){return Kn(t,this,e)};function Kn(e,t,r){let n=t._walker.currentNode,l=e.target.closest("[role='treeitem']"),o=!t.querySelector("textarea");if(!!l){if(e.shiftKey||e.metaKey)switch(n.compareDocumentPosition(l)){case Node.DOCUMENT_POSITION_CONTAINS:return b(t,l);case Node.DOCUMENT_POSITION_CONTAINED_BY:return b(t,n);default:if(l.parentNode.closest("[role='treeitem']")!=n.parentNode.closest("[role='treeitem']"))return b(t,l)}if(e.shiftKey)xe(t,n,l);else if(e.metaKey)Qt(n,t._walker.currentNode=l);else{let a=l.closest("[data-tag='file']");t._walker.currentNode=l,Fe({tree:t},{notFocusIfTextArea:o}),a&&t.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{file:a.key,path:l.id,command:Fe}}))}t.renderSchMeta()}}var Hn=({tree:e,store:t})=>{let r=e.querySelectorAll("[id='fmodel'] [aria-selected='true']");if(r.length==1){let n=P(t,r[0].id);n.key=r[0].key,n.path=r[0].id,n.rootKey=e.querySelector(".root-item").key,me(e._metaContainer,n,t)}},yr=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:n,key:l})=>{let o=[];return e&&o.push("shift"),(t||n)&&o.push("meta"),r&&o.push("alt"),l&&o.push(l),o.join("-")},On=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();xe(e,t,r)},Cn=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();xe(e,t,r)},Mn=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();B(t,r)},In=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();B(t,r)},tr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();b(e,t)},rr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();b(e,t)},nr=({tree:e})=>b(e,e._walker.previousNode()),lr=({tree:e})=>b(e,e._walker.nextNode()),or=({tree:e})=>{for(;e._walker.parentNode(););b(e,e._walker.currentNode)},ir=({tree:e})=>{for(;e._walker.nextNode(););b(e,e._walker.currentNode)},Fe=({tree:e},t={})=>b(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),sr=({tree:e,store:t})=>{var d;let r=e._walker.currentNode,n=P(t,r.id),l,o=n._addSchDefault||t._allowedSchs[0],a=()=>ee(o);((d=n.put)==null?void 0:d.pos)=="prepend"?l=0:l=Number.MAX_SAFE_INTEGER,te(t,r.id,[{k:null,sch:a,index:l}]),e._render(),e.scrollTop=e.style.height,b(e,r)},Rn=({tree:e,store:t})=>{var n,l;((l=(n=e._walker.currentNode.closest("[role='group']"))==null?void 0:n.dataset)==null?void 0:l.group)=="keyed"&&hr({tree:e,store:t,editMode:"editKey"})},ur=({tree:e,store:t})=>{hr({tree:e,store:t,editMode:"editType"})},hr=({tree:e,store:t,editMode:r})=>{let n=e._walker.currentNode;R(t,n.id,(o,a)=>({...o,uiMode:r})),e._render();let l=e.querySelector("textarea");!l||(l._treeItem=n,l.onblur=o=>Wn(e,t,l),l.focus())},Wn=(e,t,r)=>{let n=R(t,r._treeItem.id,(l,o)=>Object.assign(l,{uiMode:"cancelled-edit"}));e._render(),n&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),b(e,e._walker.currentNode))},dr=({tree:e,store:t},r)=>{r.id=="key-edit"?Tr(e,t,r,Jn):r.id=="type-edit"&&Tr(e,t,r,zn)},Tr=(e,t,r,n)=>{let l=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),b(e,r._treeItem,{focus:!1});let o=n(e,t,r)||l.id;R(t,o,(a,d)=>Object.assign(a,{uiMode:"editted"})),e._render(),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(o)}']`),b(e,e._walker.currentNode)},zn=(e,t,r)=>{let n=t._allowedSchs.find(a=>a.type==r.value),l=Object.keys(t._models).find(a=>t._models[a]==r.value),o=ge(r.value);return n?le(t,r._treeItem.id,()=>ee(n)):l?le(t,r._treeItem.id,()=>st(l)):o&&le(t,r._treeItem.id,()=>o),e._walker.currentNode.id},Jn=(e,t,r)=>{let n=L(e),l=r.dataset.parentPath;n[r.dataset.parentPath]=n[r.dataset.parentPath].filter(s=>s.id==r._treeItem.id).map(s=>({id:s.id,newK:r.value,index:s.index}));let o=n[r.dataset.parentPath][0].index,d=re(t,{dstPath:l,startIndex:o},n)[l][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${d}]`},Ye=({tree:e,store:t})=>{let r=be(()=>e._walker.nextSibling())||be(()=>e._walker.previousSibling())||be(()=>e._walker.parentNode());Fn(e,t),e._render(),b(e,r)},Fn=(e,t)=>{let r=L(e);for(let n of Object.keys(r))Ae(t,n,r[n].map(l=>l.index))};var pr=({store:e,tree:t})=>{Q(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-cutting");let r=L(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",storeKey:e.key,ops:n=>Oe(e,r,{dstPath:n}),selected:r}},fr=({store:e,tree:t})=>{Q(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-copying");let r=L(t,{ops:".item-copying"});window._treeClipboard={type:"copy",storeKey:e.key,ops:n=>Me(e,r,{dstPath:n,startIndex:0}),selected:r}},mr=({tree:e,store:t,srcStore:r})=>{let n=P(t,e._walker.currentNode.id);if(!![m,y,h].includes(n.type)&&window._treeClipboard){let l=e._walker.currentNode.id,{type:o,storeKey:a,ops:d,selected:c}=window._treeClipboard,s=c,u={};if(t.key==a)switch(o){case"copy":u=Re(t,{dstPath:l},s);break;case"cut":u=re(t,{dstPath:l},s);break}else switch(o){case"copy":let p=d(l);u=Ie(t,{dstPath:l},p);break;case"cut":let N=d(l);u=Ce(t,{dstPath:l},N);break}Object.keys(u).length!=0&&(e._render(),Q(e),we(e,u))}},ar=({tree:e,store:t})=>xr({tree:e,store:t,direction:"up"},r=>r[0].index),cr=({tree:e,store:t})=>xr({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),xr=({tree:e,store:t,direction:r},n)=>{let l=L(e),o={};for(let a of Object.keys(l))o=Re(t,{dstPath:a,startIndex:n(l[a])},{[a]:l[a]});Object.keys(o).length!=0&&(e._render(),we(e,o,{direction:r}))},Ln=({tree:e,store:t})=>br({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),Dn=({tree:e,store:t})=>br({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),br=({tree:e,store:t,startIndex:r,direction:n})=>{let l=L(e),o={};for(let a of Object.keys(l)){let d=l[a].sort((c,s)=>c.index-s.index);o=re(t,{dstPath:a,startIndex:r(d[0].index)},l)}Object.keys(o).length!=0&&(e._render(),we(e,o,{direction:n}))},wr=({store:e,target:t,metaSelector:r,opts:n})=>{e.render=a=>Ut(t,a||e,n||{}),e.render();let l=document.querySelector(`${t} [role='tree']`),o=document.querySelector(r);if(l){l._aria=Be,l._render=e.render,Ft(l),l.onkeydown=jn(e,n.treeKeyDownOpts),l.onclick=Gn(e);let a=l._walker.nextNode();b(l,l._walker.nextNode()||a,{focus:n.focus}),r&&(l._metaContainer=o),l.renderSchMeta=()=>Hn({tree:l,store:e}),l.renderSchMeta()}},Yn=({store:e,target:t,metaSelector:r})=>{wr({store:e,target:t,metaSelector:r,opts:{ui:{depthLimit:2,modelTypeText:(n,l)=>"file",typeText:(n,l)=>{if(n.type==m)return"record";if(n.type==S)return"value";if(n.type==h)return"tuple";if(n.type==y)return"union"},viewTypeRoot:n=>""},treeKeyDownOpts:{denyCmds:[ur,fr,pr,mr].map(n=>n.name)},focus:!0}})},We=({store:e,target:t,metaSelector:r})=>{wr({store:e,target:t,metaSelector:r,opts:{ui:{modelTypeText:(n,l)=>"type"}}})},Xn=({store:e,detail:t,target:r})=>{let{path:n,attrs:l}=t,o=R(e,n,(a,d)=>Lt(a,l));e.render(),me(r.closest("sch-meta"),o,e)};export{He as Project,er as allSchs,Ne as createStore,Yn as initFileView,We as initModelView,ze as isContextSwitchedCmd,ve as isModelChangedCmd,Xn as update};
/*! (c) Andrea Giammarchi - ISC */
