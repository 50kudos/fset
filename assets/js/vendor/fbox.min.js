var hl=Object.defineProperty;var Mr=(e,t)=>{for(var r in t)hl(e,r,{get:t[r],enumerable:!0})};var xt,Tl=new Uint8Array(16);function Yt(){if(!xt&&(xt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!xt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xt(Tl)}var Pr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function xl(e){return typeof e=="string"&&Pr.test(e)}var Cr=xl;var k=[];for(var zt=0;zt<256;++zt)k.push((zt+256).toString(16).substr(1));function yl(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase();if(!Cr(r))throw TypeError("Stringified UUID is invalid");return r}var Rr=yl;function _l(e,t,r){e=e||{};var n=e.random||(e.rng||Yt)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var l=0;l<16;++l)t[r+l]=n[l];return t}return Rr(n)}var Jt=_l;var A=10,V=11,le=12,M=13,I=14,D=15,S=16,ie=17,ae=18,oe=19,se=20,ce=21,de=22,ue=23;var fe=24,pe=25;var me=26,Ne=27,K=28,he=29,Ke=30,yt=31,P="fmodel",ge=()=>({t:Ke}),_t=()=>({t:ie}),Lr=()=>({t:me}),jr=()=>({t:ae,min:-128,max:127}),Ur=()=>({t:se,min:-32768,max:32767}),Vr=()=>({t:de,min:-2147483648,max:2147483647}),Gr=()=>({t:oe,min:0,max:255}),Fr=()=>({t:ce,min:0,max:65535}),Kr=()=>({t:ue,min:0,max:4294967295}),qr=()=>({t:fe}),Wr=()=>({t:pe}),Br=()=>({t:yt}),Hr=()=>({t:Ne}),Te=()=>({t:A,fields:[]}),Yr=()=>({t:V,schs:[v(()=>tt(null)),v(Te)]}),zr=()=>({t:M,sch:v(ge)}),Jr=()=>({t:I,schs:[v(ge)]}),Xr=()=>({t:D,schs:[v(ge)]}),Qr=()=>({t:S,fields:[{...v(Te),key:"tag_a"}],tagname:"tag",allowedSchs:[Te()],keyPrefix:"tag"}),Zr=()=>({t:le,schs:[v(_t),v(ge)]}),tt=e=>({t:K,$r:e}),bt=e=>{try{return e=JSON.parse(e),e==null||["string","number","boolean"].includes(typeof e)?{t:he,v:e}:!1}catch(t){return!1}},v=(e,t={})=>{let r=e();return r.$a||(r.$a=Jt()),t.force&&(r.$a=Jt()),r},we=e=>bl[e],bl={[A]:"record",[V]:"e_record",[le]:"dict",[M]:"list",[I]:"tuple",[D]:"union",[S]:"tagged_union",[ie]:"string",[ae]:"int8",[oe]:"uint8",[se]:"int16",[ce]:"uint16",[de]:"int32",[ue]:"uint32",[fe]:"float32",[pe]:"float64",[me]:"boolean",[Ne]:"nil",[K]:"ref",[he]:"value",[Ke]:"any",[yt]:"timestamp"};var qe=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},en=e=>{qe(e),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},{defineProperty:Nl}=Object,tn=Nl,C=(e,t,r)=>tn(e,t,{value:r,configurable:!0}),Me=(e,t,r)=>tn(e,t,{value:r,configurable:!0,writable:!0}),Xt=function(e,t,r){var n=null;return function(){n&&clearTimeout(n);var l=arguments;n=setTimeout(function(){n=null,e.apply(r,l)},t)}};var Nt=(e,t)=>{let r=JSON.parse(JSON.stringify(e));return R(r,(n,l)=>v(()=>n,{force:!0})),r},R=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,delete e._pruned,e=t(e,r),e._halt||e._pruned)return e;let n=({t:l,$a:i,key:a},{path:o,level:s})=>({level:s,t:l,$a:i,key:a,path:o});switch(!0){case e.hasOwnProperty("fields"):for(let a=e.fields.length-1;a>=0;a--){let o=e.fields[a],s=o.key,c={path:`${r.path}[${s}]`,level:r.level+1,index:a,parent:n(e,r)};if(o=R(o,t,c),o.index=a,e.fields[a]=o,o._halt)return Object.assign(e,{_halt:!0})}break;case e.hasOwnProperty("schs"):for(let a=0;a<e.schs.length;a++){let o=e.schs[a],s={path:`${r.path}[][${a}]`,level:r.level+1,index:a,parent:n(e,r)};if(o=R(o,t,s),o.index=a,e.schs[a]=o,o._halt)return Object.assign(e,{_halt:!0})}break;case e.hasOwnProperty("sch"):let l={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:n(e,r)},i=R(e.sch,t,l);if(i.index=0,e.sch=i,i._halt)return Object.assign(e,{_halt:!0});break;default:}return e},gl=(e,t,r)=>{let n={original:{},popped:[]},l=r.sort((i,a)=>a-i);return R(e,(i,a)=>{if(a.path!=t)return i;switch(!0){case i.hasOwnProperty("fields"):for(let o of l)n.popped.unshift({k:i.fields[o].key,sch:i.fields.splice(o,1)[0],index:o});break;case i.hasOwnProperty("sch"):break;case i.hasOwnProperty("schs"):for(let o of l)n.popped.unshift({k:o,sch:i.schs.splice(o,1)[0],index:o});i.schs.length==0&&i.schs.splice(0,0,v(ge));break;default:}return i}),n},wl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),gt=(e,t,r)=>{let n={original:{},inserted:[]},l=(i,a)=>(i=Math.max(i,0),i=Math.min(i,a.length),i);return R(e,(i,a)=>{var o;if(a.path!=t)return i;{typeof r=="function"&&(r=r.call(i));let s=r.sort((c,u)=>c.index-u.index);switch(!0){case i.hasOwnProperty("fields"):let c=(o=e.taggedLevel)==null?void 0:o[a.level+1];for(let{k:u,sch:d,index:m}of s){u=u==0?"0":u,u=u||`${c||i.keyPrefix||"key"}_${Math.floor(Date.now()/100)}`,u=`${u}`;let _={};for(let h=0;h<i.fields.length;h++)_[i.fields[h].key]=!0;for(;_[u];)u=`${u} \u2013`;m=l(m,i.fields),i.fields.splice(m,0,v(d)),i.fields[m].key=u,n.inserted.push({k:i.fields[m].key,sch:i.fields[m],index:m})}break;case i.hasOwnProperty("sch"):break;case i.hasOwnProperty("schs"):for(let{k:u,sch:d,index:m}of s)m=l(m,i.schs),i.schs.splice(m,0,v(d)),n.inserted.push({k:u,sch:i.schs[m],index:m});break;default:}return i}}),n},vt=(e,{dstPath:t,startIndex:r=0},n)=>{let l=(s,c,u)=>xe(s,c,(d,m)=>(C(d,"_pinId",u),d)),i=Symbol(t);l(e,t,i);let a=wt(e,n,{dstPath:t});return Qt(e,{dstPin:i,startIndex:r},a)},wt=(e,t,r={})=>{let n={},l=wl(Object.keys(t));for(let i of l){let a=t[i],o=u=>{var d;return(d=a.find(m=>m.index==u))==null?void 0:d.newK};if(r.dstPath&&a.filter(d=>r.dstPath.startsWith(d.id)).length!=0)continue;let c=gl(e,i,a.map(u=>u.index)).popped.map(({k:u,sch:d,index:m})=>({k:o(m)||u,sch:()=>d}));n[i]=c}return n},Qt=(e,{dstPin:t,dstPath:r,startIndex:n=0},l)=>{let i=(c,u)=>We(c,(d,m)=>d._pinId==u,(d,m)=>(C(d,"_pinned",m),d));n=Math.max(n,0);let a={},o=Object.values(l).flatMap(c=>c).map((c,u)=>Object.assign(c,{index:n+u}));if(t){let c=i(e,t);c&&(r=c._pinned.path)}let s=gt(e,r,o);return s.inserted.length!=0&&(a[r]=s.inserted),a},tr=(e,{dstPath:t,startIndex:r=0},n)=>{let l=Zt(e,n,{dstPath:t,startIndex:r});return er(e,{dstPath:t},l)},Zt=(e,t,r={})=>Object.values(t).reduce((n,l)=>{let i=l.map(o=>o.id),a=[];We(e,(o,s)=>(i.includes(s.path)&&(C(o,"_meta",s),a.unshift(o)),a.length==i.length),(o,s)=>o);for(let o of l){if(r.dstPath&&r.dstPath.startsWith(o.id))continue;let s=a.find(c=>c._meta.path==o.id);s&&n.unshift({k:o.key,sch:()=>Nt(s,e),index:r.startIndex+n.length,id:o.id})}return n},[]),er=(e,{dstPath:t},r)=>{let n={},l=gt(e,t,r);return l.inserted.length!=0&&(n[t]=l.inserted),n},Et=(e,t,r)=>xe(e,t,(n,l)=>{let i=v(r),{title:a,description:o,rw:s,required:c,$a:u,key:d}=n,m=i.t==K&&i.$r!=n.$r,_=i.t==he&&i.v!=n.v,h=i.t!=n.t;return i.$r==u?n:h||_||m?Object.assign(i,{metadata:{title:a,description:o,rw:s,required:c},$a:u,key:d}):n}),G=(e,t)=>We(e,(r,n)=>n.path==t,(r,n)=>(C(r,"_meta",n),r)),xe=(e,t,r)=>We(e,(n,l)=>l.path==t,r),We=(e,t,r)=>{let n;return R(e,(l,i)=>t(l,i)?(n=r(l,i),n._halt=!0,n):l),n&&delete n._halt,n};var rr={};Mr(rr,{clearClipboard:()=>Ee,collapseSelected:()=>ir,createWalker:()=>rn,ensureNodeConnected:()=>At,expandSelected:()=>lr,findUnselectedNode:()=>nt,reselectNodes:()=>He,selectMultiNode:()=>Pe,selectMultiNodeTo:()=>rt,selectNode:()=>g,selectedGroupedByParent:()=>ve,toggleSelectNode:()=>an});var F="aria-selected",kt="aria-expanded",rn=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{var r;if(t.hasAttribute(F)){let n=(r=t.parentElement.closest(`[${kt}]`))==null?void 0:r.getAttribute(kt);return n&&n=="false"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}else return NodeFilter.FILTER_SKIP}},!1),e),g=(e,t,r={focus:!0})=>{t=At(e,t),!!t&&(e._walker.currentNode=t,nn(e),Be(t),r.focus&&t.focus())},an=(e,t)=>{e&&(e.tabIndex=-1),ln(t)},Pe=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(F)=="true"?ln(e):Be(t),r.focus&&t.focus())},nn=(e,t={})=>{t=Object.assign({sync:!0},t);for(let r of e.querySelectorAll(`[${F}='true']`))t.sync?$t(r):Xt($t,0)(r)},nr=(e,t,r,n={})=>{var a,o,s;let l=e._walker.currentNode,i=t();if(!!i){if(l==r)return(a=n.target)==null?void 0:a.call(null,r);(o=n.pre)==null||o.call(null,l,i),nr(e,t,r,n),(s=n.post)==null||s.call(null,l,i)}},rt=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,nr(e,()=>e._walker.nextSibling(),r,{pre:(n,l)=>{Pe(n,l,{focus:!1})}}),e._walker.currentNode=r,Be(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,Be(r.parentNode.closest(`[${F}]`)),nr(e,()=>e._walker.previousSibling(),r,{pre:(n,l)=>{Pe(n,l,{focus:!1})}}),$t(r.parentNode.closest(`[${F}]`)),e._walker.currentNode=r,Be(r),r.focus();break}},Be=e=>{!e||(e.setAttribute(F,!0),e.tabIndex=0)},$t=e=>{!e||(e.setAttribute(F,!1),e.tabIndex=-1)},ln=e=>(e==null?void 0:e.getAttribute(F))=="true"?$t(e):Be(e),nt=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(F))=="true");return t},vl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),He=(e,t,r={})=>{nn(e,r);for(let n of vl(Object.keys(t))){let l=t[n];if(n==""?n=e.querySelector("[id][aria-level]"):n=e.querySelector(`[id='${CSS.escape(n)}'][aria-level]`),!n)continue;let i=parseInt(n.getAttribute("aria-level")),a=n.querySelectorAll(`[aria-level='${i+1}'][role='treeitem']`);for(let o=0;o<l.length;o++){let s=l[o].index,c=a[s];if(!c)return;r.direction&&c.classList.add(r.direction),Pe(null,c,{focus:!1}),e._walker.currentNode=c}r=Object.assign({sync:!0},r),r.sync?e._walker.currentNode.focus():Xt(()=>e._walker.currentNode.focus())()}},ve=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${F}='true']`}`),n={};for(let l=0;l<r.length;l++){let i=r[l],a=i.parentNode.closest("[role='treeitem']");if(!a)break;i.index=i.index||parseInt(i.getAttribute("aria-posinset"))-1,n[a.id]=n[a.id]||[],n[a.id].push(i)}return n},lr=e=>{let t=e.querySelectorAll(`[${F}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(kt,"true")},ir=e=>{let t=e.querySelectorAll(`[${F}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(kt,"false")},Ee=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null},At=(e,t)=>t&&!t.isConnected?t.id?e.querySelector(`[id='${CSS.escape(t.id)}']`):e.querySelector("[id]"):t;var El=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();rt(e,t,r)},kl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();rt(e,t,r)},Al=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();Pe(t,r)},$l=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();Pe(t,r)},Dl=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();g(e,t)},Sl=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();g(e,t)},Ol=({tree:e})=>g(e,e._walker.previousNode()),Il=({tree:e})=>g(e,e._walker.nextNode()),Ml=({tree:e})=>{for(;e._walker.parentNode(););g(e,e._walker.nextNode()),g(e,e._walker.parentNode())},Pl=({tree:e})=>{for(;e._walker.nextNode(););g(e,e._walker.currentNode)},lt=({tree:e},t={})=>g(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),it=({tree:e,store:t},r)=>on(e,t,r),Dt={selectMultiNodeUpTo:El,selectMultiNodeDownTo:kl,selectMultiNodeUp:Al,selectMultiNodeDown:$l,selectUpEnd:Dl,selectDownEnd:Sl,selectUp:Ol,selectDown:Il,selectRoot:Ml,selectLast:Pl},H=({tree:e,store:t})=>{var a,o;let r=e._walker.currentNode,n=G(t,r.id),l,i=((a=sn(e,t))==null?void 0:a[0])||n._addSchDefault||n.allowedSchs&&n.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!i||(((o=t.put)==null?void 0:o.pos)=="prepend"?l=0:l=Number.MAX_SAFE_INTEGER,gt(t,r.id,[{k:null,sch:()=>Nt(i),index:l}]),e._render(t),g(e,r))},Ye=({tree:e,store:t})=>{var l,i;let r=e._walker.currentNode;if(((i=(l=r.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:i.group)=="keyed"){let a=r.querySelector(".k").getBoundingClientRect();cn({tree:e,store:t,editMode:"editKey",textRect:a})}},ze=({tree:e,store:t})=>{let r=e._walker.currentNode.querySelector(".t").getBoundingClientRect();cn({tree:e,store:t,editMode:"editType",textRect:r})},cn=({tree:e,store:t,editMode:r,textRect:n})=>{let l=e._walker.currentNode,i=xe(t,l.id,(s,c)=>Me(s,"uiMode",r));e._render(t);let a=e.querySelector("textarea");if(!a)return;let o=window.getComputedStyle(a);a.style.minWidth=n.width+"px",a.style.minHeight=n.height+"px",a._treeItem=l,a.onblur=s=>s.relatedTarget&&s.relatedTarget.id!=a._treeItem.id&&on(e,t,a),a.focus()},on=(e,t,r)=>{let n=xe(t,r._treeItem.id,(l,i)=>Object.assign(l,{uiMode:"cancelled-edit"}));e._render(t),n&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),g(e,e._walker.currentNode))},ke=({tree:e,store:t},r)=>{r.id=="key-edit"?dn(e,t,r,Rl):r.id=="type-edit"&&dn(e,t,r,Cl)},dn=(e,t,r,n)=>{let l=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),g(e,r._treeItem,{focus:!1});let i=n(e,t,r)||l.id;xe(t,i,(a,o)=>Object.assign(a,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(i)}']`),g(e,e._walker.currentNode)},Cl=(e,t,r)=>{let l=(sn(e,t)||t.allowedSchs).find(o=>we(o.t)==r.value),i=t._models[r.value]&&r.value||Object.keys(t._models).find(o=>t._models[o].display==r.value),a=bt(r.value);return l?Et(t,r._treeItem.id,()=>Nt(l)):i?Et(t,r._treeItem.id,()=>tt(i)):a&&Et(t,r._treeItem.id,()=>a),e._walker.currentNode.id},Rl=(e,t,r)=>{let n=ve(e),l=r.dataset.parentPath;n[r.dataset.parentPath]=n[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>({id:c.id,newK:r.value,index:c.index}));let i=n[r.dataset.parentPath][0].index,o=vt(t,{dstPath:l,startIndex:i},n)[l][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${o}]`},q=({tree:e,store:t})=>{let r=nt(()=>e._walker.nextSibling())||nt(()=>e._walker.previousSibling())||nt(()=>e._walker.parentNode());wt(t,ve(e)),e._render(t),g(e,r)},at=({tree:e,store:t})=>{var n;let r=e._walker.currentNode;!r||((n=t.entryable)==null?void 0:n.includes(r.dataset.tag))&&(xe(t,r.id,(l,i)=>Object.assign(l,{isEntry:!0})),e._render(t),g(e,r))};var Ce=({store:e,tree:t})=>{Ee(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-cutting");let r=ve(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",srcStoreKey:e.key,ops:n=>wt(e,r,{dstPath:n}),selected:r}},Re=({store:e,tree:t})=>{if(document.getSelection().toString().length!=0)return;Ee(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-copying");let r=ve(t,{ops:".item-copying"});window._treeClipboard={type:"copy",srcStoreKey:e.key,ops:n=>Zt(e,r,{dstPath:n,startIndex:0}),selected:r}},Y=({tree:e,store:t,srcStore:r})=>{var l;let n=G(t,e._walker.currentNode.id);if(!![A,D,I].includes(n.t)&&!(((l=t.put)==null?void 0:l.onlyDst)&&!t.put.onlyDst[t.taggedLevel[n._meta.level]])&&window._treeClipboard){let i=e._walker.currentNode.id,{type:a,srcStoreKey:o,ops:s,selected:c}=window._treeClipboard,u=c,d={};if(t.key==o)switch(a){case"copy":d=tr(t,{dstPath:i},u);break;case"cut":d=vt(t,{dstPath:i},u);break}else switch(a){case"copy":let _=s("");d=er(t,{dstPath:i},_);break;case"cut":let h=s("");d=Qt(t,{dstPath:i},h);break}let m=(_,h)=>{let p={};for(let y of Object.keys(h))y==n._meta.path?p[""]=h[y]:p[y]=h[y];_._render(n),Ee(_),He(_,p)};Object.keys(d).length!=0&&(n._tree?m(n._tree,d):(e._render(t),Ee(e),He(e,d)))}},z=({tree:e,store:t})=>un({tree:e,store:t,direction:""},r=>r[0].index),J=({tree:e,store:t})=>un({tree:e,store:t,direction:""},r=>r[r.length-1].index+1),un=({tree:e,store:t,direction:r},n)=>{let l=ve(e),i={};for(let a of Object.keys(l))i=tr(t,{dstPath:a,startIndex:n(l[a])},{[a]:l[a]});Object.keys(i).length!=0&&(e._render(t),He(e,i,{direction:r,sync:!!e.sync}))},X=({tree:e,store:t})=>fn({tree:e,store:t,startIndex:r=>r-1,direction:""}),Q=({tree:e,store:t})=>fn({tree:e,store:t,startIndex:r=>r+1,direction:""}),fn=({tree:e,store:t,startIndex:r,direction:n})=>{let l=ve(e),i={};for(let a of Object.keys(l)){let o=l[a].sort((s,c)=>s.index-c.index);i=vt(t,{dstPath:a,startIndex:r(o[0].index)},l)}Object.keys(i).length!=0&&(e._render(t),He(e,i))},sn=(e,t)=>{var o,s,c;let r=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!r)return;let n=G(t,r.id),l=e._walker.currentNode,i=G(t,l.id),a=(u,d)=>{if(!u)return!1;let m=!0;for(let _ of d)m=m&&u[_[0]]==_[1];return m};for(let u of t.rulesTable||[])if(a(n,u.selector)){if((s=(o=u.rules)==null?void 0:o.nthChild)==null?void 0:s[i._meta.index])return u.rules.nthChild[i._meta.index].allowedSchs;if((c=u.rules.children)==null?void 0:c.allowedSchs)return u.rules.children.allowedSchs}return null},St=({tree:e})=>lr(e),Ot=({tree:e})=>ir(e);var{defineProperties:Ll}=Object,ar=({store:e,target:t,view:r,treeKeyDownCmds:n,textAreaKeyDownCmd:l,opts:i={}})=>{Ll(e,{render:{value:function(o){r(o||this)},configurable:!0},currentNode:{writable:!0,configurable:!0},_tree:{writable:!0,configurable:!0}}),e.render();let a=document.querySelector(`${t} [role='tree']`);if(a){a._aria=rr,a._render=r,e._tree=a,rn(a),a.onkeydown=jl(e,n,{textAreaKeyDownCmd:l}),a.onclick=Ul(e);let o=a.querySelector(`[id='${CSS.escape(i.selectId)}']`);if(o&&i.selectId!="")a._walker.currentNode=o,g(a,a._walker.currentNode,{focus:i.focus});else{e.currentNode=At(a,e.currentNode);let s=a._walker.nextNode(),c=e.currentNode||a._walker.nextNode()||s;g(a,c,{focus:i.focus})}return a._walker.currentNode.scrollIntoView({block:"center"}),a}},jl=(e,t,r)=>function(n){Vl(n,this,e,t,r)};async function Vl(e,t,r,n=[],l={}){switch(e.stopPropagation(),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}if(e.target instanceof HTMLTextAreaElement)return Fl(e,t,r,l.textAreaKeyDownCmd);let a=new Map(n).get(pn(e));!a||(l.denyCmds||[]).includes(a.name)||Gl(t,r,a)||(a({tree:t,store:r}),t._walker.currentNode=At(t,t._walker.currentNode),g(t._walker.currentNode),r.currentNode=t._walker.currentNode,or(t,t._walker.currentNode,a))}var Gl=(e,t,r)=>{var s,c,u,d,m,_,h;let n=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!n)return;let l=G(t,n.id),i=e._walker.currentNode,a=G(t,i.id),o=(p,y)=>{if(!p)return!1;let x=!0;for(let f of y)x=x&&p[f[0]]==f[1];return x};for(let p of t.rulesTable||[])if(o(l,p.selector)&&(((u=(c=(s=p.rules)==null?void 0:s.nthChild)==null?void 0:c[a._meta.index])==null?void 0:u.exceptActions)&&p.rules.nthChild[a._meta.index].exceptActions.map(y=>y.name).includes(r.name)||((d=p.rules.children)==null?void 0:d.onlyActions)&&!p.rules.children.onlyActions.map(y=>y.name).includes(r.name)||((m=p.rules.children)==null?void 0:m.exceptActions)&&p.rules.children.exceptActions.map(y=>y.name).includes(r.name))||o(a,p.selector)&&(((_=p.rules.self)==null?void 0:_.onlyActions)&&!p.rules.self.onlyActions.map(y=>y.name).includes(r.name)||((h=p.rules.self)==null?void 0:h.exceptActions)&&p.rules.self.exceptActions.map(y=>y.name).includes(r.name)))return!0;return!1},Fl=(e,t,r,n=[])=>{e.stopPropagation();let l=e.target,a=new Map(n).get(pn(e));!a||(a({tree:t,store:r},l),r.currentNode=t._walker.currentNode,or(t,t._walker.currentNode,a))},Ul=e=>function(t){return Kl(t,this,e)};function Kl(e,t,r){e.stopPropagation();let n=t._walker.currentNode,l=e.target.closest("[role='treeitem']"),i=!t.querySelector("textarea");if(!!l){if(e.shiftKey||e.metaKey)switch(n.compareDocumentPosition(l)){case Node.DOCUMENT_POSITION_CONTAINS:return g(t,l);case Node.DOCUMENT_POSITION_CONTAINED_BY:return g(t,n);default:if(l.parentNode.closest("[role='treeitem']")!=n.parentNode.closest("[role='treeitem']"))return g(t,l)}e.shiftKey?(n!=l&&document.getSelection().removeAllRanges(),rt(t,n,l)):e.metaKey?an(n,t._walker.currentNode=l):(t._walker.currentNode=l,lt({tree:t},{notFocusIfTextArea:i}),r.currentNode=t._walker.currentNode,or(t,l,lt))}}var pn=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:n,key:l})=>{let i=[];return e&&i.push("shift"),(t||n)&&i.push("meta"),r&&i.push("alt"),l&&i.push(l),i.join("-")},or=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}}));var mn=new WeakMap,ot=e=>(...t)=>{let r=e(...t);return mn.set(r,!0),r},Le=e=>typeof e=="function"&&mn.has(e);var sr=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,It=(e,t,r=null,n=null)=>{for(;t!==r;){let l=t.nextSibling;e.insertBefore(t,n),t=l}},je=(e,t,r=null)=>{for(;t!==r;){let n=t.nextSibling;e.removeChild(t),t=n}};var L={},ye={};var Z=`{{lit-${String(Math.random()).slice(2)}}}`,cr=`<!--${Z}-->`,hn=new RegExp(`${Z}|${cr}`),Je="$lit$",Mt=class{constructor(t,r){this.parts=[],this.element=r;let n=[],l=[],i=document.createTreeWalker(r.content,133,null,!1),a=0,o=-1,s=0,{strings:c,values:{length:u}}=t;for(;s<u;){let d=i.nextNode();if(d===null){i.currentNode=l.pop();continue}if(o++,d.nodeType===1){if(d.hasAttributes()){let m=d.attributes,{length:_}=m,h=0;for(let p=0;p<_;p++)Tn(m[p].name,Je)&&h++;for(;h-- >0;){let p=c[s],y=Pt.exec(p)[2],x=y.toLowerCase()+Je,f=d.getAttribute(x);d.removeAttribute(x);let N=f.split(hn);this.parts.push({type:"attribute",index:o,name:y,strings:N}),s+=N.length-1}}d.tagName==="TEMPLATE"&&(l.push(d),i.currentNode=d.content)}else if(d.nodeType===3){let m=d.data;if(m.indexOf(Z)>=0){let _=d.parentNode,h=m.split(hn),p=h.length-1;for(let y=0;y<p;y++){let x,f=h[y];if(f==="")x=j();else{let N=Pt.exec(f);N!==null&&Tn(N[2],Je)&&(f=f.slice(0,N.index)+N[1]+N[2].slice(0,-Je.length)+N[3]),x=document.createTextNode(f)}_.insertBefore(x,d),this.parts.push({type:"node",index:++o})}h[p]===""?(_.insertBefore(j(),d),n.push(d)):d.data=h[p],s+=p}}else if(d.nodeType===8)if(d.data===Z){let m=d.parentNode;(d.previousSibling===null||o===a)&&(o++,m.insertBefore(j(),d)),a=o,this.parts.push({type:"node",index:o}),d.nextSibling===null?d.data="":(n.push(d),o--),s++}else{let m=-1;for(;(m=d.data.indexOf(Z,m+1))!==-1;)this.parts.push({type:"node",index:-1}),s++}}for(let d of n)d.parentNode.removeChild(d)}},Tn=(e,t)=>{let r=e.length-t.length;return r>=0&&e.slice(r)===t},dr=e=>e.index!==-1,j=()=>document.createComment(""),Pt=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;var st=class{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(let n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(let n of this.__parts)n!==void 0&&n.commit()}_clone(){let t=sr?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,l=document.createTreeWalker(t,133,null,!1),i=0,a=0,o,s=l.nextNode();for(;i<n.length;){if(o=n[i],!dr(o)){this.__parts.push(void 0),i++;continue}for(;a<o.index;)a++,s.nodeName==="TEMPLATE"&&(r.push(s),l.currentNode=s.content),(s=l.nextNode())===null&&(l.currentNode=r.pop(),s=l.nextNode());if(o.type==="node"){let c=this.processor.handleTextExpression(this.options);c.insertAfterNode(s.previousSibling),this.__parts.push(c)}else this.__parts.push(...this.processor.handleAttributeExpressions(s,o.name,o.strings,this.options));i++}return sr&&(document.adoptNode(t),customElements.upgrade(t)),t}};var xn=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),ql=` ${Z} `,Xe=class{constructor(t,r,n,l){this.strings=t,this.values=r,this.type=n,this.processor=l}getHTML(){let t=this.strings.length-1,r="",n=!1;for(let l=0;l<t;l++){let i=this.strings[l],a=i.lastIndexOf("<!--");n=(a>-1||n)&&i.indexOf("-->",a+1)===-1;let o=Pt.exec(i);o===null?r+=i+(n?ql:cr):r+=i.substr(0,o.index)+o[1]+o[2]+Je+o[3]+Z}return r+=this.strings[t],r}getTemplateElement(){let t=document.createElement("template"),r=this.getHTML();return xn!==void 0&&(r=xn.createHTML(r)),t.innerHTML=r,t}};var Ct=e=>e===null||!(typeof e=="object"||typeof e=="function"),Rt=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]),ct=class{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let l=0;l<n.length-1;l++)this.parts[l]=this._createPart()}_createPart(){return new Qe(this)}_getValue(){let t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){let i=n[0].value;if(typeof i=="symbol")return String(i);if(typeof i=="string"||!Rt(i))return i}let l="";for(let i=0;i<r;i++){l+=t[i];let a=n[i];if(a!==void 0){let o=a.value;if(Ct(o)||!Rt(o))l+=typeof o=="string"?o:String(o);else for(let s of o)l+=typeof s=="string"?s:String(s)}}return l+=t[r],l}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}},Qe=class{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==L&&(!Ct(t)||t!==this.value)&&(this.value=t,Le(t)||(this.committer.dirty=!0))}commit(){for(;Le(this.value);){let t=this.value;this.value=L,t(this)}this.value!==L&&this.committer.commit()}},W=class{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(j()),this.endNode=t.appendChild(j())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=j()),t.__insert(this.endNode=j())}insertAfterPart(t){t.__insert(this.startNode=j()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;Le(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=L,r(this)}let t=this.__pendingValue;t!==L&&(Ct(t)?t!==this.value&&this.__commitText(t):t instanceof Xe?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):Rt(t)?this.__commitIterable(t):t===ye?(this.value=ye,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){let r=this.startNode.nextSibling;t=t==null?"":t;let n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){let r=this.options.templateFactory(t);if(this.value instanceof st&&this.value.template===r)this.value.update(t.values);else{let n=new st(r,t.processor,this.options),l=n._clone();n.update(t.values),this.__commitNode(l),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());let r=this.value,n=0,l;for(let i of t)l=r[n],l===void 0&&(l=new W(this.options),r.push(l),n===0?l.appendIntoPart(this):l.insertAfterPart(r[n-1])),l.setValue(i),l.commit(),n++;n<r.length&&(r.length=n,this.clear(l&&l.endNode))}clear(t=this.startNode){je(this.startNode.parentNode,t.nextSibling,this.endNode)}},Lt=class{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;Le(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=L,r(this)}if(this.__pendingValue===L)return;let t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=L}},jt=class extends ct{constructor(t,r,n){super(t,r,n);this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new ur(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}},ur=class extends Qe{},yn=!1;(()=>{try{let e={get capture(){return yn=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();var Ut=class{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=l=>this.handleEvent(l)}setValue(t){this.__pendingValue=t}commit(){for(;Le(this.__pendingValue);){let i=this.__pendingValue;this.__pendingValue=L,i(this)}if(this.__pendingValue===L)return;let t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),l=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),l&&(this.__options=Wl(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=L}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}},Wl=e=>e&&(yn?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);var fr=class{handleAttributeExpressions(t,r,n,l){let i=r[0];return i==="."?new jt(t,r.slice(1),n).parts:i==="@"?[new Ut(t,r.slice(1),l.eventContext)]:i==="?"?[new Lt(t,r.slice(1),n)]:new ct(t,r,n).parts}handleTextExpression(t){return new W(t)}},pr=new fr;function hr(e){let t=mr.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},mr.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;let n=e.strings.join(Z);return r=t.keyString.get(n),r===void 0&&(r=new Mt(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}var mr=new Map;var Tr=new WeakMap,Ue=(e,t,r)=>{let n=Tr.get(t);n===void 0&&(je(t,t.firstChild),Tr.set(t,n=new W(Object.assign({templateFactory:hr},r))),n.appendInto(t)),n.setValue(e),n.commit()};typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");var b=(e,...t)=>new Xe(e,t,"html",pr);var _n=(e,t)=>{let r=e.startNode.parentNode,n=t===void 0?e.endNode:t.startNode,l=r.insertBefore(j(),n);r.insertBefore(j(),n);let i=new W(e.options);return i.insertAfterNode(l),i},Ve=(e,t)=>(e.setValue(t),e.commit(),e),xr=(e,t,r)=>{let n=e.startNode.parentNode,l=r?r.startNode:e.endNode,i=t.endNode.nextSibling;i!==l&&It(n,t.startNode,i,l)},yr=e=>{je(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},bn=(e,t,r)=>{let n=new Map;for(let l=t;l<=r;l++)n.set(e[l],l);return n},Nn=new WeakMap,gn=new WeakMap,Ae=ot((e,t,r)=>{let n;return r===void 0?r=t:t!==void 0&&(n=t),l=>{if(!(l instanceof W))throw new Error("repeat can only be used in text bindings");let i=Nn.get(l)||[],a=gn.get(l)||[],o=[],s=[],c=[],u=0;for(let x of e)c[u]=n?n(x,u):u,s[u]=r(x,u),u++;let d,m,_=0,h=i.length-1,p=0,y=s.length-1;for(;_<=h&&p<=y;)if(i[_]===null)_++;else if(i[h]===null)h--;else if(a[_]===c[p])o[p]=Ve(i[_],s[p]),_++,p++;else if(a[h]===c[y])o[y]=Ve(i[h],s[y]),h--,y--;else if(a[_]===c[y])o[y]=Ve(i[_],s[y]),xr(l,i[_],o[y+1]),_++,y--;else if(a[h]===c[p])o[p]=Ve(i[h],s[p]),xr(l,i[h],i[_]),h--,p++;else if(d===void 0&&(d=bn(c,p,y),m=bn(a,_,h)),!d.has(a[_]))yr(i[_]),_++;else if(!d.has(a[h]))yr(i[h]),h--;else{let x=m.get(c[p]),f=x!==void 0?i[x]:null;if(f===null){let N=_n(l,i[_]);Ve(N,s[p]),o[p]=N}else o[p]=Ve(f,s[p]),xr(l,f,i[_]),i[x]=null;p++}for(;p<=y;){let x=_n(l,o[y+1]);Ve(x,s[p]),o[p++]=x}for(;_<=h;){let x=i[_++];x!==null&&yr(x)}Nn.set(l,o),gn.set(l,c)}});var _r=new WeakMap,Vt=ot(e=>t=>{let r=_r.get(t);if(e===void 0&&t instanceof Qe){if(r!==void 0||!_r.has(t)){let n=t.committer.name;t.committer.element.removeAttribute(n)}}else e!==r&&t.setValue(e);_r.set(t,e)});var Gt={};Mr(Gt,{ENTRY_MARKED:()=>Ze,MOVED:()=>ee,NEW:()=>$e,NEW_KEY:()=>Oe,NEW_ORDER:()=>Se,NEW_TYPE:()=>te,REMOVED:()=>De,buildBaseIndices:()=>Hl,diff:()=>Yl});var $e="new",De="removed",ee="moved",Se="order_changed",Oe="key_changed",te="type_changed",Ze="entry_changed",Hl=e=>{let t={};return R(e,(r,n)=>(C(r,"_meta",n),Object.assign(t,{[r.$a]:r}),delete r._visit,delete r._pruned,r)),e._indices=t,e},Yl=(e,t,r={})=>{let n=[],l=t._indices;R(e,(a,o)=>{Me(a,"_diff",{});let s=l[a.$a];if(s){let c=o.parent,u=s._meta.parent;u.$a!=c.$a&&Object.assign(a._diff||(a._diff={}),{[ee]:{oldParent:u,newParent:c,oldPath:s._meta.path,newPath:o.path}}),s._meta.index!=o.index&&Object.assign(a._diff||(a._diff={}),{[Se]:{oldOrder:s.index,newOrder:a.index}}),s.t!=a.t&&Object.assign(a._diff||(a._diff={}),{[te]:{oldType:s.t,newType:a.t,parent:c}}),s.$r!=a.$r&&Object.assign(a._diff||(a._diff={}),{[te]:{oldType:s.$r,newType:a.$r,parent:c}}),s.v!=a.v&&Object.assign(a._diff||(a._diff={}),{[te]:{oldType:s.v,newType:a.v,parent:c}}),s.key!=a.key&&Object.assign(a._diff||(a._diff={}),{[Oe]:{oldKey:s.key,newKey:a.key,parent:c}}),s.isEntry!=a.isEntry&&Object.assign(a._diff||(a._diff={}),{[Ze]:{oldIsEntry:s.isEntry,newIsEntry:a.isEntry,parent:c}}),Object.keys(a._diff).length!=0&&(Object.assign(a._diff,{meta:{level:o.level,path:o.path,pa:o.parent.$a}}),n.push(a)),C(s,"_visit",!0)}else a._diff={[$e]:{parent:o.parent},meta:{level:o.level,path:o.path,pa:o.parent.$a}},n.push(a);return a});let i=[];return R(t,(a,o)=>(Me(a,"_diff",{}),a._visit||(a._diff={[De]:{parent:o.parent},meta:{level:o.level,path:o.path,pa:o.parent.$a}},i.push(a),C(a,"_pruned",!0)),a)),n=n.concat(i),n};var wn=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),dt(e,"title",t),dt(e,"description",t),Jl(e,"rw",["rw","r","w"],t),br(e,"required",t),zl(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},zl=(e,t)=>{switch(e.t){case A:ei(e,t);break;case M:ti(e,t);break;case I:ri(e,t);break;case D:ni(e,t);break;case S:li(e,t);break;case ie:Xl(e,t);break;case ae:case se:case de:case oe:case ce:case ue:vn(e,t,{min:e.min,max:e.max});break;case fe:case pe:vn(e,t);break;case me:Ql(e,t);break;case Ne:Zl(e,t);break}},Xl=(e,t)=>{ii(e,"pattern",t),_e(e,"min",t,{min:0}),_e(e,"max",t,{min:0}),ut(e,t),dt(e,"default",t,Object.assign(En(e,["min","max","pattern"]),{ignoreEmpty:!0}))},Ql=(e,t)=>{br(e,"default",t)},vn=(e,t,r)=>{Ft(e,"min",t,r),Ft(e,"max",t,r),_e(e,"multipleOf",t),ut(e,t),Ft(e,"default",t,En(e,["min","max","multipleOf"]))},Zl=(e,t)=>{ai(e,"default",t)},ei=(e,t)=>{_e(e,"min",t,{min:0}),_e(e,"max",t,{min:0}),ut(e,t)},ti=(e,t)=>{_e(e,"min",t,{min:1}),_e(e,"max",t,{min:1}),ut(e,t),br(e,"unique",t)},ri=(e,t)=>{_e(e,"min",t,{min:1}),_e(e,"max",t,{min:1}),ut(e,t)},ni=(e,t)=>{},li=(e,t)=>{dt(e,"tagname",t,{min:1})},En=(e,t=[])=>{let r={};for(let n of t)(e.errors[n]||[]).length==0&&(typeof e.changes[n]=="number"?(e.changes[n]||e.changes[n]==0)&&(r[n]=e.changes[n]):r[n]=e.changes[n]);return r},dt=(e,t,r,n={})=>{if(!r.hasOwnProperty(t)||n.ignoreEmpty&&r[t]=="")return;let l=r[t],i=2**18;(o=>new Blob([o]).size)(l)>i?$(e,t,`string size limit is ${Math.ceil(i/1024)} KB`):n.max&&l.length>n.max?$(e,t,`must be less than or equal ${n.max} length`):n.min&&l.length<n.min?$(e,t,`must be grater than or equal ${n.min} length`):n.pattern?new RegExp(n.pattern).test(l)||$(e,t,`must matche pattern ${n.pattern}`):e.changes[t]=l},br=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let n=!!r[t];e.changes[t]=n},Ft=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return;let l=Nr(r[t]);!l&&l!=0?$(e,t,"must be number"):n.min&&l<n.min?$(e,t,`must be greater than or equal ${n.min}`):n.max&&l>n.max?$(e,t,`must be less than than or equal ${n.max}`):n.multipleOf&&l%n.multipleOf!=0?$(e,t,`must be multiple of ${n.multipleOf}`):e.changes[t]=l},_e=(e,t,r,n)=>{if(!r.hasOwnProperty(t))return;Ft(e,t,r,n);let l=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?$(e,t,"must be integer number"):l>Number.MAX_SAFE_INTEGER?$(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):l<Number.MIN_SAFE_INTEGER&&$(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},ii=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(dt(e,t,r),(e.errors[t]||[]).length==0))try{let n=r[t];if(n=="")return;e.changes[t]=new RegExp(n)}catch(n){$(e,t,"invalid regex")}},ut=(e,t)=>{if(t.min&&t.max){let r=Nr(t.min),n=Nr(t.max);(r||r==0)&&(n||n==0)&&r>n&&($(e,"min","min is greater than max"),$(e,"max","max is less than min"))}},ai=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?$(e,t,"must be null"):e.changes[t]=r[t])},Jl=(e,t,r,n)=>{!n.hasOwnProperty(t)||(r.includes(n[t])?e.changes[t]=n[t]:$(e,t,"value must be r, w, or rw"))},$=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},Nr=e=>oi(e,"number");var oi=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=i=>["checkbox","radio"].includes(i.type)?i.checked:i.value,r=this.querySelector("form").elements,n={};for(let i=0;i<r.length;i++){let a=t(r[i]);!(r[i]instanceof HTMLTextAreaElement)&&a==""||(n[r[i].name]=a)}let l={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:n};this.dispatchEvent(new CustomEvent("sch-update",{detail:l,bubbles:!0}))}}});customElements.define("autosize-text",class extends HTMLElement{static get observedAttributes(){return["data-value"]}attributeChangedCallback(e,t,r){this.autosize(r)}connectedCallback(){this.autosize.bind(this)()}autosize(e){for(let t of this.getElementsByTagName("textarea"))e||(e=t.value),e&&(t.value=e,qe({target:t}))}});var kn=e=>Ue(Ae([{$a:"nothing"}],t=>t.$a,t=>ye),document.querySelector(e)),gr=(e,t,r)=>{try{Ue(Ae([t],n=>n.$a,n=>b`
    <p class="meta-def">${si(r.key,n._meta.path)||"-"}</p>
    <p>${we(n.t)}</span>
    <form data-path="${n._meta.path}" data-file="${r.key}" class="fbox">
      ${ft(n,"title",{keyDisplay:"Title"})}
      ${ft(n,"description",{keyDisplay:"Description"})}
      ${ui(n)}
      ${ci(n,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:w(n,"rw")||"rw",keyDisplay:"Read / Write"})}
      ${di(n,"default",{keyDisplay:"Default",min:w(n,"min"),max:w(n,"max")})}
    </form>
  `),document.querySelector(e))}catch(n){console.log(n)}},si=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(n=>n!=""),t.splice(0,0,e);let r=b`<span style="color: var(--meta-def-color);">${t[0]} :: ${t[1]}</span>`;return t=t.slice(2).flatMap(n=>[b`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(n)]),t.splice(0,0,r),t},pt=(e,t,r,n={})=>{var l;return b`
  <label class="${n.readonly&&`box-label ${t} readonly`||`box-label ${t}`}">
    <p class="l">${n.keyDisplay||t} ${n.readonly&&b`<span>· readonly</span>`}</p>
    ${r}
    ${(l=Kt(e,t))==null?void 0:l.map(i=>b`<p class="err">${i}</p>`)}
  </label>
  `},ft=(e,t,r={})=>pt(e,t,b`
    <autosize-text data-value="${w(e,t)||""}">
      <textarea name="${mt(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${Kt(e,t)&&"invalid"}" @input="${qe}">${r.value||w(e,t)||""}</textarea>
    </autosize-text>
  `,r),Ge=(e,t,r={})=>pt(e,t,b`
    <input type="number" name="${mt(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${r.min}" max="${r.max}" value="${r.value||w(e,t)}" ?readonly="${r.readonly}" class="${Kt(e,t)&&"invalid"}">
  `,r),Ie=(e,t,r={})=>pt(e,t,b`
    <input type="number" name="${mt(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${r.value||w(e,t)}" ?readonly="${r.readonly}" class="${Kt(e,t)&&"invalid"}">
  `,r),wr=(e,t,r={})=>pt(e,t,b`
    <input type="checkbox" name="${mt(e,t)}" ?disabled="${r.readonly}" ?checked="${r.value||w(e,t)}">
  `,r),ci=(e,t,r={})=>pt(e,t,b`
    <select name="${mt(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([n,l])=>b`<option value="${n}" ?selected="${(r.selected||w(e,t))==n}">${l}</option>`)}
    </select>
  `,r),di=(e,t,r={})=>{switch(e.t){case me:return wr(e,t,r);case ae:case se:case de:case oe:case ce:case ue:case fe:case pe:return Ge(e,t,r);case ie:return ft(e,t,r);default:return""}},mt=(e,t)=>t,w=(e,t)=>(e.metadata||{})[t],ui=e=>{let t;switch(e.t){case A:let i=0;for(let a of e.fields)w(a,"required")&&i++;t=[Ie(e,"min",{keyDisplay:"Min Properties",value:i,readonly:!0}),Ie(e,"max",{keyDisplay:"Max Properties",value:e.fields.length,min:Math.max(w(e,"min")||0,0)})];break;case M:t=[Ie(e,"min",{keyDisplay:"Min Items",min:1,value:1,max:w(e,"max")}),Ie(e,"max",{keyDisplay:"Max Items",min:w(e,"min")}),wr(e,"unique",{keyDisplay:"Item uniqueness"})];break;case I:t=[Ie(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),Ie(e,"max",{keyDisplay:"Max Items",value:w(e,"max")||e.schs.length})];break;case S:t=[ft(e,"tagname",{keyDisplay:"Tag name",value:e.tagname})];break;case ie:t=[Ie(e,"min",{keyDisplay:"Min Length",min:0,max:w(e,"max")}),Ie(e,"max",{keyDisplay:"Max Length",min:Math.max(0,w(e,"min"))}),ft(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case ae:case se:case de:case oe:case ce:case ue:t=[Ge(e,"min",{keyDisplay:"Min",min:e.min,max:Math.min(w(e,"max"),e.max)}),Ge(e,"max",{keyDisplay:"Max",min:Math.max(w(e,"min"),e.min),max:e.max}),Ge(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:Math.min(w(e,"max"),e.max)})];break;case fe:case pe:t=[Ge(e,"min",{keyDisplay:"Min",max:w(e,"max")}),Ge(e,"max",{keyDisplay:"Max",min:w(e,"min")}),Ge(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:w(e,"max")})];break;case me:t=[];case Ne:t=[];case D:t=[];case Ke:t=[];case K:t=[];case he:t=[];default:t=[]}let r=e._meta.parent.t==A,n=e._meta.level>2,l=!e.isKeyPattern;return r&&n&&l&&t.push(wr(e,"required",{keyDisplay:"Required"})),t},Kt=(e,t)=>e.errors&&e.errors[t];var An=e=>Ue(b`<ul role="tree"></ul>`,document.querySelector(e)),vr=(e,t,r={})=>{var n;try{let l={level:1,tab:((n=r.ui)==null?void 0:n.tab)||0,models:t._models||{},taggedLevel:t.taggedLevel};l.rootLevel=l.level,Object.assign(l,r.ui),r.ui.lineClass&&Object.assign(l,{tab:r.ui.tab+2}),fi(e,{sch:t,ui:l,path:t.path||"",key:t.key,parent:t})}catch(l){console.log(l)}},fi=(e,t)=>Ue(b`
  <ul role="tree" aria-multiselectable="true" class="${`${t.ui.lineClass||""} text-sm`}" aria-labelledby="${Er(t.ui)+"_tree"}">
    ${ht(t)}
  </ul>
  `,document.querySelector(e)),kr=e=>Vt(Er(e)),Er=e=>e.taggedLevel[e.level],$n=e=>{let t;if(!e)return Vt(t);for(let r of Object.keys(e))switch(r){case $e:t="N";break;case De:t="R";break;case ee:t="M";break;case Se:t="O";break;case Oe:t="C";break;case te:t="C";break;case Ze:t="C";break}return Vt(t)},ht=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Object.assign(e.ui,{expanded:!0}),pi(e);case[M].includes(e.sch.t):return e.sch.sch.hasOwnProperty("fields")||e.sch.sch.hasOwnProperty("schs")?Object.assign(e.ui,{expanded:!0}):Object.assign(e.ui,{expanded:!1}),Dn(e);case(e.sch.hasOwnProperty("fields")||e.sch.hasOwnProperty("schs")):return Object.assign(e.ui,{expanded:!0}),Dn(e);default:return mi(e)}},pi=e=>b`
  <li id="${e.path}" data-tag="${kr(e.ui)}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" id="${Er(e.ui)}_tree">
      ${Ar(e.key)}
    </dfn>
    <ul data-group="${On(e.sch)}" role="group" tabindex="-1">
      ${Sn(e)}
    </ul>
  </li>`,Dn=e=>b`
  <li id="${e.path}" data-tag="${kr(e.ui)}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" data-diff="${$n(e.sch._diff)}" data-group-size="${hi(e.sch)}">
      ${In(Object.assign(e,{key:Ar(e.key)}))}
      ${Mn(e)}
    </dfn>
    <ul data-group="${On(e.sch)}" role="group">
      ${Sn(e)}
    </ul>
  </li>`,mi=e=>b`
  <li id="${e.path}" data-tag="${kr(e.ui)}" data-diff="${$n(e.sch._diff)}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${In(Object.assign(e,{key:Ar(e.key)}))}
    ${Mn(e)}
  </li>`,Sn=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return ye;switch(!0){case[A,S].includes(e.sch.t):return Ti(e);case[I,le,V].includes(e.sch.t):return xi(e);case[M].includes(e.sch.t):return yi(e);case[D].includes(e.sch.t):return _i(e);default:return ye}},Ti=e=>Ae(e.sch.fields,t=>t.$a,(t,r)=>ht({key:t.key,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[${t.key}]`})),xi=e=>Ae(e.sch.schs,t=>t.$a,(t,r)=>ht({key:r,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),yi=e=>Ae([e.sch.sch],t=>t.$a,(t,r)=>ht({key:r,sch:e.sch.sch,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),_i=e=>Ae(e.sch.schs,t=>t.$a,(t,r)=>ht({key:"",sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),re=(e,t=0)=>`padding-left: ${(e.ui.level-1)*2+e.ui.tab-1+t}ch`,Pn=(e,t,r)=>b`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  @input="${qe}"
  @focus="${en}"
  >${r}</textarea>`,In=e=>e.ui.level==e.ui.rootLevel+1?bi(e):Ni(e),bi=e=>b`
  <span class="def" style="${re(e)}">
    ${gi(e.sch,e.ui)}
  </span>
  <span class="k">${qt(e)}</span>
  <span class="s">=</span>
  `,Ni=e=>{var t;switch(!0){case e.parent.t==D:return b`
      <span class="s" style="${re(e,1)}">|</span>
      `;case(e.parent.t==le&&e.sch.$a==e.parent.schs[0].$a):return b`
      <span class="s" style="${re(e)}">k</span>
      `;case(e.parent.t==le&&e.sch.$a==e.parent.schs[1].$a):return b`
      <span class="s" style="${re(e)}">v</span>
      `;case(e.parent.t==V&&e.sch.$a==e.parent.schs[0].$a):return b`
      <span class="s" style="${re(e)}">extends</span>
      `;case(e.parent.t==V&&e.sch.$a==e.parent.schs[1].$a):return b`
      <span class="s" style="${re(e)}">record</span>
      `;case e.parent.t==M:return b`
      <span class="s" style="${re(e)}">└</span>
      `;case e.parent.t==A:return b`
      <span class="k" style="${re(e,1)}" data-required="${!!((t=e.sch.metadata)==null?void 0:t.required)}">
        ${qt(e)}
      </span>
      <span class="s">:</span>
    `;case e.parent.t==S:return b`
      <span class="s" style="${re(e,.5)}">|</span>
      <span class="k tag">
        ${qt(e)}
      </span>
      <span class="s">·</span>
    `;default:return b`
      <span class="k" style="${re(e,1)}">
        ${qt(e)}
      </span >
      <span class="s">:</span>
    `}},qt=e=>e.sch.uiMode=="editKey"?Pn("key-edit",e.ui.parentPath,e.key):b`${e.key}`,Mn=e=>e.ui.level==e.ui.rootLevel+1?wi(e):vi(e),wi=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):b`<span class="t">${Cn(e)}</span>`,vi=e=>b`<span class="t">${Cn(e)}</span>`,Cn=e=>e.sch.uiMode=="editType"?b`<combo-box id="type_search" list="typesearch">
      ${Pn("type-edit",e.ui.parentPath,$r(e.sch,e.ui))}
    </combo-box>`:b`${Rn(e.sch,e.ui)}`,$r=(e,t)=>{var r;switch(!0){case e.t==he:return JSON.stringify(e.v);case e.t==K:return(r=t.models[e.$r])==null?void 0:r.display;default:return we(e.t)}},Rn=(e,t)=>{let r,n=e.metadata;switch(!0){case(e.t==A&&e.fields.length==0):r="{ any }";break;case e.t==A:r="{ \xA0 }";break;case e.t==V:r="e { }";break;case e.t==M:r=b`[\xa0 ${Rn(e.sch,t)} \xa0]`;break;case e.t==I:r="( \xA0 )";break;case e.t==le:r="dict";break;case e.t==D:r="||";break;case e.t==S:r=`|| ${(n==null?void 0:n.tagname)||e.tagname}`;break;case e.t==ie:r="string";break;case e.t==ae:r="int_8";break;case e.t==se:r="int_16";break;case e.t==de:r="int_32";break;case e.t==oe:r="uint_8";break;case e.t==ce:r="uint_16";break;case e.t==ue:r="uint_32";break;case e.t==fe:r="float_32";break;case e.t==pe:r="float_64";break;case e.t==yt:r="timestamp";break;case e.t==me:r="bool";break;case e.t==Ne:r="null";break;case e.t==Ke:r="any";break;case(e.t==K&&!!t.models[e.$r]):Me(e,"_text",$r(e,t)),r=b`<span class="ref">${e._text}</span >`;break;case(e.t==K&&e.$r==null):r=b`<span class="ref notfound" title="Ref type">nothing</span>`;break;case e.t==K:r=b`<span class="ref notfound" title="Ref type">${`${e._text||e.$r} (#404)`}</span>`;break;case e.t==he:r=b`<span class="value" title="Value type">${$r(e,t)}</span>`;break;default:r="# UNDEFINED_TYPE #"}return t.tText&&(r=t.tText(e,t)||r),r},Ar=e=>e,On=e=>{switch(!0){case[A,S].includes(e.t):return"keyed";case[I,D,V].includes(e.t):return"indexed";default:return"none"}},hi=e=>{switch(!0){case[A,S].includes(e.t):return e.fields.length;case[I,D,V].includes(e.t):return e.schs.length;case[M].includes(e.t):return 1;default:return 0}},gi=(e,t)=>{let r;switch(!0){case e.t==A:r="record";break;case e.t==M:r="list";break;case e.t==I:r="tuple";break;case e.t==D:r="union";break;case e.t==S:r="tagged union";break;case e.t==V:r="extensible union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r};var{selectMultiNodeUpTo:Ln,selectMultiNodeDownTo:jn,selectMultiNodeUp:Un,selectMultiNodeDown:Vn,selectUpEnd:Gn,selectDownEnd:Fn,selectUp:Kn,selectDown:qn,selectRoot:Wn,selectLast:Bn}=Dt,Hn=({store:e,target:t,select:r,focus:n=!0})=>{ar({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",Ln],["shift-meta-ArrowDown",jn],["shift-ArrowUp",Un],["shift-ArrowDown",Vn],["meta-ArrowUp",Gn],["meta-ArrowDown",Fn],["ArrowUp",Kn],["ArrowDown",qn],["Home",Wn],["End",Bn],["shift-+",H],["Enter",Ye],["Delete",q],["meta-v",Y],["shift-alt-ArrowUp",z],["shift-alt-ArrowDown",J],["alt-ArrowUp",X],["alt-ArrowDown",Q]],textAreaKeyDownCmd:[["Enter",ke],["Escape",it]],view:l=>vr(t,l||e,{ui:{depthLimit:2,tab:0,modelTypeText:(i,a)=>"file",typeText:(i,a)=>{if(i.t==T.RECORD)return"record";if(i.t==T.VALUE)return"value";if(i.t==T.TUPLE)return"tuple";if(i.t==T.UNION)return"union"},viewTypeTop:i=>""}}),opts:{focus:n,selectId:r}})},Wt=({store:e,target:t,select:r,focus:n,nothing:l=!1})=>{ar({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",Ln],["shift-meta-ArrowDown",jn],["shift-ArrowUp",Un],["shift-ArrowDown",Vn],["meta-ArrowUp",Gn],["meta-ArrowDown",Fn],["ArrowUp",Kn],["ArrowDown",qn],["Home",Wn],["End",Bn],["shift-+",H],["Enter",Ye],["shift-Enter",ze],["Delete",q],["m",at],["meta-x",Ce],["meta-c",Re],["meta-v",Y],["shift-alt-ArrowUp",z],["shift-alt-ArrowDown",J],["alt-ArrowUp",X],["alt-ArrowDown",Q],["ArrowRight",St],["ArrowLeft",Ot],["Escape",({tree:i})=>Ee(i)]],textAreaKeyDownCmd:[["Enter",ke],["Escape",it]],view:i=>vr(t,i||e,{ui:{lineClass:"setnu",tab:3,modelTypeText:(a,o)=>a.isEntry?"entrypoint":"type"}}),opts:{focus:n,selectId:r}})},Bt=({store:e,target:t,treeTarget:r})=>{let n=document.querySelector(t),l=document.querySelector(`${r} [role='tree']`);!n||!l||(C(e,"renderSchMeta",function(i){Ei({tree:l,store:i||this,metaForm:t})}),e.renderSchMeta())},Ei=({tree:e,store:t,metaForm:r})=>{let n=e.querySelectorAll("[role='treeitem'][aria-selected='true']");if(n.length==1){let l=G(t,n[0].id);l&&gr(r,l,t)}},Yn=e=>An(e),zn=e=>kn(e);var B="file",et="project",Jn=(e,t)=>(Object.assign(t,e),t.fields=[],v(()=>t)),Xn=(e,t)=>R(e,(r,n)=>(r.metadata=t[r.$a],r)),Zn=(e,t,r)=>(t||(t=Qn()),Object.assign(t,e),v(()=>t)),tl=()=>el({taggedLevel:{1:et,2:B,3:P},allowedSchs:[Qn],put:{pos:"prepend",onlyDst:{[B]:!0}}}),Qn=()=>el({taggedLevel:{1:B,2:P},addDefault:Te,entryable:[P],put:{pos:"prepend"},rulesTable:Dr}),el=(e={})=>{let t=v(Te);return t.allowedSchs=(e.allowedSchs||Sr).map(r=>r()),t.taggedLevel=e.taggedLevel,e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.t==e.addDefault().t)&&e.addDefault()),e.rulesTable&&(t.rulesTable=e.rulesTable),t},Tt=(e,t)=>G(e,`[${t}]`),Fe=e=>{let t={};return Or(e,(r,n)=>{t[r.$a]={display:[n.file.key,r.key].join(" :: "),file:n.file.key,fmodel:r.key,type:r.t}}),t},Or=(e,t)=>{for(let r of e.fields)for(let n=0;n<r.fields.length;n++)r.fields[n]=t(r.fields[n],{path:`[${r.key}][${r.fields[n].key}]`,file:r})||r.fields[n]},Sr=[_t,Te,zr,Jr,Xr,ge,Lr,Hr,()=>bt('"json string"'),jr,Ur,Vr,Gr,Fr,Kr,qr,Wr,Br,Qr,Zr,Yr],ki={selector:[["t",le]],rules:{self:{exceptActions:[H,Y]},children:{exceptActions:[Ce,Re,z,J,q,X,Q]},nthChild:[{allowedSchs:[_t()]}]}},Ai={selector:[["t",V]],rules:{self:{exceptActions:[H,Y]},children:{exceptActions:[Ce,Re,z,J,q,X,Q]},nthChild:[{allowedSchs:[tt(null)]},{allowedSchs:[Te()],exceptActions:[ze,ke]}]}},$i={selector:[["t",S]],rules:{children:{allowedSchs:[Te()]}}},Dr=[ki,$i,Ai];var{selectMultiNodeUpTo:rl,selectMultiNodeDownTo:nl,selectMultiNodeUp:ll,selectMultiNodeDown:il,selectUpEnd:Di,selectDownEnd:Si,selectUp:Oi,selectDown:Ii,selectRoot:al,selectLast:Mi}=Dt,ol=(e,t,r,n)=>{let l=t.closest("[data-tag='file']"),i=l==null?void 0:l.key;t.closest("[id='project']")?Pi(e,i,r,n):t.closest("[id='fmodel']")&&Ci(e,i,t,r,n)},Pi=(e,t,r,n)=>{switch(r){case Ye:case X:case Q:case rl:case nl:case ll:case il:case al:break;case H:case q:case z:case J:case ke:case lt:case Di:case Si:case Oi:case Ii:case Mi:Ir(e,t);break;case Y:e.render();break}},Ci=(e,t,r,n,l)=>{switch(n){case al:case rl:case nl:case ll:case il:case X:case Q:case St:case Ot:case it:case Ye:case ze:case Ce:case Re:return}let i=Tt(e,t);switch(r.dataset.tag){case B:switch(n){case H:case Y:i._models=Fe(e),e.render();break}break;case P:switch(n){case at:sl(r,e,t),i.render();break;case q:i._models=Fe(e),e.render();break;case z:case J:sl(r,e,t),i._models=Fe(e),i.render(),e.render();break}break}i.renderSchMeta()},Ir=(e,t,r=null,n=!1)=>{let l=Tt(e,t);if(l){if(l._models=Fe(e),Wt({store:l,target:"[id='fmodel']",select:r,focus:n}),Bt({store:l,target:"[id='fsch']",treeTarget:"[id='fmodel']"}),!window._treeClipboard){let i=document.querySelector("[id='fmodel'] [role='tree']");i._aria.clearClipboard(i)}}else if(e.fields.length==0){let i=document.querySelector("[id='fmodel'] [role='tree']");Yn("[id='fmodel']"),zn("[id='fsch']")}},sl=(e,t,r)=>{e.dataset.tag==P&&Or(t,(n,l)=>(l.path!=`[${r}]${e.id}`&&n.isEntry&&delete n.isEntry,n))},cl={update:({store:e,detail:t})=>{let{path:r,attrs:n}=t,l=xe(e,r,(i,a)=>wn(i,n));return l&&(e.render&&e.render(e),e.renderSchMeta&&e.renderSchMeta(e)),l}},dl=e=>[H,q,ke,Y,z,J,X,Q,q,at].map(t=>t.name).includes(e);var{assign:be}=Object,ul=(e,t)=>{let r=x=>{for(let f of e.fields)for(let N of f.fields)if(x==N.key)return{file:f,fmodelDst:N}},n=x=>We(e,(f,N)=>{if(e.taggedLevel[N.level]==P&&N.path!="")return x.startsWith(N.path)},(f,N)=>(C(f,"_meta",N),f)),l=({$a:x,key:f,index:N,t:E})=>({$a:x,key:f,index:N,t:E}),i=x=>l(x),a=x=>x,o=e._diffToRemote;if(!o)return;let s={};s.files=[],s.fmodels=[],s.subfmodels=[];for(let x of o){let f=e.taggedLevel[x._diff.meta.level];f==et?s.project=x:f==B?s.files.push(x):f==P?s.fmodels.push(x):s.subfmodels.push(x)}let c={},u={},d={},m={};u.files||(u.files={}),u.fmodels||(u.fmodels={}),d.files||(d.files={}),d.fmodels||(d.fmodels={}),c.files||(c.files={}),c.fmodels||(c.fmodels={}),m.files||(m.files={}),m.fmodels||(m.fmodels={}),s.project&&(c.project=i(s.project));for(let x=0;x<s.files.length;x++){let f=s.files[x],N=l(f),E=f._diff.meta.path;if(f._diff[$e]){u.files[E]=N;for(let U of f.fields)u.fmodels[`[${f.key}][${U.key}]`]=be(a(U),{pa:N.$a})}if(f._diff[De]&&(d.files[E]={$a:N.$a}),f._diff[Oe]&&(c.files[E]=N),f._diff[Se])for(let U of e.fields)m.files[`[${U.key}]`]=l(U);f._diff[ee]&&console.log("project does not permit as parent for moving items"),f._diff[te]&&console.log("file type is always record, cannot be changed")}for(let x=0;x<s.fmodels.length;x++){let f=s.fmodels[x],N=a(f),E=f._diff.meta.path,U=f._diff.meta.pa;if(f._diff[$e]&&(u.fmodels[E]=be(N,{pa:U})),f._diff[De]&&(d.fmodels[E]={$a:N.$a,pa:U}),(f._diff[Oe]||f._diff[te]||f._diff[Ze])&&(c.fmodels[E]=be(N,{pa:U})),f._diff[Se]){let O=r(f.key);for(let ne of O.file.fields)m.fmodels[`[${O.file.key}][${ne.key}]`]={$a:ne.$a,key:ne.key,index:ne.index,pa:O.file.$a}}if(f._diff[ee]){let{oldParent:O,newParent:ne,oldPath:fl,newPath:pl}=f._diff[ee];switch(e.taggedLevel[O.level]){case et:console.log("fmodel was not possible to be a file");break;case B:var _=e.fields.find(ml=>ml.key==O.key),h=l(_);c.files[O.path]=h,d.fmodels[fl]={$a:f.$a,pa:h.$a};break;case P:var p=r(O.key),h=p.file;c.fmodels[O.path]=be(a(p.fmodelDst),{pa:h.$a});break;default:var y=n(O.path),p=r(y.key),h=p.file;c.fmodels[y._meta.path]=be(a(y),{pa:h.$a})}switch(e.taggedLevel[ne.level]){case B:var _=e.fields.find(Ht=>Ht.key==ne.key),h=l(_);u.fmodels[pl]=be(N,{pa:h.$a});break;default:console.log("fmodel parent can only be file tag")}}}for(let x=0;x<s.subfmodels.length;x++){let f=s.subfmodels[x],N=f._diff.meta.path;if(f._diff[$e]||f._diff[De]||f._diff[Se]||f._diff[Oe]||f._diff[te]){let E=n(N),O=r(E.key).file;c.fmodels[E._meta.path]=be(a(E),{pa:O.$a})}if(f._diff[ee]){let{oldParent:E,newParent:U,oldPath:O,newPath:ne}=f._diff[ee];switch(e.taggedLevel[E.level]){case et:console.log("subfmodel was not possible to be a file");break;case B:var _=e.fields.find(Ht=>Ht.key==E.key),h=l(_);d.fmodels[O]={$a:f.$a,pa:h.$a};break;case P:default:var y=n(E.path),p=r(y.key),h=l(p.file);c.fmodels[y._meta.path]=be(a(y),{pa:h.$a})}switch(e.taggedLevel[U.level]){case et:console.log("subfmodel parent can only be fmodel or subfmodel");break;case B:console.log("subfmodel parent can only be fmodel or subfmodel");break;case P:default:var y=n(ne),p=r(y.key),h=p.file;c.fmodels[y._meta.path]=be(a(y),{pa:h.$a})}}}return console.log({changed:c,added:u,removed:d,reorder:m}),t({changed:c,added:u,removed:d,reorder:m})};var Ri={createProjectStore:tl,getFileStore:Tt,anchorsModels:Fe,projectToStore:Jn,fileToStore:Zn,controller:ol,mergeSchMetas:Xn,changeFile:Ir,taggedDiff:ul,isDiffableCmd:dl,SchMeta:cl,allSchs:Sr,rulesTable:Dr};export{Gt as Diff,Wt as FmodelTree,Ri as Project,Hn as ProjectTree,Bt as SchMetaForm,we as tstr};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
