var ol=Object.defineProperty;var kr=(e,t)=>{for(var r in t)ol(e,r,{get:t[r],enumerable:!0})};var ht,sl=new Uint8Array(16);function Wt(){if(!ht&&(ht=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!ht))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ht(sl)}var $r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function dl(e){return typeof e=="string"&&$r.test(e)}var Dr=dl;var A=[];for(var Bt=0;Bt<256;++Bt)A.push((Bt+256).toString(16).substr(1));function cl(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(A[e[t+0]]+A[e[t+1]]+A[e[t+2]]+A[e[t+3]]+"-"+A[e[t+4]]+A[e[t+5]]+"-"+A[e[t+6]]+A[e[t+7]]+"-"+A[e[t+8]]+A[e[t+9]]+"-"+A[e[t+10]]+A[e[t+11]]+A[e[t+12]]+A[e[t+13]]+A[e[t+14]]+A[e[t+15]]).toLowerCase();if(!Dr(r))throw TypeError("Stringified UUID is invalid");return r}var Sr=cl;function ul(e,t,r){e=e||{};var n=e.random||(e.rng||Wt)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var l=0;l<16;++l)t[r+l]=n[l];return t}return Sr(n)}var Ht=ul;var k=10,L=11,ee=12,M=13,O=14,D=15,S=16,te=17,re=18,ne=19,le=20,ie=21,ae=22,oe=23;var se=24,de=25;var ce=26,ye=27,j=28,B=29,Oe=30,Tt=31,U="fmodel",_e=()=>({t:Oe}),xt=()=>({t:te}),Or=()=>({t:ce}),Ir=()=>({t:re,min:-128,max:127}),Mr=()=>({t:le,min:-32768,max:32767}),Cr=()=>({t:ae,min:-2147483648,max:2147483647}),Rr=()=>({t:ne,min:0,max:255}),Pr=()=>({t:ie,min:0,max:65535}),Lr=()=>({t:oe,min:0,max:4294967295}),jr=()=>({t:se}),Ur=()=>({t:de}),Vr=()=>({t:Tt}),Gr=()=>({t:ye}),ue=()=>({t:k,fields:[]}),Fr=()=>({t:L,schs:[E(()=>Qe(null)),E(ue)]}),Kr=()=>({t:M,sch:E(_e)}),qr=()=>({t:O,schs:[E(_e)]}),Wr=()=>({t:D,schs:[E(_e)]}),Br=()=>({t:S,fields:[{...E(ue),key:"tag_a"}],tagname:"tag",allowedSchs:[ue()],keyPrefix:"tag"}),Hr=()=>({t:ee,schs:[E(xt),E(_e)]}),Qe=e=>({t:j,$r:e}),yt=e=>{try{return e=JSON.parse(e),e==null||["string","number","boolean"].includes(typeof e)?{t:B,v:e}:!1}catch(t){return!1}},E=(e,t={})=>{let r=e();return r.$a||(r.$a=Ht()),t.force&&(r.$a=Ht()),r},Ne=e=>pl[e],pl={[k]:"record",[L]:"e_record",[ee]:"dict",[M]:"list",[O]:"tuple",[D]:"union",[S]:"tagged_union",[te]:"string",[re]:"int8",[ne]:"uint8",[le]:"int16",[ie]:"uint16",[ae]:"int32",[oe]:"uint32",[se]:"float32",[de]:"float64",[ce]:"boolean",[ye]:"nil",[j]:"ref",[B]:"value",[Oe]:"any",[Tt]:"timestamp"};var Ve=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},Yr=e=>{Ve(e),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},{defineProperty:fl}=Object,zr=fl,I=(e,t,r)=>zr(e,t,{value:r,configurable:!0}),Ie=(e,t,r)=>zr(e,t,{value:r,configurable:!0,writable:!0}),Yt=function(e,t,r){var n=null;return function(){n&&clearTimeout(n);var l=arguments;n=setTimeout(function(){n=null,e.apply(r,l)},t)}};var _t=(e,t)=>{let r=JSON.parse(JSON.stringify(e));return C(r,(n,l)=>E(()=>n,{force:!0})),r},C=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,delete e._pruned,e=t(e,r),e._halt||e._pruned)return e;let n=({t:l,$a:a,key:o},{path:s,level:d})=>({level:d,t:l,$a:a,key:o,path:s});switch(!0){case e.hasOwnProperty("fields"):for(let o=e.fields.length-1;o>=0;o--){let s=e.fields[o],d=s.key,c={path:`${r.path}[${d}]`,level:r.level+1,index:o,parent:n(e,r)};if(s=C(s,t,c),s.index=o,e.fields[o]=s,s._halt)return Object.assign(e,{_halt:!0})}break;case e.hasOwnProperty("schs"):for(let o=0;o<e.schs.length;o++){let s=e.schs[o],d={path:`${r.path}[][${o}]`,level:r.level+1,index:o,parent:n(e,r)};if(s=C(s,t,d),s.index=o,e.schs[o]=s,s._halt)return Object.assign(e,{_halt:!0})}break;case e.hasOwnProperty("sch"):let l={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:n(e,r)},a=C(e.sch,t,l);if(a.index=0,e.sch=a,a._halt)return Object.assign(e,{_halt:!0});break;default:}return e},ml=(e,t,r)=>{let n={original:{},popped:[]},l=r.sort((a,o)=>o-a);return C(e,(a,o)=>{if(o.path!=t)return a;switch(!0){case a.hasOwnProperty("fields"):for(let s of l)n.popped.unshift({k:a.fields[s].key,sch:a.fields.splice(s,1)[0],index:s});break;case a.hasOwnProperty("sch"):break;case a.hasOwnProperty("schs"):for(let s of l)n.popped.unshift({k:s,sch:a.schs.splice(s,1)[0],index:s});a.schs.length==0&&a.schs.splice(0,0,E(_e));break;default:}return a}),n},hl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),Nt=(e,t,r)=>{let n={original:{},inserted:[]},l=(a,o)=>(a=Math.max(a,0),a=Math.min(a,o.length),a);return C(e,(a,o)=>{var s;if(o.path!=t)return a;{typeof r=="function"&&(r=r.call(a));let d=r.sort((c,p)=>c.index-p.index);switch(!0){case a.hasOwnProperty("fields"):let c=(s=e.taggedLevel)==null?void 0:s[o.level+1];for(let{k:p,sch:u,index:y}of d){p=p==0?"0":p,p=p||`${c||a.keyPrefix||"key"}_${Math.floor(Date.now()/100)}`,p=`${p}`;let x={};for(let _=0;_<a.fields.length;_++)x[a.fields[_].key]=!0;for(;x[p];)p=`${p} \u2013`;y=l(y,a.fields),a.fields.splice(y,0,E(u)),a.fields[y].key=p,n.inserted.push({k:a.fields[y].key,sch:a.fields[y],index:y})}break;case a.hasOwnProperty("sch"):break;case a.hasOwnProperty("schs"):for(let{k:p,sch:u,index:y}of d)y=l(y,a.schs),a.schs.splice(y,0,E(u)),n.inserted.push({k:p,sch:a.schs[y],index:y});break;default:}return a}}),n},gt=(e,{dstPath:t,startIndex:r=0},n)=>{let l=(d,c,p)=>pe(d,c,(u,y)=>(I(u,"_pinId",p),u)),a=Symbol(t);l(e,t,a);let o=bt(e,n,{dstPath:t});return zt(e,{dstPin:a,startIndex:r},o)},bt=(e,t,r={})=>{let n={},l=hl(Object.keys(t));for(let a of l){let o=t[a],s=p=>{var u;return(u=o.find(y=>y.index==p))==null?void 0:u.newK};if(r.dstPath&&o.filter(u=>r.dstPath.startsWith(u.id)).length!=0)continue;let c=ml(e,a,o.map(p=>p.index)).popped.map(({k:p,sch:u,index:y})=>({k:s(y)||p,sch:()=>u}));n[a]=c}return n},zt=(e,{dstPin:t,dstPath:r,startIndex:n=0},l)=>{let a=(c,p)=>Ge(c,(u,y)=>u._pinId==p,(u,y)=>(I(u,"_pinned",y),u));n=Math.max(n,0);let o={},s=Object.values(l).flatMap(c=>c).map((c,p)=>({...c,index:n+p}));if(t){let c=a(e,t);c&&(r=c._pinned.path)}let d=Nt(e,r,s);return d.inserted.length!=0&&(o[r]=d.inserted),o},Qt=(e,{dstPath:t,startIndex:r=0},n)=>{let l=Jt(e,n,{dstPath:t,startIndex:r});return Xt(e,{dstPath:t},l)},Jt=(e,t,r={})=>Object.values(t).reduce((n,l)=>{let a=l.map(s=>s.id),o=[];Ge(e,(s,d)=>(a.includes(d.path)&&(I(s,"_meta",d),o.unshift(s)),o.length==a.length),(s,d)=>s);for(let s of l){if(r.dstPath&&r.dstPath.startsWith(s.id))continue;let d=o.find(c=>c._meta.path==s.id);d&&n.unshift({k:s.key,sch:()=>_t(d,e),index:r.startIndex+n.length,id:s.id})}return n},[]),Xt=(e,{dstPath:t},r)=>{let n={},l=Nt(e,t,r);return l.inserted.length!=0&&(n[t]=l.inserted),n},wt=(e,t,r)=>pe(e,t,(n,l)=>{let a=E(r),{title:o,description:s,rw:d,required:c,$a:p,key:u}=n,y=a.t==j&&a.$r!=n.$r,x=a.t==B&&a.v!=n.v,_=a.t!=n.t;return a.$r==p?n:_||x||y?Object.assign(a,{metadata:{title:o,description:s,rw:d,required:c},$a:p,key:u}):n}),V=(e,t)=>Ge(e,(r,n)=>n.path==t,(r,n)=>(I(r,"_meta",n),r)),pe=(e,t,r)=>Ge(e,(n,l)=>l.path==t,r),Ge=(e,t,r)=>{let n;return C(e,(l,a)=>t(l,a)?(n=r(l,a),n._halt=!0,n):l),n&&delete n._halt,n};var Zt={};kr(Zt,{clearClipboard:()=>fe,collapseSelected:()=>rr,createWalker:()=>Jr,ensureNodeConnected:()=>Et,expandSelected:()=>tr,findUnselectedNode:()=>et,reselectNodes:()=>Ke,selectMultiNode:()=>Me,selectMultiNodeTo:()=>Ze,selectNode:()=>w,selectedGroupedByParent:()=>be,toggleSelectNode:()=>Zr});var G="aria-selected",vt="aria-expanded",Jr=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{var r;if(t.hasAttribute(G)){let n=(r=t.parentElement.closest(`[${vt}]`))==null?void 0:r.getAttribute(vt);return n&&n=="false"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}else return NodeFilter.FILTER_SKIP}},!1),e),w=(e,t,r={focus:!0})=>{t=Et(e,t),!!t&&(e._walker.currentNode=t,Xr(e),Fe(t),r.focus&&t.focus())},Zr=(e,t)=>{e&&(e.tabIndex=-1),Qr(t)},Me=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(G)=="true"?Qr(e):Fe(t),r.focus&&t.focus())},Xr=(e,t={sync:!0})=>{for(let r of e.querySelectorAll(`[${G}='true']`))t.sync?At(r):Yt(At,0)(r);for(let r of e.querySelectorAll(".item-pasted"))r.classList.remove("item-pasted","up","down")},er=(e,t,r,n={})=>{var o,s,d;let l=e._walker.currentNode,a=t();if(!!a){if(l==r)return(o=n.target)==null?void 0:o.call(null,r);(s=n.pre)==null||s.call(null,l,a),er(e,t,r,n),(d=n.post)==null||d.call(null,l,a)}},Ze=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,er(e,()=>e._walker.nextSibling(),r,{pre:(n,l)=>{Me(n,l,{focus:!1})}}),e._walker.currentNode=r,Fe(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,Fe(r.parentNode.closest(`[${G}]`)),er(e,()=>e._walker.previousSibling(),r,{pre:(n,l)=>{Me(n,l,{focus:!1})}}),At(r.parentNode.closest(`[${G}]`)),e._walker.currentNode=r,Fe(r),r.focus();break}},Fe=e=>{!e||(e.setAttribute(G,!0),e.tabIndex=0)},At=e=>{!e||(e.setAttribute(G,!1),e.tabIndex=-1)},Qr=e=>(e==null?void 0:e.getAttribute(G))=="true"?At(e):Fe(e),et=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(G))=="true");return t},Tl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),Ke=(e,t,r={})=>{Xr(e,r);for(let n of Tl(Object.keys(t))){let l=t[n];if(n==""?n=e.querySelector("[id][aria-level]"):n=e.querySelector(`[id='${CSS.escape(n)}'][aria-level]`),!n)continue;let a=parseInt(n.getAttribute("aria-level")),o=n.querySelectorAll(`[aria-level='${a+1}'][role='treeitem']`);for(let s=0;s<l.length;s++){let d=l[s].index,c=o[d];if(!c)return;c.classList.add("item-pasted"),r.direction&&c.classList.add(r.direction),Me(null,c,{focus:!1}),e._walker.currentNode=c}Yt(()=>e._walker.currentNode.focus())()}},be=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${G}='true']`}`),n={};for(let l=0;l<r.length;l++){let a=r[l],o=a.parentNode.closest("[role='treeitem']");if(!o)break;a.index=a.index||parseInt(a.getAttribute("aria-posinset"))-1,n[o.id]=n[o.id]||[],n[o.id].push(a)}return n},tr=e=>{let t=e.querySelectorAll(`[${G}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(vt,"true")},rr=e=>{let t=e.querySelectorAll(`[${G}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(vt,"false")},fe=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null},Et=(e,t)=>t&&!t.isConnected?t.id?e.querySelector(`[id='${CSS.escape(t.id)}']`):e.querySelector("[id]"):t;var xl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();Ze(e,t,r)},yl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();Ze(e,t,r)},_l=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();Me(t,r)},Nl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();Me(t,r)},bl=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();w(e,t)},gl=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();w(e,t)},wl=({tree:e})=>w(e,e._walker.previousNode()),vl=({tree:e})=>w(e,e._walker.nextNode()),El=({tree:e})=>{for(;e._walker.parentNode(););w(e,e._walker.nextNode()),w(e,e._walker.parentNode())},Al=({tree:e})=>{for(;e._walker.nextNode(););w(e,e._walker.currentNode)},qe=({tree:e},t={})=>w(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),nr=({tree:e},t={})=>w(e,e._walker.currentNode),kt={selectMultiNodeUpTo:xl,selectMultiNodeDownTo:yl,selectMultiNodeUp:_l,selectMultiNodeDown:Nl,selectUpEnd:bl,selectDownEnd:gl,selectUp:wl,selectDown:vl,selectRoot:El,selectLast:Al},me=({tree:e,store:t})=>{var o,s;let r=e._walker.currentNode,n=V(t,r.id),l,a=((o=en(e,t))==null?void 0:o[0])||n._addSchDefault||n.allowedSchs&&n.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!a||(((s=t.put)==null?void 0:s.pos)=="prepend"?l=0:l=Number.MAX_SAFE_INTEGER,Nt(t,r.id,[{k:null,sch:()=>_t(a),index:l}]),e._render(t),w(e,r))},tt=({tree:e,store:t})=>{var l,a;let r=e._walker.currentNode;if(((a=(l=r.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:a.group)=="keyed"){let o=r.querySelector(".k").getBoundingClientRect();tn({tree:e,store:t,editMode:"editKey",textRect:o})}},We=({tree:e,store:t})=>{let r=e._walker.currentNode.querySelector(".t").getBoundingClientRect();tn({tree:e,store:t,editMode:"editType",textRect:r})},tn=({tree:e,store:t,editMode:r,textRect:n})=>{let l=e._walker.currentNode,a=pe(t,l.id,(d,c)=>Ie(d,"uiMode",r));e._render(t);let o=e.querySelector("textarea");if(!o)return;let s=window.getComputedStyle(o);o.style.minWidth=n.width+"px",o.style.minHeight=n.height+"px",o._treeItem=l,o.onblur=d=>d.relatedTarget&&d.relatedTarget.id!=o._treeItem.id&&kl(e,t,o),o.focus()},kl=(e,t,r)=>{let n=pe(t,r._treeItem.id,(l,a)=>Object.assign(l,{uiMode:"cancelled-edit"}));e._render(t),n&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),w(e,e._walker.currentNode))},ge=({tree:e,store:t},r)=>{r.id=="key-edit"?rn(e,t,r,Dl):r.id=="type-edit"&&rn(e,t,r,$l)},rn=(e,t,r,n)=>{let l=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),w(e,r._treeItem,{focus:!1});let a=n(e,t,r)||l.id;pe(t,a,(o,s)=>Object.assign(o,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(a)}']`),w(e,e._walker.currentNode)},$l=(e,t,r)=>{let l=(en(e,t)||t.allowedSchs).find(s=>Ne(s.t)==r.value),a=t._models[r.value]&&r.value||Object.keys(t._models).find(s=>t._models[s].display==r.value),o=yt(r.value);return l?wt(t,r._treeItem.id,()=>_t(l)):a?wt(t,r._treeItem.id,()=>Qe(a)):o&&wt(t,r._treeItem.id,()=>o),e._walker.currentNode.id},Dl=(e,t,r)=>{let n=be(e),l=r.dataset.parentPath;n[r.dataset.parentPath]=n[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>({id:c.id,newK:r.value,index:c.index}));let a=n[r.dataset.parentPath][0].index,s=gt(t,{dstPath:l,startIndex:a},n)[l][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${s}]`},F=({tree:e,store:t})=>{let r=et(()=>e._walker.nextSibling())||et(()=>e._walker.previousSibling())||et(()=>e._walker.parentNode());bt(t,be(e)),e._render(t),w(e,r)},Be=({tree:e,store:t})=>{var n;let r=e._walker.currentNode;!r||((n=t.entryable)==null?void 0:n.includes(r.dataset.tag))&&(pe(t,r.id,(l,a)=>Object.assign(l,{isEntry:!0})),e._render(t),w(e,r))};var rt=({store:e,tree:t})=>{fe(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-cutting");let r=be(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",srcStoreKey:e.key,ops:n=>bt(e,r,{dstPath:n}),selected:r}},nt=({store:e,tree:t})=>{if(document.getSelection().toString().length!=0)return;fe(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-copying");let r=be(t,{ops:".item-copying"});window._treeClipboard={type:"copy",srcStoreKey:e.key,ops:n=>Jt(e,r,{dstPath:n,startIndex:0}),selected:r}},K=({tree:e,store:t,srcStore:r})=>{var l;let n=V(t,e._walker.currentNode.id);if(!![k,D,O].includes(n.t)&&!(((l=t.put)==null?void 0:l.onlyDst)&&!t.put.onlyDst[t.taggedLevel[n._meta.level]])&&window._treeClipboard){let a=e._walker.currentNode.id,{type:o,srcStoreKey:s,ops:d,selected:c}=window._treeClipboard,p=c,u={};if(t.key==s)switch(o){case"copy":u=Qt(t,{dstPath:a},p);break;case"cut":u=gt(t,{dstPath:a},p);break}else switch(o){case"copy":let x=d("");u=Xt(t,{dstPath:a},x);break;case"cut":let _=d("");u=zt(t,{dstPath:a},_);break}let y=(x,_)=>{let h={};for(let m of Object.keys(_))m==n._meta.path?h[""]=_[m]:h[m]=_[m];x._render(n),fe(x),Ke(x,h)};Object.keys(u).length!=0&&(n._tree?y(n._tree,u):(e._render(t),fe(e),Ke(e,u)))}},H=({tree:e,store:t})=>nn({tree:e,store:t,direction:"up"},r=>r[0].index),Y=({tree:e,store:t})=>nn({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),nn=({tree:e,store:t,direction:r},n)=>{let l=be(e),a={};for(let o of Object.keys(l))a=Qt(t,{dstPath:o,startIndex:n(l[o])},{[o]:l[o]});Object.keys(a).length!=0&&(e._render(t),Ke(e,a,{direction:r,sync:!1}))},we=({tree:e,store:t})=>ln({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),ve=({tree:e,store:t})=>ln({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),ln=({tree:e,store:t,startIndex:r,direction:n})=>{let l=be(e),a={};for(let o of Object.keys(l)){let s=l[o].sort((d,c)=>d.index-c.index);a=gt(t,{dstPath:o,startIndex:r(s[0].index)},l)}Object.keys(a).length!=0&&(e._render(t),Ke(e,a,{direction:n}))},en=(e,t)=>{var s,d,c;let r=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!r)return;let n=V(t,r.id),l=e._walker.currentNode,a=V(t,l.id),o=(p,u)=>{if(!p)return!1;let y=!0;for(let x of u)y=y&&p[x[0]]==x[1];return y};for(let p of t.rulesTable||[])if(o(n,p.selector)){if((d=(s=p.rules)==null?void 0:s.nthChild)==null?void 0:d[a._meta.index])return p.rules.nthChild[a._meta.index].allowedSchs;if((c=p.rules.children)==null?void 0:c.allowedSchs)return p.rules.children.allowedSchs}return null},an=({tree:e})=>tr(e),on=({tree:e})=>rr(e);var{defineProperties:Sl}=Object,lr=({store:e,target:t,view:r,treeKeyDownCmds:n,textAreaKeyDownCmd:l,opts:a={}})=>{Sl(e,{render:{value:function(s){r(s||this)},configurable:!0},currentNode:{writable:!0,configurable:!0},_tree:{writable:!0,configurable:!0}}),e.render();let o=document.querySelector(`${t} [role='tree']`);if(o){o._aria=Zt,o._render=r,e._tree=o,Jr(o),o.onkeydown=Ol(e,n,{textAreaKeyDownCmd:l}),o.onclick=Il(e);let s=o.querySelector(`[id='${CSS.escape(a.selectId)}']`);if(s&&a.selectId!="")o._walker.currentNode=s,w(o,o._walker.currentNode,{focus:a.focus});else{e.currentNode=Et(o,e.currentNode);let d=o._walker.nextNode(),c=e.currentNode||o._walker.nextNode()||d;w(o,c,{focus:a.focus})}return o._walker.currentNode.scrollIntoView({block:"start"}),o}},Ol=(e,t,r)=>function(n){Ml(n,this,e,t,r)};async function Ml(e,t,r,n=[],l={}){switch(e.stopPropagation(),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}if(e.target instanceof HTMLTextAreaElement)return Rl(e,t,r,l.textAreaKeyDownCmd);let o=new Map(n).get(sn(e));!o||(l.denyCmds||[]).includes(o.name)||Cl(t,r,o)||(o({tree:t,store:r}),t._walker.currentNode=Et(t,t._walker.currentNode),w(t._walker.currentNode),r.currentNode=t._walker.currentNode,ir(t,t._walker.currentNode,o))}var Cl=(e,t,r)=>{var d,c,p,u,y,x,_;let n=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!n)return;let l=V(t,n.id),a=e._walker.currentNode,o=V(t,a.id),s=(h,m)=>{if(!h)return!1;let f=!0;for(let b of m)f=f&&h[b[0]]==b[1];return f};for(let h of t.rulesTable||[])if(s(l,h.selector)&&(((p=(c=(d=h.rules)==null?void 0:d.nthChild)==null?void 0:c[o._meta.index])==null?void 0:p.exceptActions)&&h.rules.nthChild[o._meta.index].exceptActions.map(m=>m.name).includes(r.name)||((u=h.rules.children)==null?void 0:u.onlyActions)&&!h.rules.children.onlyActions.map(m=>m.name).includes(r.name)||((y=h.rules.children)==null?void 0:y.exceptActions)&&h.rules.children.exceptActions.map(m=>m.name).includes(r.name))||s(o,h.selector)&&(((x=h.rules.self)==null?void 0:x.onlyActions)&&!h.rules.self.onlyActions.map(m=>m.name).includes(r.name)||((_=h.rules.self)==null?void 0:_.exceptActions)&&h.rules.self.exceptActions.map(m=>m.name).includes(r.name)))return!0;return!1},Rl=(e,t,r,n=[])=>{e.stopPropagation();let l=e.target,o=new Map(n).get(sn(e));!o||(o({tree:t,store:r},l),r.currentNode=t._walker.currentNode,ir(t,t._walker.currentNode,o))},Il=e=>function(t){return Pl(t,this,e)};function Pl(e,t,r){e.stopPropagation();let n=t._walker.currentNode,l=e.target.closest("[role='treeitem']"),a=!t.querySelector("textarea");if(!!l){if(e.shiftKey||e.metaKey)switch(n.compareDocumentPosition(l)){case Node.DOCUMENT_POSITION_CONTAINS:return w(t,l);case Node.DOCUMENT_POSITION_CONTAINED_BY:return w(t,n);default:if(l.parentNode.closest("[role='treeitem']")!=n.parentNode.closest("[role='treeitem']"))return w(t,l)}e.shiftKey?(n!=l&&document.getSelection().removeAllRanges(),Ze(t,n,l)):e.metaKey?Zr(n,t._walker.currentNode=l):(t._walker.currentNode=l,qe({tree:t},{notFocusIfTextArea:a}),r.currentNode=t._walker.currentNode,ir(t,l,qe))}}var sn=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:n,key:l})=>{let a=[];return e&&a.push("shift"),(t||n)&&a.push("meta"),r&&a.push("alt"),l&&a.push(l),a.join("-")},ir=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}}));var dn=new WeakMap,ar=e=>(...t)=>{let r=e(...t);return dn.set(r,!0),r},Ce=e=>typeof e=="function"&&dn.has(e);var or=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,$t=(e,t,r=null,n=null)=>{for(;t!==r;){let l=t.nextSibling;e.insertBefore(t,n),t=l}},Re=(e,t,r=null)=>{for(;t!==r;){let n=t.nextSibling;e.removeChild(t),t=n}};var R={},Ee={};var z=`{{lit-${String(Math.random()).slice(2)}}}`,sr=`<!--${z}-->`,cn=new RegExp(`${z}|${sr}`),He="$lit$",Dt=class{constructor(t,r){this.parts=[],this.element=r;let n=[],l=[],a=document.createTreeWalker(r.content,133,null,!1),o=0,s=-1,d=0,{strings:c,values:{length:p}}=t;for(;d<p;){let u=a.nextNode();if(u===null){a.currentNode=l.pop();continue}if(s++,u.nodeType===1){if(u.hasAttributes()){let y=u.attributes,{length:x}=y,_=0;for(let h=0;h<x;h++)un(y[h].name,He)&&_++;for(;_-- >0;){let h=c[d],m=St.exec(h)[2],f=m.toLowerCase()+He,b=u.getAttribute(f);u.removeAttribute(f);let g=b.split(cn);this.parts.push({type:"attribute",index:s,name:m,strings:g}),d+=g.length-1}}u.tagName==="TEMPLATE"&&(l.push(u),a.currentNode=u.content)}else if(u.nodeType===3){let y=u.data;if(y.indexOf(z)>=0){let x=u.parentNode,_=y.split(cn),h=_.length-1;for(let m=0;m<h;m++){let f,b=_[m];if(b==="")f=P();else{let g=St.exec(b);g!==null&&un(g[2],He)&&(b=b.slice(0,g.index)+g[1]+g[2].slice(0,-He.length)+g[3]),f=document.createTextNode(b)}x.insertBefore(f,u),this.parts.push({type:"node",index:++s})}_[h]===""?(x.insertBefore(P(),u),n.push(u)):u.data=_[h],d+=h}}else if(u.nodeType===8)if(u.data===z){let y=u.parentNode;(u.previousSibling===null||s===o)&&(s++,y.insertBefore(P(),u)),o=s,this.parts.push({type:"node",index:s}),u.nextSibling===null?u.data="":(n.push(u),s--),d++}else{let y=-1;for(;(y=u.data.indexOf(z,y+1))!==-1;)this.parts.push({type:"node",index:-1}),d++}}for(let u of n)u.parentNode.removeChild(u)}},un=(e,t)=>{let r=e.length-t.length;return r>=0&&e.slice(r)===t},dr=e=>e.index!==-1,P=()=>document.createComment(""),St=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;var lt=class{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(let n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(let n of this.__parts)n!==void 0&&n.commit()}_clone(){let t=or?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,l=document.createTreeWalker(t,133,null,!1),a=0,o=0,s,d=l.nextNode();for(;a<n.length;){if(s=n[a],!dr(s)){this.__parts.push(void 0),a++;continue}for(;o<s.index;)o++,d.nodeName==="TEMPLATE"&&(r.push(d),l.currentNode=d.content),(d=l.nextNode())===null&&(l.currentNode=r.pop(),d=l.nextNode());if(s.type==="node"){let c=this.processor.handleTextExpression(this.options);c.insertAfterNode(d.previousSibling),this.__parts.push(c)}else this.__parts.push(...this.processor.handleAttributeExpressions(d,s.name,s.strings,this.options));a++}return or&&(document.adoptNode(t),customElements.upgrade(t)),t}};var pn=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),Ll=` ${z} `,Ye=class{constructor(t,r,n,l){this.strings=t,this.values=r,this.type=n,this.processor=l}getHTML(){let t=this.strings.length-1,r="",n=!1;for(let l=0;l<t;l++){let a=this.strings[l],o=a.lastIndexOf("<!--");n=(o>-1||n)&&a.indexOf("-->",o+1)===-1;let s=St.exec(a);s===null?r+=a+(n?Ll:sr):r+=a.substr(0,s.index)+s[1]+s[2]+He+s[3]+z}return r+=this.strings[t],r}getTemplateElement(){let t=document.createElement("template"),r=this.getHTML();return pn!==void 0&&(r=pn.createHTML(r)),t.innerHTML=r,t}};var Ot=e=>e===null||!(typeof e=="object"||typeof e=="function"),It=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]),it=class{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let l=0;l<n.length-1;l++)this.parts[l]=this._createPart()}_createPart(){return new Mt(this)}_getValue(){let t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){let a=n[0].value;if(typeof a=="symbol")return String(a);if(typeof a=="string"||!It(a))return a}let l="";for(let a=0;a<r;a++){l+=t[a];let o=n[a];if(o!==void 0){let s=o.value;if(Ot(s)||!It(s))l+=typeof s=="string"?s:String(s);else for(let d of s)l+=typeof d=="string"?d:String(d)}}return l+=t[r],l}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}},Mt=class{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==R&&(!Ot(t)||t!==this.value)&&(this.value=t,Ce(t)||(this.committer.dirty=!0))}commit(){for(;Ce(this.value);){let t=this.value;this.value=R,t(this)}this.value!==R&&this.committer.commit()}},q=class{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(P()),this.endNode=t.appendChild(P())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=P()),t.__insert(this.endNode=P())}insertAfterPart(t){t.__insert(this.startNode=P()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;Ce(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=R,r(this)}let t=this.__pendingValue;t!==R&&(Ot(t)?t!==this.value&&this.__commitText(t):t instanceof Ye?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):It(t)?this.__commitIterable(t):t===Ee?(this.value=Ee,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){let r=this.startNode.nextSibling;t=t==null?"":t;let n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){let r=this.options.templateFactory(t);if(this.value instanceof lt&&this.value.template===r)this.value.update(t.values);else{let n=new lt(r,t.processor,this.options),l=n._clone();n.update(t.values),this.__commitNode(l),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());let r=this.value,n=0,l;for(let a of t)l=r[n],l===void 0&&(l=new q(this.options),r.push(l),n===0?l.appendIntoPart(this):l.insertAfterPart(r[n-1])),l.setValue(a),l.commit(),n++;n<r.length&&(r.length=n,this.clear(l&&l.endNode))}clear(t=this.startNode){Re(this.startNode.parentNode,t.nextSibling,this.endNode)}},Ct=class{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;Ce(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=R,r(this)}if(this.__pendingValue===R)return;let t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=R}},Rt=class extends it{constructor(t,r,n){super(t,r,n);this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new cr(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}},cr=class extends Mt{},fn=!1;(()=>{try{let e={get capture(){return fn=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();var Pt=class{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=l=>this.handleEvent(l)}setValue(t){this.__pendingValue=t}commit(){for(;Ce(this.__pendingValue);){let a=this.__pendingValue;this.__pendingValue=R,a(this)}if(this.__pendingValue===R)return;let t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),l=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),l&&(this.__options=jl(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=R}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}},jl=e=>e&&(fn?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);var ur=class{handleAttributeExpressions(t,r,n,l){let a=r[0];return a==="."?new Rt(t,r.slice(1),n).parts:a==="@"?[new Pt(t,r.slice(1),l.eventContext)]:a==="?"?[new Ct(t,r.slice(1),n)]:new it(t,r,n).parts}handleTextExpression(t){return new q(t)}},pr=new ur;function mr(e){let t=fr.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},fr.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;let n=e.strings.join(z);return r=t.keyString.get(n),r===void 0&&(r=new Dt(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}var fr=new Map;var hr=new WeakMap,at=(e,t,r)=>{let n=hr.get(t);n===void 0&&(Re(t,t.firstChild),hr.set(t,n=new q(Object.assign({templateFactory:mr},r))),n.appendInto(t)),n.setValue(e),n.commit()};typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");var N=(e,...t)=>new Ye(e,t,"html",pr);var mn=(e,t)=>{let r=e.startNode.parentNode,n=t===void 0?e.endNode:t.startNode,l=r.insertBefore(P(),n);r.insertBefore(P(),n);let a=new q(e.options);return a.insertAfterNode(l),a},Pe=(e,t)=>(e.setValue(t),e.commit(),e),Tr=(e,t,r)=>{let n=e.startNode.parentNode,l=r?r.startNode:e.endNode,a=t.endNode.nextSibling;a!==l&&$t(n,t.startNode,a,l)},xr=e=>{Re(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},hn=(e,t,r)=>{let n=new Map;for(let l=t;l<=r;l++)n.set(e[l],l);return n},Tn=new WeakMap,xn=new WeakMap,Le=ar((e,t,r)=>{let n;return r===void 0?r=t:t!==void 0&&(n=t),l=>{if(!(l instanceof q))throw new Error("repeat can only be used in text bindings");let a=Tn.get(l)||[],o=xn.get(l)||[],s=[],d=[],c=[],p=0;for(let f of e)c[p]=n?n(f,p):p,d[p]=r(f,p),p++;let u,y,x=0,_=a.length-1,h=0,m=d.length-1;for(;x<=_&&h<=m;)if(a[x]===null)x++;else if(a[_]===null)_--;else if(o[x]===c[h])s[h]=Pe(a[x],d[h]),x++,h++;else if(o[_]===c[m])s[m]=Pe(a[_],d[m]),_--,m--;else if(o[x]===c[m])s[m]=Pe(a[x],d[m]),Tr(l,a[x],s[m+1]),x++,m--;else if(o[_]===c[h])s[h]=Pe(a[_],d[h]),Tr(l,a[_],a[x]),_--,h++;else if(u===void 0&&(u=hn(c,h,m),y=hn(o,x,_)),!u.has(o[x]))xr(a[x]),x++;else if(!u.has(o[_]))xr(a[_]),_--;else{let f=y.get(c[h]),b=f!==void 0?a[f]:null;if(b===null){let g=mn(l,a[x]);Pe(g,d[h]),s[h]=g}else s[h]=Pe(b,d[h]),Tr(l,b,a[x]),a[f]=null;h++}for(;h<=m;){let f=mn(l,s[m+1]);Pe(f,d[h]),s[h++]=f}for(;x<=_;){let f=a[x++];f!==null&&xr(f)}Tn.set(l,s),xn.set(l,c)}});var Lt={};kr(Lt,{ENTRY_MARKED:()=>ze,MOVED:()=>J,NEW:()=>Ae,NEW_KEY:()=>De,NEW_ORDER:()=>$e,NEW_TYPE:()=>X,REMOVED:()=>ke,buildBaseIndices:()=>Vl,diff:()=>Gl});var Ae="new",ke="removed",J="moved",$e="order_changed",De="key_changed",X="type_changed",ze="entry_changed",Vl=e=>{let t={};C(e,(r,n)=>(I(r,"_meta",n),Object.assign(t,{[r.$a]:r}),delete r._visit,delete r._pruned,r)),e._indices=t},Gl=(e,t,r={})=>{let n=[],l=t._indices;C(e,(o,s)=>{Ie(o,"_diff",{});let d=l[o.$a];if(d){let c=s.parent,p=d._meta.parent;p.$a!=c.$a&&Object.assign(o._diff||(o._diff={}),{[J]:{oldParent:p,newParent:c,oldPath:d._meta.path,newPath:s.path}}),d._meta.index!=s.index&&Object.assign(o._diff||(o._diff={}),{[$e]:{oldOrder:d.index,newOrder:o.index}}),d.t!=o.t&&Object.assign(o._diff||(o._diff={}),{[X]:{oldType:d.t,newType:o.t,parent:c}}),d.$r!=o.$r&&Object.assign(o._diff||(o._diff={}),{[X]:{oldType:d.$r,newType:o.$r,parent:c}}),d.v!=o.v&&Object.assign(o._diff||(o._diff={}),{[X]:{oldType:d.v,newType:o.v,parent:c}}),d.key!=o.key&&Object.assign(o._diff||(o._diff={}),{[De]:{oldKey:d.key,newKey:o.key,parent:c}}),d.isEntry!=o.isEntry&&Object.assign(o._diff||(o._diff={}),{[ze]:{oldIsEntry:d.isEntry,newIsEntry:o.isEntry,parent:c}}),Object.keys(o._diff).length!=0&&(Object.assign(o._diff,{meta:{level:s.level,path:s.path,pa:s.parent.$a}}),n.push(o)),I(d,"_visit",!0)}else o._diff={[Ae]:{parent:s.parent},meta:{level:s.level,path:s.path,pa:s.parent.$a}},n.push(o),I(o,"_pruned",!0);return o});let a=[];return C(t,(o,s)=>(Ie(o,"_diff",{}),o._visit||(o._diff={[ke]:{parent:s.parent},meta:{level:s.level,path:s.path,pa:s.parent.$a}},a.push(o),I(o,"_pruned",!0)),o)),n=n.concat(a),n};var yn=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),ot(e,"title",t),ot(e,"description",t),Kl(e,"rw",["rw","r","w"],t),yr(e,"required",t),Fl(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},Fl=(e,t)=>{switch(e.t){case k:Hl(e,t);break;case M:Yl(e,t);break;case O:zl(e,t);break;case D:Jl(e,t);break;case S:Xl(e,t);break;case te:ql(e,t);break;case re:case le:case ae:case ne:case ie:case oe:_n(e,t,{min:e.min,max:e.max});break;case se:case de:_n(e,t);break;case ce:Wl(e,t);break;case ye:Bl(e,t);break}},ql=(e,t)=>{Ql(e,"pattern",t),he(e,"min",t,{min:0}),he(e,"max",t,{min:0}),st(e,t),ot(e,"default",t,Object.assign(Nn(e,["min","max","pattern"]),{ignoreEmpty:!0}))},Wl=(e,t)=>{yr(e,"default",t)},_n=(e,t,r)=>{jt(e,"min",t,r),jt(e,"max",t,r),he(e,"multipleOf",t),st(e,t),jt(e,"default",t,Nn(e,["min","max","multipleOf"]))},Bl=(e,t)=>{Zl(e,"default",t)},Hl=(e,t)=>{he(e,"min",t,{min:0}),he(e,"max",t,{min:0}),st(e,t)},Yl=(e,t)=>{he(e,"min",t,{min:1}),he(e,"max",t,{min:1}),st(e,t),yr(e,"unique",t)},zl=(e,t)=>{he(e,"min",t,{min:1}),he(e,"max",t,{min:1}),st(e,t)},Jl=(e,t)=>{},Xl=(e,t)=>{ot(e,"tagname",t,{min:1})},Nn=(e,t=[])=>{let r={};for(let n of t)(e.errors[n]||[]).length==0&&(typeof e.changes[n]=="number"?(e.changes[n]||e.changes[n]==0)&&(r[n]=e.changes[n]):r[n]=e.changes[n]);return r},ot=(e,t,r,n={})=>{if(!r.hasOwnProperty(t)||n.ignoreEmpty&&r[t]=="")return;let l=r[t],a=2**18;(s=>new Blob([s]).size)(l)>a?$(e,t,`string size limit is ${Math.ceil(a/1024)} KB`):n.max&&l.length>n.max?$(e,t,`must be less than or equal ${n.max} length`):n.min&&l.length<n.min?$(e,t,`must be grater than or equal ${n.min} length`):n.pattern?new RegExp(n.pattern).test(l)||$(e,t,`must matche pattern ${n.pattern}`):e.changes[t]=l},yr=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let n=!!r[t];e.changes[t]=n},jt=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return;let l=_r(r[t]);!l&&l!=0?$(e,t,"must be number"):n.min&&l<n.min?$(e,t,`must be greater than or equal ${n.min}`):n.max&&l>n.max?$(e,t,`must be less than than or equal ${n.max}`):n.multipleOf&&l%n.multipleOf!=0?$(e,t,`must be multiple of ${n.multipleOf}`):e.changes[t]=l},he=(e,t,r,n)=>{if(!r.hasOwnProperty(t))return;jt(e,t,r,n);let l=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?$(e,t,"must be integer number"):l>Number.MAX_SAFE_INTEGER?$(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):l<Number.MIN_SAFE_INTEGER&&$(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},Ql=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(ot(e,t,r),(e.errors[t]||[]).length==0))try{let n=r[t];if(n=="")return;e.changes[t]=new RegExp(n)}catch(n){$(e,t,"invalid regex")}},st=(e,t)=>{if(t.min&&t.max){let r=_r(t.min),n=_r(t.max);(r||r==0)&&(n||n==0)&&r>n&&($(e,"min","min is greater than max"),$(e,"max","max is less than min"))}},Zl=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?$(e,t,"must be null"):e.changes[t]=r[t])},Kl=(e,t,r,n)=>{!n.hasOwnProperty(t)||(r.includes(n[t])?e.changes[t]=n[t]:$(e,t,"value must be r, w, or rw"))},$=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},_r=e=>ei(e,"number");var ei=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=a=>["checkbox","radio"].includes(a.type)?a.checked:a.value,r=this.querySelector("form").elements,n={};for(let a=0;a<r.length;a++){let o=t(r[a]);!(r[a]instanceof HTMLTextAreaElement)&&o==""||(n[r[a].name]=o)}let l={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:n};this.dispatchEvent(new CustomEvent("sch-update",{detail:l,bubbles:!0}))}}});customElements.define("autosize-text",class extends HTMLElement{static get observedAttributes(){return["data-value"]}attributeChangedCallback(e,t,r){this.autosize(r)}connectedCallback(){this.autosize.bind(this)()}autosize(e){for(let t of this.getElementsByTagName("textarea"))e||(e=t.value),e&&(t.value=e,Ve({target:t}))}});var Nr=(e,t,r)=>{try{at(Le([t],n=>n.$a,n=>N`
    <p class="meta-def">${ti(r.key,n._meta.path)||"-"}</p>
    <p>${Ne(n.t)}</span>
    <form data-path="${n._meta.path}" data-file="${r.key}" class="fbox">
      ${dt(n,"title",{keyDisplay:"Title"})}
      ${dt(n,"description",{keyDisplay:"Description"})}
      ${li(n)}
      ${ri(n,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:v(n,"rw")||"rw",keyDisplay:"Read / Write"})}
      ${ni(n,"default",{keyDisplay:"Default",min:v(n,"min"),max:v(n,"max")})}
    </form>
  `),e)}catch(n){console.log(n)}},ti=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(n=>n!=""),t.splice(0,0,e);let r=N`<span style="color: var(--meta-def-color);">${t[0]} :: ${t[1]}</span>`;return t=t.slice(2).flatMap(n=>[N`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(n)]),t.splice(0,0,r),t},ct=(e,t,r,n={})=>{var l;return N`
  <label class="${n.readonly&&`box-label ${t} readonly`||`box-label ${t}`}">
    <p class="l">${n.keyDisplay||t} ${n.readonly&&N`<span>· readonly</span>`}</p>
    ${r}
    ${(l=Ut(e,t))==null?void 0:l.map(a=>N`<p class="err">${a}</p>`)}
  </label>
  `},dt=(e,t,r={})=>ct(e,t,N`
    <autosize-text data-value="${v(e,t)||""}">
      <textarea name="${ut(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${Ut(e,t)&&"invalid"}" @input="${Ve}">${r.value||v(e,t)||""}</textarea>
    </autosize-text>
  `,r),je=(e,t,r={})=>ct(e,t,N`
    <input type="number" name="${ut(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${r.min}" max="${r.max}" value="${r.value||v(e,t)}" ?readonly="${r.readonly}" class="${Ut(e,t)&&"invalid"}">
  `,r),Se=(e,t,r={})=>ct(e,t,N`
    <input type="number" name="${ut(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${r.value||v(e,t)}" ?readonly="${r.readonly}" class="${Ut(e,t)&&"invalid"}">
  `,r),br=(e,t,r={})=>ct(e,t,N`
    <input type="checkbox" name="${ut(e,t)}" ?disabled="${r.readonly}" ?checked="${r.value||v(e,t)}">
  `,r),ri=(e,t,r={})=>ct(e,t,N`
    <select name="${ut(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([n,l])=>N`<option value="${n}" ?selected="${(r.selected||v(e,t))==n}">${l}</option>`)}
    </select>
  `,r),ni=(e,t,r={})=>{switch(e.t){case ce:return br(e,t,r);case re:case le:case ae:case ne:case ie:case oe:case se:case de:return je(e,t,r);case te:return dt(e,t,r);default:return""}},ut=(e,t)=>t,v=(e,t)=>(e.metadata||{})[t],li=e=>{let t;switch(e.t){case k:let a=0;for(let o of e.fields)v(o,"required")&&a++;t=[Se(e,"min",{keyDisplay:"Min Properties",value:a,readonly:!0}),Se(e,"max",{keyDisplay:"Max Properties",value:e.fields.length,min:Math.max(v(e,"min")||0,0)})];break;case M:t=[Se(e,"min",{keyDisplay:"Min Items",min:1,value:1,max:v(e,"max")}),Se(e,"max",{keyDisplay:"Max Items",min:v(e,"min")}),br(e,"unique",{keyDisplay:"Item uniqueness"})];break;case O:t=[Se(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),Se(e,"max",{keyDisplay:"Max Items",value:v(e,"max")||e.schs.length})];break;case S:t=[dt(e,"tagname",{keyDisplay:"Tag name",value:e.tagname})];break;case te:t=[Se(e,"min",{keyDisplay:"Min Length",min:0,max:v(e,"max")}),Se(e,"max",{keyDisplay:"Max Length",min:Math.max(0,v(e,"min"))}),dt(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case re:case le:case ae:case ne:case ie:case oe:t=[je(e,"min",{keyDisplay:"Min",min:e.min,max:Math.min(v(e,"max"),e.max)}),je(e,"max",{keyDisplay:"Max",min:Math.max(v(e,"min"),e.min),max:e.max}),je(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:Math.min(v(e,"max"),e.max)})];break;case se:case de:t=[je(e,"min",{keyDisplay:"Min",max:v(e,"max")}),je(e,"max",{keyDisplay:"Max",min:v(e,"min")}),je(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:v(e,"max")})];break;case ce:t=[];case ye:t=[];case D:t=[];case Oe:t=[];case j:t=[];case B:t=[];default:t=[]}let r=e._meta.parent.t==k,n=e._meta.level>2,l=!e.isKeyPattern;return r&&n&&l&&t.push(br(e,"required",{keyDisplay:"Required"})),t};var Ut=(e,t)=>e.errors&&e.errors[t];var Vt=(e,t,r={})=>{var n;try{let l={level:1,tab:((n=r.ui)==null?void 0:n.tab)||0,models:t._models||{},taggedLevel:t.taggedLevel};l.rootLevel=l.level,Object.assign(l,r.ui),r.ui.lineClass&&Object.assign(l,{tab:r.ui.tab+2}),ii(e,{sch:t,ui:l,path:t.path||"",key:t.key,parent:t})}catch(l){console.log(l)}},ii=(e,t)=>at(N`
  <ul role="tree" aria-multiselectable="true" class="${`${t.ui.lineClass||""} text-sm`}" aria-labelledby="${t.ui.taggedLevel[t.ui.level]+"_tree"}">
    ${t.ui.nothing?Ee:pt(t)}
  </ul>
  `,document.querySelector(e)),bn=e=>{if(!e)return"";for(let t of Object.keys(e))switch(t){case Ae:return"N";case ke:return"R";case J:return"M";case $e:return"";case De:return"C";case X:return"C";case ze:return"C"}},pt=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Object.assign(e.ui,{expanded:!0}),ai(e);case[M].includes(e.sch.t):return e.sch.sch.hasOwnProperty("fields")||e.sch.sch.hasOwnProperty("schs")?Object.assign(e.ui,{expanded:!0}):Object.assign(e.ui,{expanded:!1}),gn(e);case(e.sch.hasOwnProperty("fields")||e.sch.hasOwnProperty("schs")):return Object.assign(e.ui,{expanded:!0}),gn(e);default:return oi(e)}},ai=e=>N`
  <li id="${e.path}" data-tag="${e.ui.taggedLevel[e.ui.level]}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" id="${e.ui.taggedLevel[e.ui.level]+"_tree"}">
      ${gr(e.key)}
    </dfn>
    <ul data-group="${vn(e.sch)}" role="group" tabindex="-1">
      ${wn(e)}
    </ul>
  </li>`,gn=e=>N`
  <li id="${e.path}" data-tag="${e.ui.taggedLevel[e.ui.level]}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" data-diff="${bn(e.sch._diff)}" data-group-size="${si(e.sch)}">
      ${En(Object.assign(e,{key:gr(e.key)}))}
      ${An(e)}
    </dfn>
    <ul data-group="${vn(e.sch)}" role="group">
      ${wn(e)}
    </ul>
  </li>`,oi=e=>N`
  <li id="${e.path}" data-tag="${e.ui.taggedLevel[e.ui.level]}" data-diff="${bn(e.sch._diff)}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${En(Object.assign(e,{key:gr(e.key)}))}
    ${An(e)}
  </li>`,wn=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return Ee;switch(!0){case[k,S].includes(e.sch.t):return di(e);case[O,ee,L].includes(e.sch.t):return ci(e);case[M].includes(e.sch.t):return ui(e);case[D].includes(e.sch.t):return pi(e);default:return Ee}},di=e=>Le(e.sch.fields,t=>t.$a,(t,r)=>pt({key:t.key,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[${t.key}]`})),ci=e=>Le(e.sch.schs,t=>t.$a,(t,r)=>pt({key:r,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),ui=e=>Le([e.sch.sch],t=>t.$a,(t,r)=>pt({key:r,sch:e.sch.sch,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),pi=e=>Le(e.sch.schs,t=>t.$a,(t,r)=>pt({key:"",sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),Q=(e,t=0)=>`padding-left: ${(e.ui.level-1)*2+e.ui.tab-1+t}ch`,kn=(e,t,r)=>N`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  @input="${Ve}"
  @focus="${Yr}"
  >${r}</textarea>`,En=e=>e.ui.level==e.ui.rootLevel+1?fi(e):mi(e),fi=e=>N`
  <span class="def" style="${Q(e)}">
    ${hi(e.sch,e.ui)}
  </span>
  <span class="k">${Gt(e)}</span>
  <span class="s">=</span>
  `,mi=e=>{var t;switch(!0){case e.parent.t==D:return N`
      <span class="s" style="${Q(e,1)}">|</span>
      `;case(e.parent.t==ee&&e.sch.$a==e.parent.schs[0].$a):return N`
      <span class="s" style="${Q(e)}">k</span>
      `;case(e.parent.t==ee&&e.sch.$a==e.parent.schs[1].$a):return N`
      <span class="s" style="${Q(e)}">v</span>
      `;case(e.parent.t==L&&e.sch.$a==e.parent.schs[0].$a):return N`
      <span class="s" style="${Q(e)}">extends</span>
      `;case(e.parent.t==L&&e.sch.$a==e.parent.schs[1].$a):return N`
      <span class="s" style="${Q(e)}">record</span>
      `;case e.parent.t==M:return N`
      <span class="s" style="${Q(e)}">└</span>
      `;case e.parent.t==k:return N`
      <span class="k" style="${Q(e,1)}" data-required="${!!((t=e.sch.metadata)==null?void 0:t.required)}">
        ${Gt(e)}
      </span>
      <span class="s">:</span>
    `;case e.parent.t==S:return N`
      <span class="s" style="${Q(e,.5)}">|</span>
      <span class="k tag">
        ${Gt(e)}
      </span>
      <span class="s">·</span>
    `;default:return N`
      <span class="k" style="${Q(e,1)}">
        ${Gt(e)}
      </span >
      <span class="s">:</span>
    `}},Gt=e=>e.sch.uiMode=="editKey"?kn("key-edit",e.ui.parentPath,e.key):N`${e.key}`,An=e=>e.ui.level==e.ui.rootLevel+1?Ti(e):xi(e),Ti=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):N`<span class="t">${$n(e)}</span>`,xi=e=>N`<span class="t">${$n(e)}</span>`,$n=e=>e.sch.uiMode=="editType"?N`<combo-box id="type_search" list="typesearch">
      ${kn("type-edit",e.ui.parentPath,wr(e.sch,e.ui))}
    </combo-box>`:N`${Dn(e.sch,e.ui)}`,wr=(e,t)=>{var r;switch(!0){case e.t==B:return JSON.stringify(e.v);case e.t==j:return(r=t.models[e.$r])==null?void 0:r.display;default:return Ne(e.t)}},Dn=(e,t)=>{let r,n=e.metadata;switch(!0){case(e.t==k&&e.fields.length==0):r="{ any }";break;case e.t==k:r="{ \xA0 }";break;case e.t==L:r="e { }";break;case e.t==M:r=N`[\xa0 ${Dn(e.sch,t)} \xa0]`;break;case e.t==O:r="( \xA0 )";break;case e.t==ee:r="dict";break;case e.t==D:r="||";break;case e.t==S:r=`|| ${(n==null?void 0:n.tagname)||e.tagname}`;break;case e.t==te:r="string";break;case e.t==re:r="int_8";break;case e.t==le:r="int_16";break;case e.t==ae:r="int_32";break;case e.t==ne:r="uint_8";break;case e.t==ie:r="uint_16";break;case e.t==oe:r="uint_32";break;case e.t==se:r="float_32";break;case e.t==de:r="float_64";break;case e.t==Tt:r="timestamp";break;case e.t==ce:r="bool";break;case e.t==ye:r="null";break;case e.t==Oe:r="any";break;case(e.t==j&&!!t.models[e.$r]):Ie(e,"_text",wr(e,t)),r=N`<span class="ref">${e._text}</span >`;break;case(e.t==j&&e.$r==null):r=N`<span class="ref notfound" title="Ref type">nothing</span>`;break;case e.t==j:r=N`<span class="ref notfound" title="Ref type">${`${e._text||e.$r} (#404)`}</span>`;break;case e.t==B:r=N`<span class="value" title="Value type">${wr(e,t)}</span>`;break;default:r="# UNDEFINED_TYPE #"}return t.tText&&(r=t.tText(e,t)||r),r},gr=e=>e,vn=e=>{switch(!0){case[k,S].includes(e.t):return"keyed";case[O,D,L].includes(e.t):return"indexed";default:return"none"}},si=e=>{switch(!0){case[k,S].includes(e.t):return e.fields.length;case[O,D,L].includes(e.t):return e.schs.length;case[M].includes(e.t):return 1;default:return 0}},hi=(e,t)=>{let r;switch(!0){case e.t==k:r="record";break;case e.t==M:r="list";break;case e.t==O:r="tuple";break;case e.t==D:r="union";break;case e.t==S:r="tagged union";break;case e.t==L:r="extensible union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r};var{selectMultiNodeUpTo:Sn,selectMultiNodeDownTo:On,selectMultiNodeUp:In,selectMultiNodeDown:Mn,selectUpEnd:Cn,selectDownEnd:Rn,selectUp:Pn,selectDown:Ln,selectRoot:jn,selectLast:Un}=kt,Vn=({store:e,target:t,select:r,focus:n=!0})=>{lr({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",Sn],["shift-meta-ArrowDown",On],["shift-ArrowUp",In],["shift-ArrowDown",Mn],["meta-ArrowUp",Cn],["meta-ArrowDown",Rn],["ArrowUp",Pn],["ArrowDown",Ln],["Home",jn],["End",Un],["shift-+",me],["Enter",tt],["Delete",F],["m",Be],["meta-v",K],["shift-alt-ArrowUp",H],["shift-alt-ArrowDown",Y],["alt-ArrowUp",we],["alt-ArrowDown",ve],["Escape",({tree:l})=>fe(l)]],textAreaKeyDownCmd:[["Enter",ge],["Escape",nr]],view:l=>Vt(t,l||e,{ui:{depthLimit:2,tab:0,modelTypeText:(a,o)=>"file",typeText:(a,o)=>{if(a.t==T.RECORD)return"record";if(a.t==T.VALUE)return"value";if(a.t==T.TUPLE)return"tuple";if(a.t==T.UNION)return"union"},viewTypeTop:a=>""}}),opts:{focus:n,selectId:r}})},Ft=({store:e,target:t,select:r,focus:n})=>{Vt(t,e,{ui:{nothing:!0}}),lr({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",Sn],["shift-meta-ArrowDown",On],["shift-ArrowUp",In],["shift-ArrowDown",Mn],["meta-ArrowUp",Cn],["meta-ArrowDown",Rn],["ArrowUp",Pn],["ArrowDown",Ln],["Home",jn],["End",Un],["shift-+",me],["Enter",tt],["shift-Enter",We],["Delete",F],["m",Be],["meta-x",rt],["meta-c",nt],["meta-v",K],["shift-alt-ArrowUp",H],["shift-alt-ArrowDown",Y],["alt-ArrowUp",we],["alt-ArrowDown",ve],["ArrowRight",an],["ArrowLeft",on],["Escape",({tree:l})=>fe(l)]],textAreaKeyDownCmd:[["Enter",ge],["Escape",nr]],view:l=>Vt(t,l||e,{ui:{lineClass:"setnu",tab:3,modelTypeText:(a,o)=>a.isEntry?"entrypoint":"type"}}),opts:{focus:n,selectId:r}})},Kt=({store:e,target:t,treeTarget:r})=>{let n=document.querySelector(t),l=document.querySelector(`${r} [role='tree']`);!n||!l||(I(e,"renderSchMeta",function(a){yi({tree:l,store:a||this,metaForm:n})}),e.renderSchMeta())},yi=({tree:e,store:t,metaForm:r})=>{let n=e.querySelectorAll("[role='treeitem'][aria-selected='true']");if(n.length==1){let l=V(t,n[0].id);l&&Nr(r,l,t)}};var Te="file",Je="project",Gn=(e,t)=>(Object.assign(t,e),t.fields=[],E(()=>t)),Fn=(e,t)=>C(e,(r,n)=>(r.metadata=t[r.$a],r)),qn=(e,t,r)=>(t||(t=Kn()),Object.assign(t,e),E(()=>t)),Bn=()=>Wn({taggedLevel:{1:Je,2:Te,3:U},allowedSchs:[Kn],put:{pos:"prepend",onlyDst:{[Te]:!0}}}),Kn=()=>Wn({taggedLevel:{1:Te,2:U},addDefault:ue,entryable:[U],put:{pos:"prepend"},rulesTable:vr}),Wn=(e={})=>{let t=E(ue);return t.allowedSchs=(e.allowedSchs||Er).map(r=>r()),t.taggedLevel=e.taggedLevel,e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.t==e.addDefault().t)&&e.addDefault()),e.rulesTable&&(t.rulesTable=e.rulesTable),t},Ue=(e,t)=>V(e,`[${t}]`),ft=e=>{let t={};return Ar(e,(r,n)=>{t[r.$a]={display:[n.file.key,r.key].join(" :: "),file:n.file.key,fmodel:r.key,type:r.t}}),t},Ar=(e,t)=>{for(let r of e.fields)for(let n=0;n<r.fields.length;n++)r.fields[n]=t(r.fields[n],{path:`[${r.key}][${r.fields[n].key}]`,file:r})||r.fields[n]},Er=[xt,ue,Kr,qr,Wr,_e,Or,Gr,()=>yt('"json string"'),Ir,Mr,Cr,Rr,Pr,Lr,jr,Ur,Vr,Br,Hr,Fr],_i={selector:[["t",ee]],rules:{self:{exceptActions:[me,K]},children:{exceptActions:[rt,nt,H,Y,F,we,ve]},nthChild:[{allowedSchs:[xt()]}]}},Ni={selector:[["t",L]],rules:{self:{exceptActions:[me,K]},children:{exceptActions:[rt,nt,H,Y,F,we,ve]},nthChild:[{allowedSchs:[Qe(null)]},{allowedSchs:[ue()],exceptActions:[We,ge]}]}},bi={selector:[["t",S]],rules:{children:{allowedSchs:[ue()]}}},vr=[_i,bi,Ni];var{selectMultiNodeUpTo:Oo,selectMultiNodeDownTo:Io,selectMultiNodeUp:Mo,selectMultiNodeDown:Co,selectUpEnd:Hn,selectDownEnd:Yn,selectUp:zn,selectDown:Jn,selectRoot:Xn,selectLast:Qn}=kt,Zn=(e,t,r,n)=>{let l=t.closest("[data-tag='file']"),a=l==null?void 0:l.key;t.closest("[id='project']")?gi(e,a,r,n):t.closest("[id='fmodel']")&&wi(e,a,t,r,n)},gi=(e,t,r,n)=>{switch(!0){case vi(r.name):mt(e,t),e.render();break;case r.name==K.name:break;case el(r.name):mt(e,t),e.render();break;case Ei(r.name):mt(e,t),e.render();break;default:e.render()}},wi=(e,t,r,n,l)=>{let a;switch(!0){case ki(n.name):if(r.dataset.tag!=U)return;Ar(e,(o,s)=>(s.path!=`[${t}]${r.id}`&&o.isEntry&&delete o.isEntry,o)),a=Ue(e,t),a.render();break;case el(n.name):a=Ue(e,t),a._models=ft(e),a.render(),a.renderSchMeta();break;case Ai(n.name):a=Ue(e,t),a.renderSchMeta()}},mt=(e,t,r=null,n=!1)=>{let l=Ue(e,t);if(l&&(l._models=ft(e),Ft({store:l,target:"[id='fmodel']",select:r,focus:n}),Kt({store:l,target:"[id='fsch']",treeTarget:"[id='fmodel']"}),!window._treeClipboard)){let a=document.querySelector("[id='fmodel'] [role='tree']");a._aria.clearClipboard(a)}},tl={update:({store:e,detail:t})=>{let{path:r,attrs:n}=t,l=pe(e,r,(a,o)=>yn(a,n));return l&&(e.render&&e.render(e),e.renderSchMeta&&e.renderSchMeta(e)),l}},Ai=e=>[zn,Jn,Hn,Yn,Xn,Qn,qe].map(t=>t.name).includes(e),vi=e=>[zn,Jn,Hn,Yn,Xn,Qn,qe,H,Y,F].map(t=>t.name).includes(e),el=e=>[me,F,ge,K].map(t=>t.name).includes(e),rl=e=>[me,F,ge,K,H,Y,we,ve,F,Be].map(t=>t.name).includes(e),ki=e=>[Be,K,H,Y].map(t=>t.name).includes(e),Ei=e=>[tt,We].map(t=>t.name).includes(e);var{assign:xe}=Object,nl=(e,t)=>{let r=m=>{for(let f of e.fields)for(let b of f.fields)if(m==b.key)return{file:f,fmodelDst:fmodel}},n=m=>Ge(e,(f,b)=>{if(e.taggedLevel[b.level]==U&&b.path!="")return m.startsWith(b.path)},(f,b)=>(I(f,"_meta",b),f)),l=({$a:m,key:f,index:b,t:g})=>({$a:m,key:f,index:b,t:g}),a=m=>l(m),o=m=>m,s=e._diffToRemote,d={};d.files=[],d.fmodels=[],d.subfmodels=[];for(let m of s){let f=e.taggedLevel[m._diff.meta.level];f==Je?d.project=m:f==Te?d.files.push(m):f==U?d.fmodels.push(m):d.subfmodels.push(m)}let c={},p={},u={};d.project&&(c.project=a(d.project));for(let m=0;m<d.files.length;m++){let f=d.files[m],b=l(f),g=f._diff.meta.path;if(p.files||(p.files={}),u.files||(u.files={}),c.files||(c.files={}),p.fmodels||(p.fmodels={}),u.fmodels||(u.fmodels={}),f._diff[Ae]){p.files[g]=b;for(let Z of f.fields)p.fmodels[`[${f.key}][${Z.key}]`]=xe(o(Z),{pa:b.$a})}f._diff[ke]&&(u.files[g]={$a:b.$a}),(f._diff[$e]||f._diff[De])&&(c.files[g]=b),f._diff[J]&&console.log("project does not permit as parent for moving items"),f._diff[X]&&console.log("file type is always record, cannot be changed")}for(let m=0;m<d.fmodels.length;m++){let f=d.fmodels[m],b=o(f),g=f._diff.meta.path,Z=f._diff.meta.pa;if(c.files||(c.files={}),p.fmodels||(p.fmodels={}),u.fmodels||(u.fmodels={}),c.fmodels||(c.fmodels={}),f._diff[Ae]&&(p.fmodels[g]=xe(b,{pa:Z})),f._diff[ke]&&(u.fmodels[g]={$a:b.$a,pa:Z}),(f._diff[$e]||f._diff[De]||f._diff[X]||f._diff[ze])&&(c.fmodels[g]=xe(b,{pa:Z})),f._diff[J]){let{oldParent:W,newParent:Xe,oldPath:ll,newPath:il}=f._diff[J];switch(e.taggedLevel[W.level]){case Je:console.log("fmodel was not possible to be a file");break;case Te:var y=e.fields.find(al=>al.key==W.key),x=l(y);c.files[W.path]=x,u.fmodels[ll]={$a:f.$a,pa:x.$a};break;case U:var _=r(W.key),x=_.file;c.fmodels[W.path]=xe(o(_.fmodelDst),{pa:x.$a});break;default:var h=n(W.path),_=r(h.key),x=_.file;c.fmodels[h._meta.path]=xe(o(h),{pa:x.$a})}switch(e.taggedLevel[Xe.level]){case Te:var y=e.fields.find(qt=>qt.key==Xe.key),x=l(y);c.files[Xe.path]=x,p.fmodels[il]=xe(b,{pa:x.$a});break;default:console.log("fmodel parent can only be file tag")}}}for(let m=0;m<d.subfmodels.length;m++){let f=d.subfmodels[m],b=f._diff.meta.path;if(c.files||(c.files={}),p.fmodels||(p.fmodels={}),u.fmodels||(u.fmodels={}),c.fmodels||(c.fmodels={}),f._diff[Ae]||f._diff[ke]||f._diff[$e]||f._diff[De]||f._diff[X]){let g=n(b),W=r(g.key).file;c.fmodels[g._meta.path]=xe(o(g),{pa:W.$a})}if(f._diff[J]){let{oldParent:g,newParent:Z,oldPath:W,newPath:Xe}=f._diff[J];switch(e.taggedLevel[g.level]){case Je:console.log("subfmodel was not possible to be a file");break;case Te:var y=e.fields.find(qt=>qt.key==g.key),x=l(y);c.files[g.path]=x,u.fmodels[W]={$a:f.$a,pa:x.$a};break;case U:default:var h=n(g.path),_=r(h.key),x=l(_.file);c.fmodels[h._meta.path]=xe(o(h),{pa:x.$a})}switch(e.taggedLevel[Z.level]){case Je:console.log("subfmodel parent can only be fmodel or subfmodel");break;case Te:console.log("subfmodel parent can only be fmodel or subfmodel");break;case U:default:var h=n(Xe),_=r(h.key),x=_.file;c.fmodels[h._meta.path]=xe(o(h),{pa:x.$a})}}}return console.log({changed:c,added:p,removed:u}),t({changed:c,added:p,removed:u})};var $i={createProjectStore:Bn,getFileStore:Ue,anchorsModels:ft,projectToStore:Gn,fileToStore:qn,controller:Zn,mergeSchMetas:Fn,changeFile:mt,taggedDiff:nl,isDiffableCmd:rl,SchMeta:tl,allSchs:Er,rulesTable:vr};export{Lt as Diff,Ft as FmodelTree,$i as Project,Vn as ProjectTree,Kt as SchMetaForm,Ne as tstr};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
