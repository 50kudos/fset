var Br=Object.defineProperty;var gt=(e,t)=>{for(var r in t)Br(e,r,{get:t[r],enumerable:!0})};var Ne,Fr=new Uint8Array(16);function He(){if(!Ne&&(Ne=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Ne))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ne(Fr)}var wt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Hr(e){return typeof e=="string"&&wt.test(e)}var $t=Hr;var k=[];for(var Ye=0;Ye<256;++Ye)k.push((Ye+256).toString(16).substr(1));function Yr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase();if(!$t(r))throw TypeError("Stringified UUID is invalid");return r}var kt=Yr;function Vr(e,t,r){e=e||{};var n=e.random||(e.rng||He)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=n[a];return t}return kt(n)}var Ve=Vr;var x="record",O="list",E="tuple",L="string",P="number",Ee="integer",j="boolean",F="null",N="union",J="any",C="ref",R="value",vt=[x,E,O,N],S="fmodel",le="sch",G=()=>({type:J}),Ot=()=>({type:L}),St=()=>({type:j}),At=()=>({type:P}),Dt=()=>({type:F}),Je=()=>({type:x,fields:{},order:[]}),Mt=()=>({type:O,sch:A(G)}),Rt=()=>({type:E,schs:[A(G)]}),Ct=()=>({type:N,schs:[A(G)]}),It=e=>({type:C,$ref:e}),ze=e=>{try{return e=JSON.parse(e),e==null||[L,P,j].includes(typeof e)?{type:R,const:e}:!1}catch(t){return!1}},A=(e,t={})=>{let r=e();return r.$anchor||(r.$anchor=Ve()),t.force&&(r.$anchor=Ve()),t.tag&&(r._tag=t.tag),t.tag==le&&D(r,(n,a)=>Object.assign(n,{_tag:t.tag})),r};var ge=e=>{let t=JSON.parse(JSON.stringify(e));return D(t,(r,n)=>A(()=>r,{force:!0})),t},g=e=>D(JSON.parse(JSON.stringify(e)),(t,r)=>{let{type:n,$anchor:a,key:l,_tag:o,isEntry:d}=t,s={type:n,$anchor:a,key:l,_tag:o};switch(d&&Object.assign(s,{isEntry:d}),t.type){case x:let{fields:c,order:p}=t;return Object.assign(s,{fields:c,order:p});case E:case N:let{schs:u}=t;return Object.assign(s,{schs:u});case O:let{sch:_}=t;return Object.assign(s,{sch:_});case R:let{const:h}=t;return Object.assign(s,{const:h});case C:let{$ref:m}=t;return Object.assign(s,{$ref:m});default:return Object.assign(s,{})}}),D=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,e=t(e,r),e._halt)return e;let n=({_tag:a,type:l,$anchor:o,key:d},{path:s,parent:{prune:c}})=>({_tag:a,type:l,$anchor:o,key:d,path:s,prune:c});switch(!0){case[x].includes(e.type):let a=Object.keys(e.fields);for(let d=e.order.length-1;d>=0;d--){let s=e.order[d],c=e.fields[s],p={path:`${r.path}[${s}]`,level:r.level+1,index:d,parent:n(e,r)};if(c=D(c,t,p),c.key=s,e.fields[s]=c,c._halt)return Object.assign(e,{_halt:!0})}break;case[E,N].includes(e.type):for(let d=0;d<e.schs.length;d++){let s=e.schs[d],c={path:`${r.path}[][${d}]`,level:r.level+1,index:d,parent:n(e,r)};if(s=D(s,t,c),e.schs[d]=s,s._halt)return Object.assign(e,{_halt:!0})}break;case[O].includes(e.type):let l={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:n(e,r)},o=D(e.sch,t,l);if(e.sch=o,o._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Jr=(e,t,r)=>{let n={original:{},popped:[]},a=r.sort((l,o)=>o-l);return D(e,(l,o)=>{if(o.path!=t)return l;switch(l.type){case x:let d=a.map(s=>[s,l.order[s]]).filter(([s,c])=>c);for(let[s,c]of d)n.popped.unshift({k:c,sch:l.fields[c],index:s}),delete l.fields[c];for(let s of a)l.order.splice(s,1);break;case O:break;case E:for(let s of a)n.popped.unshift({k:s,sch:l.schs.splice(s,1)[0],index:s});l.schs.length==0&&l.schs.splice(0,0,A(G));break;case N:for(let s of a)n.popped.unshift({k:s,sch:l.schs.splice(s,1)[0],index:s});l.schs.length==0&&l.schs.splice(0,0,A(G));break;default:}return l}),n},zr=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),we=(e,t,r)=>{let n={original:{},inserted:[]},a=r.sort((o,d)=>o.index-d.index),l=(o,d)=>(o=Math.max(o,0),o=Math.min(o,d.length),o);return D(e,(o,d)=>{var s,c,p,u,_,h;if(d.path!=t)return o;switch(o.type){case x:for(let{k:m,sch:b,index:f}of a){for(m=m==0?"0":m,m=m||`${b()._tag||"key"}_${Math.floor(Date.now()/100)}`,m=`${m}`;o.fields[m];)m=`${m} \u2013`;f=l(f,o.order),o.fields[m]=A(b,{tag:(c=(s=e.put)==null?void 0:s.tag)==null?void 0:c[o._tag]}),o.order.splice(f,0,m),n.inserted.push({k:m,sch:o.fields[m],index:f})}break;case O:break;case E:for(let{k:m,sch:b,index:f}of a)f=l(f,o.schs),o.schs.splice(f,0,A(b,{tag:(u=(p=e.put)==null?void 0:p.tag)==null?void 0:u[o._tag]})),n.inserted.push({k:m,sch:o.schs[f],index:f});break;case N:for(let{k:m,sch:b,index:f}of a)f=l(f,o.schs),o.schs.splice(f,0,A(b,{tag:(h=(_=e.put)==null?void 0:_.tag)==null?void 0:h[o._tag]})),n.inserted.push({k:m,sch:o.schs[f],index:f});default:}return o}),n},ke=(e,{dstPath:t,startIndex:r=0},n)=>{let a=(s,c,p)=>K(s,c,(u,_)=>(u._pinId=p,u)),l=Symbol(t);a(e,t,l);let o=$e(e,n,{dstPath:t});return Qe(e,{dstPin:l,startIndex:r},o)},$e=(e,t,r={})=>{let n={},a=zr(Object.keys(t));for(let l of a){let o=t[l],d=p=>{var u;return(u=o.find(_=>_.index==p))==null?void 0:u.newK};if(r.dstPath&&o.filter(u=>r.dstPath.startsWith(u.id)).length!=0)continue;let c=Jr(e,l,o.map(p=>p.index)).popped.map(({k:p,sch:u,index:_})=>({k:d(_)||p,sch:()=>u}));n[l]=c}return n},Qe=(e,{dstPin:t,dstPath:r,startIndex:n=0},a)=>{let l=(c,p)=>z(c,(u,_)=>u._pinId==p,(u,_)=>(u._pinned=_,u));n=Math.max(n,0);let o={},d=Object.values(a).flatMap(c=>c).map((c,p)=>({...c,index:n+p}));if(t){let c=l(e,t);c&&(r=c._pinned.path)}let s=we(e,r,d);return s.inserted.length!=0&&(o[r]=s.inserted),o},et=(e,{dstPath:t,startIndex:r=0},n)=>{let a=Xe(e,n,{dstPath:t,startIndex:r});return Ze(e,{dstPath:t},a)},Xe=(e,t,r={})=>Object.values(t).reduce((n,a)=>{let l=a.map(d=>d.id),o=[];z(e,(d,s)=>(l.includes(s.path)&&(d._meta=s,o.unshift(d)),o.length==l.length),(d,s)=>d);for(let d of a){if(r.dstPath&&r.dstPath.startsWith(d.id))continue;let s=o.find(c=>c._meta.path==d.id);s&&n.unshift({k:d.key,sch:()=>ge(s),index:r.startIndex+n.length,id:d.id})}return n},[]),Ze=(e,{dstPath:t},r)=>{let n={},a=we(e,t,r);return a.inserted.length!=0&&(n[t]=a.inserted),n},ve=(e,t,r)=>K(e,t,(n,a)=>{let l=A(r);switch(!0){case l.type==C:case l.type==R:case l.type!=n.type:let{title:o,description:d,rw:s,required:c,$anchor:p,key:u}=n;return Object.assign(l,{metadata:{title:o,description:d,rw:s,required:c},$anchor:p,key:u}),l;default:return n}}),Q=(e,t)=>z(e,(r,n)=>n.path==t,(r,n)=>(r._meta=n,r)),K=(e,t,r)=>z(e,(n,a)=>a.path==t,r),z=(e,t,r)=>{let n;return D(e,(a,l)=>t(a,l)?(n=r(a,l),n._halt=!0,n):a),n&&delete n._halt,n};var ae=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var Lt=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,Qr=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Xr=/<[a-z][^>]+$/i,Zr=/>[^<>]*$/,en=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,tn=/\s+$/,Pt=(e,t)=>0<t--&&(Xr.test(e[t])||!Zr.test(e[t])&&Pt(e,t)),rn=(e,t,r)=>Qr.test(t)?e:`<${t}${r.replace(tn,"")}></${t}>`,jt=(e,t,r)=>{let n=[],{length:a}=e;for(let o=1;o<a;o++){let d=e[o-1];n.push(Lt.test(d)&&Pt(e,o)?d.replace(Lt,(s,c,p)=>`${t}${o-1}=${p||'"'}${c}${p?"":'"'}`):`${d}<!--${t}${o-1}-->`)}n.push(e[a-1]);let l=n.join("").trim();return r?l:l.replace(en,rn)};var{isArray:X}=Array,{indexOf:Ut,slice:Oe}=[];var nn=1,Gt=111,ln=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},Kt=(e,t)=>e.nodeType===Gt?1/t<0?t?ln(e):e.lastChild:t?e.valueOf():e.firstChild:e,qt=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let n=Oe.call(t,0),a=n[0],l=n[r-1];return{ELEMENT_NODE:nn,nodeType:Gt,firstChild:a,lastChild:l,valueOf(){if(t.length!==r){let o=0;for(;o<r;)e.appendChild(n[o++])}return e}}};var Wt=(e,t,r,n,a)=>{let l=r.length,o=t.length,d=l,s=0,c=0,p=null;for(;s<o||c<d;)if(o===s){let u=d<l?c?n(r[c-1],-0).nextSibling:n(r[d-c],0):a;for(;c<d;)e.insertBefore(n(r[c++],1),u)}else if(d===c)for(;s<o;)(!p||!p.has(t[s]))&&e.removeChild(n(t[s],-1)),s++;else if(t[s]===r[c])s++,c++;else if(t[o-1]===r[d-1])o--,d--;else if(t[s]===r[d-1]&&r[c]===t[o-1]){let u=n(t[--o],-1).nextSibling;e.insertBefore(n(r[c++],1),n(t[s++],-1).nextSibling),e.insertBefore(n(r[--d],1),u),t[o]=r[d]}else{if(!p){p=new Map;let u=c;for(;u<d;)p.set(r[u],u++)}if(p.has(t[s])){let u=p.get(t[s]);if(c<u&&u<d){let _=s,h=1;for(;++_<o&&_<d&&p.get(t[_])===u+h;)h++;if(h>u-c){let m=n(t[s],0);for(;c<u;)e.insertBefore(n(r[c++],1),m)}else e.replaceChild(n(r[c++],1),n(t[s++],-1))}else s++}else e.removeChild(n(t[s++],-1))}return r};var Bt=e=>t=>{for(let r in t){let n=r==="role"?r:`aria-${r}`,a=t[r];a==null?e.removeAttribute(n):e.setAttribute(n,a)}},Ft=(e,t)=>{let r,n=!0,a=document.createAttributeNS(null,t);return l=>{r!==l&&(r=l,r==null?n||(e.removeAttributeNode(a),n=!0):(a.value=l,n&&(e.setAttributeNodeNS(a),n=!1)))}},Ht=(e,t,r)=>n=>{r!==!!n&&((r=!!n)?e.setAttribute(t,""):e.removeAttribute(t))},an=({dataset:e})=>t=>{for(let r in t){let n=t[r];n==null?delete e[r]:e[r]=n}},Yt=(e,t)=>{let r,n=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(n=n.toLowerCase()),a=>{let l=X(a)?a:[a,!1];r!==l[0]&&(r&&e.removeEventListener(n,r,l[1]),(r=l[0])&&e.addEventListener(n,r,l[1]))}},Vt=e=>t=>{typeof t=="function"?t(e):t.current=e},Jt=(e,t)=>t==="dataset"?an(e):r=>{e[t]=r},zt=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var on=function(e){"use strict";var t="fragment",r="template",n="content"in o(r),a=n?function(s){var c=o(r);return c.innerHTML=s,c.content}:function(s){var c=o(t),p=o(r),u=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(s)){var _=RegExp.$1;p.innerHTML="<table>"+s+"</table>",u=p.querySelectorAll(_)}else p.innerHTML=s,u=p.childNodes;return l(c,u),c};return function(c,p){return(p==="svg"?d:a)(c)};function l(s,c){for(var p=c.length;p--;)s.appendChild(c[0])}function o(s){return s===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",s)}function d(s){var c=o(t),p=o("div");return p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+s+"</svg>",l(c,p.firstChild.childNodes),c}}(document),tt=on;var Qt=({childNodes:e},t)=>e[t],Se=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(Ut.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:Xt,importNode:Ae}=document;var Zt=Ae.length!=1,er=Zt?(e,t,r)=>Ae.call(document,tt(e,t,r),!0):tt,tr=Zt?e=>Xt.call(document,e,1|128,null,!1):e=>Xt.call(document,e,1|128);var ie=(e,t,r)=>Wt(e.parentNode,t,r,Kt,e),sn=e=>{let t,r,n=[],a=l=>{switch(typeof l){case"string":case"number":case"boolean":t!==l&&(t=l,r?r.textContent=l:r=document.createTextNode(l),n=ie(e,n,[r]));break;case"object":case"undefined":if(l==null){t!=l&&(t=l,n=ie(e,n,[]));break}if(X(l)){t=l,l.length===0?n=ie(e,n,[]):typeof l[0]=="object"?n=ie(e,n,l):a(String(l));break}"ELEMENT_NODE"in l&&t!==l&&(t=l,n=ie(e,n,l.nodeType===11?Oe.call(l.childNodes):[l]))}};return a},cn=(e,t)=>{switch(t[0]){case"?":return Ht(e,t.slice(1),!1);case".":return Jt(e,t.slice(1));case"o":if(t[1]==="n")return Yt(e,t)}switch(t){case"ref":return Vt(e);case"aria":return Bt(e)}return Ft(e,t)};function rr(e){let{type:t,path:r}=e,n=r.reduceRight(Qt,this);return t==="node"?sn(n):t==="attr"?cn(n,e.name):zt(n)}var oe="is\xB5",nr=ae(new WeakMap),dn=/^(?:plaintext|script|style|textarea|title|xmp)$/i,Z=()=>({stack:[],entry:null,wire:null}),pn=(e,t)=>{let{content:r,updates:n}=fn(e,t);return{type:e,template:t,content:r,updates:n,wire:null}},un=(e,t)=>{let r=jt(t,oe,e==="svg"),n=er(r,e),a=tr(n),l=[],o=t.length-1,d=0,s=`${oe}${d}`;for(;d<o;){let c=a.nextNode();if(!c)throw`bad template: ${r}`;if(c.nodeType===8)c.textContent===s&&(l.push({type:"node",path:Se(c)}),s=`${oe}${++d}`);else{for(;c.hasAttribute(s);)l.push({type:"attr",path:Se(c),name:c.getAttribute(s)}),c.removeAttribute(s),s=`${oe}${++d}`;dn.test(c.tagName)&&c.textContent.trim()===`<!--${s}-->`&&(c.textContent="",l.push({type:"text",path:Se(c)}),s=`${oe}${++d}`)}}return{content:n,nodes:l}},fn=(e,t)=>{let{content:r,nodes:n}=nr.get(t)||nr.set(t,un(e,t)),a=Ae.call(document,r,!0),l=n.map(rr,a);return{content:a,updates:l}},se=(e,{type:t,template:r,values:n})=>{let{length:a}=n;lr(e,n,a);let{entry:l}=e;(!l||l.template!==r||l.type!==t)&&(e.entry=l=pn(t,r));let{content:o,updates:d,wire:s}=l;for(let c=0;c<a;c++)d[c](n[c]);return s||(l.wire=qt(o))},lr=({stack:e},t,r)=>{for(let n=0;n<r;n++){let a=t[n];a instanceof De?t[n]=se(e[n]||(e[n]=Z()),a):X(a)?lr(e[n]||(e[n]=Z()),a,a.length):e[n]=null}r<e.length&&e.splice(r)};function De(e,t,r){this.type=e,this.template=t,this.values=r}var{create:mn,defineProperties:yn}=Object,ar=e=>{let t=ae(new WeakMap),r=n=>(a,...l)=>se(n,{type:e,template:a,values:l});return yn((n,...a)=>new De(e,n,a),{for:{value(n,a){let l=t.get(n)||t.set(n,mn(null));return l[a]||(l[a]=r(Z()))}},node:{value:(n,...a)=>se(Z(),{type:e,template:n,values:a}).valueOf()}})},ir=ae(new WeakMap),Me=(e,t)=>{let r=typeof t=="function"?t():t,n=ir.get(e)||ir.set(e,Z()),a=r instanceof De?se(n,r):r;return a!==n.wire&&(n.wire=a,e.textContent="",e.appendChild(a.valueOf())),e},y=ar("html"),sa=ar("svg");var ce=(e,t)=>JSON.stringify(e)==JSON.stringify(t),Re=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`};var or=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),Ce(e,"title",t),Ce(e,"description",t),Tn(e,"rw",["rw","r","w"],t),rt(e,"required",t),hn(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},hn=(e,t)=>{e.type==x?En(e,t):e.type==O?gn(e,t):e.type==E?wn(e,t):e.type==N?$n(e,t):e.type==L?_n(e,t):e.type==P?bn(e,t):e.type==j?xn(e,t):e.type==F&&Nn(e,t)},_n=(e,t)=>{kn(e,"pattern",t),U(e,"min",t,{min:0}),U(e,"max",t,{min:0}),de(e,t),Ce(e,"default",t,Object.assign(sr(e,["min","max","pattern"]),{ignoreEmpty:!0}))},xn=(e,t)=>{rt(e,"default",t)},bn=(e,t)=>{Ie(e,"min",t),Ie(e,"max",t),U(e,"multipleOf",t),de(e,t),Ie(e,"default",t,sr(e,["min","max","multipleOf"]))},Nn=(e,t)=>{vn(e,"default",t)},En=(e,t)=>{U(e,"min",t,{min:0}),U(e,"max",t,{min:0}),de(e,t)},gn=(e,t)=>{U(e,"min",t,{min:1}),U(e,"max",t,{min:1}),de(e,t),rt(e,"unique",t)},wn=(e,t)=>{U(e,"min",t,{min:1}),U(e,"max",t,{min:1}),de(e,t)},$n=(e,t)=>{},sr=(e,t=[])=>{let r={};for(let n of t)(e.errors[n]||[]).length==0&&(typeof e.changes[n]=="number"?(e.changes[n]||e.changes[n]==0)&&(r[n]=e.changes[n]):r[n]=e.changes[n]);return r},Ce=(e,t,r,n={})=>{if(!r.hasOwnProperty(t)||n.ignoreEmpty&&r[t]=="")return;let a=r[t],l=2**18;(d=>new Blob([d]).size)(a)>l?v(e,t,`string size limit is ${Math.ceil(l/1024)} KB`):n.max&&a.length>n.max?v(e,t,`must be less than or equal ${n.max} length`):n.min&&a.length<n.min?v(e,t,`must be grater than or equal ${n.min} length`):n.pattern?new RegExp(n.pattern).test(a)||v(e,t,`must matche pattern ${n.pattern}`):e.changes[t]=a},rt=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let n=On(r[t]);n==null?v(e,t,"must be boolean"):e.changes[t]=n},Ie=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return;let a=nt(r[t]);!a&&a!=0?v(e,t,"must be number"):n.min&&a<n.min?v(e,t,`must be greater than or equal ${n.min}`):n.max&&a>n.max?v(e,t,`must be less than than or equal ${n.max}`):n.multipleOf&&a%n.multipleOf!=0?v(e,t,`must be multiple of ${n.multipleOf}`):e.changes[t]=a},U=(e,t,r,n)=>{if(!r.hasOwnProperty(t))return;Ie(e,t,r,n);let a=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?v(e,t,"must be integer number"):a>Number.MAX_SAFE_INTEGER?v(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):a<Number.MIN_SAFE_INTEGER&&v(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},kn=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(Ce(e,t,r),(e.errors[t]||[]).length==0))try{let n=r[t];if(n=="")return;e.changes[t]=new RegExp(n)}catch(n){v(e,t,"invalid regex")}},de=(e,t)=>{if(t.min&&t.max){let r=nt(t.min),n=nt(t.max);(r||r==0)&&(n||n==0)&&r>n&&(v(e,"min","min is greater than max"),v(e,"max","max is less than min"))}},vn=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?v(e,t,"must be null"):e.changes[t]=r[t])},Tn=(e,t,r,n)=>{!n.hasOwnProperty(t)||(r.includes(n[t])?e.changes[t]=n[t]:v(e,t,"value must be r, w, or rw"))},v=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},nt=e=>cr(e,"number"),On=e=>cr(e,"boolean");var cr=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=l=>["checkbox","radio"].includes(l.type)?l.checked:l.value,r=this.querySelector("form").elements,n={};for(let l=0;l<r.length;l++){let o=t(r[l]);!(r[l]instanceof HTMLTextAreaElement)&&o==""||(n[r[l].name]=o)}let a={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:n};this.dispatchEvent(new CustomEvent("sch-update",{detail:a,bubbles:!0}))}}});var Pe=(e,t,r)=>{if(!(t._tag!=S&&t._tag!=null))try{Me(e,y.for(t)`
    <p>${Sn(t.rootKey,t.path)||"-"} : <span>${t.type}</span></p>
    <form data-path="${t.path}" data-file="${t.rootKey}">
      ${Le(t,"title",{keyDisplay:"Title"})}
      ${Le(t,"description",{keyDisplay:"Description"})}
      ${Mn(t)}
      ${An(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:"rw",keyDisplay:"Read / Write"})}
      ${Dn(t,"default",{keyDisplay:"Default"})}
    </form>
  `)}catch(n){console.log(n)}},Sn=(e,t)=>(t=t.substring(1,t.length-1).split("][").filter(r=>r!=""),t.splice(0,0,e),t.join(" / ")),fe=(e,t,r,n={})=>{var a;return y`
  <label class="${n.readonly&&`meta-box ${t} readonly`||`meta-box ${t}`}">
    <p class="l">${n.keyDisplay||t} ${n.readonly&&y`<span>· readonly</span>`}</p>
    ${r}
    ${(a=je(e,t))==null?void 0:a.map(l=>y`<p class="err">${l}</p>`)}
  </label>
  `},Le=(e,t,r={})=>fe(e,t,y`
    <textarea name="${pe(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${je(e,t)&&"invalid"}" oninput="${Re}">${ee(e,t)||r.value}</textarea>
  `,r),Ue=(e,t,r={})=>fe(e,t,y`
    <input type="number" name="${pe(e,t)}" inputmode="decimal" step="any" min="${r.min}" max="${r.max}" value="${ee(e,t)||r.value}" ?readonly="${r.readonly}" class="${je(e,t)&&"invalid"}">
  `,r),q=(e,t,r={})=>fe(e,t,y`
    <input type="number" name="${pe(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${ee(e,t)||r.value}" ?readonly="${r.readonly}" class="${je(e,t)&&"invalid"}">
  `,r),lt=(e,t,r={})=>fe(e,t,y`
    <input type="checkbox" name="${pe(e,t)}" ?disabled="${r.readonly}" ?checked="${ee(e,t)||r.value}">
  `,r),An=(e,t,r={})=>fe(e,t,y`
    <select name="${pe(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([n,a])=>y`<option value="${n}" ?selected="${(ee(e,t)||r.selected)==n}">${a}</option>`)}
    </select>
  `,r),Dn=(e,t,r={})=>{switch(e.type){case j:return lt(e,t,r);case P:return Ue(e,t,r);case L:return Le(e,t,r);default:return""}},pe=(e,t)=>t,ee=(e,t)=>(e.metadata||{})[t],Mn=e=>{let t;switch(e.type){case x:t=[q(e,"min",{keyDisplay:"Min Properties",value:Object.keys(e.fields).length,readonly:!0}),q(e,"max",{keyDisplay:"Max Properties",value:Object.keys(e.fields).length,readonly:!0})];break;case O:t=[q(e,"min",{keyDisplay:"Min Items",min:1,value:1}),q(e,"max",{keyDisplay:"Max Items",min:1}),lt(e,"unique",{keyDisplay:"Item uniqueness"})];break;case E:t=[q(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),q(e,"max",{keyDisplay:"Max Items",value:ee(e,"max")||e.schs.length})];break;case L:t=[q(e,"min",{keyDisplay:"Min Length",min:0}),q(e,"max",{keyDisplay:"Max Length",min:0}),Le(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case P:t=[Ue(e,"min",{keyDisplay:"Min"}),Ue(e,"max",{keyDisplay:"Max"}),Ue(e,"multipleOf",{keyDisplay:"Multiple of",min:1})];break;case Ee:t=[];case j:t=[];case F:t=[];case N:t=[];case J:t=[];case C:t=[];case R:t=[];default:t=[]}return e._meta.parent.type==x&&![S,"file","project"].includes(e._tag)&&t.push(lt(e,"required",{keyDisplay:"Required"})),t};var je=(e,t)=>e.errors&&e.errors[t];var dr=(e,t,r={})=>{try{let n=t._models||t.order.reduce((l,o)=>(l[t.fields[o].$anchor]=o,l),{}),a={level:1,tab:0,models:n,rootTag:t._tag,rootKey:t.key};Rn(e,{sch:t,ui:Object.assign(a,r.ui),path:t.path||"",key:t.key,parent:{type:t.type,_tag:t._tag}})}catch(n){console.log(n)}},Rn=(e,t)=>Me(document.querySelector(e),y`
  <theme>
    <ul role="tree" aria-multiselectable="true" class="text-sm" tabindex="-1">
      ${ue(t)}
    </ul>
  </theme>
  ${null}
`);var ue=e=>{switch(!0){case e.sch._tag==e.ui.rootTag:return Cn(e);case vt.includes(e.sch.type):return In(e);default:return Ln(e)}},Cn=e=>y.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._tag}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${at(e.key)}
    </dfn>
    <ul data-group="${pr(e.sch)}" role="group">
      ${fr(e)}
    </ul>
  </li>`,In=e=>y.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._tag}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${ur(Object.assign(e,{key:at(e.key)}))}
      ${mr(e)}
      ${yr(e)}
    </dfn>
    <ul data-group="${pr(e.sch)}" role="group">
      ${fr(e)}
    </ul>
  </li>`,Ln=e=>y.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._tag}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${ur(Object.assign(e,{key:at(e.key)}))}
    ${mr(e)}
    ${yr(e)}
  </li>`,fr=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return y``;switch(!0){case[x].includes(e.sch.type):return Pn(e);case[E].includes(e.sch.type):return jn(e);case[O].includes(e.sch.type):return Un(e);case[N].includes(e.sch.type):return Gn(e);default:return y``}},Pn=e=>e.sch.order.map((t,r)=>ue({key:t,sch:e.sch.fields[t],parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[${t}]`})),jn=e=>e.sch.schs.map((t,r)=>ue({key:r,sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Un=e=>ue({key:0,sch:e.sch.sch,parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:0},path:`${e.path}[][${0}]`}),Gn=e=>e.sch.schs.map((t,r)=>ue({key:"",sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Ge=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab}rem`,hr=(e,t,r)=>y`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="256" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${Re}"
  >${r}</textarea>`,ur=e=>e.parent._tag==e.ui.rootTag?Kn(e):qn(e),Kn=e=>y`
  <span class="def" style="${Ge(e)}">
    ${Wn(e.sch,e.ui)}
  </span>
  <span class="k">${Tr(e)}</span>
  <span class="s">=</span>
  `,qn=e=>{switch(!0){case e.parent.type==N:return y`
      <span class="" style="${Ge(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==O:return y`
      <span class="k" style="${Ge(e)}"></span>
      <span class="s">└</span>
      `;default:return y`
      <span class="k" style="${Ge(e)}">
        ${Tr(e)}
      </span >
      <span class="s">:</span>
    `}},Tr=e=>e.sch.uiMode=="editKey"?hr("key-edit",e.parent.path,e.key):y`${e.key}`,mr=e=>e.parent._tag==e.ui.rootTag?Bn(e):Fn(e),Bn=e=>e.ui.viewTypeRoot?e.ui.viewTypeRoot(e):y`<span class="t">${_r(e)}</span>`,Fn=e=>y`<span class="t">${_r(e)}</span>`,_r=e=>e.sch.uiMode=="editType"?hr("type-edit",e.parent.path,Hn(e.sch,e.ui)):y`${xr(e.sch,e.ui)}`,Hn=(e,t)=>{switch(!0){case e.type==R:return JSON.stringify(e.const);case e.type==C:return t.models[e.$ref];default:return e.type}},xr=(e,t)=>{let r;switch(!0){case(e.type==x&&ce(e.fields,{})):r="{ any }";break;case e.type==x:r="{ \xA0 }";break;case e.type==O:r=y`[ ${xr(e.sch,t)} ]`;break;case e.type==E:r="( \xA0 )";break;case e.type==L:r="string";break;case e.type==P:r="number";break;case e.type==Ee:r="integer";break;case e.type==j:r="bool";break;case e.type==F:r="null";break;case e.type==N:r="||";break;case e.type==J:r="any";break;case(e.type==C&&!!t.models[e.$ref]):r=y`<span class="ref">${e._text=t.models[e.$ref]}</span>`;break;case e.type==C:r=y`<span class="ref notfound" title="Ref type">${`${e._text} (#404)`}</span>`;break;case e.type==R:r=y`<span class="value" title="Value type">${JSON.stringify(e.const)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},at=e=>e,pr=e=>{switch(!0){case[x].includes(e.type):return"keyed";case[E,N].includes(e.type):return"indexed";default:return"none"}},Wn=(e,t)=>{let r;switch(!0){case e.type==x:r="record";break;case e.type==O:r="list";break;case e.type==E:r="tuple";break;case e.type==N:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},yr=e=>{var r;let t;switch(!0){case(e.parent.type==x&&((r=e.sch.metadata)==null?void 0:r.required)):t=[y`<span class="m"> · required</span>`];break;default:t=[]}return t};var it={};gt(it,{clearClipboard:()=>me,createWalker:()=>br,findUnselectedNode:()=>qe,reselectNodes:()=>We,selectMultiNode:()=>re,selectMultiNodeTo:()=>Ke,selectNode:()=>w,selectedGroupedByParent:()=>H,toggleSelectNode:()=>gr});var I="aria-selected",br=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.hasAttribute(I)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),e),w=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,Nr(e),te(t),r.focus&&t.focus())},gr=(e,t)=>{e&&(e.tabIndex=-1),Er(t)},re=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(I)=="true"?Er(e):te(t),r.focus&&t.focus())},Nr=e=>{for(let t of e.querySelectorAll(`[${I}='true']`))ot(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},st=(e,t,r,n={})=>{var o,d,s;let a=e._walker.currentNode,l=t();if(!!l){if(a==r)return(o=n.target)==null?void 0:o.call(null,r);(d=n.pre)==null||d.call(null,a,l),st(e,t,r,n),(s=n.post)==null||s.call(null,a,l)}},Ke=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,st(e,()=>e._walker.nextSibling(),r,{pre:(n,a)=>{re(n,a,{focus:!1})}}),e._walker.currentNode=r,te(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,te(r.parentNode.closest(`[${I}]`)),st(e,()=>e._walker.previousSibling(),r,{pre:(n,a)=>{re(n,a,{focus:!1})}}),ot(r.parentNode.closest(`[${I}]`)),e._walker.currentNode=r,te(r),r.focus();break}},te=e=>{!e||(e.setAttribute(I,!0),e.tabIndex=0)},ot=e=>{!e||(e.setAttribute(I,!1),e.tabIndex=-1)},Er=e=>(e==null?void 0:e.getAttribute(I))=="true"?ot(e):te(e),qe=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(I))=="true");return t},Yn=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),We=(e,t,r={})=>{Nr(e);for(let n of Yn(Object.keys(t))){let a=t[n];if(n==""?n=e.querySelector("[id][aria-level]"):n=e.querySelector(`[id='${CSS.escape(n)}'][aria-level]`),!n)continue;let l=parseInt(n.getAttribute("aria-level")),o=n.querySelectorAll(`[aria-level='${l+1}'][role='treeitem']`);for(let d=0;d<a.length;d++){let s=a[d].index,c=o[s];if(!c)return;c.classList.add("item-pasted"),r.direction&&c.classList.add(r.direction),re(null,c,{focus:d==a.length-1}),e._walker.currentNode=c}}},H=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${I}='true']`}`),n={};for(let a=0;a<r.length;a++){let l=r[a],o=l.parentNode.closest("[role='treeitem']");if(!o)break;l.index=l.index||parseInt(l.getAttribute("aria-posinset"))-1,n[o.id]=n[o.id]||[],n[o.id].push(l)}return n},me=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var dt={};gt(dt,{anchorsModels:()=>yt,createProjectStore:()=>Vn,getFileStore:()=>xe,handleProjectContext:()=>Xn,handleProjectRemote:()=>Jn,projectToStore:()=>el});var Y="new",W="removed",V="moved",ye="order_changed",he="key_changed",Te="type_changed",ct="entry_changed",wr=(e,t,r={})=>{let n={},a=[];D(t,(l,o)=>(l._meta=o,Object.assign(n,{[l.$anchor]:l}),delete l._visit,l)),D(e,(l,o)=>{var s;l._meta=o;let d=n[l.$anchor];if(d){let c=l._meta.parent,p=d._meta.parent;p.$anchor!=c.$anchor&&(l._diff={[V]:{oldParent:p,newParent:c}}),ce(d.order,l.order)||(l._diff={[ye]:{oldOrder:d.order,newOrder:l.order}}),d.type!=l.type&&Object.assign(l._diff||(l._diff={}),{[Te]:{oldType:d.type,newType:l.type,parent:c}}),d.key!=l.key&&Object.assign(l._diff||(l._diff={}),{[he]:{oldKey:d.key,newKey:l.key,parent:c}}),d.isEntry!=l.isEntry&&Object.assign(l._diff||(l._diff={}),{[ct]:{oldIsEntry:d.isEntry,newIsEntry:l.isEntry,parent:c}}),l._diff&&a.push(l),d._visit=!0}else o.path.startsWith((s=o.parent.prune)==null?void 0:s.added)||(l._diff={[Y]:{parent:o.parent}},a.push(l),Object.assign(o.parent,{prune:{added:o.path}}));return l});for(let l of Object.keys(n)){if(n[l]._visit)continue;let o=n[l]._meta,d=o.path;a.filter(c=>c._diff[W]&&d.startsWith(c._meta.path)).length==0&&(n[l]._diff={[W]:{parent:o.parent}},a.push(n[l]))}return a};var B="file",ne="project",Vn=()=>_e({tag:ne,allowedSchs:[$r()],put:{pos:"append"}}),xe=(e,t)=>{let r=Q(e,`[${t}]`);return r.schMetas=e.schMetas,r},Jn=(e,t,r,n)=>{if(!ut(r.name))return;let a=f=>{for(let T of Object.keys(e.fields))if(e.fields[T].fields[f])return{file:e.fields[T],fmodelDst:e.fields[T].fields[f]}},l=f=>z(e,(T,$)=>{if(T._tag==S&&$.path!="")return f.startsWith($.path)},(T,$)=>(T._meta=$,T)),o=wr(e,t),d={};d.files=[],d.fmodels=[],d.subfmodels=[];for(let f of o)f._tag==ne?d.project=f:f._tag==B?d.files.push(f):f._tag==S?d.fmodels.push(f):d.subfmodels.push(f);let s={},c={},p={};if(d.project){let{fields:f,...T}=g(d.project);s.project=T}for(let f of d.files){let{fields:T,...$}=g(f);if(c.files||(c.files={}),p.files||(p.files={}),s.files||(s.files={}),c.fmodels||(c.fmodels={}),p.fmodels||(p.fmodels={}),f._diff[Y]){c.files[f._meta.path]={...$,parentAnchor:f._diff[Y].parent.$anchor};for(let M of Object.keys(T))c.fmodels[f.fields[M]._meta.path]={...T[M],parentAnchor:$.$anchor}}if(f._diff[W]){p.files[f._meta.path]={$anchor:$.$anchor,parentAnchor:f._diff[W].parent.$anchor};for(let M of Object.keys(T))p.fmodels[f.fields[M]._meta.path]={$anchor:T[M].$anchor,parentAnchor:$.$anchor}}(f._diff[ye]||f._diff[he])&&(s.files[f._meta.path]=$),f._diff[V]&&console.log("file cannot be moved to different parent"),f._diff[Te]&&console.log("file type is always record, cannot be changed")}for(let f of d.fmodels){let T=g(f);if(s.files||(s.files={}),c.fmodels||(c.fmodels={}),p.fmodels||(p.fmodels={}),s.fmodels||(s.fmodels={}),f._diff[Y]&&(c.fmodels[f._meta.path]={...T,parentAnchor:f._diff[Y].parent.$anchor}),f._diff[W]&&(p.fmodels[f._meta.path]={$anchor:T.$anchor,parentAnchor:f._diff[W].parent.$anchor}),(f._diff[ye]||f._diff[he]||f._diff[Te]||f._diff[ct])&&(s.fmodels[f._meta.path]={...T,parentAnchor:f._meta.parent.$anchor}),f._diff[V]){let{oldParent:$,newParent:M}=f._diff[V];switch($._tag){case ne:console.log("fmodel cannot be moved from project as direct child");break;case B:var u=e.fields[$.key],{fields:_,...h}=g(u);s.files[u._meta.path]=h,p.fmodels[f._meta.path]={$anchor:f.$anchor,parentAnchor:h.$anchor};break;case S:console.log("impossible for fmodel to have fmodel as parent");break;default:console.log("impossible for fmodel to be moved from unknown tag parent")}switch(M._tag){case ne:console.log("fmodel cannot be moved to project as direct child");break;case B:var u=e.fields[M.key],{fields:_,...h}=g(u);s.files[u._meta.path]=h,c.fmodels[f._meta.path]={...T,parentAnchor:h.$anchor};break;case S:var m=a(M.key),h=g(m.file);c.fmodels[m.fmodelDst._meta.path]={...g(m.fmodelDst),parentAnchor:h.$anchor};break;default:var b=l(M.path),m=a(b.key),h=g(m.file);s.fmodels[b._meta.path]={...g(b),parentAnchor:h.$anchor}}}}for(let f of d.subfmodels){if(s.files||(s.files={}),c.fmodels||(c.fmodels={}),p.fmodels||(p.fmodels={}),s.fmodels||(s.fmodels={}),f._diff[Y]||f._diff[W]||f._diff[ye]||f._diff[he]||f._diff[Te]){let T=l(f._meta.path),$=a(T.key),M=g($.file);s.fmodels[T._meta.path]={...g(T),parentAnchor:M.$anchor}}if(f._diff[V]){let{oldParent:T,newParent:$}=f._diff[V];switch(T._tag){case ne:console.log("subfmodel cannot be moved from project as direct child");break;case B:var u=e.fields[T.key],{fields:_,...h}=g(u);s.files[u._meta.path]=h,p.fmodels[f._meta.path]={$anchor:f.$anchor,parentAnchor:h.$anchor};break;case S:default:var b=l(T.path),m=a(b.key),h=g(m.file);s.fmodels[b._meta.path]={...g(b),parentAnchor:h.$anchor}}switch($._tag){case ne:console.log("subfmodel cannot be moved to project as direct child");break;case B:var b=l(f._meta.path),m=a(b.key),{fields:_,...h}=g(m.file);s.files[m.file._meta.path]=h,c.fmodels[f._meta.path]={...g(f),parentAnchor:h.$anchor};break;case S:default:var b=l(f._meta.path),m=a(b.key),h=g(m.file);s.fmodels[b._meta.path]={...g(b),parentAnchor:h.$anchor}}}}return console.log({changed:s,added:c,removed:p}),n({changed:s,added:c,removed:p})},Xn=(e,t,r)=>{let n=t.closest("[data-tag='file']"),a=n==null?void 0:n.key;if(!!a){if(t.closest("[id='project']"))switch(!0){case pt(r.name):zn(e,a);break;case Be(r.name):let l=xe(e,a);document.querySelector("[id='fmodel'] [role='tree']")._render(l);break}else if(t.closest("[id='fmodel']")){let l,o;switch(!0){case mt(r.name):if(l=xe(e,a),t.dataset.tag!=S)return;Qn(e,(d,s)=>{s.path==`[${l.key}]${t.id}`?(e.entrypoints={},e.entrypoints[d.$anchor]={}):(delete d.isEntry,delete e.entrypoints[d.$anchor])}),o=document.querySelector("[id='fmodel'] [role='tree']"),o._render(l);break;case Be(r.name):l=xe(e,a),l._models=yt(e,l),o=document.querySelector("[id='fmodel'] [role='tree']"),o._render(l);break}}}},yt=(e,t)=>{let r={};for(let n of e.order){let a=e.fields[n];for(let l of a.order)r[a.fields[l].$anchor]=n!=t.key?`${n}.${l}`:l}return r},$r=()=>_e({tag:B,addDefault:()=>_e({tag:S}),put:{tag:{[B]:S,[S]:le,[le]:le}},entryable:[S]}),Zn=(e,t,r)=>{for(let n of e.fmodels)Object.assign(n.sch,{$anchor:n.anchor,type:n.type,key:n.key,_tag:S}),n.isEntry&&(n.sch.isEntry=n.isEntry,r.entrypoints[n.sch.$anchor]={}),t.fields[n.key]=n.sch;return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,A(()=>t)},el=(e,t)=>{t.entrypoints={};for(let r of e.files)t.fields[r.key]=Zn(r,$r(),t);return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,t.schMetas=e.allmeta,A(()=>t)},zn=(e,t)=>{let r=xe(e,t);if((r==null?void 0:r._tag)==B&&(r._models=yt(e,r),ft({store:r,target:"[id='fmodel']",metaSelector:"sch-meta"}),!window._treeClipboard)){let n=document.querySelector("[id='fmodel'] [role='tree']");n._aria.clearClipboard(n)}},Qn=(e,t)=>{for(let r of Object.keys(e.fields)){let n=e.fields[r];for(let a of Object.keys(n.fields)){let l=n.fields[a];t(l,{path:`[${n.key}][${l.key}]`})}}};var kr=[Ot,Je,Mt,Rt,Ct,G,St,At,Dt,()=>ze('"json string"')],_e=(e={})=>{let t=A(Je);return t._allowedSchs=e.allowedSchs||kr.map(r=>r()),e.tag&&(t._tag=e.tag),e.addDefault&&(t._addSchDefault=t._allowedSchs.find(r=>r.type==e.addDefault().type)&&e.addDefault()),e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),t};var pt=e=>[Sr,Ar,vr,Or,Dr,Mr,ht,Tt,_t,be].map(t=>t.name).includes(e),Be=e=>[xt,be,bt,Fe].map(t=>t.name).includes(e),ut=e=>[xt,be,bt,Fe,Tt,_t,Rr,Cr,be,Nt].map(t=>t.name).includes(e),mt=e=>[Nt].map(t=>t.name).includes(e),il=()=>new Map([["shift-meta-ArrowUp",tl],["shift-meta-ArrowDown",rl],["shift-ArrowUp",nl],["shift-ArrowDown",ll],["meta-ArrowUp",vr],["meta-ArrowDown",Or],["ArrowUp",Sr],["ArrowDown",Ar],["Home",Dr],["End",Mr],["shift-+",xt],["Enter",al],["shift-Enter",Ir],["Delete",be],["m",Nt],["meta-x",Lr],["meta-c",Pr],["meta-v",Fe],["shift-alt-ArrowUp",Tt],["shift-alt-ArrowDown",_t],["alt-ArrowUp",Rr],["alt-ArrowDown",Cr],["Escape",({tree:e})=>me(e)]]),sl=(e,t={})=>function(r){ol(r,this,e,t)};async function ol(e,t,r,n){if(e.target instanceof HTMLTextAreaElement)return cl(e,t,r);let a=il().get(jr(e));if(!!a&&!(n.denyCmds||[]).includes(a.name)){switch(a({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t.renderSchMeta(),t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`)),r.currentNode=t._walker.currentNode,Et(t,t._walker.currentNode,a)}}var dl=()=>new Map([["Enter",bt]]),cl=(e,t,r)=>{let n=e.target,a=dl().get(jr(e));!a||(a({tree:t,store:r},n),t.renderSchMeta(),Et(t,t._walker.currentNode,a))},pl=e=>function(t){return fl(t,this,e)};function fl(e,t,r){let n=t._walker.currentNode,a=e.target.closest("[role='treeitem']"),l=!t.querySelector("textarea");if(!!a){if(e.shiftKey||e.metaKey)switch(n.compareDocumentPosition(a)){case Node.DOCUMENT_POSITION_CONTAINS:return w(t,a);case Node.DOCUMENT_POSITION_CONTAINED_BY:return w(t,n);default:if(a.parentNode.closest("[role='treeitem']")!=n.parentNode.closest("[role='treeitem']"))return w(t,a)}e.shiftKey?Ke(t,n,a):e.metaKey?gr(n,t._walker.currentNode=a):(t._walker.currentNode=a,ht({tree:t},{notFocusIfTextArea:l}),r.currentNode=t._walker.currentNode,Et(t,a,ht)),t.renderSchMeta()}}var ul=({tree:e,store:t})=>{let r=e.querySelectorAll("[id='fmodel'] [aria-selected='true']");if(r.length==1){let n=Q(t,r[0].id);n.displayKey=`${r[0].key}`,n.path=r[0].id,n.rootKey=e.querySelector(".root-item").key,n.metadata=t.schMetas[n.$anchor],Pe(e._metaContainer,n,t)}},jr=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:n,key:a})=>{let l=[];return e&&l.push("shift"),(t||n)&&l.push("meta"),r&&l.push("alt"),a&&l.push(a),l.join("-")},Et=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}})),tl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();Ke(e,t,r)},rl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();Ke(e,t,r)},nl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();re(t,r)},ll=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();re(t,r)},vr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();w(e,t)},Or=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();w(e,t)},Sr=({tree:e})=>w(e,e._walker.previousNode()),Ar=({tree:e})=>w(e,e._walker.nextNode()),Dr=({tree:e})=>{for(;e._walker.parentNode(););w(e,e._walker.currentNode)},Mr=({tree:e})=>{for(;e._walker.nextNode(););w(e,e._walker.currentNode)},ht=({tree:e},t={})=>w(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),xt=({tree:e,store:t})=>{var o;let r=e._walker.currentNode,n=Q(t,r.id),a,l=n._addSchDefault||n._allowedSchs&&n._allowedSchs[0]||t._allowedSchs&&t._allowedSchs[0];!l||(((o=n.put)==null?void 0:o.pos)=="prepend"?a=0:a=Number.MAX_SAFE_INTEGER,we(t,r.id,[{k:null,sch:()=>ge(l),index:a}]),e._render(t),w(e,r))},al=({tree:e,store:t})=>{var n,a;((a=(n=e._walker.currentNode.closest("[role='group']"))==null?void 0:n.dataset)==null?void 0:a.group)=="keyed"&&Ur({tree:e,store:t,editMode:"editKey"})},Ir=({tree:e,store:t})=>{Ur({tree:e,store:t,editMode:"editType"})},Ur=({tree:e,store:t,editMode:r})=>{let n=e._walker.currentNode;K(t,n.id,(l,o)=>({...l,uiMode:r})),e._render(t);let a=e.querySelector("textarea");!a||(a._treeItem=n,a.onblur=l=>ml(e,t,a),a.focus())},ml=(e,t,r)=>{let n=K(t,r._treeItem.id,(a,l)=>Object.assign(a,{uiMode:"cancelled-edit"}));e._render(t),n&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),w(e,e._walker.currentNode))},bt=({tree:e,store:t},r)=>{r.id=="key-edit"?Gr(e,t,r,hl):r.id=="type-edit"&&Gr(e,t,r,yl)},Gr=(e,t,r,n)=>{let a=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),w(e,r._treeItem,{focus:!1});let l=n(e,t,r)||a.id;K(t,l,(o,d)=>Object.assign(o,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(l)}']`),w(e,e._walker.currentNode)},yl=(e,t,r)=>{let n=t._allowedSchs.find(o=>o.type==r.value),a=Object.keys(t._models).find(o=>t._models[o]==r.value),l=ze(r.value);return n?ve(t,r._treeItem.id,()=>ge(n)):a?ve(t,r._treeItem.id,()=>It(a)):l&&ve(t,r._treeItem.id,()=>l),e._walker.currentNode.id},hl=(e,t,r)=>{let n=H(e),a=r.dataset.parentPath;n[r.dataset.parentPath]=n[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>({id:c.id,newK:r.value,index:c.index}));let l=n[r.dataset.parentPath][0].index,d=ke(t,{dstPath:a,startIndex:l},n)[a][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${d}]`},be=({tree:e,store:t})=>{let r=qe(()=>e._walker.nextSibling())||qe(()=>e._walker.previousSibling())||qe(()=>e._walker.parentNode());$e(t,H(e)),e._render(t),w(e,r)},Nt=({tree:e,store:t})=>{var n;let r=e._walker.currentNode;!r||((n=t.entryable)==null?void 0:n.includes(r.dataset.tag))&&(K(t,r.id,(a,l)=>Object.assign(a,{isEntry:!0})),e._render(t),w(e,r))};var Lr=({store:e,tree:t})=>{me(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-cutting");let r=H(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",storeKey:e.key,ops:n=>$e(e,r,{dstPath:n}),selected:r}},Pr=({store:e,tree:t})=>{me(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-copying");let r=H(t,{ops:".item-copying"});window._treeClipboard={type:"copy",storeKey:e.key,ops:n=>Xe(e,r,{dstPath:n,startIndex:0}),selected:r}},Fe=({tree:e,store:t,srcStore:r})=>{let n=Q(t,e._walker.currentNode.id);if(!![x,N,E].includes(n.type)&&window._treeClipboard){let a=e._walker.currentNode.id,{type:l,storeKey:o,ops:d,selected:s}=window._treeClipboard,c=s,p={};if(t.key==o)switch(l){case"copy":p=et(t,{dstPath:a},c);break;case"cut":p=ke(t,{dstPath:a},c);break}else switch(l){case"copy":let u=d(a);p=Ze(t,{dstPath:a},u);break;case"cut":let _=d(a);p=Qe(t,{dstPath:a},_);break}Object.keys(p).length!=0&&(e._render(t),me(e),We(e,p))}},Tt=({tree:e,store:t})=>Kr({tree:e,store:t,direction:"up"},r=>r[0].index),_t=({tree:e,store:t})=>Kr({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),Kr=({tree:e,store:t,direction:r},n)=>{let a=H(e),l={};for(let o of Object.keys(a))l=et(t,{dstPath:o,startIndex:n(a[o])},{[o]:a[o]});Object.keys(l).length!=0&&(e._render(t),We(e,l,{direction:r}))},Rr=({tree:e,store:t})=>qr({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),Cr=({tree:e,store:t})=>qr({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),qr=({tree:e,store:t,startIndex:r,direction:n})=>{let a=H(e),l={};for(let o of Object.keys(a)){let d=a[o].sort((s,c)=>s.index-c.index);l=ke(t,{dstPath:o,startIndex:r(d[0].index)},a)}Object.keys(l).length!=0&&(e._render(t),We(e,l,{direction:n}))},Wr=({store:e,target:t,metaSelector:r,opts:n})=>{e.render=o=>dr(t,o,n||{}),e.render(e),e.schMetas||(e.schMetas={});let a=document.querySelector(`${t} [role='tree']`),l=document.querySelector(r);if(a){a._aria=it,a._render=e.render,br(a),a.onkeydown=sl(e,n.treeKeyDownOpts),a.onclick=pl(e);let o=a._walker.nextNode(),d=e.currentNode||a._walker.nextNode()||o;return w(a,d,{focus:n.focus}),r&&(a._metaContainer=l),a.renderSchMeta=()=>ul({tree:a,store:e}),a.renderSchMeta(),a}},Tl=({store:e,target:t,metaSelector:r})=>{Wr({store:e,target:t,metaSelector:r,opts:{ui:{depthLimit:2,modelTypeText:(n,a)=>"file",typeText:(n,a)=>{if(n.type==x)return"record";if(n.type==R)return"value";if(n.type==E)return"tuple";if(n.type==N)return"union"},viewTypeRoot:n=>""},treeKeyDownOpts:{denyCmds:[Ir,Pr,Lr,Fe].map(n=>n.name)},focus:!0}})},ft=({store:e,target:t,metaSelector:r})=>{Wr({store:e,target:t,metaSelector:r,opts:{ui:{modelTypeText:(n,a)=>n.isEntry?"entrypoint":"type"}}})},_l=({store:e,detail:t,target:r})=>{let{path:n,attrs:a}=t,l=K(e,n,(o,d)=>or(o,a));return e.render&&e.render(e),Object.assign(e.schMetas,{[l.$anchor]:l.metadata}),Pe(r.closest("sch-meta"),l,e),l};export{dt as Project,kr as allSchs,_e as createStore,Tl as initFileView,ft as initModelView,pt as isContextSwitchedCmd,ut as isDiffableCmd,mt as isEntryChangedCmd,Be as isModelChangedCmd,_l as update};
/*! (c) Andrea Giammarchi - ISC */
