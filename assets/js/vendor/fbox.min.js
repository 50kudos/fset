var Yi=Object.defineProperty;var sn=(e,t)=>{for(var r in t)Yi(e,r,{get:t[r],enumerable:!0})};var Lt,zi=new Uint8Array(16);function yr(){if(!Lt&&(Lt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Lt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Lt(zi)}var cn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ji(e){return typeof e=="string"&&cn.test(e)}var dn=Ji;var O=[];for(var xr=0;xr<256;++xr)O.push((xr+256).toString(16).substr(1));function Xi(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(O[e[t+0]]+O[e[t+1]]+O[e[t+2]]+O[e[t+3]]+"-"+O[e[t+4]]+O[e[t+5]]+"-"+O[e[t+6]]+O[e[t+7]]+"-"+O[e[t+8]]+O[e[t+9]]+"-"+O[e[t+10]]+O[e[t+11]]+O[e[t+12]]+O[e[t+13]]+O[e[t+14]]+O[e[t+15]]).toLowerCase();if(!dn(r))throw TypeError("Stringified UUID is invalid");return r}var un=Xi;function Qi(e,t,r){e=e||{};var n=e.random||(e.rng||yr)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return un(n)}var br=Qi;var A=10,I=11,G=12,F=13,W=14,U=15,C=16,Te=17,te=18,re=19,ne=20,ie=21,le=22,ae=23;var ye=24,xe=25;var be=26,$e=27,J=28,oe=29,it=30,we=31,q="fmodel",Ae=()=>({t:it}),Ut=()=>({t:Te}),fn=()=>({t:be}),pn=()=>({t:we}),mn=()=>({t:te}),hn=()=>({t:ne}),Tn=()=>({t:le}),yn=()=>({t:re}),xn=()=>({t:ie}),bn=()=>({t:ae}),wn=()=>({t:ye}),_n=()=>({t:xe}),gn=()=>({t:$e}),X=e=>Object.assign({t:A,fields:[]},e),Nn=e=>Object.assign({t:I,schs:[S(()=>Se(null)),S(X)]},e),vn=()=>({t:F,sch:S(Ae)}),kn=()=>({t:W,schs:[S(Ae)]}),En=()=>({t:U,schs:[S(Ae)]}),$n=()=>({t:C,fields:[{...S(X),key:"tag_a"}],tagname:"tag",allowedSchs:[X()],keyPrefix:"tag"}),An=()=>({t:G,schs:[S(Ut),S(Ae)]}),Se=(e,t)=>Object.assign({t:J,$r:e},t),Vt=e=>{try{return e=JSON.parse(e),e==null||["string","number","boolean"].includes(typeof e)?{t:oe,v:e}:!1}catch(t){return!1}},S=(e,t={})=>{let r=e();return r.$a||(r.$a=br()),t.force&&(r.$a=br()),r},De=e=>Zi[e],Zi={[A]:"record",[I]:"e_record",[G]:"dict",[F]:"list",[W]:"tuple",[U]:"union",[C]:"tagged_union",[Te]:"string",[we]:"integer",[te]:"int8",[re]:"uint8",[ne]:"int16",[ie]:"uint16",[le]:"int32",[ae]:"uint32",[ye]:"float32",[xe]:"float64",[be]:"boolean",[$e]:"nil",[J]:"ref",[oe]:"value",[it]:"any"},_t=e=>el[e],el={[te]:{min:-128,max:127},[ne]:{min:-32768,max:32767},[le]:{min:-2147483648,max:2147483647},[re]:{min:0,max:255},[ie]:{min:0,max:65535},[ae]:{min:0,max:4294967295}},Gt=(e,t)=>e.find(r=>{if(r.t==Se(null).t)return r.to?tl(r,t):!0}),tl=(e,t)=>e.to.find(r=>{var i;let n=r.t==t.sch.t;if((i=t.sch).metadata||(i.metadata={}),r.metadata){let l=!0;for(let a of Object.keys(r.metadata))typeof r.metadata[a]=="boolean"&&(l=l&&r.metadata[a]==!!t.sch.metadata[a]);return n&&l}else return n});var lt=e=>{var t;((t=e.target.dataset)==null?void 0:t.newline)=="false"&&(e.target.value=e.target.value.replace(/\n/g,"")),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},Sn=e=>{lt(e),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},{defineProperty:rl}=Object,Dn=rl,g=(e,t,r)=>Dn(e,t,{value:r,configurable:!0}),Ft=(e,t,r)=>Dn(e,t,{value:r,configurable:!0,writable:!0}),wr=function(e,t,r){var n=null;return function(){n&&clearTimeout(n);var i=arguments;n=setTimeout(function(){n=null,e.apply(r,i)},t)}},qt=(e,t)=>{for(let r=0;r<e.length;r++)if(t(e[r]))return e[r]},_e=(e,t)=>{for(let r=0;r<e.length;r++)t(e[r],r)},at=(e,t,r)=>{for(let n=0;n<e.length;n++)t(r,e[n]);return r};var Kt=(e,t)=>{let r=JSON.parse(JSON.stringify(e));return R(r,(n,i)=>S(()=>n,{force:!0})),r},On=e=>JSON.parse(JSON.stringify(e)),_r=({t:e,$a:t,key:r},{path:n,lpath:i,level:l})=>({t:e,$a:t,key:r,level:l,path:n,lpath:i}),gr=(e,t)=>{let r=e.slice(0);return r.push(t),r},R=(e,t,r={path:"",lpath:[e],level:1,parent:{}})=>{if(delete e._halt,delete e._pruned,e=t(e,r),e._halt||e._pruned)return e;switch(!0){case e.hasOwnProperty("fields"):_e(e.fields,(l,a)=>{let o=l.key,s={path:`${r.path}[${o}]`,level:r.level+1,index:a,parent:_r(e,r),lpath:gr(r.lpath,l)};if(l=R(l,t,s),e.fields[a]=l,l._halt)return Object.assign(e,{_halt:!0})});break;case e.hasOwnProperty("schs"):_e(e.schs,(l,a)=>{let o={path:`${r.path}[][${a}]`,level:r.level+1,index:a,parent:_r(e,r),lpath:gr(r.lpath,l)};if(l=R(l,t,o),e.schs[a]=l,l._halt)return Object.assign(e,{_halt:!0})});break;case e.hasOwnProperty("sch"):let n=e.sch,i={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:_r(e,r),lpath:gr(r.lpath,n)};if(n=R(e.sch,t,i),e.sch=n,n._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Nr=(e,t,r)=>{let n={original:{},popped:[]};return R(e,(i,l)=>{if(typeof t=="function"&&!t.call(null,i,l))return i;if(typeof t!="function"&&l.path!=t)return i;{typeof t=="string"&&(i._halt=!0),typeof r=="function"&&(r=r.call(null,i,l));let a=r.sort((o,s)=>s-o);switch(!0){case i.hasOwnProperty("fields"):for(let o of a)n.popped.unshift({k:i.fields[o].key,sch:i.fields.splice(o,1)[0],index:o});break;case i.hasOwnProperty("sch"):break;case i.hasOwnProperty("schs"):for(let o of a)n.popped.unshift({k:o,sch:i.schs.splice(o,1)[0],index:o});i.schs.length==0&&i.schs.splice(0,0,S(Ae));break;default:}return i}}),n},nl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),ot=(e,t,r)=>{let n={original:{},inserted:[]},i=(l,a)=>(l=Math.max(l,0),l=Math.min(l,a),l);return R(e,(l,a)=>{var o;if(typeof t=="function"&&!t.call(null,l,a))return l;if(typeof t!="function"&&a.path!=t)return l;{typeof t=="string"&&(l._halt=!0),typeof r=="function"&&(r=r.call(null,l,a));let s=r.sort((c,p)=>c.index-p.index);switch(!0){case l.hasOwnProperty("fields"):let c=(o=e.taggedLevel)==null?void 0:o[a.level+1],p=[],{keys:u,anchors:y}=at(l.fields,(f,m)=>(Object.assign(f.keys,{[m.key]:!0}),Object.assign(f.anchors,{[m.$a]:!0}),f),{keys:{},anchors:{}});for(let{k:f,sch:m,index:d}of s){if(y[m().$a])continue;for(f=f==0?"0":f,f=f||`${c||l.keyPrefix||"key"}_${Math.floor(Date.now()/100)}`,f=`${f}`;u[f];)f=`${f} \u2013`;u[f]=!0,d=i(d,l.fields.length+p.length);let h=S(m);h.key=f,h.index=d,p.push(h),n.inserted.push({k:h.key,sch:h,index:d})}s.length!=0&&l.fields.splice(s[0].index,0,...p);break;case l.hasOwnProperty("sch"):break;case l.hasOwnProperty("schs"):for(let{k:f,sch:m,index:d}of s){d=i(d,l.schs.length);let h=S(m);h.index=d,l.schs.splice(d,0,h),n.inserted.push({k:f,sch:l.schs[d],index:d})}break;default:}return l}}),n},Wt=(e,{isRefConstraint:t,dstPath:r,dstLevel:n,dstStore:i,startIndex:l=0},a)=>{let o=(u,y,f)=>ge(u,y,(m,d)=>(g(m,"_pinId",f),m)),s=Symbol(r);o(e,r,s);let c=Bt(e,a,{dstPath:r,dstLevel:n,dstStore:i,isRefConstraint:t});return vr(e,{dstPin:s,startIndex:l},c)},Bt=(e,t,r={})=>{let n={},i=nl(Object.keys(t));r.isRefConstraint==null&&(r.isRefConstraint=!0);let l=r.dstStore||e;for(let a of i){let o=t[a],s=m=>{var d;return(d=o.find(h=>h.index==m))==null?void 0:d.newK},c=m=>{var d;return((d=m.sch)==null?void 0:d.referrers)&&m.sch.referrers.length!=0&&r.isRefConstraint},p=r.dstLevel!=l.refParentLevel;if(r.dstPath&&qt(o,d=>r.dstPath.startsWith(d.id)))continue;let u=at(o,(m,d)=>(c(d)&&p?m.refed.push(d):m.indices.push(d.index),m),{indices:[],refed:[]});r.isRefConstraint&&_e(u.refed,m=>m.setAttribute("data-err","ref"));let f=Nr(e,a,u.indices).popped.map(({k:m,sch:d,index:h})=>({k:s(h)||m,sch:()=>d}));n[a]=f}return n},vr=(e,{dstPin:t,dstPath:r,startIndex:n=0},i)=>{let l=(c,p)=>Oe(c,(u,y)=>u._pinId==p,(u,y)=>(g(u,"_pinned",y),u));n=Math.max(n,0);let a={},o=Object.values(i).flatMap(c=>c).map((c,p)=>Object.assign(c,{index:n+p}));if(t){let c=l(e,t);c&&(r=c._pinned.path)}let s=ot(e,r,o);return s.inserted.length!=0&&(a[r]=s.inserted),a},$r=(e,{dstPath:t,startIndex:r=0},n)=>{let i=kr(e,n,{dstPath:t,startIndex:r});return Er(e,{dstPath:t},i)},kr=(e,t,r={})=>at(Object.values(t),(n,i)=>{let l=i.map(o=>o.id),a=[];Oe(e,(o,s)=>(l.includes(s.path)&&(g(o,"_meta",s),a.unshift(o)),a.length==l.length),(o,s)=>o);for(let o of i){if(r.dstPath&&r.dstPath.startsWith(o.id))continue;let s=a.find(c=>c._meta.path==o.id);s&&n.unshift({k:o.key,sch:()=>Kt(s,e),index:r.startIndex+n.length,id:o.id})}return n},[]),Er=(e,{dstPath:t},r)=>{let n={},i=ot(e,t,r);return i.inserted.length!=0&&(n[t]=i.inserted),n},Ht=(e,t,r)=>ge(e,t,(n,i)=>{let l=S(r),{title:a,description:o,rw:s,required:c,$a:p,key:u}=n,y=l.t==J&&l.$r!=n.$r,f=l.t==oe&&l.v!=n.v,m=l.t!=n.t;return l.$r==p?n:m||f||y?Object.assign(l,{metadata:{title:a,description:o,rw:s,required:c},$a:p,key:u}):n}),H=(e,t)=>Oe(e,(r,n)=>n.path==t,(r,n)=>(g(r,"_meta",n),r)),ge=(e,t,r)=>Oe(e,(n,i)=>i.path==t,r),Oe=(e,t,r)=>{let n;return R(e,(i,l)=>t(i,l)?(n=r(i,l),n._halt=!0,n):i),n&&delete n._halt,n};var Ar={};sn(Ar,{clearClipboard:()=>Re,collapseSelected:()=>Or,createWalker:()=>In,ensureNodeConnected:()=>zt,expandSelected:()=>Dr,findUnselectedNode:()=>Nt,reselectNodes:()=>ct,selectMultiNode:()=>We,selectMultiNodeTo:()=>gt,selectNode:()=>$,selectedGroupedByParent:()=>Ie,toggleSelectNode:()=>Cn});var Y="aria-selected",Yt="aria-expanded",In=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{var r;if(t.hasAttribute(Y)){let n=(r=t.parentElement.closest(`[${Yt}]`))==null?void 0:r.getAttribute(Yt);return n&&n=="false"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}else return NodeFilter.FILTER_SKIP}},!1),e),$=(e,t,r={focus:!0})=>{t=zt(e,t),!!t&&(e._walker.currentNode=t,Rn(e),st(t),r.focus&&t.focus())},Cn=(e,t)=>{e&&(e.tabIndex=-1),Mn(t)},We=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(Y)=="true"?Mn(e):st(t),r.focus&&t.focus())},Rn=(e,t={})=>{t=Object.assign({sync:!0},t);for(let r of e.querySelectorAll(`[${Y}='true']`))t.sync?Jt(r):wr(Jt,0)(r)},Sr=(e,t,r,n={})=>{var a,o,s;let i=e._walker.currentNode,l=t();if(!!l){if(i==r)return(a=n.target)==null?void 0:a.call(null,r);(o=n.pre)==null||o.call(null,i,l),Sr(e,t,r,n),(s=n.post)==null||s.call(null,i,l)}},gt=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,Sr(e,()=>e._walker.nextSibling(),r,{pre:(n,i)=>{We(n,i,{focus:!1})}}),e._walker.currentNode=r,st(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,st(r.parentNode.closest(`[${Y}]`)),Sr(e,()=>e._walker.previousSibling(),r,{pre:(n,i)=>{We(n,i,{focus:!1})}}),Jt(r.parentNode.closest(`[${Y}]`)),e._walker.currentNode=r,st(r),r.focus();break}},st=e=>{!e||(e.setAttribute(Y,!0),e.tabIndex=0)},Jt=e=>{!e||(e.setAttribute(Y,!1),e.tabIndex=-1)},Mn=e=>(e==null?void 0:e.getAttribute(Y))=="true"?Jt(e):st(e),Nt=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(Y))=="true");return t},il=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),ct=(e,t,r={})=>{Rn(e,r);for(let n of il(Object.keys(t))){let i=t[n];if(n==""?n=e.querySelector("[id][aria-level]"):n=e.querySelector(`[id='${CSS.escape(n)}'][aria-level]`),!n)continue;let l=parseInt(n.getAttribute("aria-level")),a=n.querySelectorAll(`[aria-level='${l+1}'][role='treeitem']`);for(let o=0;o<i.length;o++){let s=i[o].index,c=a[s];if(!c)return;r.direction&&c.classList.add(r.direction),We(a[s-1],c,{focus:!1}),e._walker.currentNode=c}r=Object.assign({sync:!0},r),r.sync?e._walker.currentNode.focus():wr(()=>e._walker.currentNode.focus())()}},Ie=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${Y}='true']`}`),n={};for(let i=0;i<r.length;i++){let l=r[i],a=l.parentNode.closest("[role='treeitem']");if(!a)break;l.index=l.index||parseInt(l.getAttribute("aria-posinset"))-1,n[a.id]=n[a.id]||[],n[a.id].push(l)}return n},Dr=e=>{let t=e.querySelectorAll(`[${Y}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(Yt,"true")},Or=e=>{let t=e.querySelectorAll(`[${Y}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(Yt,"false")},Re=e=>{_e(e.querySelectorAll(".item-cutting, .item-copying, [data-err]"),t=>{t.classList.remove("item-cutting","item-copying"),t.removeAttribute("data-err")}),window._treeClipboard=null},zt=(e,t)=>t&&!t.isConnected?t.id?e.querySelector(`[id='${CSS.escape(t.id)}']`):e.querySelector("[id]"):t;var ll=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();gt(e,t,r)},al=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();gt(e,t,r)},ol=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();We(t,r)},sl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();We(t,r)},cl=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();$(e,t)},dl=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();$(e,t)},ul=({tree:e})=>$(e,e._walker.previousNode()),fl=({tree:e})=>$(e,e._walker.nextNode()),pl=({tree:e})=>{for(;e._walker.parentNode(););$(e,e._walker.nextNode()),$(e,e._walker.parentNode())},ml=({tree:e})=>{for(;e._walker.nextNode(););$(e,e._walker.currentNode)},vt=({tree:e},t={})=>$(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),kt=({tree:e,store:t},r)=>Pn(e,t,r),Xt={selectMultiNodeUpTo:ll,selectMultiNodeDownTo:al,selectMultiNodeUp:ol,selectMultiNodeDown:sl,selectUpEnd:cl,selectDownEnd:dl,selectUp:ul,selectDown:fl,selectRoot:pl,selectLast:ml},se=({tree:e,store:t})=>{var a,o;let r=e._walker.currentNode,n=H(t,r.id),i,l=((a=Ir(e,t))==null?void 0:a[0])||n._addSchDefault||n.allowedSchs&&n.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!l||(((o=t.put)==null?void 0:o.pos)=="prepend"?i=0:i=Number.MAX_SAFE_INTEGER,ot(t,r.id,[{k:null,sch:()=>Kt(l),index:i}]),e._render(t),$(e,r))},dt=({tree:e,store:t})=>{var i,l;let r=e._walker.currentNode;if(((l=(i=r.closest("[role='group']"))==null?void 0:i.dataset)==null?void 0:l.group)=="keyed"){let a=r.querySelector(".k").getBoundingClientRect();jn({tree:e,store:t,editMode:"editKey",textRect:a})}},ut=({tree:e,store:t})=>{let r=e._walker.currentNode.querySelector(".t").getBoundingClientRect(),n=Ir(e,t)||t.allowedSchs;jn({tree:e,store:t,editMode:"editType",textRect:r,opts:{allowedTs:n}})},jn=({tree:e,store:t,editMode:r,textRect:n,opts:i={}})=>{let l=e._walker.currentNode,a=ge(t,l.id,(c,p)=>g(c,"uiMode",r));e._render(t);let o=e.querySelector("textarea");if(!o)return;let s=window.getComputedStyle(o);o.style.minWidth=n.width+"px",o.style.minHeight=n.height+"px",o._treeItem=l,o.opts=i,o.onblur=c=>c.relatedTarget&&c.relatedTarget.id!=o._treeItem.id&&Pn(e,t,o),o.focus()},Pn=(e,t,r)=>{let n=ge(t,r._treeItem.id,(i,l)=>g(i,"uiMode","cancelled-edit"));e._render(t),n&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),$(e,e._walker.currentNode))},Ne=({tree:e,store:t},r)=>{r.id=="key-edit"?Ln(e,t,r,Tl):r.id=="type-edit"&&Ln(e,t,r,hl)},Ln=(e,t,r,n)=>{let i=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),$(e,r._treeItem,{focus:!1});let l=n(e,t,r)||i.id;ge(t,l,(a,o)=>g(a,"uiMode","editted")),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(l)}']`),$(e,e._walker.currentNode)},hl=(e,t,r)=>{let n=Ir(e,t)||t.allowedSchs,i=n.find(o=>De(o.t)==r.value),l=t._models[r.value]&&r.value||Object.keys(t._models).find(o=>{let s=t._models[o];return t._models[o].display==r.value?Gt(n,s):!1}),a=Vt(r.value);return i?Ht(t,r._treeItem.id,()=>Kt(i)):l?Ht(t,r._treeItem.id,()=>Se(l)):a&&Ht(t,r._treeItem.id,()=>a),e._walker.currentNode.id},Tl=(e,t,r)=>{let n=Ie(e),i=r.dataset.parentPath;n[r.dataset.parentPath]=n[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>Object.assign(c,{newK:r.value}));let l=n[r.dataset.parentPath][0].index,o=Wt(t,{dstPath:i,startIndex:l,isRefConstraint:!1},n)[i][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${o}]`},z=({tree:e,store:t})=>{let r=e._walker.currentNode,n=Nt(()=>e._walker.nextSibling())||Nt(()=>e._walker.previousSibling())||Nt(()=>e._walker.parentNode());Bt(t,Ie(e)),e._render(t),r.getAttribute("data-err")=="ref"?e._walker.currentNode=r:$(e,n)},Et=({tree:e,store:t})=>{var n;let r=e._walker.currentNode;!r||((n=t.entryable)==null?void 0:n.includes(r.dataset.tag))&&(ge(t,r.id,(i,l)=>Object.assign(i,{isEntry:!0})),e._render(t),$(e,r))};var He=({store:e,tree:t})=>{Re(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-cutting");let r=Ie(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",srcStore:e,ops:({dstPath:n,dstLevel:i,dstStore:l})=>Bt(e,r,{dstPath:n,dstLevel:i,dstStore:l}),selected:r}},Ye=({store:e,tree:t})=>{if(document.getSelection().toString().length!=0)return;Re(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-copying");let r=Ie(t,{ops:".item-copying"});window._treeClipboard={type:"copy",srcStore:e,ops:({dstPath:n})=>kr(e,r,{dstPath:n,startIndex:0}),selected:r}},ce=({tree:e,store:t,srcStore:r})=>{var i;let n=H(t,e._walker.currentNode.id);if(!!(n.hasOwnProperty("fields")||n.hasOwnProperty("schs")||n.hasOwnProperty("sch"))&&!(((i=t.put)==null?void 0:i.onlyDst)&&!t.put.onlyDst[t.taggedLevel[n._meta.level]])&&window._treeClipboard){let l=e._walker.currentNode.id,{type:a,srcStore:o,ops:s,selected:c}=window._treeClipboard,p=c,u={};if(t.key==o.key)switch(a){case"copy":u=$r(t,{dstPath:l},p);break;case"cut":u=Wt(t,{dstPath:l,dstLevel:n._meta.level,dstStore:t},p);break}else switch(a){case"copy":let f=s({dstPath:""});u=Er(t,{dstPath:l},f);break;case"cut":let m=s({dstPath:"",dstLevel:n._meta.level,dstStore:t});u=vr(t,{dstPath:l},m);break}let y=(f,m)=>{let d={};for(let h of Object.keys(m))h==n._meta.path?d[""]=m[h]:d[h]=m[h];f._render(n),Re(f),ct(f,d)};Object.keys(u).length!=0&&(n._tree?y(n._tree,u):(e._render(t),Re(e),ct(e,u)))}},ve=({tree:e,store:t})=>Un({tree:e,store:t,direction:""},r=>r[0].index),ke=({tree:e,store:t})=>Un({tree:e,store:t,direction:""},r=>r[r.length-1].index+1),Un=({tree:e,store:t,direction:r},n)=>{let i=Ie(e),l={};for(let a of Object.keys(i))l=$r(t,{dstPath:a,startIndex:n(i[a])},{[a]:i[a]});Object.keys(l).length!=0&&(e._render(t),ct(e,l,{direction:r,sync:!!e.sync}))},de=({tree:e,store:t})=>Vn({tree:e,store:t,startIndex:r=>r-1,direction:""}),ue=({tree:e,store:t})=>Vn({tree:e,store:t,startIndex:r=>r+1,direction:""}),Vn=({tree:e,store:t,startIndex:r,direction:n})=>{let i=Ie(e),l={};for(let a of Object.keys(i)){let o=i[a].sort((s,c)=>s.index-c.index);l=Wt(t,{dstPath:a,startIndex:r(o[0].index),isRefConstraint:!1},i)}Object.keys(l).length!=0&&(e._render(t),ct(e,l))},Ir=(e,t)=>{var o,s,c;let r=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!r)return;let n=H(t,r.id),i=e._walker.currentNode,l=H(t,i.id),a=(p,u)=>{if(!p)return!1;let y=!0;for(let f of u)y=y&&p[f[0]]==f[1];return y};for(let p of t.rulesTable||[])if(a(n,p.selector)){if((s=(o=p.rules)==null?void 0:o.nthChild)==null?void 0:s[l._meta.index])return p.rules.nthChild[l._meta.index].allowedSchs;if((c=p.rules.children)==null?void 0:c.allowedSchs)return p.rules.children.allowedSchs}return null},$t=({tree:e})=>Dr(e),At=({tree:e})=>Or(e),Qt=({store:e})=>e.inlineDocs=!e.inlineDocs;var{defineProperties:yl}=Object,Zt=({store:e,target:t,view:r,treeKeyDownCmds:n,textAreaKeyDownCmd:i,opts:l={}})=>{yl(e,{render:{value:function(o){r(o||this)},configurable:!0},currentNode:{writable:!0,configurable:!0},_tree:{writable:!0,configurable:!0}}),e.render();let a=document.querySelector(`${t} [role='tree']`);if(a){a._aria=Ar,a._render=r,e._tree=a,In(a),a.onkeydown=xl(e,n,{textAreaKeyDownCmd:i}),a.onclick=bl(e);let o=a.querySelector(`[id='${CSS.escape(l.selectId)}']`);if(l.selectId!==!1)if(o&&l.selectId!="")a._walker.currentNode=o,$(a,a._walker.currentNode,{focus:l.focus});else{e.currentNode=zt(a,e.currentNode);let s=a._walker.nextNode(),c=e.currentNode||a._walker.nextNode()||s;$(a,c,{focus:l.focus})}return l.focus&&a._walker.currentNode.scrollIntoView({block:"center"}),a}},xl=(e,t,r)=>function(n){wl(n,this,e,t,r)};async function wl(e,t,r,n=[],i={}){if(e.stopPropagation(),e.target instanceof HTMLTextAreaElement)return gl(e,t,r,i.textAreaKeyDownCmd);switch(e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}let a=new Map(n).get(Gn(e));!a||(i.denyCmds||[]).includes(a.name)||_l(t,r,a)||(a({tree:t,store:r}),t._walker.currentNode=zt(t,t._walker.currentNode),$(t._walker.currentNode),r.currentNode=t._walker.currentNode,Rr(t,t._walker.currentNode,a))}var _l=(e,t,r)=>{var s,c,p,u,y,f,m;let n=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!n)return;let i=H(t,n.id),l=e._walker.currentNode,a=H(t,l.id),o=(d,h)=>{if(!d)return!1;let v=!0;for(let D of h)v=v&&d[D[0]]==D[1];return v};for(let d of t.rulesTable||[])if(o(i,d.selector)&&(((p=(c=(s=d.rules)==null?void 0:s.nthChild)==null?void 0:c[a._meta.index])==null?void 0:p.exceptActions)&&d.rules.nthChild[a._meta.index].exceptActions.map(h=>h.name).includes(r.name)||((u=d.rules.children)==null?void 0:u.onlyActions)&&!d.rules.children.onlyActions.map(h=>h.name).includes(r.name)||((y=d.rules.children)==null?void 0:y.exceptActions)&&d.rules.children.exceptActions.map(h=>h.name).includes(r.name))||o(a,d.selector)&&(((f=d.rules.self)==null?void 0:f.onlyActions)&&!d.rules.self.onlyActions.map(h=>h.name).includes(r.name)||((m=d.rules.self)==null?void 0:m.exceptActions)&&d.rules.self.exceptActions.map(h=>h.name).includes(r.name)))return!0;return!1},gl=(e,t,r,n=[])=>{e.stopPropagation();let i=e.target,a=new Map(n).get(Gn(e));!a||(a({tree:t,store:r},i),r.currentNode=t._walker.currentNode,Rr(t,t._walker.currentNode,a))},bl=e=>function(t){return Nl(t,this,e)};function Nl(e,t,r){e.stopPropagation();let n=t._walker.currentNode,i=e.target.closest("[role='treeitem']"),l=!t.querySelector("textarea");if(!!i){if(e.shiftKey||e.metaKey)switch(n.compareDocumentPosition(i)){case Node.DOCUMENT_POSITION_CONTAINS:return $(t,i);case Node.DOCUMENT_POSITION_CONTAINED_BY:return $(t,n);default:if(i.parentNode.closest("[role='treeitem']")!=n.parentNode.closest("[role='treeitem']"))return $(t,i)}e.shiftKey?(n!=i&&document.getSelection().removeAllRanges(),gt(t,n,i)):e.metaKey?Cn(n,t._walker.currentNode=i):(t._walker.currentNode=i,vt({tree:t},{notFocusIfTextArea:l}),r.currentNode=t._walker.currentNode,Rr(t,i,vt))}}var Gn=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:n,key:i})=>{let l=[];return e&&l.push("shift"),(t||n)&&l.push("meta"),r&&l.push("alt"),i&&l.push(i),l.join("-")},Rr=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}}));var Fn=new WeakMap,St=e=>(...t)=>{let r=e(...t);return Fn.set(r,!0),r},ze=e=>typeof e=="function"&&Fn.has(e);var Mr=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,er=(e,t,r=null,n=null)=>{for(;t!==r;){let i=t.nextSibling;e.insertBefore(t,n),t=i}},Je=(e,t,r=null)=>{for(;t!==r;){let n=t.nextSibling;e.removeChild(t),t=n}};var K={},Q={};var fe=`{{lit-${String(Math.random()).slice(2)}}}`,Cr=`<!--${fe}-->`,qn=new RegExp(`${fe}|${Cr}`),ft="$lit$",tr=class{constructor(t,r){this.parts=[],this.element=r;let n=[],i=[],l=document.createTreeWalker(r.content,133,null,!1),a=0,o=-1,s=0,{strings:c,values:{length:p}}=t;for(;s<p;){let u=l.nextNode();if(u===null){l.currentNode=i.pop();continue}if(o++,u.nodeType===1){if(u.hasAttributes()){let y=u.attributes,{length:f}=y,m=0;for(let d=0;d<f;d++)Kn(y[d].name,ft)&&m++;for(;m-- >0;){let d=c[s],h=rr.exec(d)[2],v=h.toLowerCase()+ft,D=u.getAttribute(v);u.removeAttribute(v);let P=D.split(qn);this.parts.push({type:"attribute",index:o,name:h,strings:P}),s+=P.length-1}}u.tagName==="TEMPLATE"&&(i.push(u),l.currentNode=u.content)}else if(u.nodeType===3){let y=u.data;if(y.indexOf(fe)>=0){let f=u.parentNode,m=y.split(qn),d=m.length-1;for(let h=0;h<d;h++){let v,D=m[h];if(D==="")v=B();else{let P=rr.exec(D);P!==null&&Kn(P[2],ft)&&(D=D.slice(0,P.index)+P[1]+P[2].slice(0,-ft.length)+P[3]),v=document.createTextNode(D)}f.insertBefore(v,u),this.parts.push({type:"node",index:++o})}m[d]===""?(f.insertBefore(B(),u),n.push(u)):u.data=m[d],s+=d}}else if(u.nodeType===8)if(u.data===fe){let y=u.parentNode;(u.previousSibling===null||o===a)&&(o++,y.insertBefore(B(),u)),a=o,this.parts.push({type:"node",index:o}),u.nextSibling===null?u.data="":(n.push(u),o--),s++}else{let y=-1;for(;(y=u.data.indexOf(fe,y+1))!==-1;)this.parts.push({type:"node",index:-1}),s++}}for(let u of n)u.parentNode.removeChild(u)}},Kn=(e,t)=>{let r=e.length-t.length;return r>=0&&e.slice(r)===t},Pr=e=>e.index!==-1,B=()=>document.createComment(""),rr=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;var Dt=class{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(let n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(let n of this.__parts)n!==void 0&&n.commit()}_clone(){let t=Mr?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,i=document.createTreeWalker(t,133,null,!1),l=0,a=0,o,s=i.nextNode();for(;l<n.length;){if(o=n[l],!Pr(o)){this.__parts.push(void 0),l++;continue}for(;a<o.index;)a++,s.nodeName==="TEMPLATE"&&(r.push(s),i.currentNode=s.content),(s=i.nextNode())===null&&(i.currentNode=r.pop(),s=i.nextNode());if(o.type==="node"){let c=this.processor.handleTextExpression(this.options);c.insertAfterNode(s.previousSibling),this.__parts.push(c)}else this.__parts.push(...this.processor.handleAttributeExpressions(s,o.name,o.strings,this.options));l++}return Mr&&(document.adoptNode(t),customElements.upgrade(t)),t}};var Bn=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),vl=` ${fe} `,pt=class{constructor(t,r,n,i){this.strings=t,this.values=r,this.type=n,this.processor=i}getHTML(){let t=this.strings.length-1,r="",n=!1;for(let i=0;i<t;i++){let l=this.strings[i],a=l.lastIndexOf("<!--");n=(a>-1||n)&&l.indexOf("-->",a+1)===-1;let o=rr.exec(l);o===null?r+=l+(n?vl:Cr):r+=l.substr(0,o.index)+o[1]+o[2]+ft+o[3]+fe}return r+=this.strings[t],r}getTemplateElement(){let t=document.createElement("template"),r=this.getHTML();return Bn!==void 0&&(r=Bn.createHTML(r)),t.innerHTML=r,t}};var nr=e=>e===null||!(typeof e=="object"||typeof e=="function"),ir=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]),Ot=class{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let i=0;i<n.length-1;i++)this.parts[i]=this._createPart()}_createPart(){return new mt(this)}_getValue(){let t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){let l=n[0].value;if(typeof l=="symbol")return String(l);if(typeof l=="string"||!ir(l))return l}let i="";for(let l=0;l<r;l++){i+=t[l];let a=n[l];if(a!==void 0){let o=a.value;if(nr(o)||!ir(o))i+=typeof o=="string"?o:String(o);else for(let s of o)i+=typeof s=="string"?s:String(s)}}return i+=t[r],i}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}},mt=class{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==K&&(!nr(t)||t!==this.value)&&(this.value=t,ze(t)||(this.committer.dirty=!0))}commit(){for(;ze(this.value);){let t=this.value;this.value=K,t(this)}this.value!==K&&this.committer.commit()}},Z=class{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(B()),this.endNode=t.appendChild(B())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=B()),t.__insert(this.endNode=B())}insertAfterPart(t){t.__insert(this.startNode=B()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;ze(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=K,r(this)}let t=this.__pendingValue;t!==K&&(nr(t)?t!==this.value&&this.__commitText(t):t instanceof pt?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):ir(t)?this.__commitIterable(t):t===Q?(this.value=Q,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){let r=this.startNode.nextSibling;t=t==null?"":t;let n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){let r=this.options.templateFactory(t);if(this.value instanceof Dt&&this.value.template===r)this.value.update(t.values);else{let n=new Dt(r,t.processor,this.options),i=n._clone();n.update(t.values),this.__commitNode(i),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());let r=this.value,n=0,i;for(let l of t)i=r[n],i===void 0&&(i=new Z(this.options),r.push(i),n===0?i.appendIntoPart(this):i.insertAfterPart(r[n-1])),i.setValue(l),i.commit(),n++;n<r.length&&(r.length=n,this.clear(i&&i.endNode))}clear(t=this.startNode){Je(this.startNode.parentNode,t.nextSibling,this.endNode)}},lr=class{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;ze(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=K,r(this)}if(this.__pendingValue===K)return;let t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=K}},ar=class extends Ot{constructor(t,r,n){super(t,r,n);this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new jr(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}},jr=class extends mt{},Wn=!1;(()=>{try{let e={get capture(){return Wn=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();var or=class{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=i=>this.handleEvent(i)}setValue(t){this.__pendingValue=t}commit(){for(;ze(this.__pendingValue);){let l=this.__pendingValue;this.__pendingValue=K,l(this)}if(this.__pendingValue===K)return;let t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),i=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=kl(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=K}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}},kl=e=>e&&(Wn?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);var Lr=class{handleAttributeExpressions(t,r,n,i){let l=r[0];return l==="."?new ar(t,r.slice(1),n).parts:l==="@"?[new or(t,r.slice(1),i.eventContext)]:l==="?"?[new lr(t,r.slice(1),n)]:new Ot(t,r,n).parts}handleTextExpression(t){return new Z(t)}},Ur=new Lr;function Gr(e){let t=Vr.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},Vr.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;let n=e.strings.join(fe);return r=t.keyString.get(n),r===void 0&&(r=new tr(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}var Vr=new Map;var Fr=new WeakMap,Xe=(e,t,r)=>{let n=Fr.get(t);n===void 0&&(Je(t,t.firstChild),Fr.set(t,n=new Z(Object.assign({templateFactory:Gr},r))),n.appendInto(t)),n.setValue(e),n.commit()};typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");var b=(e,...t)=>new pt(e,t,"html",Ur);var Hn=(e,t)=>{let r=e.startNode.parentNode,n=t===void 0?e.endNode:t.startNode,i=r.insertBefore(B(),n);r.insertBefore(B(),n);let l=new Z(e.options);return l.insertAfterNode(i),l},Qe=(e,t)=>(e.setValue(t),e.commit(),e),qr=(e,t,r)=>{let n=e.startNode.parentNode,i=r?r.startNode:e.endNode,l=t.endNode.nextSibling;l!==i&&er(n,t.startNode,l,i)},Kr=e=>{Je(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},Yn=(e,t,r)=>{let n=new Map;for(let i=t;i<=r;i++)n.set(e[i],i);return n},zn=new WeakMap,Jn=new WeakMap,Me=St((e,t,r)=>{let n;return r===void 0?r=t:t!==void 0&&(n=t),i=>{if(!(i instanceof Z))throw new Error("repeat can only be used in text bindings");let l=zn.get(i)||[],a=Jn.get(i)||[],o=[],s=[],c=[],p=0;for(let v of e)c[p]=n?n(v,p):p,s[p]=r(v,p),p++;let u,y,f=0,m=l.length-1,d=0,h=s.length-1;for(;f<=m&&d<=h;)if(l[f]===null)f++;else if(l[m]===null)m--;else if(a[f]===c[d])o[d]=Qe(l[f],s[d]),f++,d++;else if(a[m]===c[h])o[h]=Qe(l[m],s[h]),m--,h--;else if(a[f]===c[h])o[h]=Qe(l[f],s[h]),qr(i,l[f],o[h+1]),f++,h--;else if(a[m]===c[d])o[d]=Qe(l[m],s[d]),qr(i,l[m],l[f]),m--,d++;else if(u===void 0&&(u=Yn(c,d,h),y=Yn(a,f,m)),!u.has(a[f]))Kr(l[f]),f++;else if(!u.has(a[m]))Kr(l[m]),m--;else{let v=y.get(c[d]),D=v!==void 0?l[v]:null;if(D===null){let P=Hn(i,l[f]);Qe(P,s[d]),o[d]=P}else o[d]=Qe(D,s[d]),qr(i,D,l[f]),l[v]=null;d++}for(;d<=h;){let v=Hn(i,o[h+1]);Qe(v,s[d]),o[d++]=v}for(;f<=m;){let v=l[f++];v!==null&&Kr(v)}zn.set(i,o),Jn.set(i,c)}});var Br=new WeakMap,j=St(e=>t=>{let r=Br.get(t);if(e===void 0&&t instanceof mt){if(r!==void 0||!Br.has(t)){let n=t.committer.name;t.committer.element.removeAttribute(n)}}else e!==r&&t.setValue(e);Br.set(t,e)});var sr={};sn(sr,{ENTRY_MARKED:()=>yt,MOVED:()=>pe,NEW:()=>Pe,NEW_KEY:()=>Ue,NEW_ORDER:()=>Le,NEW_TYPE:()=>me,REMOVED:()=>je,buildBaseIndices:()=>Wr,diff:()=>Dl,mergeToBase:()=>Ol,mergeToCurrent:()=>Il});var ee="file",ht="project",Xn=(e,t)=>(Object.assign(t,e),t.fields=[],S(()=>t)),Qn=(e,t)=>R(e,(r,n)=>(t[r.$a]&&(r.metadata=t[r.$a]),r)),Zn=(e,t)=>{Wr(e);let r=e._indices;for(let n of e.fields)for(let i of n.fields)if(t[i.$a]){let l=at(t[i.$a],(a,o)=>(r[o]&&a.push(r[o]),a),[]);l.length!=0?g(i,"referrers",l):delete i.referrers}else delete i.referrers},Tt=(e,t,r)=>(t||(t=ei()),Object.assign(t,e),S(()=>t)),ri=()=>ti({taggedLevel:{1:ht,2:ee,3:q},refParentLevel:2,allowedSchs:[ei],put:{pos:"prepend",onlyDst:{[ee]:!0}}}),ei=()=>ti({taggedLevel:{1:ee,2:q},refParentLevel:1,addDefault:X,entryable:[q],put:{pos:"prepend"},rulesTable:Hr}),ti=(e={})=>{let t=S(X);return t.allowedSchs=(e.allowedSchs||Yr).map(r=>r()),t.taggedLevel=e.taggedLevel,e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.t==e.addDefault().t)&&e.addDefault()),e.rulesTable&&(t.rulesTable=e.rulesTable),e.refParentLevel&&(t.refParentLevel=e.refParentLevel),t},It=(e,t)=>H(e,`[${t}]`)||e._currentFileStore,Ce=e=>{let t={};return zr(e,(r,n)=>{t[r.$a]={display:[n.file.key,r.key].join(" :: "),file:n.file.key,fmodel:r.key,sch:r}}),t},zr=(e,t)=>{for(let r of e.fields)for(let n=0;n<r.fields.length;n++)r.fields[n]=t(r.fields[n],{path:`[${r.key}][${r.fields[n].key}]`,file:r})||r.fields[n]},Yr=[Ut,X,vn,kn,En,Ae,fn,gn,()=>Vt('"json string"'),pn,mn,hn,Tn,yn,xn,bn,wn,_n,$n,An,Nn,()=>Se(null)],$l={selector:[["t",G]],rules:{self:{exceptActions:[se,ce]},children:{exceptActions:[He,Ye,ve,ke,z,de,ue]},nthChild:[{allowedSchs:[Ut()]}]}},Al={selector:[["t",I]],rules:{self:{exceptActions:[se,ce]},children:{exceptActions:[He,Ye,ve,ke,z,de,ue]},nthChild:[{allowedSchs:[Se(null,{to:[X({metadata:{strict:!1}})]})]},{allowedSchs:[X()],exceptActions:[ut,Ne]}]}},Sl={selector:[["t",C]],rules:{children:{min:1,allowedSchs:[X(),Se(null,{to:[X()]})]}}},Hr=[$l,Sl,Al];var Pe="new",je="removed",pe="moved",Le="order_changed",Ue="key_changed",me="type_changed",yt="entry_changed",Wr=e=>{let t={};return R(e,(r,n)=>(g(r,"_meta",n),Object.assign(t,{[r.$a]:r}),delete r._visit,delete r._pruned,r)),g(e,"_indices",t),e},Dl=(e,t,r={})=>{let n=[],i=t._indices;R(e,(a,o)=>{delete a._diff;let s={},c=i[a.$a];if(c){let p=o.parent,u=c._meta.parent;u.$a!=p.$a&&Object.assign(s,{[pe]:{oldParent:u,newParent:p,oldPath:c._meta.path,newPath:o.path}}),c._meta.index!=o.index&&u.$a==p.$a&&Object.assign(s,{[Le]:{oldOrder:c.index,newOrder:a.index}}),c.t!=a.t&&Object.assign(s,{[me]:{oldType:c.t,newType:a.t,parent:p}}),c.$r!=a.$r&&Object.assign(s,{[me]:{oldType:c.$r,newType:a.$r,parent:p}}),c.v!=a.v&&Object.assign(s,{[me]:{oldType:c.v,newType:a.v,parent:p}}),c.key!=a.key&&Object.assign(s,{[Ue]:{oldKey:c.key,newKey:a.key,parent:p}}),c.isEntry!=a.isEntry&&Object.assign(s,{[yt]:{oldIsEntry:c.isEntry,newIsEntry:a.isEntry,parent:p}}),Object.keys(s).length!=0&&(g(a,"_diff",Object.assign(s,{meta:Jr(o)})),n.push(a)),g(c,"_visit",!0)}else g(a,"_diff",{[Pe]:{parent:o.parent},meta:Jr(o)}),n.push(a);return a});let l=[];return R(t,(a,o)=>(a._visit||(g(a,"_diff",{[je]:{parent:o.parent},meta:Jr(o)}),l.push(a),g(a,"_pruned",!0)),delete a._visit,a)),n=n.concat(l),n},Jr=({level:e,path:t,lpath:r,parent:n})=>({level:e,path:t,lpath:r,pa:n.$a}),Ol=(e,t)=>(e._indices||(e._indices={}),ii(e,t.removed),li(e,t.added),ni(e,t.changed),ai(e,t.reorder),e),Il=(e,t)=>(e._indices||(e._indices={}),ii(e,t.removed),li(e,t.added),ni(e,t.changed),ai(e,t.reorder),e),ni=(e,{fmodels:t,files:r})=>{oi(e,r,(n,i)=>{let{key:l,index:a}=i;return Object.assign(n,{key:l,index:a})}),oi(e,t,(n,i)=>(n.referrers&&g(i,"referrers",n.referrers),i))},oi=(e,t,r=n=>n)=>{let n={};for(let a of t)n[a.$a]=!0;let i={},l={};for(let a of t)R(a,(o,s)=>(i[o.$a]=o,l[o.$a]=o,o));R(e,(a,o)=>{if(Object.keys(i).length==0&&(a._halt=!0),i[a.$a]){if(e._indices[a.$a]){let s=e._indices[a.$a].metadata;s&&Ft(i[a.$a],"metadata",s)}n[a.$a]?a=r(a,i[a.$a]):a=i[a.$a],delete i[a.$a]}return a}),Xr(e,l)},ii=(e,{fmodels:t,files:r})=>{si(e,r,n=>Tt(n)),si(e,t)},si=(e,t)=>{var i;let r={};for(let l of t)r[i=l.pa]||(r[i]=[]),r[l.pa].push(l.$a);let n=(l,a)=>a.reduce((o,s,c)=>(r[l.$a].includes(s.$a)&&o.push(c),o),[]);if(Nr(e,(l,a)=>(Object.keys(r).length==0&&(l._halt=!0),r[l.$a]),(l,a)=>{let o=[];switch(!0){case l.hasOwnProperty("fields"):o=n(l,l.fields);break;case l.hasOwnProperty("schs"):o=n(l,l.schs);break}return delete r[l.$a],o}),e._indices)for(let l of t)delete e._indices[l.$a]},li=(e,{fmodels:t,files:r})=>{ci(e,r,n=>Tt(n)),ci(e,t)},ci=(e,t,r=n=>n)=>{var l;let n={};for(let a of t)n[l=a.pa]||(n[l]=[]),n[a.pa].push({k:a.key,sch:()=>On(r(a)),index:a.index});ot(e,(a,o)=>(Object.keys(n).length==0&&(a._halt=!0),n[a.$a]),(a,o)=>{let s=n[a.$a];return delete n[a.$a],s});let i={};for(let a of t)R(a,(o,s)=>(i[o.$a]=o,o));Xr(e,i)},ai=(e,{fmodels:t,files:r})=>{di(e,r,n=>Tt(n)),di(e,t)},di=(e,t)=>{var l;let r={};for(let a of t){let{$a:o,index:s}=a;r[l=a.pa]||(r[l]=[]),r[a.pa].push({$a:o,index:s})}let n=(a,o)=>{let s={};for(let c of o)s[c.$a]=c;return r[a.$a].sort((c,p)=>c.index-p.index).map(c=>s[c.$a])};Oe(e,(a,o)=>(Object.keys(r).length==0&&(a._halt=!0),r[a.$a]),(a,o)=>{switch(!0){case a.hasOwnProperty("fields"):a.fields=n(a,a.fields);break;case a.hasOwnProperty("schs"):a.schs=n(a,a.schs);break}return delete r[a.$a],a});let i={};for(let a of t)i[a.$a]=a;Xr(e,i)},Xr=(e,t)=>R(e,(r,n)=>(Object.keys(t).length==0&&(r._halt=!0),t[r.$a]&&(g(r,"_visit",!0),g(r,"_meta",n),e._indices[r.$a]=r,delete r._diff,delete t[r.$a]),r));var fi=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),Ze(e,"title",t),Ze(e,"description",t),ui(e,"rw",["rw","r","w"],t),Rl(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&e.changes[r]!=null?e.metadata[r]=e.changes[r]:delete e.metadata[r];return e},Rl=(e,t)=>{let r=_t(e.t)||{};switch(e.t){case A:jl(e,t);break;case I:Ll(e,t);break;case F:Ul(e,t);break;case W:Vl(e,t);break;case G:Gl(e,t);break;case U:Fl(e,t);break;case C:ql(e,t);break;case Te:Ml(e,t);break;case we:Qr(e,t);break;case te:case ne:case le:case re:case ie:case ae:Qr(e,t,{min:r.min,max:r.max});break;case ye:case xe:Qr(e,t);break;case be:Cl(e,t);break;case $e:Pl(e,t);break}switch(e._meta.parent.t){case A:Rt(e,"required",t);break}},Ml=(e,t)=>{Kl(e,"pattern",t),Ee(e,"min",t,{min:0}),Ee(e,"max",t,{min:0}),Ze(e,"format",t),Mt(e,t),Ze(e,"default",t,Object.assign(pi(e,["min","max","pattern"]),{ignoreEmpty:!0}))},Cl=(e,t)=>{ui(e,"default",["t","f","i"],t)},Qr=(e,t,r)=>{cr(e,"min",t,r),cr(e,"max",t,r),Ee(e,"multipleOf",t),Ze(e,"format",t),Mt(e,t),cr(e,"default",t,Object.assign(pi(e,["min","max","multipleOf"]),r))},Pl=(e,t)=>{Bl(e,"default",t)},jl=(e,t)=>{Rt(e,"strict",t)},Ll=(e,t)=>{Rt(e,"strict",t)},Ul=(e,t)=>{Ee(e,"min",t,{min:0}),Ee(e,"max",t,{min:0}),Mt(e,t),Rt(e,"unique",t)},Vl=(e,t)=>{Ee(e,"min",t,{min:1}),Ee(e,"max",t,{min:1}),Mt(e,t)},Gl=(e,t)=>{Ee(e,"min",t,{min:0}),Ee(e,"max",t,{min:0}),Mt(e,t)},Fl=(e,t)=>{Rt(e,"asUnion",t)},ql=(e,t)=>{Ze(e,"tagname",t,{min:1})},pi=(e,t=[])=>{let r={};for(let n of t)(e.errors[n]||[]).length==0&&(typeof e.changes[n]=="number"?(e.changes[n]||e.changes[n]==0)&&(r[n]=e.changes[n]):r[n]=e.changes[n]);return r},Ze=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;if(n.ignoreEmpty&&r[t]=="")return;let i=r[t],l=2**18,a=s=>new Blob([s]).size,o=s=>n[s]!=null;a(i)>l?V(e,t,`string size limit is ${Math.ceil(l/1024)} KB`):o("max")&&i.length>n.max?V(e,t,`must be less than or equal ${n.max} length`):o("min")&&i.length<n.min?V(e,t,`must be grater than or equal ${n.min} length`):o("pattern")&&n.pattern!=""?new RegExp(n.pattern).test(i)||V(e,t,`must matche pattern ${n.pattern}`):e.changes[t]=i},Rt=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;let n=!!r[t];e.changes[t]=n},cr=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;let i=Zr(r[t]),l=a=>n[a]!=null;!i&&i!=0?V(e,t,"must be number"):l("min")&&i<n.min?V(e,t,`must be greater than or equal ${n.min}`):l("max")&&i>n.max?V(e,t,`must be less than than or equal ${n.max}`):l("multipleOf")&&i%n.multipleOf!=0?V(e,t,`must be multiple of ${n.multipleOf}`):e.changes[t]=i},Ee=(e,t,r,n)=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;cr(e,t,r,n);let i=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])&&V(e,t,"must be integer number")},Kl=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;if(Ze(e,t,r),(e.errors[t]||[]).length==0)try{let n=r[t];if(n=="")return;new RegExp(n),e.changes[t]=n}catch(n){V(e,t,"invalid regex")}},Mt=(e,t)=>{if(t.min&&t.max){let r=Zr(t.min),n=Zr(t.max);(r||r==0)&&(n||n==0)&&r>n&&(V(e,"min","min is greater than max"),V(e,"max","max is less than min"))}},Bl=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;r[t]!=null?V(e,t,"must be null"):e.changes[t]=r[t]},ui=(e,t,r,n)=>{if(!n.hasOwnProperty(t))return e.changes[t]=void 0;r.includes(n[t])?e.changes[t]=n[t]:V(e,t,"value must be r, w, or rw")},V=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},Zr=e=>Wl(e,"number");var Wl=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=l=>["checkbox","radio"].includes(l.type)?l.checked:l.value,r=this.querySelector("form").elements,n={};for(let l=0;l<r.length;l++){let a=t(r[l]);!(r[l]instanceof HTMLTextAreaElement)&&a==""||(n[r[l].name]=a)}let i={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:n};this.dispatchEvent(new CustomEvent("sch-update",{detail:i,bubbles:!0}))}}});customElements.define("autosize-text",class extends HTMLElement{static get observedAttributes(){return["data-value"]}attributeChangedCallback(e,t,r){this.autosize(r)}connectedCallback(){this.autosize.bind(this)()}autosize(e){for(let t of this.getElementsByTagName("textarea"))e||(e=t.value),e&&(t.value=e,lt({target:t}))}});var mi=e=>Xe(Me([{$a:"nothing"}],t=>t.$a,t=>Q),document.querySelector(e)),en=(e,t,r)=>{try{let n=t.referrers||[];Xe(Me([t],i=>i.$a,i=>b`
    <p class="meta-def">${Yl(r.key,i._meta.path)||"-"}</p>
    <p>${De(i.t)}</p>
    <form data-path="${i._meta.path}" data-file="${r.key}" class="fbox">
      ${et(i,"title",{keyDisplay:"Title"})}
      ${et(i,"description",{keyDisplay:"Description"})}
      ${Jl(i)}
      ${hi(i,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:N(i,"rw","rw"),keyDisplay:"Read / Write"})}
      ${zl(i,"default",{keyDisplay:"Default",min:N(i,"min"),max:N(i,"max")})}
    </form>
    ${Hl(n)}
  `),document.querySelector(e))}catch(n){console.log(n)}},Hl=e=>e.length!=0?b`
    <p class="referrers">Referrers</p>
    <ul>
      ${e.map(t=>b`<li>${t._meta.lpath.slice(1).map(r=>r.key||r.index||r._meta.index).join(" / ")}</li>`)}
    </ul>
    `:Q,Yl=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(n=>n!=""),t.splice(0,0,e);let r=b`<span style="color: var(--meta-def-color);">${t[0]} :: ${t[1]}</span>`;return t=t.slice(2).flatMap(n=>[b`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(n)]),t.splice(0,0,r),t},xt=(e,t,r,n={})=>{var i;return b`
  <label class="${n.readonly&&`box-label ${t} readonly`||`box-label ${t}`}">
    <p class="l">${n.keyDisplay||t}</p>
    ${n.title}
    ${r}
    ${(i=Ct(e,t))==null?void 0:i.map(l=>b`<p class="err">${l}</p>`)}
  </label>
  `};var et=(e,t,r={})=>xt(e,t,b`
    <autosize-text data-value="${N(e,t)||""}">
      <textarea name="${bt(e,t)}" maxlength="${j(Ve(r.maxlength))}" minlength="${j(Ve(r.minlength))}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${j(Ct(e,t)&&"invalid")}" @input="${lt}">${r.value||N(e,t,"")}</textarea>
    </autosize-text>
  `,r),tt=(e,t,r={})=>xt(e,t,b`
    <input type="number" name="${bt(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${j(Ve(r.min))}" max="${j(Ve(r.max))}" value="${j(Ve(r.value)||N(e,t))}" ?readonly="${r.readonly}" class="${j(Ct(e,t)&&"invalid")}">
  `,r),Ge=(e,t,r={})=>xt(e,t,b`
    <input type="number" name="${bt(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${j(Ve(r.min))}" max="${j(Ve(r.max))}" value="${j(Ve(r.value)||N(e,t))}" ?readonly="${r.readonly}" class="${j(Ct(e,t)&&"invalid")}">
  `,r),rt=(e,t,r={})=>xt(e,t,b`
    <input type="checkbox" name="${bt(e,t)}" ?disabled="${r.readonly}" ?checked="${!!N(e,t)}" .checked="${!!N(e,t)}" .indeterminate="${r.indeterminate}">
  `,r),hi=(e,t,r={})=>xt(e,t,b`
    <select name="${bt(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([n,i])=>b`<option value="${n}" ?selected="${(r.selected||N(e,t))==n}">${i}</option>`)}
    </select>
  `,r),Xl=(e,t,r={})=>xt(e,t,b`
    <input type="text" list="${e._meta.level}${e._meta.index}" name="${bt(e,t)}" ?readonly="${r.readonly}" class="${j(Ct(e,t)&&"invalid")}">
    <datalist id="${e._meta.level}${e._meta.index}">
      ${r.collection.map(([n,i])=>b`<option value="${n}">${i}</option>`)}
    </datalist>
  `,r),zl=(e,t,r={})=>{let n=_t(e.t)||{};switch(e.t){case be:let i={collection:[["t","True"],["f","False"],["i","Unset"]],selected:N(e,t,"i")};return hi(e,t,Object.assign(r,i));case we:case te:case ne:case le:case re:case ie:case ae:case ye:case xe:return tt(e,t,Object.assign(r,n));case Te:return et(e,t,r);default:return""}},Ql=["uuid","date-time","date","time","duration","email","idn-email","hostname","idn-hostname","ipv4","ipv6","uri","uri-reference","iri","iri-reference","uri-template","json-pointer","relative-json-pointer"],Ve=e=>e==0?"0":e,bt=(e,t)=>t,N=(e,t,r)=>(e.metadata||{})[t]||r,wt=e=>Math.max(0,e),Jl=e=>{let t,r=_t(e.t)||{};switch(e.t){case A:!e.referrers||e.referrers.length==0?t=[rt(e,"strict",{keyDisplay:"Strict"})]:t=[];break;case I:!e.referrers||e.referrers.length==0?t=[rt(e,"strict",{keyDisplay:"Strict"})]:t=[];break;case F:t=[Ge(e,"min",{keyDisplay:"Min Items",min:0,max:wt(N(e,"max"))}),Ge(e,"max",{keyDisplay:"Max Items",min:wt(N(e,"min",0))}),rt(e,"unique",{keyDisplay:"Item uniqueness"})];break;case W:t=[Ge(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),Ge(e,"max",{keyDisplay:"Max Items",value:e.schs.length,readonly:!0})];break;case G:t=[Ge(e,"min",{keyDisplay:"Min Properties",min:0,max:wt(N(e,"max"))}),Ge(e,"max",{keyDisplay:"Max Properties",min:wt(N(e,"min",0))})];break;case C:t=[et(e,"tagname",{keyDisplay:"Tag name",value:e.tagname})];break;case Te:t=[Ge(e,"min",{keyDisplay:"Min Length",min:0,max:wt(N(e,"max"))}),Ge(e,"max",{keyDisplay:"Max Length",min:wt(N(e,"min",0))}),et(e,"pattern",{keyDisplay:"String Pattern",maxlength:256}),Xl(e,"format",{collection:Ql.map(l=>[l,l]),keyDisplay:"Format"})];break;case we:t=[tt(e,"min",{keyDisplay:"Min",max:N(e,"max")}),tt(e,"max",{keyDisplay:"Max",min:N(e,"min")}),tt(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:Math.min(N(e,"max",r.max),r.max)})];break;case te:case ne:case le:case re:case ie:case ae:t=[tt(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:Math.min(N(e,"max",r.max),r.max)}),et(e,"format",{keyDisplay:"Format"})];break;case ye:case xe:t=[tt(e,"min",{keyDisplay:"Min",max:N(e,"max")}),tt(e,"max",{keyDisplay:"Max",min:N(e,"min")}),et(e,"format",{keyDisplay:"Format"})];break;case be:t=[];case $e:t=[];break;case U:e.schs.reduce((l,a)=>a.t==oe&&l,!0)?t=[rt(e,"asUnion",{keyDisplay:"As Union"})]:t=[];break;case it:t=[];case J:t=[];case oe:t=[];default:t=[]}let n=e._meta.parent.t==A,i=e._meta.level>2;if(n&&i)switch(!0){case(!N(e,"isKeyPattern")&&!N(e,"required")):t.push(rt(e,"required",{keyDisplay:"Required"}));break;case N(e,"isKeyPattern"):t.push(rt(e,"required",{keyDisplay:"Required",readonly:!0}));break;case N(e,"required"):t.push(rt(e,"required",{keyDisplay:"Required"}));break}return t},Ct=(e,t)=>e.errors&&e.errors[t];var Ti=e=>Xe(b`<ul role="tree"></ul>`,document.querySelector(e)),dr=(e,t,r={})=>{var n;try{let i={level:1,tab:((n=r.ui)==null?void 0:n.tab)||0,models:t._models||{},taggedLevel:t.taggedLevel||{}};i.rootLevel=i.level,Object.assign(i,r.ui),r.ui.lineClass&&Object.assign(i,{tab:r.ui.tab+2}),Zl(e,{sch:t,ui:i,path:t.path||"",key:t.key,parent:t})}catch(i){console.log(i)}},Zl=(e,t)=>Xe(b`
  <ul role="tree" aria-multiselectable="true" class="${`${t.ui.lineClass||""} text-sm`}" aria-labelledby="${tn(t.ui)+"_tree"}">
    ${Pt(t)}
  </ul>
  `,document.querySelector(e)),rn=e=>j(tn(e)),tn=e=>e.taggedLevel[e.level],yi=e=>{let t;if(!e)return"";for(let r of Object.keys(e))switch(r){case Pe:t="N";break;case je:t="R";break;case pe:t="M";break;case Le:t="O";break;case Ue:t="C";break;case me:t="C";break;case yt:t="C";break}return t||""},Pt=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Object.assign(e.ui,{expanded:!0}),ea(e);case[F].includes(e.sch.t):return e.sch.sch.hasOwnProperty("fields")||e.sch.sch.hasOwnProperty("schs")?Object.assign(e.ui,{expanded:!0}):Object.assign(e.ui,{expanded:!1}),xi(e);case(e.sch.hasOwnProperty("fields")||e.sch.hasOwnProperty("schs")):return Object.assign(e.ui,{expanded:!0}),xi(e);default:return ta(e)}},ea=e=>b`
  <li id="${e.path}" data-tag="${rn(e.ui)}" .key="${e.key}" .index="${0}" .sch=${e.sch} aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" id="${tn(e.ui)}_tree">
      ${nn(e.key)}
    </dfn>
    <ul data-group="${wi(e.sch)}" role="group" tabindex="-1">
      ${bi(e)}
    </ul>
  </li>`,xi=e=>b`
  <li id="${e.path}" data-tag="${rn(e.ui)}" .key="${e.key}" .index="${e.ui.index}" .sch=${e.sch} aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" data-diff="${yi(e.sch._diff)}" data-group-size="${ra(e.sch)}">
      ${gi(Object.assign(e,{key:nn(e.key)}))}
      ${Ni(e)}
    </dfn>
    ${_i(e)}
    <ul data-group="${wi(e.sch)}" role="group">
      ${bi(e)}
    </ul>
  </li>`,ta=e=>b`
  <li id="${e.path}" data-tag="${rn(e.ui)}" data-diff="${yi(e.sch._diff)}" .key="${e.key}" .index="${e.ui.index}" .sch=${e.sch} aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${gi(Object.assign(e,{key:nn(e.key)}))}
    ${Ni(e)}
  </li>
  ${_i(e)}
  `,_i=e=>{var t;return e.ui.inlineDocs?((t=e.sch.metadata)==null?void 0:t.description)&&b`<pre style="${na(e)}" class="inline-docs">${e.sch.metadata.description}</pre>`:Q},bi=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return Q;switch(!0){case[A,C].includes(e.sch.t):return ia(e);case[W,G,I].includes(e.sch.t):return la(e);case[F].includes(e.sch.t):return aa(e);case[U].includes(e.sch.t):return oa(e);default:return Q}},ia=e=>Me(e.sch.fields,t=>t.$a,(t,r)=>Pt({key:t.key,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[${t.key}]`})),la=e=>Me(e.sch.schs,t=>t.$a,(t,r)=>Pt({key:r,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),aa=e=>Me([e.sch.sch],t=>t.$a,(t,r)=>Pt({key:r,sch:e.sch.sch,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),oa=e=>Me(e.sch.schs,t=>t.$a,(t,r)=>Pt({key:"",sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),he=(e,t=0)=>`padding-left: ${(e.ui.level-1)*2+e.ui.tab-1+t}ch`,na=(e,t=0)=>{switch(!0){case e.parent.t==U:t=3.5;break;case e.parent.t==A:t=3.5;break;case e.parent.t==C:t=.5;break;default:t=1}return`padding-left: ${(e.ui.level-1)*2+e.ui.tab-1+t}ch`},vi=(e,t,r)=>b`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  data-newline="false"
  @input="${lt}"
  @focus="${Sn}"
  >${r}</textarea>`,gi=e=>e.ui.level==e.ui.rootLevel+1?sa(e):ca(e),sa=e=>b`
  <span class="def" style="${he(e)}">
    ${da(e.sch,e.ui)}
  </span>
  <span class="k">${ur(e)}</span>
  <span class="s">=</span>
  `,ca=e=>{var t,r;switch(!0){case e.parent.t==U:return b`
      <span class="s" style="${he(e,1)}">|</span>
      `;case(e.parent.t==G&&e.sch.$a==e.parent.schs[0].$a):return b`
      <span class="s" style="${he(e)}">k</span>
      `;case(e.parent.t==G&&e.sch.$a==e.parent.schs[1].$a):return b`
      <span class="s" style="${he(e)}">v</span>
      `;case(e.parent.t==I&&e.sch.$a==e.parent.schs[0].$a):return b`
      <span class="s" style="${he(e)}">e</span>
      `;case(e.parent.t==I&&e.sch.$a==e.parent.schs[1].$a):return b`
      <span class="s" style="${he(e)}">r</span>
      `;case e.parent.t==F:return b`
      <span class="s" style="${he(e)}">└</span>
      `;case e.parent.t==A:return b`
      <span class="k" style="${he(e,1)}" data-required="${!!((t=e.sch.metadata)==null?void 0:t.required)}" data-is-pattern="${!!((r=e.sch.metadata)==null?void 0:r.isKeyPattern)}">
        ${ur(e)}
      </span>
      <span class="s">:</span>
    `;case e.parent.t==C:return b`
      <span class="s" style="${he(e,.5)}">|</span>
      <span class="k tag">
        ${ur(e)}
      </span>
      <span class="s">·</span>
    `;default:return b`
      <span class="k" style="${he(e,1)}">
        ${ur(e)}
      </span >
      <span class="s">:</span>
    `}},ur=e=>e.sch.uiMode=="editKey"?vi("key-edit",e.ui.parentPath,e.key):b`${e.key}`,Ni=e=>e.ui.level==e.ui.rootLevel+1?ua(e):fa(e),ua=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):b`<span class="t">${ki(e)}</span>`,fa=e=>b`<span class="t">${ki(e)}</span>`,ki=e=>e.sch.uiMode=="editType"?b`<combo-box id="type_search" list="typesearch">
      ${vi("type-edit",e.ui.parentPath,ln(e.sch,e.ui))}
    </combo-box>`:b`${Ei(e.sch,e.ui)}`,ln=(e,t)=>{var r;switch(!0){case e.t==oe:return JSON.stringify(e.v);case e.t==J:return(r=t.models[e.$r])==null?void 0:r.display;default:return De(e.t)}},Ei=(e,t)=>{let r,n=e.metadata;switch(!0){case(e.t==A&&e.fields.length==0&&(n==null?void 0:n.strict)):r="{ empty }";break;case(e.t==A&&e.fields.length==0):r="{ any }";break;case(e.t==A&&(n==null?void 0:n.strict)):r="{ strict }";break;case e.t==A:r="{ \xA0 }";break;case(e.t==I&&(n==null?void 0:n.strict)):r="{ e | r strict }";break;case e.t==I:r="{ e | r }";break;case e.t==F:r=b`[\xa0 ${Ei(e.sch,t)} \xa0]`;break;case e.t==W:r="( \xA0 )";break;case e.t==G:r="dict";break;case e.t==U:r="||";break;case e.t==C:r=`|| ${(n==null?void 0:n.tagname)||e.tagname}`;break;case e.t==Te:r="string",(n==null?void 0:n.pattern)&&(r=b`${r} <span class="m pattern">/${n.pattern}/<span>`);break;case e.t==we:r="integer";break;case e.t==te:r="int_8";break;case e.t==ne:r="int_16";break;case e.t==le:r="int_32";break;case e.t==re:r="uint_8";break;case e.t==ie:r="uint_16";break;case e.t==ae:r="uint_32";break;case e.t==ye:r="float_32";break;case e.t==xe:r="float_64";break;case e.t==be:r="bool";break;case e.t==$e:r="nil";break;case e.t==it:r="any";break;case(e.t==J&&!!t.models[e.$r]):Ft(e,"_text",ln(e,t)),r=b`<span class="ref" ._a="${e.$r}">${e._text}</span >`;break;case(e.t==J&&e.$r==null):r=b`<span class="ref" title="Ref type">{ }</span>`;break;case e.t==J:r=b`<span class="ref notfound" title="Ref type">${`${e._text||e.$r} (#404)`}</span>`;break;case e.t==oe:r=b`<span class="value" title="Value type">${ln(e,t)}</span>`;break;default:r="# UNDEFINED_TYPE #"}return t.tText&&(r=t.tText(e,t)||r),r},nn=e=>e,wi=e=>{switch(!0){case[A,C].includes(e.t):return"keyed";case[W,U,I].includes(e.t):return"indexed";default:return"none"}},ra=e=>{switch(!0){case[A,C].includes(e.t):return e.fields.length;case[W,U,I].includes(e.t):return e.schs.length;case[F].includes(e.t):return 1;default:return 0}},da=(e,t)=>{let r;switch(!0){case e.t==A:r="record";break;case e.t==F:r="list";break;case e.t==W:r="tuple";break;case e.t==U:r="union";break;case e.t==C:r="tagged union";break;case e.t==I:r="extensible union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r};var{selectMultiNodeUpTo:$i,selectMultiNodeDownTo:Ai,selectMultiNodeUp:Si,selectMultiNodeDown:Di,selectUpEnd:Oi,selectDownEnd:Ii,selectUp:an,selectDown:on,selectRoot:Ri,selectLast:Mi}=Xt,Ci=({store:e,target:t,select:r,focus:n=!0,inlineDocs:i=!1})=>{Zt({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",$i],["shift-meta-ArrowDown",Ai],["shift-ArrowUp",Si],["shift-ArrowDown",Di],["meta-ArrowUp",Oi],["meta-ArrowDown",Ii],["ArrowUp",an],["ArrowDown",on],["Home",Ri],["End",Mi],["shift-+",se],["Enter",dt],["Delete",z],["meta-v",ce],["alt-ArrowUp",de],["alt-ArrowDown",ue]],textAreaKeyDownCmd:[["Enter",Ne],["Escape",kt]],view:l=>dr(t,l||e,{ui:{depthLimit:2,tab:0,modelTypeText:(a,o)=>"modu",typeText:(a,o)=>{if(a.t==T.RECORD)return"record";if(a.t==T.VALUE)return"value";if(a.t==T.TUPLE)return"tuple";if(a.t==T.UNION)return"union"},viewTypeTop:a=>""}}),opts:{focus:n,selectId:r}})},fr=(e={})=>{let{store:t,target:r}=e;Zt({store:t,target:r,treeKeyDownCmds:[["shift-meta-ArrowUp",$i],["shift-meta-ArrowDown",Ai],["shift-ArrowUp",Si],["shift-ArrowDown",Di],["meta-ArrowUp",Oi],["meta-ArrowDown",Ii],["ArrowUp",an],["ArrowDown",on],["Home",Ri],["End",Mi],["shift-+",se],["Enter",dt],["shift-Enter",ut],["Delete",z],["m",Et],["meta-x",He],["meta-c",Ye],["meta-v",ce],["shift-alt-ArrowUp",ve],["shift-alt-ArrowDown",ke],["alt-ArrowUp",de],["alt-ArrowDown",ue],["ArrowRight",$t],["ArrowLeft",At],["Escape",({tree:n})=>Re(n)],["d",Qt]],textAreaKeyDownCmd:[["Enter",Ne],["Escape",kt]],view:n=>dr(r,n||t,{ui:{lineClass:e.lineNumber||"setnu",inlineDocs:e.inlineDocs,tab:e.lineNumber?1:3,modelTypeText:(i,l)=>i.isEntry?"entrypoint":"type"}}),opts:{focus:e.focus,selectId:e.select}})},pr=({store:e,target:t,select:r,focus:n=!1})=>{Zt({store:e,target:t,treeKeyDownCmds:[["ArrowUp",an],["ArrowDown",on],["ArrowRight",$t],["ArrowLeft",At]],textAreaKeyDownCmd:[],view:i=>dr(t,i||e,{ui:{lineClass:"setnu",tab:3,modelTypeText:(l,a)=>l.isEntry?"entrypoint":"type"}}),opts:{focus:n,selectId:r}})},mr=({store:e,target:t,treeTarget:r})=>{let n=document.querySelector(t),i=document.querySelector(`${r} [role='tree']`);!n||!i||(g(e,"renderSchMeta",function(l){pa({tree:i,store:l||this,metaForm:t})}),e.renderSchMeta())},pa=({tree:e,store:t,metaForm:r})=>{let n=e.querySelectorAll("[role='treeitem'][aria-selected='true']");if(n.length==1){let i=H(t,n[0].id);i&&en(r,i,t)}},Pi=e=>Ti(e),ji=e=>mi(e);var{selectMultiNodeUpTo:Li,selectMultiNodeDownTo:Ui,selectMultiNodeUp:Vi,selectMultiNodeDown:Gi,selectUpEnd:ma,selectDownEnd:ha,selectUp:Ta,selectDown:ya,selectRoot:Fi,selectLast:xa}=Xt,qi=(e,t,r,n)=>{let i=t.closest("[data-tag='file']"),l=i==null?void 0:i.key;t.closest("[id='project']")?ba(e,l,r,n):t.closest("[id='fmodel']")&&wa(e,l,t,r,n)},ba=(e,t,r,n)=>{switch(r){case dt:case de:case ue:case Li:case Ui:case Vi:case Gi:case Fi:break;case se:case z:case ve:case ke:case Ne:case vt:case ma:case ha:case Ta:case ya:case xa:hr({projectStore:e,filename:t});break;case ce:e.render();break}},wa=(e,t,r,n,i)=>{switch(n){case Fi:case Li:case Ui:case Vi:case Gi:case de:case ue:case $t:case At:case kt:case dt:case ut:case He:case Ye:return}let l=It(e,t);switch(r.dataset.tag){case ee:switch(n){case se:case z:case ce:l._models=Ce(e),e.render();break}break;case q:switch(n){case Et:Ki(r,e,t),l.render();break;case z:l._models=Ce(e),e.render();break;case ve:case ke:Ki(r,e,t),l._models=Ce(e),l.render(),e.render();break;case Ne:l._models=Ce(e),l.render()}break}switch(n){case Qt:hr({projectStore:e,filename:t,inlineDocs:l.inlineDocs,focus:!0});break}l.renderSchMeta()},hr=e=>{let{projectStore:t,filename:r,fmodelname:n=null,focus:i=!1,inlineDocs:l}=e,a=It(t,r);if(a){if(g(t,"_currentFileStore",a),a._models=Ce(t),fr({store:a,target:"[id='fmodel']",select:n,focus:i,inlineDocs:l}),mr({store:a,target:"[id='fsch']",treeTarget:"[id='fmodel']"}),!window._treeClipboard){let o=document.querySelector("[id='fmodel'] [role='tree']");o._aria.clearClipboard(o)}}else if(t.fields.length==0){let o=document.querySelector("[id='fmodel'] [role='tree']");Pi("[id='fmodel']"),ji("[id='fsch']")}},Ki=(e,t,r)=>{e.dataset.tag==q&&zr(t,(n,i)=>(i.path!=`[${r}]${e.id}`&&n.isEntry&&delete n.isEntry,n))},Bi={update:({store:e,detail:t})=>{let{path:r,attrs:n}=t,i=ge(e,r,(l,a)=>fi(l,n));return i&&(e.render&&e.render(e),e.renderSchMeta&&e.renderSchMeta(e)),i}},Wi=e=>[se,z,Ne,ce,ve,ke,de,ue,z,Et].map(t=>t.name).includes(e);var{assign:Fe}=Object,Hi=(e,t)=>{var m,d,h,v,D,P;let r={},n=w=>{if(r[w])return r[w];for(let x of e.fields)for(let _ of x.fields)if(r[_.key]={file:x,fmodelOf:_},_.key==w)return r[w]},i={},l=w=>i[w]?i[w]:Oe(e,(x,_)=>{if(e.taggedLevel[_.level]==q&&_.path!="")return w.startsWith(_.path)?(i[w]=x,!0):!1},(x,_)=>(g(x,"_meta",_),x)),a=({$a:w,key:x,index:_,t:k})=>({$a:w,key:x,index:_,t:k}),o=w=>a(w),s=e._diffToRemote;if(!s)return;let c={};c.files=[],c.fmodels=[],c.subfmodels=[];for(let w of s){let x=e.taggedLevel[w._diff.meta.level];x==ht?c.project=w:x==ee?c.files.push(w):x==q?c.fmodels.push(w):c.subfmodels.push(w)}let p={},u={},y={},f={};u.files||(u.files={}),u.fmodels||(u.fmodels={}),y.files||(y.files={}),y.fmodels||(y.fmodels={}),p.files||(p.files={}),p.fmodels||(p.fmodels={}),f.files||(f.files={}),f.fmodels||(f.fmodels={}),c.project&&(p.project=o(c.project));for(let w=0;w<c.files.length;w++){let x=c.files[w],_=a(x),k=x._diff.meta.path;if(x._diff[Pe]){u.files[k]=_;for(let E of x.fields)u.fmodels[`[${x.key}][${E.key}]`]=Fe(E,{pa:_.$a})}else x._diff[je]?y.files[k]={$a:_.$a}:x._diff[Le]?_e(e.fields,(E,M)=>{f.files[`[${E.key}]`]=a(Object.assign(E,{index:M}))}):x._diff[pe]?console.log("project does not permit as parent for moving items"):(x._diff[Ue]&&(p.files[k]=_),x._diff[me]&&console.log("file type is always record, cannot be changed"))}for(let w=0;w<c.fmodels.length;w++){let x=c.fmodels[w],_=x._diff.meta.path,k=x._diff.meta.pa;if(x._diff[Pe])u.fmodels[_]=Fe(x,{pa:k});else if(x._diff[je])y.fmodels[_]={$a:x.$a,pa:k};else if(x._diff[Le]){let E=x._diff.meta.lpath[1];f.fmodels[`[${E.key}][${x.key}]`]||_e(E.fields,(M,L)=>{f.fmodels[`[${E.key}][${M.key}]`]={$a:M.$a,t:M.t,key:M.key,index:L,pa:E.$a}})}else if(x._diff[pe]){let{oldParent:E,newParent:M,oldPath:L,newPath:qe}=x._diff[pe],Ke,nt,jt,Be,Tr;switch(e.taggedLevel[E.level]){case ht:console.log("fmodel was not possible to be a file");break;case ee:Be=E,y.fmodels[L]={$a:x.$a,pa:Be.$a};break;case q:default:Be=E.lpath[1],Tr=E.lpath[2]||E,jt=`[${Be.key}][${Tr.key}]`,nt=((m=e._indices)==null?void 0:m[Tr.$a])||l(jt),p.fmodels[jt]=Fe(nt,{pa:Be.$a})}switch(e.taggedLevel[M.level]){case ee:Ke=M,nt=x,u.fmodels[qe]=Fe(nt,{pa:Ke.$a});break;default:console.log("fmodel parent can only be file tag")}}u.fmodels[_]||y.fmodels[_]||(x._diff[Ue]||x._diff[me]||x._diff[yt])&&(p.fmodels[_]=Fe(x,{pa:k}))}for(let w=0;w<c.subfmodels.length;w++){let x,_,k,E,M,L=c.subfmodels[w];if(L._diff[Pe]||L._diff[je]||L._diff[Le]||L._diff[Ue]||L._diff[me])E=L._diff.meta.lpath[1],M=L._diff.meta.lpath[2],k=`[${E.key}][${M.key}]`,!u.fmodels[k]&&!y.fmodels[k]&&(_=((d=e._indices)==null?void 0:d[M.$a])||l(k),(h=p.fmodels)[k]||(h[k]=Fe(_,{pa:E.$a})));else if(L._diff[pe]){let{oldParent:qe,newParent:Ke,oldPath:nt,newPath:jt}=L._diff[pe];switch(e.taggedLevel[qe.level]){case ht:console.log("subfmodel was not possible to be a file");break;case ee:E=qe,y.fmodels[nt]={$a:L.$a,pa:E.$a};break;case q:default:E=qe.lpath[1],M=qe.lpath[2]||qe,k=`[${E.key}][${M.key}]`,_=((v=e._indices)==null?void 0:v[M.$a])||l(k),(D=p.fmodels)[k]||(D[k]=Fe(_,{pa:E.$a}))}switch(e.taggedLevel[Ke.level]){case ht:console.log("subfmodel parent can only be fmodel or subfmodel");break;case ee:console.log("subfmodel parent can only be fmodel or subfmodel");break;case q:default:x=Ke.lpath[1],_=Ke.lpath[2]||qt(x.fields,Be=>Ke.key==Be.key),k=`[${x.key}][${_.key}]`,(P=p.fmodels)[k]||(P[k]=Fe(_,{pa:x.$a}))}}}return console.log({added:u,changed:p,removed:y,reorder:f,type:"diff_to_persist"}),t({changed:p,added:u,removed:y,reorder:f})};var _a={createProjectStore:ri,getFileStore:It,anchorsModels:Ce,projectToStore:Xn,fileToStore:Tt,controller:qi,mergeSchMetas:Qn,mergeReferrers:Zn,changeFile:hr,taggedDiff:Hi,isDiffableCmd:Wi,SchMeta:Bi,allSchs:Yr,rulesTable:Hr},ga={rFmodelTree:pr};export{sr as Diff,fr as FmodelTree,_a as Project,Ci as ProjectTree,mr as SchMetaForm,ga as View,Gt as legitTs,pr as rFmodelTree,De as tstr};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
