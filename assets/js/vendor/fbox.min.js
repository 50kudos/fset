var jr=Object.defineProperty;var Tt=(e,t)=>{for(var r in t)jr(e,r,{get:t[r],enumerable:!0})};var xe,Ur=new Uint8Array(16);function Be(){if(!xe&&(xe=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!xe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xe(Ur)}var xt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Kr(e){return typeof e=="string"&&xt.test(e)}var _t=Kr;var w=[];for(var Fe=0;Fe<256;++Fe)w.push((Fe+256).toString(16).substr(1));function qr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(w[e[t+0]]+w[e[t+1]]+w[e[t+2]]+w[e[t+3]]+"-"+w[e[t+4]]+w[e[t+5]]+"-"+w[e[t+6]]+w[e[t+7]]+"-"+w[e[t+8]]+w[e[t+9]]+"-"+w[e[t+10]]+w[e[t+11]]+w[e[t+12]]+w[e[t+13]]+w[e[t+14]]+w[e[t+15]]).toLowerCase();if(!_t(r))throw TypeError("Stringified UUID is invalid");return r}var bt=qr;function Wr(e,t,r){e=e||{};var l=e.random||(e.rng||Be)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=l[n];return t}return bt(l)}var He=Wr;var T="record",g="list",b="tuple",L="string",P="number",_e="integer",j="boolean",G="null",_="union",J="any",M="ref",D="value",Nt=[T,b,g,_],C="fmodel",K=()=>({type:J}),Et=()=>({type:L}),wt=()=>({type:j}),vt=()=>({type:P}),$t=()=>({type:G}),Ye=()=>({type:T,fields:{},order:[]}),gt=()=>({type:g,sch:k(K)}),kt=()=>({type:b,schs:[k(K)]}),St=()=>({type:_,schs:[k(K)]}),Ot=e=>({type:M,$ref:e}),Ve=e=>{try{return e=JSON.parse(e),e==null||[L,P,j].includes(typeof e)?{type:D,const:e}:!1}catch(t){return!1}},k=(e,t,r={force:!1})=>{let l=e();return l.$anchor||(l.$anchor=He()),r.force&&(l.$anchor=He()),t==C&&delete l._tag,l};var be=e=>{let t=JSON.parse(JSON.stringify(e));return R(t,(r,l)=>k(()=>r,null,{force:!0})),t},N=e=>R(JSON.parse(JSON.stringify(e)),(t,r)=>{let{type:l,$anchor:n,key:a,_tag:s}=t,d={type:l,$anchor:n,key:a,_tag:s};switch(t.type){case T:let{fields:o,order:c}=t;return Object.assign(d,{fields:o,order:c});case b:case _:let{schs:f}=t;return Object.assign(d,{schs:f});case g:let{sch:u}=t;return Object.assign(d,{sch:u});case D:let{const:x}=t;return Object.assign(d,{const:x});case M:let{$ref:h}=t;return Object.assign(d,{$ref:h});default:return Object.assign(d,{})}}),R=(e,t,r={path:"",level:1,parent:{}})=>{if(e._halt=!1,e=t(e,r),e._halt)return e;let l=({_tag:n,type:a,$anchor:s,key:d},{path:o,parent:{prune:c}})=>({_tag:n,type:a,$anchor:s,key:d,path:o,prune:c});switch(!0){case[T].includes(e.type):let n=Object.keys(e.fields);for(let d=e.order.length-1;d>=0;d--){let o=e.order[d],c=e.fields[o],f={path:`${r.path}[${o}]`,level:r.level+1,index:d,parent:l(e,r)};if(c=R(c,t,f),c.key=o,e.fields[o]=c,c._halt)return Object.assign(e,{_halt:!0})}break;case[b,_].includes(e.type):for(let d=0;d<e.schs.length;d++){let o=e.schs[d],c={path:`${r.path}[][${d}]`,level:r.level+1,index:d,parent:l(e,r)};if(o=R(o,t,c),e.schs[d]=o,o._halt)return Object.assign(e,{_halt:!0})}break;case[g].includes(e.type):let a={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:l(e,r)},s=R(e.sch,t,a);if(e.sch=s,s._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Gr=(e,t,r)=>{let l={original:{},popped:[]},n=r.sort((a,s)=>s-a);return R(e,(a,s)=>{if(s.path!=t)return a;switch(a.type){case T:let d=n.map(o=>[o,a.order[o]]).filter(([o,c])=>c);for(let[o,c]of d)l.popped.unshift({k:c,sch:a.fields[c],index:o}),delete a.fields[c];for(let o of n)a.order.splice(o,1);break;case g:break;case b:for(let o of n)l.popped.unshift({k:o,sch:a.schs.splice(o,1)[0],index:o});a.schs.length==0&&a.schs.splice(0,0,k(K));break;case _:for(let o of n)l.popped.unshift({k:o,sch:a.schs.splice(o,1)[0],index:o});a.schs.length==0&&a.schs.splice(0,0,k(K));break;default:}return a}),l},Br=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),Ne=(e,t,r)=>{let l={original:{},inserted:[]},n=r.sort((s,d)=>s.index-d.index),a=(s,d)=>(s=Math.max(s,0),s=Math.min(s,d.length),s);return R(e,(s,d)=>{if(d.path!=t)return s;switch(s.type){case T:for(let{k:o,sch:c,index:f}of n){for(o=o==0?"0":o,o=o||`${c()._tag||"key"}_${Math.floor(Date.now()/100)}`,o=`${o}`;s.fields[o];)o=`${o} \u2013`;f=a(f,s.order),s.fields[o]=k(c,s._tag),s.order.splice(f,0,o),l.inserted.push({k:o,sch:s.fields[o],index:f})}break;case g:break;case b:for(let{k:o,sch:c,index:f}of n)f=a(f,s.schs),s.schs.splice(f,0,k(c,s._tag)),l.inserted.push({k:o,sch:s.schs[f],index:f});break;case _:for(let{k:o,sch:c,index:f}of n)f=a(f,s.schs),s.schs.splice(f,0,k(c,s._tag)),l.inserted.push({k:o,sch:s.schs[f],index:f});default:}return s}),l},we=(e,{dstPath:t,startIndex:r=0},l)=>{let n=(o,c,f)=>B(o,c,(u,x)=>(u._pinId=f,u)),a=Symbol(t);n(e,t,a);let s=Ee(e,l,{dstPath:t});return Je(e,{dstPin:a,startIndex:r},s)},Ee=(e,t,r={})=>{let l={},n=Br(Object.keys(t));for(let a of n){let s=t[a],d=f=>{var u;return(u=s.find(x=>x.index==f))==null?void 0:u.newK};if(r.dstPath&&s.filter(u=>r.dstPath.startsWith(u.id)).length!=0)continue;let c=Gr(e,a,s.map(f=>f.index)).popped.map(({k:f,sch:u,index:x})=>({k:d(x)||f,sch:()=>u}));l[a]=c}return l},Je=(e,{dstPin:t,dstPath:r,startIndex:l=0},n)=>{let a=(c,f)=>z(c,(u,x)=>u._pinId==f,(u,x)=>(u._pinned=x,u));l=Math.max(l,0);let s={},d=Object.values(n).flatMap(c=>c).map((c,f)=>({...c,index:l+f}));if(t){let c=a(e,t);c&&(r=c._pinned.path)}let o=Ne(e,r,d);return o.inserted.length!=0&&(s[r]=o.inserted),s},Xe=(e,{dstPath:t,startIndex:r=0},l)=>{let n=ze(e,l,{dstPath:t,startIndex:r});return Qe(e,{dstPath:t},n)},ze=(e,t,r={})=>Object.values(t).reduce((l,n)=>{let a=n.map(d=>d.id),s=[];z(e,(d,o)=>(a.includes(o.path)&&(d._meta=o,s.unshift(d)),s.length==a.length),(d,o)=>d);for(let d of n){if(r.dstPath&&r.dstPath.startsWith(d.id))continue;let o=s.find(c=>c._meta.path==d.id);o&&l.unshift({k:d.key,sch:()=>be(o),index:r.startIndex+l.length,id:d.id})}return l},[]),Qe=(e,{dstPath:t},r)=>{let l={},n=Ne(e,t,r);return n.inserted.length!=0&&(l[t]=n.inserted),l},ve=(e,t,r)=>B(e,t,(l,n)=>{let a=k(r,n.parent._tag);switch(!0){case a.type==M:case a.type==D:case a.type!=l.type:let{title:s,description:d,rw:o,required:c,$anchor:f}=l;return Object.assign(a,{title:s,description:d,rw:o,required:c,$anchor:f}),a;default:return l}}),Q=(e,t)=>z(e,(r,l)=>l.path==t,(r,l)=>(r._meta=l,r)),B=(e,t,r)=>z(e,(l,n)=>n.path==t,r),z=(e,t,r)=>{let l;return R(e,(n,a)=>t(n,a)?(l=r(n,a),l._halt=!0,l):n),l&&(l._halt=!1),l};var le=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var At=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,Fr=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Hr=/<[a-z][^>]+$/i,Yr=/>[^<>]*$/,Vr=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,Jr=/\s+$/,Dt=(e,t)=>0<t--&&(Hr.test(e[t])||!Yr.test(e[t])&&Dt(e,t)),zr=(e,t,r)=>Fr.test(t)?e:`<${t}${r.replace(Jr,"")}></${t}>`,Mt=(e,t,r)=>{let l=[],{length:n}=e;for(let s=1;s<n;s++){let d=e[s-1];l.push(At.test(d)&&Dt(e,s)?d.replace(At,(o,c,f)=>`${t}${s-1}=${f||'"'}${c}${f?"":'"'}`):`${d}<!--${t}${s-1}-->`)}l.push(e[n-1]);let a=l.join("").trim();return r?a:a.replace(Vr,zr)};var{isArray:X}=Array,{indexOf:Rt,slice:$e}=[];var Qr=1,Ct=111,Xr=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},It=(e,t)=>e.nodeType===Ct?1/t<0?t?Xr(e):e.lastChild:t?e.valueOf():e.firstChild:e,Lt=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let l=$e.call(t,0),n=l[0],a=l[r-1];return{ELEMENT_NODE:Qr,nodeType:Ct,firstChild:n,lastChild:a,valueOf(){if(t.length!==r){let s=0;for(;s<r;)e.appendChild(l[s++])}return e}}};var Pt=(e,t,r,l,n)=>{let a=r.length,s=t.length,d=a,o=0,c=0,f=null;for(;o<s||c<d;)if(s===o){let u=d<a?c?l(r[c-1],-0).nextSibling:l(r[d-c],0):n;for(;c<d;)e.insertBefore(l(r[c++],1),u)}else if(d===c)for(;o<s;)(!f||!f.has(t[o]))&&e.removeChild(l(t[o],-1)),o++;else if(t[o]===r[c])o++,c++;else if(t[s-1]===r[d-1])s--,d--;else if(t[o]===r[d-1]&&r[c]===t[s-1]){let u=l(t[--s],-1).nextSibling;e.insertBefore(l(r[c++],1),l(t[o++],-1).nextSibling),e.insertBefore(l(r[--d],1),u),t[s]=r[d]}else{if(!f){f=new Map;let u=c;for(;u<d;)f.set(r[u],u++)}if(f.has(t[o])){let u=f.get(t[o]);if(c<u&&u<d){let x=o,h=1;for(;++x<s&&x<d&&f.get(t[x])===u+h;)h++;if(h>u-c){let S=l(t[o],0);for(;c<u;)e.insertBefore(l(r[c++],1),S)}else e.replaceChild(l(r[c++],1),l(t[o++],-1))}else o++}else e.removeChild(l(t[o++],-1))}return r};var jt=e=>t=>{for(let r in t){let l=r==="role"?r:`aria-${r}`,n=t[r];n==null?e.removeAttribute(l):e.setAttribute(l,n)}},Ut=(e,t)=>{let r,l=!0,n=document.createAttributeNS(null,t);return a=>{r!==a&&(r=a,r==null?l||(e.removeAttributeNode(n),l=!0):(n.value=a,l&&(e.setAttributeNodeNS(n),l=!1)))}},Kt=(e,t,r)=>l=>{r!==!!l&&((r=!!l)?e.setAttribute(t,""):e.removeAttribute(t))},Zr=({dataset:e})=>t=>{for(let r in t){let l=t[r];l==null?delete e[r]:e[r]=l}},qt=(e,t)=>{let r,l=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(l=l.toLowerCase()),n=>{let a=X(n)?n:[n,!1];r!==a[0]&&(r&&e.removeEventListener(l,r,a[1]),(r=a[0])&&e.addEventListener(l,r,a[1]))}},Wt=e=>t=>{typeof t=="function"?t(e):t.current=e},Gt=(e,t)=>t==="dataset"?Zr(e):r=>{e[t]=r},Bt=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var el=function(e){"use strict";var t="fragment",r="template",l="content"in s(r),n=l?function(o){var c=s(r);return c.innerHTML=o,c.content}:function(o){var c=s(t),f=s(r),u=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(o)){var x=RegExp.$1;f.innerHTML="<table>"+o+"</table>",u=f.querySelectorAll(x)}else f.innerHTML=o,u=f.childNodes;return a(c,u),c};return function(c,f){return(f==="svg"?d:n)(c)};function a(o,c){for(var f=c.length;f--;)o.appendChild(c[0])}function s(o){return o===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",o)}function d(o){var c=s(t),f=s("div");return f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+o+"</svg>",a(c,f.firstChild.childNodes),c}}(document),Ze=el;var Ft=({childNodes:e},t)=>e[t],ge=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(Rt.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:Ht,importNode:ke}=document;var Yt=ke.length!=1,Vt=Yt?(e,t,r)=>ke.call(document,Ze(e,t,r),!0):Ze,Jt=Yt?e=>Ht.call(document,e,1|128,null,!1):e=>Ht.call(document,e,1|128);var ne=(e,t,r)=>Pt(e.parentNode,t,r,It,e),tl=e=>{let t,r,l=[],n=a=>{switch(typeof a){case"string":case"number":case"boolean":t!==a&&(t=a,r?r.textContent=a:r=document.createTextNode(a),l=ne(e,l,[r]));break;case"object":case"undefined":if(a==null){t!=a&&(t=a,l=ne(e,l,[]));break}if(X(a)){t=a,a.length===0?l=ne(e,l,[]):typeof a[0]=="object"?l=ne(e,l,a):n(String(a));break}"ELEMENT_NODE"in a&&t!==a&&(t=a,l=ne(e,l,a.nodeType===11?$e.call(a.childNodes):[a]))}};return n},rl=(e,t)=>{switch(t[0]){case"?":return Kt(e,t.slice(1),!1);case".":return Gt(e,t.slice(1));case"o":if(t[1]==="n")return qt(e,t)}switch(t){case"ref":return Wt(e);case"aria":return jt(e)}return Ut(e,t)};function zt(e){let{type:t,path:r}=e,l=r.reduceRight(Ft,this);return t==="node"?tl(l):t==="attr"?rl(l,e.name):Bt(l)}var ae="is\xB5",Qt=le(new WeakMap),ll=/^(?:plaintext|script|style|textarea|title|xmp)$/i,Z=()=>({stack:[],entry:null,wire:null}),al=(e,t)=>{let{content:r,updates:l}=nl(e,t);return{type:e,template:t,content:r,updates:l,wire:null}},il=(e,t)=>{let r=Mt(t,ae,e==="svg"),l=Vt(r,e),n=Jt(l),a=[],s=t.length-1,d=0,o=`${ae}${d}`;for(;d<s;){let c=n.nextNode();if(!c)throw`bad template: ${r}`;if(c.nodeType===8)c.textContent===o&&(a.push({type:"node",path:ge(c)}),o=`${ae}${++d}`);else{for(;c.hasAttribute(o);)a.push({type:"attr",path:ge(c),name:c.getAttribute(o)}),c.removeAttribute(o),o=`${ae}${++d}`;ll.test(c.tagName)&&c.textContent.trim()===`<!--${o}-->`&&(c.textContent="",a.push({type:"text",path:ge(c)}),o=`${ae}${++d}`)}}return{content:l,nodes:a}},nl=(e,t)=>{let{content:r,nodes:l}=Qt.get(t)||Qt.set(t,il(e,t)),n=ke.call(document,r,!0),a=l.map(zt,n);return{content:n,updates:a}},ie=(e,{type:t,template:r,values:l})=>{let{length:n}=l;Xt(e,l,n);let{entry:a}=e;(!a||a.template!==r||a.type!==t)&&(e.entry=a=al(t,r));let{content:s,updates:d,wire:o}=a;for(let c=0;c<n;c++)d[c](l[c]);return o||(a.wire=Lt(s))},Xt=({stack:e},t,r)=>{for(let l=0;l<r;l++){let n=t[l];n instanceof Se?t[l]=ie(e[l]||(e[l]=Z()),n):X(n)?Xt(e[l]||(e[l]=Z()),n,n.length):e[l]=null}r<e.length&&e.splice(r)};function Se(e,t,r){this.type=e,this.template=t,this.values=r}var{create:ol,defineProperties:sl}=Object,Zt=e=>{let t=le(new WeakMap),r=l=>(n,...a)=>ie(l,{type:e,template:n,values:a});return sl((l,...n)=>new Se(e,l,n),{for:{value(l,n){let a=t.get(l)||t.set(l,ol(null));return a[n]||(a[n]=r(Z()))}},node:{value:(l,...n)=>ie(Z(),{type:e,template:l,values:n}).valueOf()}})},er=le(new WeakMap),Oe=(e,t)=>{let r=typeof t=="function"?t():t,l=er.get(e)||er.set(e,Z()),n=r instanceof Se?ie(l,r):r;return n!==l.wire&&(l.wire=n,e.textContent="",e.appendChild(n.valueOf())),e},m=Zt("html"),Zn=Zt("svg");var oe=(e,t)=>JSON.stringify(e)==JSON.stringify(t),Ae=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`};var tr=(e,t)=>{e.errors={},e.changes={},De(e,"title",t),De(e,"description",t),dl(e,"rw",["rw","r","w"],t),et(e,"required",t),cl(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e[r]=e.changes[r]);return e},cl=(e,t)=>{e.type==T?yl(e,t):e.type==g?hl(e,t):e.type==b?Tl(e,t):e.type==_?xl(e,t):e.type==L?fl(e,t):e.type==P?ul(e,t):e.type==j?pl(e,t):e.type==G&&ml(e,t)},fl=(e,t)=>{_l(e,"pattern",t),U(e,"min",t,{min:0}),U(e,"max",t,{min:0}),se(e,t),De(e,"default",t,Object.assign(rr(e,["min","max","pattern"]),{ignoreEmpty:!0}))},pl=(e,t)=>{et(e,"default",t)},ul=(e,t)=>{Me(e,"min",t),Me(e,"max",t),U(e,"multipleOf",t),se(e,t),Me(e,"default",t,rr(e,["min","max","multipleOf"]))},ml=(e,t)=>{bl(e,"default",t)},yl=(e,t)=>{U(e,"min",t,{min:0}),U(e,"max",t,{min:0}),se(e,t)},hl=(e,t)=>{U(e,"min",t,{min:1}),U(e,"max",t,{min:1}),se(e,t),et(e,"unique",t)},Tl=(e,t)=>{U(e,"min",t,{min:1}),U(e,"max",t,{min:1}),se(e,t)},xl=(e,t)=>{},rr=(e,t=[])=>{let r={};for(let l of t)(e.errors[l]||[]).length==0&&(typeof e.changes[l]=="number"?(e.changes[l]||e.changes[l]==0)&&(r[l]=e.changes[l]):r[l]=e.changes[l]);return r},De=(e,t,r,l={})=>{if(!r.hasOwnProperty(t)||l.ignoreEmpty&&r[t]=="")return;let n=r[t],a=2**18;(d=>new Blob([d]).size)(n)>a?v(e,t,`string size limit is ${Math.ceil(a/1024)} KB`):l.max&&n.length>l.max?v(e,t,`must be less than or equal ${l.max} length`):l.min&&n.length<l.min?v(e,t,`must be grater than or equal ${l.min} length`):l.pattern?new RegExp(l.pattern).test(n)||v(e,t,`must matche pattern ${l.pattern}`):e.changes[t]=n},et=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let l=Nl(r[t]);l==null?v(e,t,"must be boolean"):e.changes[t]=l},Me=(e,t,r,l={})=>{if(!r.hasOwnProperty(t))return;let n=tt(r[t]);!n&&n!=0?v(e,t,"must be number"):l.min&&n<l.min?v(e,t,`must be greater than or equal ${l.min}`):l.max&&n>l.max?v(e,t,`must be less than than or equal ${l.max}`):l.multipleOf&&n%l.multipleOf!=0?v(e,t,`must be multiple of ${l.multipleOf}`):e.changes[t]=n},U=(e,t,r,l)=>{if(!r.hasOwnProperty(t))return;Me(e,t,r,l);let n=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?v(e,t,"must be integer number"):n>Number.MAX_SAFE_INTEGER?v(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):n<Number.MIN_SAFE_INTEGER&&v(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},_l=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(De(e,t,r),(e.errors[t]||[]).length==0))try{let l=r[t];if(l=="")return;e.changes[t]=new RegExp(l)}catch(l){v(e,t,"invalid regex")}},se=(e,t)=>{if(t.min&&t.max){let r=tt(t.min),l=tt(t.max);(r||r==0)&&(l||l==0)&&r>l&&(v(e,"min","min is greater than max"),v(e,"max","max is less than min"))}},bl=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?v(e,t,"must be null"):e.changes[t]=r[t])},dl=(e,t,r,l)=>{!l.hasOwnProperty(t)||(r.includes(l[t])?e.changes[t]=l[t]:v(e,t,"value must be r, w, or rw"))},v=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},tt=e=>lr(e,"number"),Nl=e=>lr(e,"boolean");var lr=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=a=>["checkbox","radio"].includes(a.type)?a.checked:a.value,r=this.querySelector("form").elements,l={};for(let a=0;a<r.length;a++){let s=t(r[a]);!(r[a]instanceof HTMLTextAreaElement)&&s==""||(l[r[a].name]=s)}let n={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:l};this.dispatchEvent(new CustomEvent("sch-update",{detail:n,bubbles:!0}))}}});var Ce=(e,t,r)=>{try{Oe(e,m.for(t)`
    <p>${t.displayKey}</p>
    <form data-path="${t.path}" data-file="${t.rootKey}">
      ${Re(t,"title",{keyDisplay:"Title"})}
      ${Re(t,"description",{keyDisplay:"Description"})}
      ${vl(t)}
      ${El(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:"rw",keyDisplay:"Read / Write"})}
      ${wl(t,"default",{keyDisplay:"Default"})}
    </form>
  `)}catch(l){}},ce=(e,t,r,l={})=>{var n;return m`
  <label class="${l.readonly&&`meta-box ${t} readonly`||`meta-box ${t}`}">
    <p class="l">${l.keyDisplay||t} ${l.readonly&&m`<span>· readonly</span>`}</p>
    ${r}
    ${(n=Ie(e,t))==null?void 0:n.map(a=>m`<p class="err">${a}</p>`)}
  </label>
  `},Re=(e,t,r={})=>ce(e,t,m`
    <textarea name="${de(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${Ie(e,t)&&"invalid"}" oninput="${Ae}">${e[t]||r.value}</textarea>
  `,r),Le=(e,t,r={})=>ce(e,t,m`
    <input type="number" name="${de(e,t)}" inputmode="decimal" step="any" min="${r.min}" max="${r.max}" value="${e[t]||r.value}" ?readonly="${r.readonly}" class="${Ie(e,t)&&"invalid"}">
  `,r),q=(e,t,r={})=>ce(e,t,m`
    <input type="number" name="${de(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${e[t]||r.value}" ?readonly="${r.readonly}" class="${Ie(e,t)&&"invalid"}">
  `,r),rt=(e,t,r={})=>ce(e,t,m`
    <input type="checkbox" name="${de(e,t)}" ?disabled="${r.readonly}" ?checked="${e[t]||r.value}">
  `,r),El=(e,t,r={})=>ce(e,t,m`
    <select name="${de(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([l,n])=>m`<option value="${l}" ?selected="${(e[t]||r.selected)==l}">${n}</option>`)}
    </select>
  `,r),wl=(e,t,r={})=>{switch(e.type){case j:return rt(e,t,r);case P:return Le(e,t,r);case L:return Re(e,t,r);default:return""}},de=(e,t)=>t,vl=e=>{let t;switch(!0){case e.type==T:t=[q(e,"min",{keyDisplay:"Min Properties",value:Object.keys(e.fields).length,readonly:!0}),q(e,"max",{keyDisplay:"Max Properties",value:Object.keys(e.fields).length,readonly:!0})];break;case e.type==g:t=[q(e,"min",{keyDisplay:"Min Items",min:1,value:1}),q(e,"max",{keyDisplay:"Max Items",min:1}),rt(e,"unique",{keyDisplay:"Item uniqueness"})];break;case e.type==b:t=[q(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),q(e,"max",{keyDisplay:"Max Items",value:e.max||e.schs.length})];break;case e.type==L:t=[q(e,"min",{keyDisplay:"Min Length",min:0}),q(e,"max",{keyDisplay:"Max Length",min:0}),Re(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case e.type==P:t=[Le(e,"min",{keyDisplay:"Min"}),Le(e,"max",{keyDisplay:"Max"}),Le(e,"multipleOf",{keyDisplay:"Multiple of",min:1})];break;case e.type==_e:t=[];case e.type==j:t=[];case e.type==G:t=[];case e.type==_:t=[];case e.type==J:t=[];case e.type==M:t=[];case e.type==D:t=[];default:t=[]}return e._meta.parent.type==T&&e._meta.parent._tag!="file"&&t.push(rt(e,"required",{keyDisplay:"Required"})),t};var Ie=(e,t)=>e.errors&&e.errors[t];var nr=(e,t,r={})=>{try{let l=t._models||t.order.reduce((a,s)=>(a[t.fields[s].$anchor]=s,a),{}),n={level:1,tab:0,models:l,rootTag:t._tag,rootKey:t.key};$l(e,{sch:t,ui:Object.assign(n,r.ui),path:t.path||"",key:t.key,parent:{type:t.type,_tag:t._tag}})}catch(l){console.log(l)}},$l=(e,t)=>Oe(document.querySelector(e),m`
  <theme>
    <ul role="tree" aria-multiselectable="true" class="text-sm" tabindex="-1">
      ${fe(t)}
    </ul>
  </theme>
  ${null}
`);var fe=e=>{switch(!0){case e.sch._tag==e.ui.rootTag:return gl(e);case Nt.includes(e.sch.type):return kl(e);default:return Sl(e)}},gl=e=>m.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._tag}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${lt(e.key)}
    </dfn>
    <ul data-group="${ir(e.sch)}" role="group">
      ${ar(e)}
    </ul>
  </li>`,kl=e=>m.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._tag}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h">
      ${or(Object.assign(e,{key:lt(e.key)}))}
      ${sr(e)}
      ${cr(e)}
    </dfn>
    <ul data-group="${ir(e.sch)}" role="group">
      ${ar(e)}
    </ul>
  </li>`,Sl=e=>m.for(e.sch,e.ui.rootKey+e.path)`
  <li id="${e.path}" .dataset="${{tag:e.sch._tag}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${or(Object.assign(e,{key:lt(e.key)}))}
    ${sr(e)}
    ${cr(e)}
  </li>`,ar=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return m``;switch(!0){case[T].includes(e.sch.type):return Ol(e);case[b].includes(e.sch.type):return Al(e);case[g].includes(e.sch.type):return Dl(e);case[_].includes(e.sch.type):return Ml(e);default:return m``}},Ol=e=>e.sch.order.map((t,r)=>fe({key:t,sch:e.sch.fields[t],parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[${t}]`})),Al=e=>e.sch.schs.map((t,r)=>fe({key:r,sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Dl=e=>fe({key:0,sch:e.sch.sch,parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:0},path:`${e.path}[][${0}]`}),Ml=e=>e.sch.schs.map((t,r)=>fe({key:"",sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path,_tag:e.sch._tag},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Pe=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab}rem`,dr=(e,t,r)=>m`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="256" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${Ae}"
  >${r}</textarea>`,or=e=>e.parent._tag==e.ui.rootTag?Rl(e):Cl(e),Rl=e=>m`
  <span class="def" style="${Pe(e)}">
    ${Il(e.sch,e.ui)}
  </span>
  <span class="k">${fr(e)}</span>
  <span class="s">=</span>
  `,Cl=e=>{switch(!0){case e.parent.type==_:return m`
      <span class="" style="${Pe(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==g:return m`
      <span class="k" style="${Pe(e)}"></span>
      <span class="s">└</span>
      `;default:return m`
      <span class="k" style="${Pe(e)}">
        ${fr(e)}
      </span >
      <span class="s">:</span>
    `}},fr=e=>e.sch.uiMode=="editKey"?dr("key-edit",e.parent.path,e.key):m`${e.key}`,sr=e=>e.parent._tag==e.ui.rootTag?Ll(e):Pl(e),Ll=e=>e.ui.viewTypeRoot?e.ui.viewTypeRoot(e):m`<span class="t">${pr(e)}</span>`,Pl=e=>m`<span class="t">${pr(e)}</span>`,pr=e=>e.sch.uiMode=="editType"?dr("type-edit",e.parent.path,jl(e.sch,e.ui)):m`${ur(e.sch,e.ui)}`,jl=(e,t)=>{switch(!0){case e.type==D:return JSON.stringify(e.const);case e.type==M:return t.models[e.$ref];default:return e.type}},ur=(e,t)=>{let r;switch(!0){case(e.type==T&&oe(e.fields,{})):r="{ any }";break;case e.type==T:r="{ \xA0 }";break;case e.type==g:r=m`[ ${ur(e.sch,t)} ]`;break;case e.type==b:r="( \xA0 )";break;case e.type==L:r="string";break;case e.type==P:r="number";break;case e.type==_e:r="integer";break;case e.type==j:r="bool";break;case e.type==G:r="null";break;case e.type==_:r="||";break;case e.type==J:r="any";break;case(e.type==M&&!!t.models[e.$ref]):r=m`<span class="ref">${e._text=t.models[e.$ref]}</span>`;break;case e.type==M:r=m`<span class="ref notfound" title="Ref type">${`${e._text} (#404)`}</span>`;break;case e.type==D:r=m`<span class="value" title="Value type">${JSON.stringify(e.const)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},lt=e=>e,ir=e=>{switch(!0){case[T].includes(e.type):return"keyed";case[b,_].includes(e.type):return"indexed";default:return"none"}},Il=(e,t)=>{let r;switch(!0){case e.type==T:r="record";break;case e.type==g:r="list";break;case e.type==b:r="tuple";break;case e.type==_:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},cr=e=>{let t;switch(!0){case(e.parent.type==T&&e.sch.required):t=[m`<span class="m"> · required</span>`];break;default:t=[]}return t};var nt={};Tt(nt,{clearClipboard:()=>pe,createWalker:()=>mr,findUnselectedNode:()=>Ue,reselectNodes:()=>Ke,selectMultiNode:()=>te,selectMultiNodeTo:()=>je,selectNode:()=>$,selectedGroupedByParent:()=>F,toggleSelectNode:()=>Tr});var I="aria-selected",mr=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.hasAttribute(I)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),e),$=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,yr(e),ee(t),r.focus&&t.focus())},Tr=(e,t)=>{e&&(e.tabIndex=-1),hr(t)},te=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(I)=="true"?hr(e):ee(t),r.focus&&t.focus())},yr=e=>{for(let t of e.querySelectorAll(`[${I}='true']`))at(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},it=(e,t,r,l={})=>{var s,d,o;let n=e._walker.currentNode,a=t();if(!!a){if(n==r)return(s=l.target)==null?void 0:s.call(null,r);(d=l.pre)==null||d.call(null,n,a),it(e,t,r,l),(o=l.post)==null||o.call(null,n,a)}},je=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,it(e,()=>e._walker.nextSibling(),r,{pre:(l,n)=>{te(l,n,{focus:!1})}}),e._walker.currentNode=r,ee(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,ee(r.parentNode.closest(`[${I}]`)),it(e,()=>e._walker.previousSibling(),r,{pre:(l,n)=>{te(l,n,{focus:!1})}}),at(r.parentNode.closest(`[${I}]`)),e._walker.currentNode=r,ee(r),r.focus();break}},ee=e=>{!e||(e.setAttribute(I,!0),e.tabIndex=0)},at=e=>{!e||(e.setAttribute(I,!1),e.tabIndex=-1)},hr=e=>(e==null?void 0:e.getAttribute(I))=="true"?at(e):ee(e),Ue=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(I))=="true");return t},Ul=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),Ke=(e,t,r={})=>{yr(e);for(let l of Ul(Object.keys(t))){let n=t[l];if(l==""?l=e.querySelector("[id][aria-level]"):l=e.querySelector(`[id='${CSS.escape(l)}'][aria-level]`),!l)continue;let a=parseInt(l.getAttribute("aria-level")),s=l.querySelectorAll(`[aria-level='${a+1}'][role='treeitem']`);for(let d=0;d<n.length;d++){let o=n[d].index,c=s[o];if(!c)return;c.classList.add("item-pasted"),r.direction&&c.classList.add(r.direction),te(null,c,{focus:d==n.length-1}),e._walker.currentNode=c}}},F=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${I}='true']`}`),l={};for(let n=0;n<r.length;n++){let a=r[n],s=a.parentNode.closest("[role='treeitem']");if(!s)break;a.index=a.index||parseInt(a.getAttribute("aria-posinset"))-1,l[s.id]=l[s.id]||[],l[s.id].push(a)}return l},pe=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var ot={};Tt(ot,{anchorsModels:()=>ft,createProjectStore:()=>Kl,getFileStore:()=>We,handleProjectContext:()=>Gl,handleProjectRemote:()=>ql,projectToStore:()=>Fl});var H="new",W="removed",Y="moved",ue="order_changed",me="key_changed",ye="type_changed",xr=(e,t,r={})=>{let l={},n=[];R(t,(a,s)=>(a._meta=s,Object.assign(l,{[a.$anchor]:a}),delete a._visit,a)),R(e,(a,s)=>{var o;a._meta=s;let d=l[a.$anchor];if(d){let c=a._meta.parent,f=d._meta.parent;f.$anchor!=c.$anchor&&(a._diff={[Y]:{oldParent:f,newParent:c}}),oe(d.order,a.order)||(a._diff={[ue]:{oldOrder:d.order,newOrder:a.order}}),d.type!=a.type&&Object.assign(a._diff||(a._diff={}),{[ye]:{oldType:d.type,newType:a.type,parent:c}}),d.key!=a.key&&Object.assign(a._diff||(a._diff={}),{[me]:{oldKey:d.key,newKey:a.key,parent:c}}),a._diff&&n.push(a),d._visit=!0}else s.path.startsWith((o=s.parent.prune)==null?void 0:o.added)||(a._diff={[H]:{parent:s.parent}},n.push(a),Object.assign(s.parent,{prune:{added:s.path}}));return a});for(let a of Object.keys(l)){if(l[a]._visit)continue;let s=l[a]._meta,d=s.path;n.filter(c=>c._diff[W]&&d.startsWith(c._meta.path)).length==0&&(l[a]._diff={[W]:{parent:s.parent}},n.push(l[a]))}return n};var V="file",re="project",Kl=()=>he({tag:re,allowedSchs:[_r()],put:{pos:"append"}}),We=(e,t)=>Q(e,`[${t}]`),ql=(e,t,r,l)=>{if(!dt(r.name))return;let n=p=>{for(let y of Object.keys(e.fields))if(e.fields[y].fields[p])return{file:e.fields[y],fmodelDst:e.fields[y].fields[p]}},a=p=>z(e,(y,E)=>y._tag==C&&E.path!=""&&p.startsWith(E.path),(y,E)=>(y._meta=E,y)),s=xr(e,t),d={};d.files=[],d.fmodels=[],d.subfmodels=[];for(let p of s)p._tag==re?d.project=p:p._tag==V?d.files.push(p):p._tag==C?d.fmodels.push(p):d.subfmodels.push(p);let o={},c={},f={};if(d.project){let{fields:p,...y}=N(d.project);o.project=y}for(let p of d.files){let{fields:y,...E}=N(p);if(c.files||(c.files={}),f.files||(f.files={}),o.files||(o.files={}),c.fmodels||(c.fmodels={}),f.fmodels||(f.fmodels={}),p._diff[H]){c.files[p._meta.path]={...E,parentAnchor:p._diff[H].parent.$anchor};for(let A of Object.keys(y))c.fmodels[p.fields[A]._meta.path]={...y[A],parentAnchor:E.$anchor}}if(p._diff[W]){f.files[p._meta.path]={$anchor:E.$anchor,parentAnchor:p._diff[W].parent.$anchor};for(let A of Object.keys(y))f.fmodels[p.fields[A]._meta.path]={$anchor:y[A].$anchor,parentAnchor:E.$anchor}}(p._diff[ue]||p._diff[me])&&(o.files[p._meta.path]=E),p._diff[Y]&&console.log("file cannot be moved to different parent"),p._diff[ye]&&console.log("file type is always record, cannot be changed")}for(let p of d.fmodels){let y=N(p);if(o.files||(o.files={}),c.fmodels||(c.fmodels={}),f.fmodels||(f.fmodels={}),o.fmodels||(o.fmodels={}),p._diff[H]&&(c.fmodels[p._meta.path]={...y,parentAnchor:p._diff[H].parent.$anchor}),p._diff[W]&&(f.fmodels[p._meta.path]={$anchor:y.$anchor,parentAnchor:p._diff[W].parent.$anchor}),(p._diff[ue]||p._diff[me]||p._diff[ye])&&(o.fmodels[p._meta.path]={...y,parentAnchor:p._meta.parent.$anchor}),p._diff[Y]){let{oldParent:E,newParent:A}=p._diff[Y];switch(E._tag){case re:console.log("fmodel cannot be moved from project as direct child");break;case V:var u=e.fields[E.key],{fields:x,...h}=N(u);o.files[u._meta.path]=h,f.fmodels[p._meta.path]={$anchor:p.$anchor,parentAnchor:h.$anchor};break;case C:console.log("impossible for fmodel to have fmodel as parent");break;default:console.log("impossible for fmodel to be moved from unknown tag parent")}switch(A._tag){case re:console.log("fmodel cannot be moved to project as direct child");break;case V:var u=e.fields[A.key],{fields:x,...h}=N(u);o.files[u._meta.path]=h,c.fmodels[p._meta.path]={...y,parentAnchor:h.$anchor};break;case C:var S=n(A.key),h=N(S.file);c.fmodels[S.fmodelDst._meta.path]={...N(S.fmodelDst),parentAnchor:h.$anchor};break;default:var O=a(A.path),S=n(O.key),h=N(S.file);o.fmodels[O._meta.path]={...N(O),parentAnchor:h.$anchor}}}}for(let p of d.subfmodels){if(o.files||(o.files={}),c.fmodels||(c.fmodels={}),f.fmodels||(f.fmodels={}),o.fmodels||(o.fmodels={}),p._diff[H]||p._diff[W]||p._diff[ue]||p._diff[me]||p._diff[ye]){let y=a(p._meta.path),E=n(y.key),A=N(E.file);o.fmodels[y._meta.path]={...N(y),parentAnchor:A.$anchor}}if(p._diff[Y]){let{oldParent:y,newParent:E}=p._diff[Y];switch(y._tag){case re:console.log("subfmodel cannot be moved from project as direct child");break;case V:var u=e.fields[y.key],{fields:x,...h}=N(u);o.files[u._meta.path]=h,f.fmodels[p._meta.path]={$anchor:p.$anchor,parentAnchor:h.$anchor};break;case C:default:var O=a(y.path),S=n(O.key),h=N(S.file);o.fmodels[O._meta.path]={...N(O),parentAnchor:h.$anchor}}switch(E._tag){case re:console.log("subfmodel cannot be moved to project as direct child");break;case V:var O=a(p._meta.path),S=n(O.key),{fields:x,...h}=N(S.file);o.files[S.file._meta.path]=h,c.fmodels[p._meta.path]={...N(p),parentAnchor:h.$anchor};break;case C:default:var O=a(p._meta.path),S=n(O.key),h=N(S.file);o.fmodels[O._meta.path]={...N(O),parentAnchor:h.$anchor}}}}return console.log({changed:o,added:c,removed:f}),l({changed:o,added:c,removed:f})},Gl=(e,t,r,l)=>{if(r){if(t.closest("[id='project']"))switch(!0){case ct(l.name):Wl(e,r);break;case qe(l.name):let n=We(e,r);document.querySelector("[id='fmodel'] [role='tree']")._render(n)}else if(t.closest("[id='fmodel']"))switch(!0){case qe(l.name):let n=We(e,r);n._models=ft(e,n),document.querySelector("[id='fmodel'] [role='tree']")._render(n)}}},ft=(e,t)=>{let r={};for(let l of e.order){let n=e.fields[l];for(let a of n.order)r[n.fields[a].$anchor]=l!=t.key?`${l}.${a}`:a}return r},_r=()=>he({tag:V,addDefault:()=>he({tag:C})}),Bl=(e,t)=>{for(let r of e.fmodels)Object.assign(r.sch,{$anchor:r.anchor,type:r.type,key:r.key,is_entry:r.is_entry,_tag:C}),t.fields[r.key]=r.sch;return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,k(()=>t)},Fl=(e,t)=>{for(let r of e.files)t.fields[r.key]=Bl(r,_r());return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,k(()=>t)},Wl=(e,t)=>{let r=We(e,t);if((r==null?void 0:r._tag)==V&&(r._models=ft(e,r),st({store:r,target:"[id='fmodel']",metaSelector:"sch-meta"}),!window._treeClipboard)){let l=document.querySelector("[id='fmodel'] [role='tree']");l._aria.clearClipboard(l)}};var br=[Et,Ye,gt,kt,St,K,wt,vt,$t,()=>Ve('"json string"')],he=(e={})=>{let t=k(Ye);return t._allowedSchs=e.allowedSchs||br.map(r=>r()),e.tag&&(t._tag=e.tag),e.addDefault&&(t._addSchDefault=t._allowedSchs.find(r=>r.type==e.addDefault().type)&&e.addDefault()),e.put&&(t.put=e.put),t};var ct=e=>[wr,vr,Nr,Er,$r,gr,pt,ut,mt,Te].map(t=>t.name).includes(e),qe=e=>[yt,Te,ht,Ge].map(t=>t.name).includes(e),dt=e=>[yt,Te,ht,Ge,ut,mt,kr,Sr,Te].map(t=>t.name).includes(e),Ql=()=>new Map([["shift-meta-ArrowUp",Hl],["shift-meta-ArrowDown",Yl],["shift-ArrowUp",Vl],["shift-ArrowDown",Jl],["meta-ArrowUp",Nr],["meta-ArrowDown",Er],["ArrowUp",wr],["ArrowDown",vr],["Home",$r],["End",gr],["shift-+",yt],["Enter",zl],["shift-Enter",Or],["Delete",Te],["meta-x",Ar],["meta-c",Dr],["meta-v",Ge],["shift-alt-ArrowUp",ut],["shift-alt-ArrowDown",mt],["alt-ArrowUp",kr],["alt-ArrowDown",Sr],["Escape",({tree:e})=>pe(e)]]),Zl=(e,t={})=>function(r){Xl(r,this,e,t)};async function Xl(e,t,r,l){if(e.target instanceof HTMLTextAreaElement)return en(e,t,r);let n=Ql().get(Mr(e));if(!n||(l.denyCmds||[]).includes(n.name))return;switch(n({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t.renderSchMeta(),t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`));let a=t._walker.currentNode.closest("[data-tag='file']");t.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{file:a==null?void 0:a.key,path:t._walker.currentNode.id,command:n}}))}var tn=()=>new Map([["Enter",ht]]),en=(e,t,r)=>{let l=e.target,n=tn().get(Mr(e));if(!n)return;n({tree:t,store:r},l),t.renderSchMeta();let a=t._walker.currentNode.closest("[data-tag='file']");t.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{file:a==null?void 0:a.key,path:t._walker.currentNode.id,command:n}}))},ln=e=>function(t){return rn(t,this,e)};function rn(e,t,r){let l=t._walker.currentNode,n=e.target.closest("[role='treeitem']"),a=!t.querySelector("textarea");if(!!n){if(e.shiftKey||e.metaKey)switch(l.compareDocumentPosition(n)){case Node.DOCUMENT_POSITION_CONTAINS:return $(t,n);case Node.DOCUMENT_POSITION_CONTAINED_BY:return $(t,l);default:if(n.parentNode.closest("[role='treeitem']")!=l.parentNode.closest("[role='treeitem']"))return $(t,n)}if(e.shiftKey)je(t,l,n);else if(e.metaKey)Tr(l,t._walker.currentNode=n);else{let s=n.closest("[data-tag='file']");t._walker.currentNode=n,pt({tree:t},{notFocusIfTextArea:a}),t.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{file:s==null?void 0:s.key,path:n.id,command:pt}}))}t.renderSchMeta()}}var nn=({tree:e,store:t})=>{let r=e.querySelectorAll("[id='fmodel'] [aria-selected='true']");if(r.length==1){let l=Q(t,r[0].id);l.displayKey=r[0].key,l.path=r[0].id,l.rootKey=e.querySelector(".root-item").key,Ce(e._metaContainer,l,t)}},Mr=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:l,key:n})=>{let a=[];return e&&a.push("shift"),(t||l)&&a.push("meta"),r&&a.push("alt"),n&&a.push(n),a.join("-")},Hl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();je(e,t,r)},Yl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();je(e,t,r)},Vl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();te(t,r)},Jl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();te(t,r)},Nr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();$(e,t)},Er=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();$(e,t)},wr=({tree:e})=>$(e,e._walker.previousNode()),vr=({tree:e})=>$(e,e._walker.nextNode()),$r=({tree:e})=>{for(;e._walker.parentNode(););$(e,e._walker.currentNode)},gr=({tree:e})=>{for(;e._walker.nextNode(););$(e,e._walker.currentNode)},pt=({tree:e},t={})=>$(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),yt=({tree:e,store:t})=>{var s;let r=e._walker.currentNode,l=Q(t,r.id),n,a=l._addSchDefault||l._allowedSchs&&l._allowedSchs[0]||t._allowedSchs&&t._allowedSchs[0];!a||(((s=l.put)==null?void 0:s.pos)=="prepend"?n=0:n=Number.MAX_SAFE_INTEGER,Ne(t,r.id,[{k:null,sch:()=>be(a),index:n}]),e._render(),$(e,r))},zl=({tree:e,store:t})=>{var l,n;((n=(l=e._walker.currentNode.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:n.group)=="keyed"&&Rr({tree:e,store:t,editMode:"editKey"})},Or=({tree:e,store:t})=>{Rr({tree:e,store:t,editMode:"editType"})},Rr=({tree:e,store:t,editMode:r})=>{let l=e._walker.currentNode;B(t,l.id,(a,s)=>({...a,uiMode:r})),e._render();let n=e.querySelector("textarea");!n||(n._treeItem=l,n.onblur=a=>an(e,t,n),n.focus())},an=(e,t,r)=>{let l=B(t,r._treeItem.id,(n,a)=>Object.assign(n,{uiMode:"cancelled-edit"}));e._render(),l&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),$(e,e._walker.currentNode))},ht=({tree:e,store:t},r)=>{r.id=="key-edit"?Cr(e,t,r,sn):r.id=="type-edit"&&Cr(e,t,r,on)},Cr=(e,t,r,l)=>{let n=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),$(e,r._treeItem,{focus:!1});let a=l(e,t,r)||n.id;B(t,a,(s,d)=>Object.assign(s,{uiMode:"editted"})),e._render(),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(a)}']`),$(e,e._walker.currentNode)},on=(e,t,r)=>{let l=t._allowedSchs.find(s=>s.type==r.value),n=Object.keys(t._models).find(s=>t._models[s]==r.value),a=Ve(r.value);return l?ve(t,r._treeItem.id,()=>be(l)):n?ve(t,r._treeItem.id,()=>Ot(n)):a&&ve(t,r._treeItem.id,()=>a),e._walker.currentNode.id},sn=(e,t,r)=>{let l=F(e),n=r.dataset.parentPath;l[r.dataset.parentPath]=l[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>({id:c.id,newK:r.value,index:c.index}));let a=l[r.dataset.parentPath][0].index,d=we(t,{dstPath:n,startIndex:a},l)[n][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${d}]`},Te=({tree:e,store:t})=>{let r=Ue(()=>e._walker.nextSibling())||Ue(()=>e._walker.previousSibling())||Ue(()=>e._walker.parentNode());Ee(t,F(e)),e._render(),$(e,r)};var Ar=({store:e,tree:t})=>{pe(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-cutting");let r=F(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",storeKey:e.key,ops:l=>Ee(e,r,{dstPath:l}),selected:r}},Dr=({store:e,tree:t})=>{pe(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-copying");let r=F(t,{ops:".item-copying"});window._treeClipboard={type:"copy",storeKey:e.key,ops:l=>ze(e,r,{dstPath:l,startIndex:0}),selected:r}},Ge=({tree:e,store:t,srcStore:r})=>{let l=Q(t,e._walker.currentNode.id);if(!![T,_,b].includes(l.type)&&window._treeClipboard){let n=e._walker.currentNode.id,{type:a,storeKey:s,ops:d,selected:o}=window._treeClipboard,c=o,f={};if(t.key==s)switch(a){case"copy":f=Xe(t,{dstPath:n},c);break;case"cut":f=we(t,{dstPath:n},c);break}else switch(a){case"copy":let u=d(n);f=Qe(t,{dstPath:n},u);break;case"cut":let x=d(n);f=Je(t,{dstPath:n},x);break}Object.keys(f).length!=0&&(e._render(),pe(e),Ke(e,f))}},ut=({tree:e,store:t})=>Ir({tree:e,store:t,direction:"up"},r=>r[0].index),mt=({tree:e,store:t})=>Ir({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),Ir=({tree:e,store:t,direction:r},l)=>{let n=F(e),a={};for(let s of Object.keys(n))a=Xe(t,{dstPath:s,startIndex:l(n[s])},{[s]:n[s]});Object.keys(a).length!=0&&(e._render(),Ke(e,a,{direction:r}))},kr=({tree:e,store:t})=>Lr({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),Sr=({tree:e,store:t})=>Lr({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),Lr=({tree:e,store:t,startIndex:r,direction:l})=>{let n=F(e),a={};for(let s of Object.keys(n)){let d=n[s].sort((o,c)=>o.index-c.index);a=we(t,{dstPath:s,startIndex:r(d[0].index)},n)}Object.keys(a).length!=0&&(e._render(),Ke(e,a,{direction:l}))},Pr=({store:e,target:t,metaSelector:r,opts:l})=>{e.render=s=>nr(t,s||e,l||{}),e.render();let n=document.querySelector(`${t} [role='tree']`),a=document.querySelector(r);if(n){n._aria=nt,n._render=e.render,mr(n),n.onkeydown=Zl(e,l.treeKeyDownOpts),n.onclick=ln(e);let s=n._walker.nextNode();$(n,n._walker.nextNode()||s,{focus:l.focus}),r&&(n._metaContainer=a),n.renderSchMeta=()=>nn({tree:n,store:e}),n.renderSchMeta()}},cn=({store:e,target:t,metaSelector:r})=>{Pr({store:e,target:t,metaSelector:r,opts:{ui:{depthLimit:2,modelTypeText:(l,n)=>"file",typeText:(l,n)=>{if(l.type==T)return"record";if(l.type==D)return"value";if(l.type==b)return"tuple";if(l.type==_)return"union"},viewTypeRoot:l=>""},treeKeyDownOpts:{denyCmds:[Or,Dr,Ar,Ge].map(l=>l.name)},focus:!0}})},st=({store:e,target:t,metaSelector:r})=>{Pr({store:e,target:t,metaSelector:r,opts:{ui:{modelTypeText:(l,n)=>"type"}}})},dn=({store:e,detail:t,target:r})=>{let{path:l,attrs:n}=t,a=B(e,l,(s,d)=>tr(s,n));e.render(),Ce(r.closest("sch-meta"),a,e)};export{ot as Project,br as allSchs,he as createStore,cn as initFileView,st as initModelView,ct as isContextSwitchedCmd,dt as isDiffableCmd,qe as isModelChangedCmd,dn as update};
/*! (c) Andrea Giammarchi - ISC */
