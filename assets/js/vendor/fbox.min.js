var Pl=Object.defineProperty;var tr=(e,t)=>{for(var r in t)Pl(e,r,{get:t[r],enumerable:!0})};var tt,Ul=new Uint8Array(16);function _t(){if(!tt&&(tt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!tt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return tt(Ul)}var rr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function jl(e){return typeof e=="string"&&rr.test(e)}var lr=jl;var k=[];for(var wt=0;wt<256;++wt)k.push((wt+256).toString(16).substr(1));function Kl(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase();if(!lr(r))throw TypeError("Stringified UUID is invalid");return r}var nr=Kl;function ql(e,t,r){e=e||{};var l=e.random||(e.rng||_t)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=l[o];return t}return nr(l)}var gt=ql;var E="record",$="list",g="tuple",K="string",q="int8",F="uint8",W="int16",G="uint16",B="int32",H="uint32",or=[q,W,B,F,G,H],Y="float32",z="float64",ir=[Y,z],kt="timestamp",J="boolean",fe="null",A="union",Ne="any",R="ref",V="value",ar=[E,g,$,A],S="fmodel";var re=()=>({type:Ne}),sr=()=>({type:K}),cr=()=>({type:J}),dr=()=>({type:q,min:-128,max:127}),fr=()=>({type:W,min:-32768,max:32767}),ur=()=>({type:B,min:-2147483648,max:2147483647}),pr=()=>({type:F,min:0,max:255}),mr=()=>({type:G,min:0,max:65535}),Tr=()=>({type:H,min:0,max:4294967295}),yr=()=>({type:Y}),hr=()=>({type:z}),xr=()=>({type:kt}),Nr=()=>({type:fe}),rt=()=>({type:E,fields:[]}),br=()=>({type:$,sch:M(re)}),Er=()=>({type:g,schs:[M(re)]}),vr=()=>({type:A,schs:[M(re)]}),Ar=e=>({type:R,$ref:e}),lt=e=>{try{return e=JSON.parse(e),e==null||[K,...ir,...or,J].includes(typeof e)?{type:V,const:e}:!1}catch(t){return!1}},M=(e,t={})=>{let r=e();return r.$anchor||(r.$anchor=gt()),t.force&&(r.$anchor=gt()),r};var Ue=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},_r=e=>{Ue(e),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},{defineProperty:Fl}=Object,wr=Fl,X=(e,t,r)=>wr(e,t,{value:r,configurable:!0}),le=(e,t,r)=>wr(e,t,{value:r,configurable:!0,writable:!0});var nt=(e,t)=>{let r=JSON.parse(JSON.stringify(e));return L(r,(l,o)=>{let a;t&&(a=t.schMetas[l.$anchor]);let n=M(()=>l,{force:!0});return a&&Object.assign(t.schMetas,{[n.$anchor]:n.metadata}),l}),r},L=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,delete e._pruned,e=t(e,r),e._halt||e._pruned)return e;let l=({type:o,$anchor:a,key:n},{path:d,level:c})=>({level:c,type:o,$anchor:a,key:n,path:d});switch(!0){case[E].includes(e.type):for(let n=e.fields.length-1;n>=0;n--){let d=e.fields[n],c=d.key,s={path:`${r.path}[${c}]`,level:r.level+1,index:n,parent:l(e,r)};if(d=L(d,t,s),d.index=n,e.fields[n]=d,d._halt)return Object.assign(e,{_halt:!0})}break;case[g,A].includes(e.type):for(let n=0;n<e.schs.length;n++){let d=e.schs[n],c={path:`${r.path}[][${n}]`,level:r.level+1,index:n,parent:l(e,r)};if(d=L(d,t,c),e.schs[n]=d,d._halt)return Object.assign(e,{_halt:!0})}break;case[$].includes(e.type):let o={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:l(e,r)},a=L(e.sch,t,o);if(e.sch=a,a._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Wl=(e,t,r)=>{let l={original:{},popped:[]},o=r.sort((a,n)=>n-a);return L(e,(a,n)=>{if(n.path!=t)return a;switch(a.type){case E:for(let d of o)l.popped.unshift({k:a.fields[d].key,sch:a.fields.splice(d,1)[0],index:d});break;case $:break;case g:for(let d of o)l.popped.unshift({k:d,sch:a.schs.splice(d,1)[0],index:d});a.schs.length==0&&a.schs.splice(0,0,M(re));break;case A:for(let d of o)l.popped.unshift({k:d,sch:a.schs.splice(d,1)[0],index:d});a.schs.length==0&&a.schs.splice(0,0,M(re));break;default:}return a}),l},Gl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),ot=(e,t,r)=>{let l={original:{},inserted:[]},o=r.sort((n,d)=>n.index-d.index),a=(n,d)=>(n=Math.max(n,0),n=Math.min(n,d.length),n);return L(e,(n,d)=>{var c;if(d.path!=t)return n;switch(n.type){case E:let s=(c=e.taggedLevel)==null?void 0:c[d.level+1];for(let{k:f,sch:u,index:m}of o){f=f==0?"0":f,f=f||`${s||"key"}_${Math.floor(Date.now()/100)}`,f=`${f}`;for(let h=0;h<n.fields.length;h++)if(n.fields[h].key==f)f=`${f} \u2013`;else continue;m=a(m,n.fields),n.fields.splice(m,0,M(u)),n.fields[m].key=f,l.inserted.push({k:n.fields[m].key,sch:n.fields[m],index:m})}break;case $:break;case g:for(let{k:f,sch:u,index:m}of o)m=a(m,n.schs),n.schs.splice(m,0,M(u)),l.inserted.push({k:f,sch:n.schs[m],index:m});break;case A:for(let{k:f,sch:u,index:m}of o)m=a(m,n.schs),n.schs.splice(m,0,M(u)),l.inserted.push({k:f,sch:n.schs[m],index:m});default:}return n}),l},at=(e,{dstPath:t,startIndex:r=0},l)=>{let o=(c,s,f)=>Q(c,s,(u,m)=>(X(u,"_pinId",f),u)),a=Symbol(t);o(e,t,a);let n=it(e,l,{dstPath:t});return $t(e,{dstPin:a,startIndex:r},n)},it=(e,t,r={})=>{let l={},o=Gl(Object.keys(t));for(let a of o){let n=t[a],d=f=>{var u;return(u=n.find(m=>m.index==f))==null?void 0:u.newK};if(r.dstPath&&n.filter(u=>r.dstPath.startsWith(u.id)).length!=0)continue;let s=Wl(e,a,n.map(f=>f.index)).popped.map(({k:f,sch:u,index:m})=>({k:d(m)||f,sch:()=>u}));l[a]=s}return l},$t=(e,{dstPin:t,dstPath:r,startIndex:l=0},o)=>{let a=(s,f)=>be(s,(u,m)=>u._pinId==f,(u,m)=>(X(u,"_pinned",m),u));l=Math.max(l,0);let n={},d=Object.values(o).flatMap(s=>s).map((s,f)=>({...s,index:l+f}));if(t){let s=a(e,t);s&&(r=s._pinned.path)}let c=ot(e,r,d);return c.inserted.length!=0&&(n[r]=c.inserted),n},Mt=(e,{dstPath:t,startIndex:r=0},l)=>{let o=Dt(e,l,{dstPath:t,startIndex:r});return Ot(e,{dstPath:t},o)},Dt=(e,t,r={})=>Object.values(t).reduce((l,o)=>{let a=o.map(d=>d.id),n=[];be(e,(d,c)=>(a.includes(c.path)&&(X(d,"_meta",c),n.unshift(d)),n.length==a.length),(d,c)=>d);for(let d of o){if(r.dstPath&&r.dstPath.startsWith(d.id))continue;let c=n.find(s=>s._meta.path==d.id);c&&l.unshift({k:d.key,sch:()=>nt(c,e),index:r.startIndex+l.length,id:d.id})}return l},[]),Ot=(e,{dstPath:t},r)=>{let l={},o=ot(e,t,r);return o.inserted.length!=0&&(l[t]=o.inserted),l},st=(e,t,r)=>Q(e,t,(l,o)=>{let a=M(r),{title:n,description:d,rw:c,required:s,$anchor:f,key:u}=l,m=a.type==R&&a.$ref!=l.$ref,h=a.type==V&&a.const!=l.const,_=a.type!=l.type;return a.$ref==f?l:_||h||m?Object.assign(a,{metadata:{title:n,description:d,rw:c,required:s},$anchor:f,key:u}):l}),ue=(e,t)=>be(e,(r,l)=>l.path==t,(r,l)=>(X(r,"_meta",l),r)),Q=(e,t,r)=>be(e,(l,o)=>o.path==t,r),be=(e,t,r)=>{let l;return L(e,(o,a)=>t(o,a)?(l=r(o,a),l._halt=!0,l):o),l&&delete l._halt,l};var St={};tr(St,{clearClipboard:()=>Z,collapseSelected:()=>Rt,createWalker:()=>gr,expandSelected:()=>Ct,findUnselectedNode:()=>Ke,reselectNodes:()=>ve,selectMultiNode:()=>pe,selectMultiNodeTo:()=>je,selectNode:()=>N,selectedGroupedByParent:()=>ne,toggleSelectNode:()=>Dr});var I="aria-selected",ct="aria-expanded",gr=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{var r;if(t.hasAttribute(I)){let l=(r=t.parentElement.closest(`[${ct}]`))==null?void 0:r.getAttribute(ct);return l&&l=="false"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}else return NodeFilter.FILTER_SKIP}},!1),e),N=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,kr(e),Ee(t),r.focus&&t.focus())},Dr=(e,t)=>{e&&(e.tabIndex=-1),$r(t)},pe=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(I)=="true"?$r(e):Ee(t),r.focus&&t.focus())},kr=e=>{for(let t of e.querySelectorAll(`[${I}='true']`))It(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},Lt=(e,t,r,l={})=>{var n,d,c;let o=e._walker.currentNode,a=t();if(!!a){if(o==r)return(n=l.target)==null?void 0:n.call(null,r);(d=l.pre)==null||d.call(null,o,a),Lt(e,t,r,l),(c=l.post)==null||c.call(null,o,a)}},je=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,Lt(e,()=>e._walker.nextSibling(),r,{pre:(l,o)=>{pe(l,o,{focus:!1})}}),e._walker.currentNode=r,Ee(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,Ee(r.parentNode.closest(`[${I}]`)),Lt(e,()=>e._walker.previousSibling(),r,{pre:(l,o)=>{pe(l,o,{focus:!1})}}),It(r.parentNode.closest(`[${I}]`)),e._walker.currentNode=r,Ee(r),r.focus();break}},Ee=e=>{!e||(e.setAttribute(I,!0),e.tabIndex=0)},It=e=>{!e||(e.setAttribute(I,!1),e.tabIndex=-1)},$r=e=>(e==null?void 0:e.getAttribute(I))=="true"?It(e):Ee(e),Ke=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(I))=="true");return t},Bl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),ve=(e,t,r={})=>{kr(e);for(let l of Bl(Object.keys(t))){let o=t[l];if(l==""?l=e.querySelector("[id][aria-level]"):l=e.querySelector(`[id='${CSS.escape(l)}'][aria-level]`),!l)continue;let a=parseInt(l.getAttribute("aria-level")),n=l.querySelectorAll(`[aria-level='${a+1}'][role='treeitem']`);for(let d=0;d<o.length;d++){let c=o[d].index,s=n[c];if(!s)return;s.classList.add("item-pasted"),r.direction&&s.classList.add(r.direction),pe(null,s,{focus:d==o.length-1}),e._walker.currentNode=s}}},ne=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${I}='true']`}`),l={};for(let o=0;o<r.length;o++){let a=r[o],n=a.parentNode.closest("[role='treeitem']");if(!n)break;a.index=a.index||parseInt(a.getAttribute("aria-posinset"))-1,l[n.id]=l[n.id]||[],l[n.id].push(a)}return l},Ct=e=>{let t=e.querySelectorAll(`[${I}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(ct,"true")},Rt=e=>{let t=e.querySelectorAll(`[${I}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(ct,"false")},Z=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var Pt=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();je(e,t,r)},Ut=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();je(e,t,r)},jt=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();pe(t,r)},Kt=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();pe(t,r)},Ae=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();N(e,t)},_e=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();N(e,t)},we=({tree:e})=>N(e,e._walker.previousNode()),ge=({tree:e})=>N(e,e._walker.nextNode()),ke=({tree:e})=>{for(;e._walker.parentNode(););N(e,e._walker.nextNode()),N(e,e._walker.parentNode())},$e=({tree:e})=>{for(;e._walker.nextNode(););N(e,e._walker.currentNode)},De=({tree:e},t={})=>N(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),qt=({tree:e},t={})=>N(e,e._walker.currentNode),Oe=({tree:e,store:t})=>{var n;let r=e._walker.currentNode,l=ue(t,r.id),o,a=l._addSchDefault||l.allowedSchs&&l.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!a||(((n=t.put)==null?void 0:n.pos)=="prepend"?o=0:o=Number.MAX_SAFE_INTEGER,ot(t,r.id,[{k:null,sch:()=>nt(a),index:o}]),e._render(t),N(e,r))},qe=({tree:e,store:t})=>{var o,a;let r=e._walker.currentNode;if(((a=(o=r.closest("[role='group']"))==null?void 0:o.dataset)==null?void 0:a.group)=="keyed"){let n=r.querySelector(".k").getBoundingClientRect();Or({tree:e,store:t,editMode:"editKey",textRect:n})}},dt=({tree:e,store:t})=>{let r=e._walker.currentNode.querySelector(".t").getBoundingClientRect();Or({tree:e,store:t,editMode:"editType",textRect:r})},Or=({tree:e,store:t,editMode:r,textRect:l})=>{let o=e._walker.currentNode,a=Q(t,o.id,(c,s)=>le(c,"uiMode",r));e._render(t);let n=e.querySelector("textarea");if(!n)return;let d=window.getComputedStyle(n);n.style.minWidth=l.width+"px",n.style.minHeight=l.height+"px",n._treeItem=o,n.onblur=c=>c.relatedTarget&&c.relatedTarget.id!=n._treeItem.id&&Hl(e,t,n),n.focus()},Hl=(e,t,r)=>{let l=Q(t,r._treeItem.id,(o,a)=>Object.assign(o,{uiMode:"cancelled-edit"}));e._render(t),l&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),N(e,e._walker.currentNode))},Me=({tree:e,store:t},r)=>{r.id=="key-edit"?Mr(e,t,r,zl):r.id=="type-edit"&&Mr(e,t,r,Yl)},Mr=(e,t,r,l)=>{let o=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),N(e,r._treeItem,{focus:!1});let a=l(e,t,r)||o.id;Q(t,a,(n,d)=>Object.assign(n,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(a)}']`),N(e,e._walker.currentNode)},Yl=(e,t,r)=>{let l=t.allowedSchs.find(n=>n.type==r.value),o=t._models[r.value]&&r.value||Object.keys(t._models).find(n=>t._models[n].display==r.value),a=lt(r.value);return l?st(t,r._treeItem.id,()=>nt(l)):o?st(t,r._treeItem.id,()=>Ar(o)):a&&st(t,r._treeItem.id,()=>a),e._walker.currentNode.id},zl=(e,t,r)=>{let l=ne(e),o=r.dataset.parentPath;l[r.dataset.parentPath]=l[r.dataset.parentPath].filter(s=>s.id==r._treeItem.id).map(s=>({id:s.id,newK:r.value,index:s.index}));let a=l[r.dataset.parentPath][0].index,d=at(t,{dstPath:o,startIndex:a},l)[o][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${d}]`},oe=({tree:e,store:t})=>{let r=Ke(()=>e._walker.nextSibling())||Ke(()=>e._walker.previousSibling())||Ke(()=>e._walker.parentNode());it(t,ne(e)),e._render(t),N(e,r)},Se=({tree:e,store:t})=>{var l;let r=e._walker.currentNode;!r||((l=t.entryable)==null?void 0:l.includes(r.dataset.tag))&&(Q(t,r.id,(o,a)=>Object.assign(o,{isEntry:!0})),e._render(t),N(e,r))};var Sr=({store:e,tree:t})=>{Z(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-cutting");let r=ne(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",srcStoreKey:e.key,ops:l=>it(e,r,{dstPath:l}),selected:r}},Ir=({store:e,tree:t})=>{if(document.getSelection().toString().length!=0)return;Z(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-copying");let r=ne(t,{ops:".item-copying"});window._treeClipboard={type:"copy",srcStoreKey:e.key,ops:l=>Dt(e,r,{dstPath:l,startIndex:0}),selected:r}},me=({tree:e,store:t,srcStore:r})=>{var o;let l=ue(t,e._walker.currentNode.id);if(!![E,A,g].includes(l.type)&&!(((o=t.put)==null?void 0:o.onlyDst)&&!t.put.onlyDst[t.taggedLevel[l._meta.level]])&&window._treeClipboard){let a=e._walker.currentNode.id,{type:n,srcStoreKey:d,ops:c,selected:s}=window._treeClipboard,f=s,u={};if(t.key==d)switch(n){case"copy":u=Mt(t,{dstPath:a},f);break;case"cut":u=at(t,{dstPath:a},f);break}else switch(n){case"copy":let h=c("");u=Ot(t,{dstPath:a},h);break;case"cut":let _=c("");u=$t(t,{dstPath:a},_);break}let m=(h,_)=>{let O={};for(let x of Object.keys(_))x==l._meta.path?O[""]=_[x]:O[x]=_[x];h._render(l),Z(h),ve(h,O)};Object.keys(u).length!=0&&(l._tree?m(l._tree,u):(e._render(t),Z(e),ve(e,u)))}},Te=({tree:e,store:t})=>Lr({tree:e,store:t,direction:"up"},r=>r[0].index),ye=({tree:e,store:t})=>Lr({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),Lr=({tree:e,store:t,direction:r},l)=>{let o=ne(e),a={};for(let n of Object.keys(o))a=Mt(t,{dstPath:n,startIndex:l(o[n])},{[n]:o[n]});Object.keys(a).length!=0&&(e._render(t),ve(e,a,{direction:r}))},Fe=({tree:e,store:t})=>Cr({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),We=({tree:e,store:t})=>Cr({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),Cr=({tree:e,store:t,startIndex:r,direction:l})=>{let o=ne(e),a={};for(let n of Object.keys(o)){let d=o[n].sort((c,s)=>c.index-s.index);a=at(t,{dstPath:n,startIndex:r(d[0].index)},o)}Object.keys(a).length!=0&&(e._render(t),ve(e,a,{direction:l}))},Rr=({tree:e})=>Ct(e),Pr=({tree:e})=>Rt(e);var{defineProperties:Jl}=Object,Ft=({store:e,target:t,view:r,treeKeyDownCmds:l,textAreaKeyDownCmd:o,opts:a={}})=>{var d;Jl(e,{render:{value:function(c){r(c||this)},configurable:!0},currentNode:{writable:!0,configurable:!0},_tree:{writable:!0,configurable:!0}}),e.render();let n=document.querySelector(`${t} [role='tree']`);if(n){n._aria=St,n._render=r,e._tree=n,gr(n),n.onkeydown=Vl(e,l,{textAreaKeyDownCmd:o}),n.onclick=Xl(e);let c=n.querySelector(`[id='${CSS.escape(a.selectId)}']`);if(c&&a.selectId!="")n._walker.currentNode=c,N(n,n._walker.currentNode,{focus:a.focus});else{let s=n._walker.nextNode(),f=((d=e.currentNode)==null?void 0:d.isConnected)&&e.currentNode||n._walker.nextNode()||s;N(n,f,{focus:a.focus})}return n._walker.currentNode.scrollIntoView({block:"center"}),n}},Vl=(e,t,r)=>function(l){Ql(l,this,e,t,r)};async function Ql(e,t,r,l=[],o={}){if(e.stopPropagation(),e.target instanceof HTMLTextAreaElement)return Zl(e,t,r,o.textAreaKeyDownCmd);let n=new Map(l).get(Ur(e));if(!!n&&!(o.denyCmds||[]).includes(n.name)){switch(n({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`)),r.currentNode=t._walker.currentNode,Wt(t,t._walker.currentNode,n)}}var Zl=(e,t,r,l=[])=>{e.stopPropagation();let o=e.target,n=new Map(l).get(Ur(e));!n||(n({tree:t,store:r},o),r.currentNode=t._walker.currentNode,Wt(t,t._walker.currentNode,n))},Xl=e=>function(t){return en(t,this,e)};function en(e,t,r){e.stopPropagation();let l=t._walker.currentNode,o=e.target.closest("[role='treeitem']"),a=!t.querySelector("textarea");if(!!o){if(e.shiftKey||e.metaKey)switch(l.compareDocumentPosition(o)){case Node.DOCUMENT_POSITION_CONTAINS:return N(t,o);case Node.DOCUMENT_POSITION_CONTAINED_BY:return N(t,l);default:if(o.parentNode.closest("[role='treeitem']")!=l.parentNode.closest("[role='treeitem']"))return N(t,o)}e.shiftKey?(l!=o&&document.getSelection().removeAllRanges(),je(t,l,o)):e.metaKey?Dr(l,t._walker.currentNode=o):(t._walker.currentNode=o,De({tree:t},{notFocusIfTextArea:a}),r.currentNode=t._walker.currentNode,Wt(t,o,De))}}var Ur=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:l,key:o})=>{let a=[];return e&&a.push("shift"),(t||l)&&a.push("meta"),r&&a.push("alt"),o&&a.push(o),a.join("-")},Wt=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}}));var Ge=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var jr=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,tn=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,rn=/<[a-z][^>]+$/i,ln=/>[^<>]*$/,nn=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,on=/\s+$/,Kr=(e,t)=>0<t--&&(rn.test(e[t])||!ln.test(e[t])&&Kr(e,t)),an=(e,t,r)=>tn.test(t)?e:`<${t}${r.replace(on,"")}></${t}>`,qr=(e,t,r)=>{let l=[],{length:o}=e;for(let n=1;n<o;n++){let d=e[n-1];l.push(jr.test(d)&&Kr(e,n)?d.replace(jr,(c,s,f)=>`${t}${n-1}=${f||'"'}${s}${f?"":'"'}`):`${d}<!--${t}${n-1}-->`)}l.push(e[o-1]);let a=l.join("").trim();return r?a:a.replace(nn,an)};var{isArray:Ie}=Array,{indexOf:Fr,slice:ft}=[];var sn=1,Wr=111,cn=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},Gr=(e,t)=>e.nodeType===Wr?1/t<0?t?cn(e):e.lastChild:t?e.valueOf():e.firstChild:e,Br=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let l=ft.call(t,0),o=l[0],a=l[r-1];return{ELEMENT_NODE:sn,nodeType:Wr,firstChild:o,lastChild:a,valueOf(){if(t.length!==r){let n=0;for(;n<r;)e.appendChild(l[n++])}return e}}};var Hr=(e,t,r,l,o)=>{let a=r.length,n=t.length,d=a,c=0,s=0,f=null;for(;c<n||s<d;)if(n===c){let u=d<a?s?l(r[s-1],-0).nextSibling:l(r[d-s],0):o;for(;s<d;)e.insertBefore(l(r[s++],1),u)}else if(d===s)for(;c<n;)(!f||!f.has(t[c]))&&e.removeChild(l(t[c],-1)),c++;else if(t[c]===r[s])c++,s++;else if(t[n-1]===r[d-1])n--,d--;else if(t[c]===r[d-1]&&r[s]===t[n-1]){let u=l(t[--n],-1).nextSibling;e.insertBefore(l(r[s++],1),l(t[c++],-1).nextSibling),e.insertBefore(l(r[--d],1),u),t[n]=r[d]}else{if(!f){f=new Map;let u=s;for(;u<d;)f.set(r[u],u++)}if(f.has(t[c])){let u=f.get(t[c]);if(s<u&&u<d){let m=c,h=1;for(;++m<n&&m<d&&f.get(t[m])===u+h;)h++;if(h>u-s){let _=l(t[c],0);for(;s<u;)e.insertBefore(l(r[s++],1),_)}else e.replaceChild(l(r[s++],1),l(t[c++],-1))}else c++}else e.removeChild(l(t[c++],-1))}return r};var Yr=e=>t=>{for(let r in t){let l=r==="role"?r:`aria-${r}`,o=t[r];o==null?e.removeAttribute(l):e.setAttribute(l,o)}},zr=(e,t)=>{let r,l=!0,o=document.createAttributeNS(null,t);return a=>{r!==a&&(r=a,r==null?l||(e.removeAttributeNode(o),l=!0):(o.value=a,l&&(e.setAttributeNodeNS(o),l=!1)))}},Jr=(e,t,r)=>l=>{r!==!!l&&((r=!!l)?e.setAttribute(t,""):e.removeAttribute(t))},dn=({dataset:e})=>t=>{for(let r in t){let l=t[r];l==null?delete e[r]:e[r]=l}},Vr=(e,t)=>{let r,l=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(l=l.toLowerCase()),o=>{let a=Ie(o)?o:[o,!1];r!==a[0]&&(r&&e.removeEventListener(l,r,a[1]),(r=a[0])&&e.addEventListener(l,r,a[1]))}},Xr=e=>t=>{typeof t=="function"?t(e):t.current=e},Qr=(e,t)=>t==="dataset"?dn(e):r=>{e[t]=r},Zr=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var fn=function(e){"use strict";var t="fragment",r="template",l="content"in n(r),o=l?function(c){var s=n(r);return s.innerHTML=c,s.content}:function(c){var s=n(t),f=n(r),u=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(c)){var m=RegExp.$1;f.innerHTML="<table>"+c+"</table>",u=f.querySelectorAll(m)}else f.innerHTML=c,u=f.childNodes;return a(s,u),s};return function(s,f){return(f==="svg"?d:o)(s)};function a(c,s){for(var f=s.length;f--;)c.appendChild(s[0])}function n(c){return c===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",c)}function d(c){var s=n(t),f=n("div");return f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+c+"</svg>",a(s,f.firstChild.childNodes),s}}(document),Gt=fn;var el=({childNodes:e},t)=>e[t],ut=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(Fr.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:tl,importNode:pt}=document;var rl=pt.length!=1,ll=rl?(e,t,r)=>pt.call(document,Gt(e,t,r),!0):Gt,nl=rl?e=>tl.call(document,e,1|128,null,!1):e=>tl.call(document,e,1|128);var Be=(e,t,r)=>Hr(e.parentNode,t,r,Gr,e),un=e=>{let t,r,l=[],o=a=>{switch(typeof a){case"string":case"number":case"boolean":t!==a&&(t=a,r?r.textContent=a:r=document.createTextNode(a),l=Be(e,l,[r]));break;case"object":case"undefined":if(a==null){t!=a&&(t=a,l=Be(e,l,[]));break}if(Ie(a)){t=a,a.length===0?l=Be(e,l,[]):typeof a[0]=="object"?l=Be(e,l,a):o(String(a));break}"ELEMENT_NODE"in a&&t!==a&&(t=a,l=Be(e,l,a.nodeType===11?ft.call(a.childNodes):[a]))}};return o},pn=(e,t)=>{switch(t[0]){case"?":return Jr(e,t.slice(1),!1);case".":return Qr(e,t.slice(1));case"o":if(t[1]==="n")return Vr(e,t)}switch(t){case"ref":return Xr(e);case"aria":return Yr(e)}return zr(e,t)};function ol(e){let{type:t,path:r}=e,l=r.reduceRight(el,this);return t==="node"?un(l):t==="attr"?pn(l,e.name):Zr(l)}var He="is\xB5",il=Ge(new WeakMap),mn=/^(?:plaintext|script|style|textarea|title|xmp)$/i,Le=()=>({stack:[],entry:null,wire:null}),yn=(e,t)=>{let{content:r,updates:l}=Tn(e,t);return{type:e,template:t,content:r,updates:l,wire:null}},hn=(e,t)=>{let r=qr(t,He,e==="svg"),l=ll(r,e),o=nl(l),a=[],n=t.length-1,d=0,c=`${He}${d}`;for(;d<n;){let s=o.nextNode();if(!s)throw`bad template: ${r}`;if(s.nodeType===8)s.textContent===c&&(a.push({type:"node",path:ut(s)}),c=`${He}${++d}`);else{for(;s.hasAttribute(c);)a.push({type:"attr",path:ut(s),name:s.getAttribute(c)}),s.removeAttribute(c),c=`${He}${++d}`;mn.test(s.tagName)&&s.textContent.trim()===`<!--${c}-->`&&(s.textContent="",a.push({type:"text",path:ut(s)}),c=`${He}${++d}`)}}return{content:l,nodes:a}},Tn=(e,t)=>{let{content:r,nodes:l}=il.get(t)||il.set(t,hn(e,t)),o=pt.call(document,r,!0),a=l.map(ol,o);return{content:o,updates:a}},Ye=(e,{type:t,template:r,values:l})=>{let{length:o}=l;al(e,l,o);let{entry:a}=e;(!a||a.template!==r||a.type!==t)&&(e.entry=a=yn(t,r));let{content:n,updates:d,wire:c}=a;for(let s=0;s<o;s++)d[s](l[s]);return c||(a.wire=Br(n))},al=({stack:e},t,r)=>{for(let l=0;l<r;l++){let o=t[l];o instanceof mt?t[l]=Ye(e[l]||(e[l]=Le()),o):Ie(o)?al(e[l]||(e[l]=Le()),o,o.length):e[l]=null}r<e.length&&e.splice(r)};function mt(e,t,r){this.type=e,this.template=t,this.values=r}var{create:xn,defineProperties:Nn}=Object,sl=e=>{let t=Ge(new WeakMap),r=l=>(o,...a)=>Ye(l,{type:e,template:o,values:a});return Nn((l,...o)=>new mt(e,l,o),{for:{value(l,o){let a=t.get(l)||t.set(l,xn(null));return a[o]||(a[o]=r(Le()))}},node:{value:(l,...o)=>Ye(Le(),{type:e,template:l,values:o}).valueOf()}})},cl=Ge(new WeakMap),Tt=(e,t)=>{let r=typeof t=="function"?t():t,l=cl.get(e)||cl.set(e,Le()),o=r instanceof mt?Ye(l,r):r;return o!==l.wire&&(l.wire=o,e.textContent="",e.appendChild(o.valueOf())),e},y=sl("html"),oi=sl("svg");var yt={};tr(yt,{ENTRY_MARKED:()=>Ce,MOVED:()=>P,NEW:()=>ie,NEW_KEY:()=>ce,NEW_ORDER:()=>se,NEW_TYPE:()=>U,REMOVED:()=>ae,buildBaseIndices:()=>bn,diff:()=>En});var ie="new",ae="removed",P="moved",se="order_changed",ce="key_changed",U="type_changed",Ce="entry_changed",bn=e=>{let t={};L(e,(r,l)=>(X(r,"_meta",l),Object.assign(t,{[r.$anchor]:r}),delete r._visit,delete r._pruned,r)),e._indices=t},En=(e,t,r={})=>{let l=[],o=t._indices;L(e,(n,d)=>{le(n,"_diff",{});let c=o[n.$anchor];if(c){let s=d.parent,f=c._meta.parent;f.$anchor!=s.$anchor&&Object.assign(n._diff||(n._diff={}),{[P]:{oldParent:f,newParent:s,oldPath:c._meta.path,newPath:d.path}}),c.index!=n.index&&Object.assign(n._diff||(n._diff={}),{[se]:{oldOrder:c.index,newOrder:n.index}}),c.type!=n.type&&Object.assign(n._diff||(n._diff={}),{[U]:{oldType:c.type,newType:n.type,parent:s}}),c.$ref!=n.$ref&&Object.assign(n._diff||(n._diff={}),{[U]:{oldType:c.$ref,newType:n.$ref,parent:s}}),c.const!=n.const&&Object.assign(n._diff||(n._diff={}),{[U]:{oldType:c.const,newType:n.const,parent:s}}),c.key!=n.key&&Object.assign(n._diff||(n._diff={}),{[ce]:{oldKey:c.key,newKey:n.key,parent:s}}),c.isEntry!=n.isEntry&&Object.assign(n._diff||(n._diff={}),{[Ce]:{oldIsEntry:c.isEntry,newIsEntry:n.isEntry,parent:s}}),Object.keys(n._diff).length!=0&&(Object.assign(n._diff,{meta:{level:d.level,path:d.path,parentAnchor:d.parent.$anchor}}),l.push(n)),c._visit=!0}else n._diff={[ie]:{parent:d.parent},meta:{level:d.level,path:d.path,parentAnchor:d.parent.$anchor}},l.push(n),n._pruned=!0;return n});let a=[];return L(t,(n,d)=>(le(n,"_diff",{}),n._visit||(n._diff={[ae]:{parent:d.parent},meta:{level:d.level,path:d.path,parentAnchor:d.parent.$anchor}},a.push(n),n._pruned=!0),n)),l=l.concat(a),l};var dl=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),ht(e,"title",t),ht(e,"description",t),An(e,"rw",["rw","r","w"],t),Bt(e,"required",t),vn(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},vn=(e,t)=>{switch(e.type){case E:kn(e,t);break;case $:$n(e,t);break;case g:Dn(e,t);break;case A:On(e,t);break;case K:_n(e,t);break;case q:case W:case B:case F:case G:case H:fl(e,t,{min:e.min,max:e.max});break;case Y:case z:fl(e,t);break;case J:wn(e,t);break;case fe:gn(e,t);break}},_n=(e,t)=>{Mn(e,"pattern",t),ee(e,"min",t,{min:0}),ee(e,"max",t,{min:0}),ze(e,t),ht(e,"default",t,Object.assign(ul(e,["min","max","pattern"]),{ignoreEmpty:!0}))},wn=(e,t)=>{Bt(e,"default",t)},fl=(e,t,r)=>{xt(e,"min",t,r),xt(e,"max",t,r),ee(e,"multipleOf",t),ze(e,t),xt(e,"default",t,ul(e,["min","max","multipleOf"]))},gn=(e,t)=>{Sn(e,"default",t)},kn=(e,t)=>{ee(e,"min",t,{min:0}),ee(e,"max",t,{min:0}),ze(e,t)},$n=(e,t)=>{ee(e,"min",t,{min:1}),ee(e,"max",t,{min:1}),ze(e,t),Bt(e,"unique",t)},Dn=(e,t)=>{ee(e,"min",t,{min:1}),ee(e,"max",t,{min:1}),ze(e,t)},On=(e,t)=>{},ul=(e,t=[])=>{let r={};for(let l of t)(e.errors[l]||[]).length==0&&(typeof e.changes[l]=="number"?(e.changes[l]||e.changes[l]==0)&&(r[l]=e.changes[l]):r[l]=e.changes[l]);return r},ht=(e,t,r,l={})=>{if(!r.hasOwnProperty(t)||l.ignoreEmpty&&r[t]=="")return;let o=r[t],a=2**18;(d=>new Blob([d]).size)(o)>a?D(e,t,`string size limit is ${Math.ceil(a/1024)} KB`):l.max&&o.length>l.max?D(e,t,`must be less than or equal ${l.max} length`):l.min&&o.length<l.min?D(e,t,`must be grater than or equal ${l.min} length`):l.pattern?new RegExp(l.pattern).test(o)||D(e,t,`must matche pattern ${l.pattern}`):e.changes[t]=o},Bt=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let l=In(r[t]);l==null?D(e,t,"must be boolean"):e.changes[t]=l},xt=(e,t,r,l={})=>{if(!r.hasOwnProperty(t))return;let o=Ht(r[t]);!o&&o!=0?D(e,t,"must be number"):l.min&&o<l.min?D(e,t,`must be greater than or equal ${l.min}`):l.max&&o>l.max?D(e,t,`must be less than than or equal ${l.max}`):l.multipleOf&&o%l.multipleOf!=0?D(e,t,`must be multiple of ${l.multipleOf}`):e.changes[t]=o},ee=(e,t,r,l)=>{if(!r.hasOwnProperty(t))return;xt(e,t,r,l);let o=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?D(e,t,"must be integer number"):o>Number.MAX_SAFE_INTEGER?D(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):o<Number.MIN_SAFE_INTEGER&&D(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},Mn=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(ht(e,t,r),(e.errors[t]||[]).length==0))try{let l=r[t];if(l=="")return;e.changes[t]=new RegExp(l)}catch(l){D(e,t,"invalid regex")}},ze=(e,t)=>{if(t.min&&t.max){let r=Ht(t.min),l=Ht(t.max);(r||r==0)&&(l||l==0)&&r>l&&(D(e,"min","min is greater than max"),D(e,"max","max is less than min"))}},Sn=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?D(e,t,"must be null"):e.changes[t]=r[t])},An=(e,t,r,l)=>{!l.hasOwnProperty(t)||(r.includes(l[t])?e.changes[t]=l[t]:D(e,t,"value must be r, w, or rw"))},D=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},Ht=e=>pl(e,"number"),In=e=>pl(e,"boolean");var pl=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=a=>["checkbox","radio"].includes(a.type)?a.checked:a.value,r=this.querySelector("form").elements,l={};for(let a=0;a<r.length;a++){let n=t(r[a]);!(r[a]instanceof HTMLTextAreaElement)&&n==""||(l[r[a].name]=n)}let o={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:l};this.dispatchEvent(new CustomEvent("sch-update",{detail:o,bubbles:!0}))}}});var Yt=(e,t,r)=>{try{Tt(e,y.for(t)`
    <p class="meta-def">${Ln(t.rootKey,t.path)||"-"} : <span>${t.type}</span></p>
    <form data-path="${t.path}" data-file="${t.rootKey}" class="fbox">
      ${Nt(t,"title",{keyDisplay:"Title"})}
      ${Nt(t,"description",{keyDisplay:"Description"})}
      ${Pn(t)}
      ${Cn(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:v(t,"rw")||"rw",keyDisplay:"Read / Write"})}
      ${Rn(t,"default",{keyDisplay:"Default",min:v(t,"min"),max:v(t,"max")})}
    </form>
  `)}catch(l){console.log(l),location.reload()}},Ln=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(l=>l!=""),t.splice(0,0,e);let r=y`<span style="color: var(--meta-def-color);">${t[0]} :: ${t[1]}</span>`;return t=t.slice(2).flatMap(l=>[y`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(l)]),t.splice(0,0,r),t},Je=(e,t,r,l={})=>{var o;return y`
  <label class="${l.readonly&&`box-label ${t} readonly`||`box-label ${t}`}">
    <p class="l">${l.keyDisplay||t} ${l.readonly&&y`<span>· readonly</span>`}</p>
    ${r}
    ${(o=bt(e,t))==null?void 0:o.map(a=>y`<p class="err">${a}</p>`)}
  </label>
  `},Nt=(e,t,r={})=>Je(e,t,y`
    <textarea name="${Ve(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${bt(e,t)&&"invalid"}" oninput="${Ue}">${r.value||v(e,t)}</textarea>
  `,r),he=(e,t,r={})=>Je(e,t,y`
    <input type="number" name="${Ve(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${r.min}" max="${r.max}" value="${r.value||v(e,t)}" ?readonly="${r.readonly}" class="${bt(e,t)&&"invalid"}">
  `,r),de=(e,t,r={})=>Je(e,t,y`
    <input type="number" name="${Ve(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${r.value||v(e,t)}" ?readonly="${r.readonly}" class="${bt(e,t)&&"invalid"}">
  `,r),zt=(e,t,r={})=>Je(e,t,y`
    <input type="checkbox" name="${Ve(e,t)}" ?disabled="${r.readonly}" ?checked="${r.value||v(e,t)}">
  `,r),Cn=(e,t,r={})=>Je(e,t,y`
    <select name="${Ve(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([l,o])=>y`<option value="${l}" ?selected="${(r.selected||v(e,t))==l}">${o}</option>`)}
    </select>
  `,r),Rn=(e,t,r={})=>{switch(e.type){case J:return zt(e,t,r);case q:case W:case B:case F:case G:case H:case Y:case z:return he(e,t,r);case K:return Nt(e,t,r);default:return""}},Ve=(e,t)=>t,v=(e,t)=>(e.metadata||{})[t],Pn=e=>{let t;switch(e.type){case E:let a=0;for(let n of e.fields)v(n,"required")&&a++;t=[de(e,"min",{keyDisplay:"Min Properties",value:a,readonly:!0}),de(e,"max",{keyDisplay:"Max Properties",value:e.fields.length,min:Math.max(v(e,"min")||0,0)})];break;case $:t=[de(e,"min",{keyDisplay:"Min Items",min:1,value:1,max:v(e,"max")}),de(e,"max",{keyDisplay:"Max Items",min:v(e,"min")}),zt(e,"unique",{keyDisplay:"Item uniqueness"})];break;case g:t=[de(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),de(e,"max",{keyDisplay:"Max Items",value:v(e,"max")||e.schs.length})];break;case K:t=[de(e,"min",{keyDisplay:"Min Length",min:0,max:v(e,"max")}),de(e,"max",{keyDisplay:"Max Length",min:Math.max(0,v(e,"min"))}),Nt(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case q:case W:case B:case F:case G:case H:t=[he(e,"min",{keyDisplay:"Min",min:e.min,max:Math.min(v(e,"max"),e.max)}),he(e,"max",{keyDisplay:"Max",min:Math.max(v(e,"min"),e.min),max:e.max}),he(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:Math.min(v(e,"max"),e.max)})];break;case Y:case z:t=[he(e,"min",{keyDisplay:"Min",max:v(e,"max")}),he(e,"max",{keyDisplay:"Max",min:v(e,"min")}),he(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:v(e,"max")})];break;case J:t=[];case fe:t=[];case A:t=[];case Ne:t=[];case R:t=[];case V:t=[];default:t=[]}let r=e._meta.parent.type==E,l=e._meta.level>2,o=!e.isKeyPattern;return r&&l&&o&&t.push(zt(e,"required",{keyDisplay:"Required"})),t};var bt=(e,t)=>e.errors&&e.errors[t];var Jt=(e,t,r={})=>{var l;try{let o={level:1,tab:((l=r.ui)==null?void 0:l.tab)||0,models:t._models||{},schMetas:t.schMetas,rootKey:t.key,taggedLevel:t.taggedLevel};o.rootLevel=o.level,Object.assign(o,r.ui),r.ui.lineClass&&Object.assign(o,{tab:r.ui.tab+2}),Un(e,{sch:t,ui:o,path:t.path||"",key:t.key,parent:t})}catch(o){console.log(o)}},Un=(e,t)=>Tt(document.querySelector(e),y`
  <ul role="tree" aria-multiselectable="true" class="${`${t.ui.lineClass||""} text-sm`}" aria-labelledby="${t.ui.taggedLevel[t.ui.level]+"_tree"}">
    ${Xe(t)}
  </ul>
`),ml=e=>{if(!e)return"";for(let t of Object.keys(e))switch(t){case ie:return"N";case ae:return"R";case P:return"M";case se:return"";case ce:return"C";case U:return"C";case Ce:return"C"}},Xe=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return jn(e);case[$].includes(e.sch.type):return Object.assign(e.ui,{expanded:!1}),Tl(e);case ar.includes(e.sch.type):return Object.assign(e.ui,{expanded:!0}),Tl(e);default:return Kn(e)}},jn=e=>y.for(e.parent,e.sch.$anchor)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" id="${e.ui.taggedLevel[e.ui.level]+"_tree"}">
      ${Vt(e.key)}
    </dfn>
    <ul data-group="${hl(e.sch)}" role="group" tabindex="-1">
      ${yl(e)}
    </ul>
  </li>`,Tl=e=>y.for(e.parent,e.sch.$anchor)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" .dataset="${{diff:ml(e.sch._diff),groupSize:qn(e.sch)}}">
      ${xl(Object.assign(e,{key:Vt(e.key)}))}
      ${Nl(e)}
      ${bl(e)}
    </dfn>
    <ul data-group="${hl(e.sch)}" role="group">
      ${yl(e)}
    </ul>
  </li>`,Kn=e=>y.for(e.parent,e.sch.$anchor)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level],diff:ml(e.sch._diff)}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${xl(Object.assign(e,{key:Vt(e.key)}))}
    ${Nl(e)}
    ${bl(e)}
  </li>`,yl=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return y``;switch(!0){case[E].includes(e.sch.type):return Fn(e);case[g].includes(e.sch.type):return Wn(e);case[$].includes(e.sch.type):return Gn(e);case[A].includes(e.sch.type):return Bn(e);default:return y``}},Fn=e=>{let t=[];for(let r=0;r<e.sch.fields.length;r++)t.push(Xe({key:e.sch.fields[r].key,sch:e.sch.fields[r],parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[${e.sch.fields[r].key}]`}));return t},Wn=e=>{let t=[];for(let r=0;r<e.sch.schs.length;r++)t.push(Xe({key:r,sch:e.sch.schs[r],parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`}));return t},Gn=e=>Xe({key:0,sch:e.sch.sch,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:0,parentPath:e.path},path:`${e.path}[][${0}]`}),Bn=e=>{let t=[];for(let r=0;r<e.sch.schs.length;r++)t.push(Xe({key:"",sch:e.sch.schs[r],parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`}));return t},Qe=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab-1}rem`,El=(e,t,r)=>y`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${Ue}"
  onfocus="${_r}"
  >${r}</textarea>`,xl=e=>e.ui.level==e.ui.rootLevel+1?Hn(e):Yn(e),Hn=e=>y`
  <span class="def" style="${Qe(e)}">
    ${zn(e.sch,e.ui)}
  </span>
  <span class="k">${Xt(e)}</span>
  <span class="s">=</span>
  `,Yn=e=>{switch(!0){case e.parent.type==A:return y`
      <span class="" style="${Qe(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==$:return y`
      <span class="k" style="${Qe(e)}"></span>
      <span class="s">└</span>
      `;case e.parent.type==E:let t=e.ui.schMetas[e.sch.$anchor];return y`
      <span class="k" style="${Qe(e)}" .dataset="${{required:t==null?void 0:t.required}}">
        ${Xt(e)}
      </span>
      <span class="s">:</span>
    `;default:return y`
      <span class="k" style="${Qe(e)}">
        ${Xt(e)}
      </span >
      <span class="s">:</span>
    `}},Xt=e=>e.sch.uiMode=="editKey"?El("key-edit",e.ui.parentPath,e.key):y`${e.key}`,Nl=e=>e.ui.level==e.ui.rootLevel+1?Jn(e):Vn(e),Jn=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):y`<span class="t">${vl(e)}</span>`,Vn=e=>y`<span class="t">${vl(e)}</span>`,vl=e=>e.sch.uiMode=="editType"?y`<combo-box id="type_search" list="typesearch">
      ${El("type-edit",e.ui.parentPath,Qt(e.sch,e.ui))}
    </combo-box>`:y`${Al(e.sch,e.ui)}`,Qt=(e,t)=>{var r;switch(!0){case e.type==V:return JSON.stringify(e.const);case e.type==R:return(r=t.models[e.$ref])==null?void 0:r.display;default:return e.type}},Al=(e,t)=>{let r;switch(!0){case(e.type==E&&e.fields.length==0):r="{ any }";break;case e.type==E:r="{ \xA0 }";break;case e.type==$:r=y`[\xa0 ${Al(e.sch,t)} \xa0]`;break;case e.type==g:r="( \xA0 )";break;case e.type==K:r="string";break;case e.type==q:r="int_8";break;case e.type==W:r="int_16";break;case e.type==B:r="int_32";break;case e.type==F:r="uint_8";break;case e.type==G:r="uint_16";break;case e.type==H:r="uint_32";break;case e.type==Y:r="float_32";break;case e.type==z:r="float_64";break;case e.type==kt:r="timestamp";break;case e.type==J:r="bool";break;case e.type==fe:r="null";break;case e.type==A:r="||";break;case e.type==Ne:r="any";break;case(e.type==R&&!!t.models[e.$ref]):r=y`<span class="ref">${e._text=Qt(e,t)}</span>`;break;case e.type==R:r=y`<span class="ref notfound" title="Ref type">${`${e._text||"reference"} (#404)`}</span>`;break;case e.type==V:r=y`<span class="value" title="Value type">${Qt(e,t)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},Vt=e=>e,hl=e=>{switch(!0){case[E].includes(e.type):return"keyed";case[g,A].includes(e.type):return"indexed";default:return"none"}},qn=e=>{switch(!0){case[E].includes(e.type):return e.fields.length;case[g,A].includes(e.type):return e.schs.length;case[$].includes(e.type):return 1;default:return 0}},zn=(e,t)=>{let r;switch(!0){case e.type==E:r="record";break;case e.type==$:r="list";break;case e.type==g:r="tuple";break;case e.type==A:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},bl=e=>{let t=e.ui.schMetas[e.sch.$anchor],r;switch(!0){default:r=[]}return r};var _l=({store:e,target:t,select:r,focus:l=!0})=>{Ft({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",Pt],["shift-meta-ArrowDown",Ut],["shift-ArrowUp",jt],["shift-ArrowDown",Kt],["meta-ArrowUp",Ae],["meta-ArrowDown",_e],["ArrowUp",we],["ArrowDown",ge],["Home",ke],["End",$e],["shift-+",Oe],["Enter",qe],["Delete",oe],["m",Se],["meta-v",me],["shift-alt-ArrowUp",Te],["shift-alt-ArrowDown",ye],["alt-ArrowUp",Fe],["alt-ArrowDown",We],["Escape",({tree:o})=>Z(o)]],textAreaKeyDownCmd:[["Enter",Me],["Escape",qt]],view:o=>Jt(t,o||e,{ui:{depthLimit:2,tab:.25,modelTypeText:(a,n)=>"file",typeText:(a,n)=>{if(a.type==T.RECORD)return"record";if(a.type==T.VALUE)return"value";if(a.type==T.TUPLE)return"tuple";if(a.type==T.UNION)return"union"},viewTypeTop:a=>""}}),opts:{focus:l,selectId:r}})},Et=({store:e,target:t,select:r,focus:l})=>{Ft({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",Pt],["shift-meta-ArrowDown",Ut],["shift-ArrowUp",jt],["shift-ArrowDown",Kt],["meta-ArrowUp",Ae],["meta-ArrowDown",_e],["ArrowUp",we],["ArrowDown",ge],["Home",ke],["End",$e],["shift-+",Oe],["Enter",qe],["shift-Enter",dt],["Delete",oe],["m",Se],["meta-x",Sr],["meta-c",Ir],["meta-v",me],["shift-alt-ArrowUp",Te],["shift-alt-ArrowDown",ye],["alt-ArrowUp",Fe],["alt-ArrowDown",We],["ArrowRight",Rr],["ArrowLeft",Pr],["Escape",({tree:o})=>Z(o)]],textAreaKeyDownCmd:[["Enter",Me],["Escape",qt]],view:o=>Jt(t,o||e,{ui:{lineClass:"setnu",tab:1,modelTypeText:(a,n)=>a.isEntry?"entrypoint":"type"}}),opts:{focus:l,selectId:r}})},vt=({store:e,target:t,treeTarget:r})=>{let l=document.querySelector(t),o=document.querySelector(`${r} [role='tree']`);!l||!o||(Object.defineProperty(e,"renderSchMeta",{value:function(a){Xn({tree:o,store:a||this,metaForm:l})},configurable:!0}),e.renderSchMeta())},Xn=({tree:e,store:t,metaForm:r})=>{let l=e.querySelectorAll("[role='treeitem'][aria-selected='true']");if(l.length==1){let o=ue(t,l[0].id);o&&(o.path=l[0].id,o.rootKey=e.querySelector(".root-item").key,o.metadata=t.schMetas[o.$anchor],Yt(r,o,t))}};var te="file",Re="project",gl=(e,t)=>{Object.assign(t,e);for(let r=0;r<e.fields.length;r++)t.fields[r]=Qn(e.fields[r],wl(),t);return le(t,"schMetas",e.schMetas),M(()=>t)},Qn=(e,t,r)=>(Object.assign(t,e),M(()=>t)),$l=()=>kl({taggedLevel:{1:Re,2:te,3:S},allowedSchs:[wl],put:{pos:"prepend",onlyDst:{[te]:!0}}}),wl=()=>kl({taggedLevel:{1:te,2:S},addDefault:rt,entryable:[S],put:{pos:"prepend"}}),kl=(e={})=>{let t=M(rt);return t.allowedSchs=(e.allowedSchs||Zt).map(r=>r()),t.taggedLevel=e.taggedLevel,e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.type==e.addDefault().type)&&e.addDefault()),t},xe=(e,t)=>{let r=ue(e,`[${t}]`);return r&&le(r,"schMetas",e.schMetas),r},Ze=e=>{let t={};return er(e,(r,l)=>{t[r.$anchor]={display:[l.file.key,r.key].join(" :: "),file:l.file.key,fmodel:r.key}}),t},er=(e,t)=>{for(let r of e.fields)for(let l=0;l<r.fields.length;l++)r.fields[l]=t(r.fields[l],{path:`[${r.key}][${r.fields[l].key}]`,file:r})||r.fields[l]},Zt=[sr,rt,br,Er,vr,re,cr,Nr,()=>lt('"json string"'),dr,fr,ur,pr,mr,Tr,yr,hr,xr];var Dl=(e,t,r,l)=>{let o=t.closest("[data-tag='file']"),a=o==null?void 0:o.key;t.closest("[id='project']")?Zn(e,a,r,l):t.closest("[id='fmodel']")&&eo(e,a,t,r,l)},Zn=(e,t,r,l)=>{switch(!0){case to(r.name):et(e,t),e.render();break;case Ol(r.name):et(e,t),e.render();break;case ro(r.name):et(e,t),e.render();break;default:e.render()}},eo=(e,t,r,l,o)=>{let a;switch(!0){case no(l.name):if(r.dataset.tag!=S)return;er(e,(n,d)=>(d.path!=`[${t}]${r.id}`&&n.isEntry&&delete n.isEntry,n)),a=xe(e,t),a.render();break;case Ol(l.name):a=xe(e,t),a._models=Ze(e),a.render();break;case lo(l.name):a=xe(e,t),a.render(),a.renderSchMeta()}},et=(e,t,r=null,l=!1)=>{let o=xe(e,t);if(o&&(o._models=Ze(e),Et({store:o,target:"[id='fmodel']",select:r,focus:l}),vt({store:o,target:"[id='fsch']",treeTarget:"[id='fmodel']"}),!window._treeClipboard)){let a=document.querySelector("[id='fmodel'] [role='tree']");a._aria.clearClipboard(a)}},Ml={update:({store:e,detail:t})=>{let{path:r,attrs:l}=t,o=Q(e,r,(a,n)=>dl(a,l));return e.render&&e.render(e),Object.assign(e.schMetas,{[o.$anchor]:o.metadata}),e.renderSchMeta&&e.renderSchMeta(e),o}},lo=e=>[we,ge,Ae,_e,ke,$e,De].map(t=>t.name).includes(e),to=e=>[we,ge,Ae,_e,ke,$e,De,Te,ye,oe].map(t=>t.name).includes(e),Ol=e=>[Oe,oe,Me,me].map(t=>t.name).includes(e),Sl=e=>[Oe,oe,Me,me,Te,ye,Fe,We,oe,Se].map(t=>t.name).includes(e),no=e=>[Se,me,Te,ye].map(t=>t.name).includes(e),ro=e=>[qe,dt].map(t=>t.name).includes(e);var Il=(e,t)=>{let r=x=>{for(let p of e.fields)for(let b of p.fields)if(x==b.key)return{file:p,fmodelDst:fmodel}},l=x=>be(e,(p,b)=>{if(e.taggedLevel[b.level]==S&&b.path!="")return x.startsWith(b.path)},(p,b)=>(X(p,"_meta",b),p)),o=({$anchor:x,key:p,index:b,type:w})=>({$anchor:x,key:p,index:b,type:w}),a=x=>o(x),n=x=>x,d=e._diffToRemote,c={};c.files=[],c.fmodels=[],c.subfmodels=[];for(let x of d){let p=e.taggedLevel[x._diff.meta.level];p==Re?c.project=x:p==te?c.files.push(x):p==S?c.fmodels.push(x):c.subfmodels.push(x)}let s={},f={},u={};c.project&&(s.project=a(c.project));for(let x=0;x<c.files.length;x++){let p=c.files[x],b=o(p),w=p._diff.meta.path;if(f.files||(f.files={}),u.files||(u.files={}),s.files||(s.files={}),f.fmodels||(f.fmodels={}),u.fmodels||(u.fmodels={}),p._diff[ie]){f.files[w]=b;for(let j of p.fields)f.fmodels[`[${p.key}][${j.key}]`]={...n(j),parentAnchor:b.$anchor}}p._diff[ae]&&(u.files[w]={$anchor:b.$anchor}),(p._diff[se]||p._diff[ce])&&(s.files[w]=b),p._diff[P]&&console.log("project does not permit as parent for moving items"),p._diff[U]&&console.log("file type is always record, cannot be changed")}for(let x=0;x<c.fmodels.length;x++){let p=c.fmodels[x],b=n(p),w=p._diff.meta.path,j=p._diff.meta.parentAnchor;if(s.files||(s.files={}),f.fmodels||(f.fmodels={}),u.fmodels||(u.fmodels={}),s.fmodels||(s.fmodels={}),p._diff[ie]&&(f.fmodels[w]={...b,parentAnchor:j}),p._diff[ae]&&(u.fmodels[w]={$anchor:b.$anchor,parentAnchor:j}),(p._diff[se]||p._diff[ce]||p._diff[U]||p._diff[Ce])&&(s.fmodels[w]={...b,parentAnchor:j}),p._diff[P]){let{oldParent:C,newParent:Pe,oldPath:Ll,newPath:Cl}=p._diff[P];switch(e.taggedLevel[C.level]){case Re:console.log("fmodel was not possible to be a file");break;case te:var m=e.fields.find(Rl=>Rl.key==C.key),h=o(m);s.files[C.path]=h,u.fmodels[Ll]={$anchor:p.$anchor,parentAnchor:h.$anchor};break;case S:var _=r(C.key),h=_.file;s.fmodels[C.path]={...n(_.fmodelDst),parentAnchor:h.$anchor};break;default:var O=l(C.path),_=r(O.key),h=_.file;s.fmodels[O._meta.path]={...n(O),parentAnchor:h.$anchor}}switch(e.taggedLevel[Pe.level]){case te:var m=e.fields.find(At=>At.key==Pe.key),h=o(m);s.files[Pe.path]=h,f.fmodels[Cl]={...b,parentAnchor:h.$anchor};break;default:console.log("fmodel parent can only be file tag")}}}for(let x=0;x<c.subfmodels.length;x++){let p=c.subfmodels[x],b=p._diff.meta.path;if(s.files||(s.files={}),f.fmodels||(f.fmodels={}),u.fmodels||(u.fmodels={}),s.fmodels||(s.fmodels={}),p._diff[ie]||p._diff[ae]||p._diff[se]||p._diff[ce]||p._diff[U]){let w=l(b),C=r(w.key).file;s.fmodels[w._meta.path]={...n(w),parentAnchor:C.$anchor}}if(p._diff[P]){let{oldParent:w,newParent:j,oldPath:C,newPath:Pe}=p._diff[P];switch(e.taggedLevel[w.level]){case Re:console.log("subfmodel was not possible to be a file");break;case te:var m=e.fields.find(At=>At.key==w.key),h=o(m);s.files[w.path]=h,u.fmodels[C]={$anchor:p.$anchor,parentAnchor:h.$anchor};break;case S:default:var O=l(w.path),_=r(O.key),h=o(_.file);s.fmodels[O._meta.path]={...n(O),parentAnchor:h.$anchor}}switch(e.taggedLevel[j.level]){case Re:console.log("subfmodel parent can only be fmodel or subfmodel");break;case te:console.log("subfmodel parent can only be fmodel or subfmodel");break;case S:default:var O=l(Pe),_=r(O.key),h=_.file;s.fmodels[O._meta.path]={...n(O),parentAnchor:h.$anchor}}}}return console.log({changed:s,added:f,removed:u}),t({changed:s,added:f,removed:u})};var oo={createProjectStore:$l,getFileStore:xe,anchorsModels:Ze,projectToStore:gl,controller:Dl,changeFile:et,taggedDiff:Il,isDiffableCmd:Sl,SchMeta:Ml,allSchs:Zt};export{yt as Diff,Et as FmodelTree,oo as Project,_l as ProjectTree,vt as SchMetaForm};
/*! (c) Andrea Giammarchi - ISC */
