var Yr=Object.defineProperty;var He=(e,t)=>{for(var r in t)Yr(e,r,{get:t[r],enumerable:!0})};var Ee,Vr=new Uint8Array(16);function Ye(){if(!Ee&&(Ee=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Ee))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ee(Vr)}var wt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Jr(e){return typeof e=="string"&&wt.test(e)}var gt=Jr;var w=[];for(var Ve=0;Ve<256;++Ve)w.push((Ve+256).toString(16).substr(1));function zr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(w[e[t+0]]+w[e[t+1]]+w[e[t+2]]+w[e[t+3]]+"-"+w[e[t+4]]+w[e[t+5]]+"-"+w[e[t+6]]+w[e[t+7]]+"-"+w[e[t+8]]+w[e[t+9]]+"-"+w[e[t+10]]+w[e[t+11]]+w[e[t+12]]+w[e[t+13]]+w[e[t+14]]+w[e[t+15]]).toLowerCase();if(!gt(r))throw TypeError("Stringified UUID is invalid");return r}var Ot=zr;function Qr(e,t,r){e=e||{};var l=e.random||(e.rng||Ye)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=l[a];return t}return Ot(l)}var Je=Qr;var N="record",A="list",$="tuple",q="string",W="number",$e="integer",K="boolean",Q="null",E="union",ee="any",R="ref",S="value",At=[N,$,A,E],L="fmodel";var B=()=>({type:ee}),Dt=()=>({type:q}),Mt=()=>({type:K}),St=()=>({type:W}),Rt=()=>({type:Q}),ze=()=>({type:N,fields:{},order:[]}),Lt=()=>({type:A,sch:D(B)}),Ct=()=>({type:$,schs:[D(B)]}),It=()=>({type:E,schs:[D(B)]}),Pt=e=>({type:R,$ref:e}),Qe=e=>{try{return e=JSON.parse(e),e==null||[q,W,K].includes(typeof e)?{type:S,const:e}:!1}catch(t){return!1}},D=(e,t={})=>{let r=e();return r.$anchor||(r.$anchor=Je()),t.force&&(r.$anchor=Je()),t.tag&&(r._tag=t.tag),r};var ke=e=>{let t=JSON.parse(JSON.stringify(e));return C(t,(r,l)=>D(()=>r,{force:!0})),t},Ut=e=>C(JSON.parse(JSON.stringify(e)),(t,r)=>{let{type:l,$anchor:a,key:n,_tag:o,isEntry:d,parentAnchor:c}=t,s={type:l,$anchor:a,key:n,_tag:o,parentAnchor:c};switch(d&&Object.assign(s,{isEntry:d}),t.type){case N:let{fields:f,order:u}=t;return Object.assign(s,{fields:f,order:u});case $:case E:let{schs:m}=t;return Object.assign(s,{schs:m});case A:let{sch:v}=t;return Object.assign(s,{sch:v});case S:let{const:h}=t;return Object.assign(s,{const:h});case R:let{$ref:_}=t;return Object.assign(s,{$ref:_});default:return Object.assign(s,{})}}),C=(e,t,r={path:"",level:1,parent:{}})=>{if(delete e._halt,e=t(e,r),e._halt)return e;let l=({_tag:a,type:n,$anchor:o,key:d},{path:c,level:s,parent:{prune:f}})=>({_tag:a,level:s,type:n,$anchor:o,key:d,path:c,prune:f});switch(!0){case[N].includes(e.type):let a=Object.keys(e.fields);for(let d=e.order.length-1;d>=0;d--){let c=e.order[d],s=e.fields[c],f={path:`${r.path}[${c}]`,level:r.level+1,index:d,parent:l(e,r)};if(s=C(s,t,f),s.key=c,e.fields[c]=s,s._halt)return Object.assign(e,{_halt:!0})}break;case[$,E].includes(e.type):for(let d=0;d<e.schs.length;d++){let c=e.schs[d],s={path:`${r.path}[][${d}]`,level:r.level+1,index:d,parent:l(e,r)};if(c=C(c,t,s),e.schs[d]=c,c._halt)return Object.assign(e,{_halt:!0})}break;case[A].includes(e.type):let n={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:l(e,r)},o=C(e.sch,t,n);if(e.sch=o,o._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Xr=(e,t,r)=>{let l={original:{},popped:[]},a=r.sort((n,o)=>o-n);return C(e,(n,o)=>{if(o.path!=t)return n;switch(n.type){case N:let d=a.map(c=>[c,n.order[c]]).filter(([c,s])=>s);for(let[c,s]of d)l.popped.unshift({k:s,sch:n.fields[s],index:c}),delete n.fields[s];for(let c of a)n.order.splice(c,1);break;case A:break;case $:for(let c of a)l.popped.unshift({k:c,sch:n.schs.splice(c,1)[0],index:c});n.schs.length==0&&n.schs.splice(0,0,D(B));break;case E:for(let c of a)l.popped.unshift({k:c,sch:n.schs.splice(c,1)[0],index:c});n.schs.length==0&&n.schs.splice(0,0,D(B));break;default:}return n}),l},Zr=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),we=(e,t,r)=>{let l={original:{},inserted:[]},a=r.sort((o,d)=>o.index-d.index),n=(o,d)=>(o=Math.max(o,0),o=Math.min(o,d.length),o);return C(e,(o,d)=>{var c;if(d.path!=t)return o;switch(o.type){case N:let s=(c=e.taggedLevel)==null?void 0:c[d.level+1];for(let{k:f,sch:u,index:m}of a){for(f=f==0?"0":f,f=f||`${s||"key"}_${Math.floor(Date.now()/100)}`,f=`${f}`;o.fields[f];)f=`${f} \u2013`;m=n(m,o.order),o.fields[f]=D(u),o.order.splice(m,0,f),l.inserted.push({k:f,sch:o.fields[f],index:m})}break;case A:break;case $:for(let{k:f,sch:u,index:m}of a)m=n(m,o.schs),o.schs.splice(m,0,D(u)),l.inserted.push({k:f,sch:o.schs[m],index:m});break;case E:for(let{k:f,sch:u,index:m}of a)m=n(m,o.schs),o.schs.splice(m,0,D(u)),l.inserted.push({k:f,sch:o.schs[m],index:m});default:}return o}),l},Oe=(e,{dstPath:t,startIndex:r=0},l)=>{let a=(c,s,f)=>F(c,s,(u,m)=>(u._pinId=f,u)),n=Symbol(t);a(e,t,n);let o=ge(e,l,{dstPath:t});return Xe(e,{dstPin:n,startIndex:r},o)},ge=(e,t,r={})=>{let l={},a=Zr(Object.keys(t));for(let n of a){let o=t[n],d=f=>{var u;return(u=o.find(m=>m.index==f))==null?void 0:u.newK};if(r.dstPath&&o.filter(u=>r.dstPath.startsWith(u.id)).length!=0)continue;let s=Xr(e,n,o.map(f=>f.index)).popped.map(({k:f,sch:u,index:m})=>({k:d(m)||f,sch:()=>u}));l[n]=s}return l},Xe=(e,{dstPin:t,dstPath:r,startIndex:l=0},a)=>{let n=(s,f)=>te(s,(u,m)=>u._pinId==f,(u,m)=>(u._pinned=m,u));l=Math.max(l,0);let o={},d=Object.values(a).flatMap(s=>s).map((s,f)=>({...s,index:l+f}));if(t){let s=n(e,t);s&&(r=s._pinned.path)}let c=we(e,r,d);return c.inserted.length!=0&&(o[r]=c.inserted),o},tt=(e,{dstPath:t,startIndex:r=0},l)=>{let a=Ze(e,l,{dstPath:t,startIndex:r});return et(e,{dstPath:t},a)},Ze=(e,t,r={})=>Object.values(t).reduce((l,a)=>{let n=a.map(d=>d.id),o=[];te(e,(d,c)=>(n.includes(c.path)&&(d._meta=c,o.unshift(d)),o.length==n.length),(d,c)=>d);for(let d of a){if(r.dstPath&&r.dstPath.startsWith(d.id))continue;let c=o.find(s=>s._meta.path==d.id);c&&l.unshift({k:d.key,sch:()=>ke(c),index:r.startIndex+l.length,id:d.id})}return l},[]),et=(e,{dstPath:t},r)=>{let l={},a=we(e,t,r);return a.inserted.length!=0&&(l[t]=a.inserted),l},Ae=(e,t,r)=>F(e,t,(l,a)=>{let n=D(r);switch(!0){case n.type==R:case n.type==S:case n.type!=l.type:let{title:o,description:d,rw:c,required:s,$anchor:f,key:u}=l;return Object.assign(n,{metadata:{title:o,description:d,rw:c,required:s},$anchor:f,key:u}),n;default:return l}}),re=(e,t)=>te(e,(r,l)=>l.path==t,(r,l)=>(r._meta=l,r)),F=(e,t,r)=>te(e,(l,a)=>a.path==t,r),te=(e,t,r)=>{let l;return C(e,(a,n)=>t(a,n)?(l=r(a,n),l._halt=!0,l):a),l&&delete l._halt,l};var ce=e=>({get:t=>e.get(t),set:(t,r)=>(e.set(t,r),r)});var jt=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,el=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,tl=/<[a-z][^>]+$/i,rl=/>[^<>]*$/,ll=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,nl=/\s+$/,qt=(e,t)=>0<t--&&(tl.test(e[t])||!rl.test(e[t])&&qt(e,t)),al=(e,t,r)=>el.test(t)?e:`<${t}${r.replace(nl,"")}></${t}>`,Wt=(e,t,r)=>{let l=[],{length:a}=e;for(let o=1;o<a;o++){let d=e[o-1];l.push(jt.test(d)&&qt(e,o)?d.replace(jt,(c,s,f)=>`${t}${o-1}=${f||'"'}${s}${f?"":'"'}`):`${d}<!--${t}${o-1}-->`)}l.push(e[a-1]);let n=l.join("").trim();return r?n:n.replace(ll,al)};var{isArray:le}=Array,{indexOf:Kt,slice:De}=[];var il=1,Gt=111,ol=({firstChild:e,lastChild:t})=>{let r=document.createRange();return r.setStartAfter(e),r.setEndAfter(t),r.deleteContents(),e},Bt=(e,t)=>e.nodeType===Gt?1/t<0?t?ol(e):e.lastChild:t?e.valueOf():e.firstChild:e,Ft=e=>{let{childNodes:t}=e,{length:r}=t;if(r<2)return r?t[0]:e;let l=De.call(t,0),a=l[0],n=l[r-1];return{ELEMENT_NODE:il,nodeType:Gt,firstChild:a,lastChild:n,valueOf(){if(t.length!==r){let o=0;for(;o<r;)e.appendChild(l[o++])}return e}}};var Ht=(e,t,r,l,a)=>{let n=r.length,o=t.length,d=n,c=0,s=0,f=null;for(;c<o||s<d;)if(o===c){let u=d<n?s?l(r[s-1],-0).nextSibling:l(r[d-s],0):a;for(;s<d;)e.insertBefore(l(r[s++],1),u)}else if(d===s)for(;c<o;)(!f||!f.has(t[c]))&&e.removeChild(l(t[c],-1)),c++;else if(t[c]===r[s])c++,s++;else if(t[o-1]===r[d-1])o--,d--;else if(t[c]===r[d-1]&&r[s]===t[o-1]){let u=l(t[--o],-1).nextSibling;e.insertBefore(l(r[s++],1),l(t[c++],-1).nextSibling),e.insertBefore(l(r[--d],1),u),t[o]=r[d]}else{if(!f){f=new Map;let u=s;for(;u<d;)f.set(r[u],u++)}if(f.has(t[c])){let u=f.get(t[c]);if(s<u&&u<d){let m=c,v=1;for(;++m<o&&m<d&&f.get(t[m])===u+v;)v++;if(v>u-s){let h=l(t[c],0);for(;s<u;)e.insertBefore(l(r[s++],1),h)}else e.replaceChild(l(r[s++],1),l(t[c++],-1))}else c++}else e.removeChild(l(t[c++],-1))}return r};var Yt=e=>t=>{for(let r in t){let l=r==="role"?r:`aria-${r}`,a=t[r];a==null?e.removeAttribute(l):e.setAttribute(l,a)}},Vt=(e,t)=>{let r,l=!0,a=document.createAttributeNS(null,t);return n=>{r!==n&&(r=n,r==null?l||(e.removeAttributeNode(a),l=!0):(a.value=n,l&&(e.setAttributeNodeNS(a),l=!1)))}},Jt=(e,t,r)=>l=>{r!==!!l&&((r=!!l)?e.setAttribute(t,""):e.removeAttribute(t))},sl=({dataset:e})=>t=>{for(let r in t){let l=t[r];l==null?delete e[r]:e[r]=l}},zt=(e,t)=>{let r,l=t.slice(2);return!(t in e)&&t.toLowerCase()in e&&(l=l.toLowerCase()),a=>{let n=le(a)?a:[a,!1];r!==n[0]&&(r&&e.removeEventListener(l,r,n[1]),(r=n[0])&&e.addEventListener(l,r,n[1]))}},Qt=e=>t=>{typeof t=="function"?t(e):t.current=e},Xt=(e,t)=>t==="dataset"?sl(e):r=>{e[t]=r},Zt=e=>{let t;return r=>{t!=r&&(t=r,e.textContent=r==null?"":r)}};var dl=function(e){"use strict";var t="fragment",r="template",l="content"in o(r),a=l?function(c){var s=o(r);return s.innerHTML=c,s.content}:function(c){var s=o(t),f=o(r),u=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(c)){var m=RegExp.$1;f.innerHTML="<table>"+c+"</table>",u=f.querySelectorAll(m)}else f.innerHTML=c,u=f.childNodes;return n(s,u),s};return function(s,f){return(f==="svg"?d:a)(s)};function n(c,s){for(var f=s.length;f--;)c.appendChild(s[0])}function o(c){return c===t?e.createDocumentFragment():e.createElementNS("http://www.w3.org/1999/xhtml",c)}function d(c){var s=o(t),f=o("div");return f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+c+"</svg>",n(s,f.firstChild.childNodes),s}}(document),rt=dl;var er=({childNodes:e},t)=>e[t],Me=e=>{let t=[],{parentNode:r}=e;for(;r;)t.push(Kt.call(r.childNodes,e)),e=r,r=e.parentNode;return t},{createTreeWalker:tr,importNode:Se}=document;var rr=Se.length!=1,lr=rr?(e,t,r)=>Se.call(document,rt(e,t,r),!0):rt,nr=rr?e=>tr.call(document,e,1|128,null,!1):e=>tr.call(document,e,1|128);var fe=(e,t,r)=>Ht(e.parentNode,t,r,Bt,e),cl=e=>{let t,r,l=[],a=n=>{switch(typeof n){case"string":case"number":case"boolean":t!==n&&(t=n,r?r.textContent=n:r=document.createTextNode(n),l=fe(e,l,[r]));break;case"object":case"undefined":if(n==null){t!=n&&(t=n,l=fe(e,l,[]));break}if(le(n)){t=n,n.length===0?l=fe(e,l,[]):typeof n[0]=="object"?l=fe(e,l,n):a(String(n));break}"ELEMENT_NODE"in n&&t!==n&&(t=n,l=fe(e,l,n.nodeType===11?De.call(n.childNodes):[n]))}};return a},fl=(e,t)=>{switch(t[0]){case"?":return Jt(e,t.slice(1),!1);case".":return Xt(e,t.slice(1));case"o":if(t[1]==="n")return zt(e,t)}switch(t){case"ref":return Qt(e);case"aria":return Yt(e)}return Vt(e,t)};function ar(e){let{type:t,path:r}=e,l=r.reduceRight(er,this);return t==="node"?cl(l):t==="attr"?fl(l,e.name):Zt(l)}var ue="is\xB5",ir=ce(new WeakMap),ul=/^(?:plaintext|script|style|textarea|title|xmp)$/i,ne=()=>({stack:[],entry:null,wire:null}),ml=(e,t)=>{let{content:r,updates:l}=pl(e,t);return{type:e,template:t,content:r,updates:l,wire:null}},yl=(e,t)=>{let r=Wt(t,ue,e==="svg"),l=lr(r,e),a=nr(l),n=[],o=t.length-1,d=0,c=`${ue}${d}`;for(;d<o;){let s=a.nextNode();if(!s)throw`bad template: ${r}`;if(s.nodeType===8)s.textContent===c&&(n.push({type:"node",path:Me(s)}),c=`${ue}${++d}`);else{for(;s.hasAttribute(c);)n.push({type:"attr",path:Me(s),name:s.getAttribute(c)}),s.removeAttribute(c),c=`${ue}${++d}`;ul.test(s.tagName)&&s.textContent.trim()===`<!--${c}-->`&&(s.textContent="",n.push({type:"text",path:Me(s)}),c=`${ue}${++d}`)}}return{content:l,nodes:n}},pl=(e,t)=>{let{content:r,nodes:l}=ir.get(t)||ir.set(t,yl(e,t)),a=Se.call(document,r,!0),n=l.map(ar,a);return{content:a,updates:n}},pe=(e,{type:t,template:r,values:l})=>{let{length:a}=l;or(e,l,a);let{entry:n}=e;(!n||n.template!==r||n.type!==t)&&(e.entry=n=ml(t,r));let{content:o,updates:d,wire:c}=n;for(let s=0;s<a;s++)d[s](l[s]);return c||(n.wire=Ft(o))},or=({stack:e},t,r)=>{for(let l=0;l<r;l++){let a=t[l];a instanceof Re?t[l]=pe(e[l]||(e[l]=ne()),a):le(a)?or(e[l]||(e[l]=ne()),a,a.length):e[l]=null}r<e.length&&e.splice(r)};function Re(e,t,r){this.type=e,this.template=t,this.values=r}var{create:hl,defineProperties:Tl}=Object,sr=e=>{let t=ce(new WeakMap),r=l=>(a,...n)=>pe(l,{type:e,template:a,values:n});return Tl((l,...a)=>new Re(e,l,a),{for:{value(l,a){let n=t.get(l)||t.set(l,hl(null));return n[a]||(n[a]=r(ne()))}},node:{value:(l,...a)=>pe(ne(),{type:e,template:l,values:a}).valueOf()}})},dr=ce(new WeakMap),Le=(e,t)=>{let r=typeof t=="function"?t():t,l=dr.get(e)||dr.set(e,ne()),a=r instanceof Re?pe(l,r):r;return a!==l.wire&&(l.wire=a,e.textContent="",e.appendChild(a.valueOf())),e},y=sr("html"),pa=sr("svg");var me=(e,t)=>JSON.stringify(e)==JSON.stringify(t),Ce=e=>{e.target.value=e.target.value.replace(/\n/g,""),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`};var lt={};He(lt,{ENTRY_MARKED:()=>ae,MOVED:()=>U,NEW:()=>P,NEW_KEY:()=>Y,NEW_ORDER:()=>H,NEW_TYPE:()=>V,REMOVED:()=>I,diff:()=>xl});var P="new",I="removed",U="moved",H="order_changed",Y="key_changed",V="type_changed",ae="entry_changed",xl=(e,t,r={})=>{let l={},a=[];C(t,(n,o)=>(n._meta=o,Object.assign(l,{[n.$anchor]:n}),delete n._visit,n)),C(e,(n,o)=>{var c;delete n._diff,n._meta=o;let d=l[n.$anchor];if(d){let s=n._meta.parent,f=d._meta.parent;f.$anchor!=s.$anchor&&(n._diff={[U]:{oldParent:f,newParent:s}}),me(d.order,n.order)||(n._diff={[H]:{oldOrder:d.order,newOrder:n.order}}),d.type!=n.type&&Object.assign(n._diff||(n._diff={}),{[V]:{oldType:d.type,newType:n.type,parent:s}}),d.key!=n.key&&Object.assign(n._diff||(n._diff={}),{[Y]:{oldKey:d.key,newKey:n.key,parent:s}}),d.isEntry!=n.isEntry&&Object.assign(n._diff||(n._diff={}),{[ae]:{oldIsEntry:d.isEntry,newIsEntry:n.isEntry,parent:s}}),n._diff&&a.push(n),d._visit=!0}else o.path.startsWith((c=o.parent.prune)==null?void 0:c.added)||(n._diff={[P]:{parent:o.parent}},a.push(n),Object.assign(o.parent,{prune:{added:o.path}}));return n});for(let n of Object.keys(l)){if(l[n]._visit)continue;let o=l[n]._meta,d=o.path;a.filter(s=>s._diff[I]&&d.startsWith(s._meta.path)).length==0&&(l[n]._diff={[I]:{parent:o.parent}},a.push(l[n]))}return a};var cr=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),Ie(e,"title",t),Ie(e,"description",t),bl(e,"rw",["rw","r","w"],t),nt(e,"required",t),_l(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&(e.metadata[r]=e.changes[r]);return e},_l=(e,t)=>{e.type==N?kl(e,t):e.type==A?wl(e,t):e.type==$?gl(e,t):e.type==E?Ol(e,t):e.type==q?Nl(e,t):e.type==W?El(e,t):e.type==K?vl(e,t):e.type==Q&&$l(e,t)},Nl=(e,t)=>{Al(e,"pattern",t),G(e,"min",t,{min:0}),G(e,"max",t,{min:0}),ye(e,t),Ie(e,"default",t,Object.assign(fr(e,["min","max","pattern"]),{ignoreEmpty:!0}))},vl=(e,t)=>{nt(e,"default",t)},El=(e,t)=>{Pe(e,"min",t),Pe(e,"max",t),G(e,"multipleOf",t),ye(e,t),Pe(e,"default",t,fr(e,["min","max","multipleOf"]))},$l=(e,t)=>{Dl(e,"default",t)},kl=(e,t)=>{G(e,"min",t,{min:0}),G(e,"max",t,{min:0}),ye(e,t)},wl=(e,t)=>{G(e,"min",t,{min:1}),G(e,"max",t,{min:1}),ye(e,t),nt(e,"unique",t)},gl=(e,t)=>{G(e,"min",t,{min:1}),G(e,"max",t,{min:1}),ye(e,t)},Ol=(e,t)=>{},fr=(e,t=[])=>{let r={};for(let l of t)(e.errors[l]||[]).length==0&&(typeof e.changes[l]=="number"?(e.changes[l]||e.changes[l]==0)&&(r[l]=e.changes[l]):r[l]=e.changes[l]);return r},Ie=(e,t,r,l={})=>{if(!r.hasOwnProperty(t)||l.ignoreEmpty&&r[t]=="")return;let a=r[t],n=2**18;(d=>new Blob([d]).size)(a)>n?g(e,t,`string size limit is ${Math.ceil(n/1024)} KB`):l.max&&a.length>l.max?g(e,t,`must be less than or equal ${l.max} length`):l.min&&a.length<l.min?g(e,t,`must be grater than or equal ${l.min} length`):l.pattern?new RegExp(l.pattern).test(a)||g(e,t,`must matche pattern ${l.pattern}`):e.changes[t]=a},nt=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=!1;let l=Ml(r[t]);l==null?g(e,t,"must be boolean"):e.changes[t]=l},Pe=(e,t,r,l={})=>{if(!r.hasOwnProperty(t))return;let a=at(r[t]);!a&&a!=0?g(e,t,"must be number"):l.min&&a<l.min?g(e,t,`must be greater than or equal ${l.min}`):l.max&&a>l.max?g(e,t,`must be less than than or equal ${l.max}`):l.multipleOf&&a%l.multipleOf!=0?g(e,t,`must be multiple of ${l.multipleOf}`):e.changes[t]=a},G=(e,t,r,l)=>{if(!r.hasOwnProperty(t))return;Pe(e,t,r,l);let a=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])?g(e,t,"must be integer number"):a>Number.MAX_SAFE_INTEGER?g(e,t,`must be less than or equal ${Number.MAX_SAFE_INTEGER}`):a<Number.MIN_SAFE_INTEGER&&g(e,t,`must be greater than or equal ${Number.MIN_SAFE_INTEGER}`)},Al=(e,t,r)=>{if(!!r.hasOwnProperty(t)&&(Ie(e,t,r),(e.errors[t]||[]).length==0))try{let l=r[t];if(l=="")return;e.changes[t]=new RegExp(l)}catch(l){g(e,t,"invalid regex")}},ye=(e,t)=>{if(t.min&&t.max){let r=at(t.min),l=at(t.max);(r||r==0)&&(l||l==0)&&r>l&&(g(e,"min","min is greater than max"),g(e,"max","max is less than min"))}},Dl=(e,t,r)=>{!r.hasOwnProperty(t)||(r[t]!=null?g(e,t,"must be null"):e.changes[t]=r[t])},bl=(e,t,r,l)=>{!l.hasOwnProperty(t)||(r.includes(l[t])?e.changes[t]=l[t]:g(e,t,"value must be r, w, or rw"))},g=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},at=e=>ur(e,"number"),Ml=e=>ur(e,"boolean");var ur=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=n=>["checkbox","radio"].includes(n.type)?n.checked:n.value,r=this.querySelector("form").elements,l={};for(let n=0;n<r.length;n++){let o=t(r[n]);!(r[n]instanceof HTMLTextAreaElement)&&o==""||(l[r[n].name]=o)}let a={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:l};this.dispatchEvent(new CustomEvent("sch-update",{detail:a,bubbles:!0}))}}});var je=(e,t,r)=>{try{Le(e,y.for(t)`
    <p class="meta-def">${Sl(t.rootKey,t.path)||"-"} : <span>${t.type}</span></p>
    <form data-path="${t.path}" data-file="${t.rootKey}">
      ${Ue(t,"title",{keyDisplay:"Title"})}
      ${Ue(t,"description",{keyDisplay:"Description"})}
      ${Cl(t)}
      ${Rl(t,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:"rw",keyDisplay:"Read / Write"})}
      ${Ll(t,"default",{keyDisplay:"Default",min:O(t,"min"),max:O(t,"max")})}
    </form>
  `)}catch(l){console.log(l)}},Sl=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(l=>l!=""),t.splice(0,0,e);let r=y`<span style="color: var(--meta-def-color);">${t[0]}.${t[1]}</span>`;return t=t.slice(2).flatMap(l=>[y`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(l)]),t.splice(0,0,r),t},he=(e,t,r,l={})=>{var a;return y`
  <label class="${l.readonly&&`meta-box ${t} readonly`||`meta-box ${t}`}">
    <p class="l">${l.keyDisplay||t} ${l.readonly&&y`<span>· readonly</span>`}</p>
    ${r}
    ${(a=qe(e,t))==null?void 0:a.map(n=>y`<p class="err">${n}</p>`)}
  </label>
  `},Ue=(e,t,r={})=>he(e,t,y`
    <textarea name="${Te(e,t)}" maxlength="${r.maxlength}" minlength="${r.minlength}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${qe(e,t)&&"invalid"}" oninput="${Ce}">${r.value||O(e,t)}</textarea>
  `,r),We=(e,t,r={})=>he(e,t,y`
    <input type="number" name="${Te(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${r.min}" max="${r.max}" value="${r.value||O(e,t)}" ?readonly="${r.readonly}" class="${qe(e,t)&&"invalid"}">
  `,r),J=(e,t,r={})=>he(e,t,y`
    <input type="number" name="${Te(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${r.min}" max="${r.max}" value="${r.value||O(e,t)}" ?readonly="${r.readonly}" class="${qe(e,t)&&"invalid"}">
  `,r),it=(e,t,r={})=>he(e,t,y`
    <input type="checkbox" name="${Te(e,t)}" ?disabled="${r.readonly}" ?checked="${r.value||O(e,t)}">
  `,r),Rl=(e,t,r={})=>he(e,t,y`
    <select name="${Te(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([l,a])=>y`<option value="${l}" ?selected="${(r.selected||O(e,t))==l}">${a}</option>`)}
    </select>
  `,r),Ll=(e,t,r={})=>{switch(e.type){case K:return it(e,t,r);case W:return We(e,t,r);case q:return Ue(e,t,r);default:return""}},Te=(e,t)=>t,O=(e,t)=>(e.metadata||{})[t],Cl=e=>{let t;switch(e.type){case N:let r=0;for(let l of Object.keys(e.fields))O(e.fields[l],"required")&&r++;t=[J(e,"min",{keyDisplay:"Min Properties",value:r,readonly:!0}),J(e,"max",{keyDisplay:"Max Properties",value:Object.keys(e.fields).length,min:Math.max(O(e,"min")||0,0)})];break;case A:t=[J(e,"min",{keyDisplay:"Min Items",min:1,value:1,max:O(e,"max")}),J(e,"max",{keyDisplay:"Max Items",min:O(e,"min")}),it(e,"unique",{keyDisplay:"Item uniqueness"})];break;case $:t=[J(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),J(e,"max",{keyDisplay:"Max Items",value:O(e,"max")||e.schs.length})];break;case q:t=[J(e,"min",{keyDisplay:"Min Length",min:0,max:O(e,"max")}),J(e,"max",{keyDisplay:"Max Length",min:Math.max(0,O(e,"min"))}),Ue(e,"pattern",{keyDisplay:"Pattern",maxlength:256})];break;case W:t=[We(e,"min",{keyDisplay:"Min",max:O(e,"max")}),We(e,"max",{keyDisplay:"Max",min:O(e,"min")}),We(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:O(e,"max")})];break;case $e:t=[];case K:t=[];case Q:t=[];case E:t=[];case ee:t=[];case R:t=[];case S:t=[];default:t=[]}return e._meta.parent.type==N&&e._meta.level>2&&t.push(it(e,"required",{keyDisplay:"Required"})),t};var qe=(e,t)=>e.errors&&e.errors[t];var pr=(e,t,r={})=>{try{let l=t._models||t.order.reduce((n,o)=>(n[t.fields[o].$anchor]=o,n),{}),a={level:1,tab:0,models:l,rootKey:t.key,taggedLevel:t.taggedLevel};a.rootLevel=a.level,Il(e,{sch:t,ui:Object.assign(a,r.ui),path:t.path||"",key:t.key,parent:{type:t.type,level:a.level}})}catch(l){console.log(l)}},Il=(e,t)=>Le(document.querySelector(e),y`
  <ul role="tree" aria-multiselectable="true" class="text-sm" tabindex="-1" aria-labelledby="${t.ui.taggedLevel[t.ui.level]+"_tree"}">
    ${xe(t)}
  </ul>
  ${null}
`);var mr=e=>{if(!e)return"";for(let t of Object.keys(e))switch(t){case P:return"N";case I:return"R";case U:return"M";case H:return"C";case Y:return"C";case V:return"C";case ae:return"C"}},xe=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Pl(e);case At.includes(e.sch.type):return Ul(e);default:return jl(e)}},Pl=e=>y.for(e.sch,`${e.parent.level}-${e.ui.level}`)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${0}" aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h" id="${e.ui.taggedLevel[e.ui.level]+"_tree"}">
      ${ot(e.key)}
    </dfn>
    <ul data-group="${hr(e.sch)}" role="group">
      ${yr(e)}
    </ul>
  </li>`,Ul=e=>y.for(e.sch,`${e.parent.level}-${e.ui.level}`)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level]}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    <dfn class="h" .dataset="${{diff:mr(e.sch._diff)}}">
      ${Tr(Object.assign(e,{key:ot(e.key)}))}
      ${xr(e)}
      ${_r(e)}
    </dfn>
    <ul data-group="${hr(e.sch)}" role="group">
      ${yr(e)}
    </ul>
  </li>`,jl=e=>y.for(e.sch,`${e.parent.level}-${e.ui.level}`)`
  <li id="${e.path}" .dataset="${{tag:e.ui.taggedLevel[e.ui.level],diff:mr(e.sch._diff)}}" .key="${e.key}" .index="${e.ui.index}" aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${Tr(Object.assign(e,{key:ot(e.key)}))}
    ${xr(e)}
    ${_r(e)}
  </li>`,yr=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return y``;switch(!0){case[N].includes(e.sch.type):return ql(e);case[$].includes(e.sch.type):return Wl(e);case[A].includes(e.sch.type):return Kl(e);case[E].includes(e.sch.type):return Gl(e);default:return y``}},ql=e=>e.sch.order.map((t,r)=>xe({key:t,sch:e.sch.fields[t],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[${t}]`})),Wl=e=>e.sch.schs.map((t,r)=>xe({key:r,sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Kl=e=>xe({key:0,sch:e.sch.sch,parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:0},path:`${e.path}[][${0}]`}),Gl=e=>e.sch.schs.map((t,r)=>xe({key:"",sch:e.sch.schs[r],parent:{type:e.sch.type,path:e.path},ui:{...e.ui,level:e.ui.level+1,index:r},path:`${e.path}[][${r}]`})),Ke=e=>`padding-left: ${(e.ui.level-1)*1.25+e.ui.tab}rem`,br=(e,t,r)=>y`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  oninput="${Ce}"
  >${r}</textarea>`,Tr=e=>e.ui.level==e.ui.rootLevel+1?Bl(e):Fl(e),Bl=e=>y`
  <span class="def" style="${Ke(e)}">
    ${Hl(e.sch,e.ui)}
  </span>
  <span class="k">${Nr(e)}</span>
  <span class="s">=</span>
  `,Fl=e=>{switch(!0){case e.parent.type==E:return y`
      <span class="" style="${Ke(e)}"></span>
      <span class="s">|</span>
      `;case e.parent.type==A:return y`
      <span class="k" style="${Ke(e)}"></span>
      <span class="s">└</span>
      `;default:return y`
      <span class="k" style="${Ke(e)}">
        ${Nr(e)}
      </span >
      <span class="s">:</span>
    `}},Nr=e=>e.sch.uiMode=="editKey"?br("key-edit",e.parent.path,e.key):y`${e.key}`,xr=e=>e.ui.level==e.ui.rootLevel+1?Yl(e):Vl(e),Yl=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):y`<span class="t">${vr(e)}</span>`,Vl=e=>y`<span class="t">${vr(e)}</span>`,vr=e=>e.sch.uiMode=="editType"?br("type-edit",e.parent.path,Jl(e.sch,e.ui)):y`${Er(e.sch,e.ui)}`,Jl=(e,t)=>{switch(!0){case e.type==S:return JSON.stringify(e.const);case e.type==R:return t.models[e.$ref];default:return e.type}},Er=(e,t)=>{let r;switch(!0){case(e.type==N&&me(e.fields,{})):r="{ any }";break;case e.type==N:r="{ \xA0 }";break;case e.type==A:r=y`[ ${Er(e.sch,t)} ]`;break;case e.type==$:r="( \xA0 )";break;case e.type==q:r="string";break;case e.type==W:r="number";break;case e.type==$e:r="integer";break;case e.type==K:r="bool";break;case e.type==Q:r="null";break;case e.type==E:r="||";break;case e.type==ee:r="any";break;case(e.type==R&&!!t.models[e.$ref]):r=y`<span class="ref">${e._text=t.models[e.$ref]}</span>`;break;case e.type==R:r=y`<span class="ref notfound" title="Ref type">${`${e._text} (#404)`}</span>`;break;case e.type==S:r=y`<span class="value" title="Value type">${JSON.stringify(e.const)}</span>`;break;default:r="please define what type ${sch} is"}return t.typeText&&(r=t.typeText(e,t)||r),r},ot=e=>e,hr=e=>{switch(!0){case[N].includes(e.type):return"keyed";case[$,E].includes(e.type):return"indexed";default:return"none"}},Hl=(e,t)=>{let r;switch(!0){case e.type==N:r="record";break;case e.type==A:r="list";break;case e.type==$:r="tuple";break;case e.type==E:r="union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r},_r=e=>{var r;let t;switch(!0){case(e.parent.type==N&&((r=e.sch.metadata)==null?void 0:r.required)):t=[y`<span class="m"> · required</span>`];break;default:t=[]}return t};var st={};He(st,{clearClipboard:()=>se,createWalker:()=>$r,findUnselectedNode:()=>Be,reselectNodes:()=>_e,selectMultiNode:()=>oe,selectMultiNodeTo:()=>Ge,selectNode:()=>k,selectedGroupedByParent:()=>X,toggleSelectNode:()=>gr});var j="aria-selected",$r=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t.hasAttribute(j)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),e),k=(e,t,r={focus:!0})=>{t&&!t.isConnected&&(t=e.querySelector(`[id='${CSS.escape(t.id)}']`)),!!t&&(e._walker.currentNode=t,kr(e),ie(t),r.focus&&t.focus())},gr=(e,t)=>{e&&(e.tabIndex=-1),wr(t)},oe=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(j)=="true"?wr(e):ie(t),r.focus&&t.focus())},kr=e=>{for(let t of e.querySelectorAll(`[${j}='true']`))dt(t);for(let t of e.querySelectorAll(".item-pasted"))t.classList.remove("item-pasted","up","down")},ct=(e,t,r,l={})=>{var o,d,c;let a=e._walker.currentNode,n=t();if(!!n){if(a==r)return(o=l.target)==null?void 0:o.call(null,r);(d=l.pre)==null||d.call(null,a,n),ct(e,t,r,l),(c=l.post)==null||c.call(null,a,n)}},Ge=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,ct(e,()=>e._walker.nextSibling(),r,{pre:(l,a)=>{oe(l,a,{focus:!1})}}),e._walker.currentNode=r,ie(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,ie(r.parentNode.closest(`[${j}]`)),ct(e,()=>e._walker.previousSibling(),r,{pre:(l,a)=>{oe(l,a,{focus:!1})}}),dt(r.parentNode.closest(`[${j}]`)),e._walker.currentNode=r,ie(r),r.focus();break}},ie=e=>{!e||(e.setAttribute(j,!0),e.tabIndex=0)},dt=e=>{!e||(e.setAttribute(j,!1),e.tabIndex=-1)},wr=e=>(e==null?void 0:e.getAttribute(j))=="true"?dt(e):ie(e),Be=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(j))=="true");return t},zl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),_e=(e,t,r={})=>{kr(e);for(let l of zl(Object.keys(t))){let a=t[l];if(l==""?l=e.querySelector("[id][aria-level]"):l=e.querySelector(`[id='${CSS.escape(l)}'][aria-level]`),!l)continue;let n=parseInt(l.getAttribute("aria-level")),o=l.querySelectorAll(`[aria-level='${n+1}'][role='treeitem']`);for(let d=0;d<a.length;d++){let c=a[d].index,s=o[c];if(!s)return;s.classList.add("item-pasted"),r.direction&&s.classList.add(r.direction),oe(null,s,{focus:d==a.length-1}),e._walker.currentNode=s}}},X=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${j}='true']`}`),l={};for(let a=0;a<r.length;a++){let n=r[a],o=n.parentNode.closest("[role='treeitem']");if(!o)break;n.index=n.index||parseInt(n.getAttribute("aria-posinset"))-1,l[o.id]=l[o.id]||[],l[o.id].push(n)}return l},se=e=>{e.querySelectorAll(".item-cutting, .item-copying").forEach(t=>t.classList.remove("item-cutting","item-copying")),window._treeClipboard=null};var ft={};He(ft,{anchorsModels:()=>ht,createProjectStore:()=>Ql,getFileStore:()=>Ne,handleProjectContext:()=>tn,handleProjectRemote:()=>Xl,projectToStore:()=>ln});var z="file",de="project",Ql=()=>be({taggedLevel:{1:de,2:z,3:L},allowedSchs:[Or()],put:{pos:"prepend",onlyDst:{[z]:!0}}}),Ne=(e,t)=>{let r=re(e,`[${t}]`);return r.schMetas=e.schMetas,r},Xl=(e,t,r)=>{if(!mt(t.name))return;let l=T=>{for(let p of Object.keys(e.fields))if(e.fields[p].fields[T])return{file:e.fields[p],fmodelDst:e.fields[p].fields[T]}},a=T=>te(e,(p,x)=>{if(e.taggedLevel[x.level]==L&&x.path!="")return T.startsWith(x.path)},(p,x)=>(p._meta=x,p)),n=({$anchor:T,key:p,order:x,type:M})=>({$anchor:T,key:p,order:x,type:M}),o=T=>n(T),d=T=>T,c=e._diffToRemote,s={};s.files=[],s.fmodels=[],s.subfmodels=[];for(let T of c){let p=e.taggedLevel[T._meta.level];p==de?s.project=T:p==z?s.files.push(T):p==L?s.fmodels.push(T):s.subfmodels.push(T)}let f={},u={},m={};s.project&&(f.project=o(s.project));for(let T=0;T<s.files.length;T++){let p=s.files[T],x=n(p);if(u.files||(u.files={}),m.files||(m.files={}),f.files||(f.files={}),u.fmodels||(u.fmodels={}),m.fmodels||(m.fmodels={}),p._diff[P]){u.files[p._meta.path]={...x,parentAnchor:p._diff[P].parent.$anchor};for(let M of Object.keys(p.fields))u.fmodels[`[${p.key}][${M}]`]={...d(p.fields[M]),parentAnchor:x.$anchor}}if(p._diff[I]){m.files[p._meta.path]={$anchor:x.$anchor,parentAnchor:p._diff[I].parent.$anchor};for(let M of Object.keys(p.fields))m.fmodels[`[${p.key}][${M}]`]={$anchor:p.fields[M].$anchor,parentAnchor:x.$anchor}}(p._diff[H]||p._diff[Y])&&(f.files[p._meta.path]=x),p._diff[U]&&console.log("project does not permit as parent for moving items"),p._diff[V]&&console.log("file type is always record, cannot be changed")}for(let T=0;T<s.fmodels.length;T++){let p=s.fmodels[T],x=d(p);if(f.files||(f.files={}),u.fmodels||(u.fmodels={}),m.fmodels||(m.fmodels={}),f.fmodels||(f.fmodels={}),p._diff[P]&&(u.fmodels[p._meta.path]={...x,parentAnchor:p._diff[P].parent.$anchor}),p._diff[I]&&(m.fmodels[p._meta.path]={$anchor:x.$anchor,parentAnchor:p._diff[I].parent.$anchor}),(p._diff[H]||p._diff[Y]||p._diff[V]||p._diff[ae])&&(f.fmodels[p._meta.path]={...x,parentAnchor:p._meta.parent.$anchor}),p._diff[U]){let{oldParent:M,newParent:Z}=p._diff[U];switch(e.taggedLevel[M.level]){case de:console.log("fmodel cannot be moved from project as direct child");break;case z:var v=e.fields[M.key],h=n(v);f.files[v._meta.path]=h,m.fmodels[p._meta.path]={$anchor:p.$anchor,parentAnchor:h.$anchor};break;case L:var _=l(M.key),h=_.file;f.fmodels[_.fmodelDst._meta.path]={...d(_.fmodelDst),parentAnchor:h.$anchor};break;default:var b=a(M.path),_=l(b.key),h=_.file;f.fmodels[b._meta.path]={...d(b),parentAnchor:h.$anchor}}switch(e.taggedLevel[Z.level]){case de:console.log("fmodel cannot be moved to project as direct child");break;case z:var v=e.fields[Z.key],h=n(v);f.files[v._meta.path]=h,u.fmodels[p._meta.path]={...x,parentAnchor:h.$anchor};break;case L:var _=l(Z.key),h=_.file;f.fmodels[_.fmodelDst._meta.path]={...d(_.fmodelDst),parentAnchor:h.$anchor};break;default:var b=a(Z.path),_=l(b.key),h=_.file;f.fmodels[b._meta.path]={...d(b),parentAnchor:h.$anchor}}}}for(let T=0;T<s.subfmodels.length;T++){let p=s.subfmodels[T];if(f.files||(f.files={}),u.fmodels||(u.fmodels={}),m.fmodels||(m.fmodels={}),f.fmodels||(f.fmodels={}),p._diff[P]||p._diff[I]||p._diff[H]||p._diff[Y]||p._diff[V]){let x=a(p._meta.path),Z=l(x.key).file;f.fmodels[x._meta.path]={...d(x),parentAnchor:Z.$anchor}}if(p._diff[U]){let{oldParent:x,newParent:M}=p._diff[U];switch(e.taggedLevel[x.level]){case de:console.log("subfmodel cannot be moved from project as direct child");break;case z:var v=e.fields[x.key],h=n(v);f.files[v._meta.path]=h,m.fmodels[p._meta.path]={$anchor:p.$anchor,parentAnchor:h.$anchor};break;case L:default:var b=a(x.path),_=l(b.key),h=n(_.file);f.fmodels[b._meta.path]={...d(b),parentAnchor:h.$anchor}}switch(e.taggedLevel[M.level]){case de:console.log("subfmodel cannot be moved to project as direct child");break;case z:var b=a(p._meta.path),_=l(b.key),h=n(v);f.files[_.file._meta.path]=h,u.fmodels[p._meta.path]={...d(p),parentAnchor:h.$anchor};break;case L:default:var b=a(p._meta.path),_=l(b.key),h=_.file;f.fmodels[b._meta.path]={...d(b),parentAnchor:h.$anchor}}}}let kt=T=>{if(!T)return;let p=Object.keys(T);for(let x=0;x<p.length;x++)T[p[x]]=Ut(T[p[x]])};return kt(u.fmodels),kt(f.fmodels),delete e._diffToRemote,console.log({changed:f,added:u,removed:m}),r({changed:f,added:u,removed:m})},tn=(e,t,r,l)=>{let a=t.closest("[data-tag='file']"),n=a==null?void 0:a.key;if(t.closest("[id='project']"))switch(!0){case(n&&pt(r.name)):e._diffToRemote=l(),Zl(e,n),document.querySelector("[id='project'] [role='tree']")._render(e);break;case(n&&Fe(r.name)):e._diffToRemote=l();let o=Ne(e,n);document.querySelector("[id='fmodel'] [role='tree']")._render(o);break;default:e._diffToRemote=l(),document.querySelector("[id='project'] [role='tree']")._render(e)}else if(t.closest("[id='fmodel']")){let o,d;switch(!0){case yt(r.name):if(t.dataset.tag!=L)return;en(e,(c,s)=>(s.path==`[${n}]${t.id}`?(e.entrypoints={},e.entrypoints[c.$anchor]={}):c.isEntry&&(delete c.isEntry,delete e.entrypoints[c.$anchor]),c)),e._diffToRemote=l(),o=Ne(e,n),d=document.querySelector("[id='fmodel'] [role='tree']"),d._render(o);break;case Fe(r.name):e._diffToRemote=l(),o=Ne(e,n),o._models=ht(e,o),d=document.querySelector("[id='fmodel'] [role='tree']"),d._render(o);break;default:e._diffToRemote=l(),d=document.querySelector("[id='fmodel'] [role='tree']"),d._render(o)}}},ht=(e,t)=>{let r={};for(let l of e.order){let a=e.fields[l];for(let n of a.order)r[a.fields[n].$anchor]=l!=t.key?`${l}.${n}`:n}return r},Or=()=>be({taggedLevel:{1:z,2:L},addDefault:()=>be(),entryable:[L]}),rn=(e,t,r)=>{for(let l of e.fmodels)Object.assign(l.sch,{$anchor:l.anchor,type:l.type,key:l.key,isEntry:l.is_entry}),l.sch.isEntry&&(r.entrypoints[l.sch.$anchor]={}),t.fields[l.key]=l.sch;return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,D(()=>t)},ln=(e,t)=>{t.entrypoints={};for(let r of e.files)t.fields[r.key]=rn(r,Or(),t);return t.key=e.key,t.order=e.order,t.$anchor=e.anchor,t.schMetas=e.allmeta,D(()=>t)},Zl=(e,t)=>{let r=Ne(e,t);if(r&&(r._models=ht(e,r),ut({store:r,target:"[id='fmodel']",metaSelector:"sch-meta"}),!window._treeClipboard)){let l=document.querySelector("[id='fmodel'] [role='tree']");l._aria.clearClipboard(l)}},en=(e,t)=>{for(let r of Object.keys(e.fields)){let l=e.fields[r];for(let a of Object.keys(l.fields)){let n=l.fields[a];l.fields[a]=t(n,{path:`[${l.key}][${n.key}]`})}}};var Ar=[Dt,ze,Lt,Ct,It,B,Mt,St,Rt,()=>Qe('"json string"')],be=(e={})=>{let t=D(ze);return t.taggedLevel=e.taggedLevel,t.allowedSchs=e.allowedSchs||Ar.map(r=>r()),e.tag&&(t._tag=e.tag),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.type==e.addDefault().type)&&e.addDefault()),e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),t};var pt=e=>[Sr,Rr,Dr,Mr,Lr,Cr,Tt,xt,_t,ve].map(t=>t.name).includes(e),Fe=e=>[bt,ve,Nt,vt].map(t=>t.name).includes(e),mt=e=>[bt,ve,Nt,vt,xt,_t,Ir,Pr,ve,Et].map(t=>t.name).includes(e),yt=e=>[Et].map(t=>t.name).includes(e),cn=()=>new Map([["shift-meta-ArrowUp",nn],["shift-meta-ArrowDown",an],["shift-ArrowUp",on],["shift-ArrowDown",sn],["meta-ArrowUp",Dr],["meta-ArrowDown",Mr],["ArrowUp",Sr],["ArrowDown",Rr],["Home",Lr],["End",Cr],["shift-+",bt],["Enter",dn],["shift-Enter",Ur],["Delete",ve],["m",Et],["meta-x",jr],["meta-c",qr],["meta-v",vt],["shift-alt-ArrowUp",xt],["shift-alt-ArrowDown",_t],["alt-ArrowUp",Ir],["alt-ArrowDown",Pr],["Escape",({tree:e})=>se(e)]]),un=(e,t={})=>function(r){fn(r,this,e,t)};async function fn(e,t,r,l){if(e.target instanceof HTMLTextAreaElement)return pn(e,t,r);let a=cn().get(Wr(e));if(!!a&&!(l.denyCmds||[]).includes(a.name)){switch(a({tree:t,store:r}),e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}t.renderSchMeta(),t._walker.currentNode.isConnected||(t._walker.currentNode=t.querySelector(`[id='${CSS.escape(t._walker.currentNode.id)}']`)),r.currentNode=t._walker.currentNode,$t(t,t._walker.currentNode,a)}}var mn=()=>new Map([["Enter",Nt]]),pn=(e,t,r)=>{let l=e.target,a=mn().get(Wr(e));!a||(a({tree:t,store:r},l),t.renderSchMeta(),$t(t,t._walker.currentNode,a))},hn=e=>function(t){return yn(t,this,e)};function yn(e,t,r){let l=t._walker.currentNode,a=e.target.closest("[role='treeitem']"),n=!t.querySelector("textarea");if(!!a){if(e.shiftKey||e.metaKey)switch(l.compareDocumentPosition(a)){case Node.DOCUMENT_POSITION_CONTAINS:return k(t,a);case Node.DOCUMENT_POSITION_CONTAINED_BY:return k(t,l);default:if(a.parentNode.closest("[role='treeitem']")!=l.parentNode.closest("[role='treeitem']"))return k(t,a)}e.shiftKey?Ge(t,l,a):e.metaKey?gr(l,t._walker.currentNode=a):(t._walker.currentNode=a,Tt({tree:t},{notFocusIfTextArea:n}),r.currentNode=t._walker.currentNode,$t(t,a,Tt)),t.renderSchMeta()}}var Tn=({tree:e,store:t})=>{let r=e.querySelectorAll("[id='fmodel'] [aria-selected='true']");if(r.length==1){let l=re(t,r[0].id);l.path=r[0].id,l.rootKey=e.querySelector(".root-item").key,l.metadata=t.schMetas[l.$anchor],je(e._metaContainer,l,t)}},Wr=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:l,key:a})=>{let n=[];return e&&n.push("shift"),(t||l)&&n.push("meta"),r&&n.push("alt"),a&&n.push(a),n.join("-")},$t=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}})),nn=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();Ge(e,t,r)},an=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();Ge(e,t,r)},on=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();oe(t,r)},sn=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();oe(t,r)},Dr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();k(e,t)},Mr=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();k(e,t)},Sr=({tree:e})=>k(e,e._walker.previousNode()),Rr=({tree:e})=>k(e,e._walker.nextNode()),Lr=({tree:e})=>{for(;e._walker.parentNode(););k(e,e._walker.currentNode)},Cr=({tree:e})=>{for(;e._walker.nextNode(););k(e,e._walker.currentNode)},Tt=({tree:e},t={})=>k(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),bt=({tree:e,store:t})=>{var o;let r=e._walker.currentNode,l=re(t,r.id),a,n=l._addSchDefault||l.allowedSchs&&l.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!n||(((o=t.put)==null?void 0:o.pos)=="prepend"?a=0:a=Number.MAX_SAFE_INTEGER,we(t,r.id,[{k:null,sch:()=>ke(n),index:a}]),e._render(t),k(e,r))},dn=({tree:e,store:t})=>{var l,a;((a=(l=e._walker.currentNode.closest("[role='group']"))==null?void 0:l.dataset)==null?void 0:a.group)=="keyed"&&Kr({tree:e,store:t,editMode:"editKey"})},Ur=({tree:e,store:t})=>{Kr({tree:e,store:t,editMode:"editType"})},Kr=({tree:e,store:t,editMode:r})=>{let l=e._walker.currentNode;F(t,l.id,(n,o)=>({...n,uiMode:r})),e._render(t);let a=e.querySelector("textarea");!a||(a._treeItem=l,a.onblur=n=>n.relatedTarget&&xn(e,t,a),a.focus())},xn=(e,t,r)=>{let l=F(t,r._treeItem.id,(a,n)=>Object.assign(a,{uiMode:"cancelled-edit"}));e._render(t),l&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),k(e,e._walker.currentNode))},Nt=({tree:e,store:t},r)=>{r.id=="key-edit"?Gr(e,t,r,bn):r.id=="type-edit"&&Gr(e,t,r,_n)},Gr=(e,t,r,l)=>{let a=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),k(e,r._treeItem,{focus:!1});let n=l(e,t,r)||a.id;F(t,n,(o,d)=>Object.assign(o,{uiMode:"editted"})),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(n)}']`),k(e,e._walker.currentNode)},_n=(e,t,r)=>{let l=t.allowedSchs.find(o=>o.type==r.value),a=Object.keys(t._models).find(o=>t._models[o]==r.value),n=Qe(r.value);return l?Ae(t,r._treeItem.id,()=>ke(l)):a?Ae(t,r._treeItem.id,()=>Pt(a)):n&&Ae(t,r._treeItem.id,()=>n),e._walker.currentNode.id},bn=(e,t,r)=>{let l=X(e),a=r.dataset.parentPath;l[r.dataset.parentPath]=l[r.dataset.parentPath].filter(s=>s.id==r._treeItem.id).map(s=>({id:s.id,newK:r.value,index:s.index}));let n=l[r.dataset.parentPath][0].index,d=Oe(t,{dstPath:a,startIndex:n},l)[a][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${d}]`},ve=({tree:e,store:t})=>{let r=Be(()=>e._walker.nextSibling())||Be(()=>e._walker.previousSibling())||Be(()=>e._walker.parentNode());ge(t,X(e)),e._render(t),k(e,r)},Et=({tree:e,store:t})=>{var l;let r=e._walker.currentNode;!r||((l=t.entryable)==null?void 0:l.includes(r.dataset.tag))&&(F(t,r.id,(a,n)=>Object.assign(a,{isEntry:!0})),e._render(t),k(e,r))};var jr=({store:e,tree:t})=>{se(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-cutting");let r=X(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",storeKey:e.key,ops:l=>ge(e,r,{dstPath:l}),selected:r}},qr=({store:e,tree:t})=>{se(t);for(let l of t.querySelectorAll("[aria-selected='true']"))l.classList.add("item-copying");let r=X(t,{ops:".item-copying"});window._treeClipboard={type:"copy",storeKey:e.key,ops:l=>Ze(e,r,{dstPath:l,startIndex:0}),selected:r}},vt=({tree:e,store:t,srcStore:r})=>{var a;let l=re(t,e._walker.currentNode.id);if(!![N,E,$].includes(l.type)&&!(((a=t.put)==null?void 0:a.onlyDst)&&!t.put.onlyDst[t.taggedLevel[l._meta.level]])&&window._treeClipboard){let n=e._walker.currentNode.id,{type:o,storeKey:d,ops:c,selected:s}=window._treeClipboard,f=s,u={};if(t.key==d)switch(o){case"copy":u=tt(t,{dstPath:n},f);break;case"cut":u=Oe(t,{dstPath:n},f);break}else switch(o){case"copy":let v=c(n);u=et(t,{dstPath:n},v);break;case"cut":let h=c(n);u=Xe(t,{dstPath:n},h);break}let m=(v,h)=>{let _={};for(let b of Object.keys(h))b==l._meta.path?_[""]=h[b]:_[b]=h[b];v._render(l),se(v),_e(v,_)};Object.keys(u).length!=0&&(l._tree?m(l._tree,u):(e._render(t),se(e),_e(e,u)))}},xt=({tree:e,store:t})=>Br({tree:e,store:t,direction:"up"},r=>r[0].index),_t=({tree:e,store:t})=>Br({tree:e,store:t,direction:"down"},r=>r[r.length-1].index+1),Br=({tree:e,store:t,direction:r},l)=>{let a=X(e),n={};for(let o of Object.keys(a))n=tt(t,{dstPath:o,startIndex:l(a[o])},{[o]:a[o]});Object.keys(n).length!=0&&(e._render(t),_e(e,n,{direction:r}))},Ir=({tree:e,store:t})=>Fr({tree:e,store:t,startIndex:r=>r-1,direction:"up"}),Pr=({tree:e,store:t})=>Fr({tree:e,store:t,startIndex:r=>r+1,direction:"down"}),Fr=({tree:e,store:t,startIndex:r,direction:l})=>{let a=X(e),n={};for(let o of Object.keys(a)){let d=a[o].sort((c,s)=>c.index-s.index);n=Oe(t,{dstPath:o,startIndex:r(d[0].index)},a)}Object.keys(n).length!=0&&(e._render(t),_e(e,n,{direction:l}))},Hr=({store:e,target:t,metaSelector:r,opts:l})=>{e.render=o=>pr(t,o||e,l||{}),e.render(e),e.schMetas||(e.schMetas={});let a=document.querySelector(`${t} [role='tree']`),n=document.querySelector(r);if(a){a._aria=st,a._render=e.render,e._tree=a,$r(a),a.onkeydown=un(e,l.treeKeyDownOpts),a.onclick=hn(e);let o=a._walker.nextNode(),d=e.currentNode||a._walker.nextNode()||o;return k(a,d,{focus:l.focus}),r&&(a._metaContainer=n),a.renderSchMeta=()=>Tn({tree:a,store:e}),a.renderSchMeta(),a}},Nn=({store:e,target:t,metaSelector:r})=>{Hr({store:e,target:t,metaSelector:r,opts:{ui:{depthLimit:2,modelTypeText:(l,a)=>"file",typeText:(l,a)=>{if(l.type==N)return"record";if(l.type==S)return"value";if(l.type==$)return"tuple";if(l.type==E)return"union"},viewTypeTop:l=>""},treeKeyDownOpts:{denyCmds:[Ur,qr,jr].map(l=>l.name)},focus:!0}})},ut=({store:e,target:t,metaSelector:r})=>{Hr({store:e,target:t,metaSelector:r,opts:{ui:{modelTypeText:(l,a)=>l.isEntry?"entrypoint":"type"}}})},vn=({store:e,detail:t,target:r})=>{let{path:l,attrs:a}=t,n=F(e,l,(o,d)=>cr(o,a));return e.render&&e.render(e),Object.assign(e.schMetas,{[n.$anchor]:n.metadata}),je(r.closest("sch-meta"),n,e),n};export{lt as Diff,ft as Project,Ar as allSchs,be as createTreeStore,Nn as initFileView,ut as initModelView,pt as isContextSwitchedCmd,mt as isDiffableCmd,yt as isEntryChangedCmd,Fe as isModelChangedCmd,vn as update};
/*! (c) Andrea Giammarchi - ISC */
