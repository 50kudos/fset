var ml=Object.defineProperty;var An=(e,t)=>{for(var r in t)ml(e,r,{get:t[r],enumerable:!0})};var Zt,hl=new Uint8Array(16);function Ir(){if(!Zt&&(Zt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Zt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Zt(hl)}var Sn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Tl(e){return typeof e=="string"&&Sn.test(e)}var On=Tl;var q=[];for(var Rr=0;Rr<256;++Rr)q.push((Rr+256).toString(16).substr(1));function yl(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(q[e[t+0]]+q[e[t+1]]+q[e[t+2]]+q[e[t+3]]+"-"+q[e[t+4]]+q[e[t+5]]+"-"+q[e[t+6]]+q[e[t+7]]+"-"+q[e[t+8]]+q[e[t+9]]+"-"+q[e[t+10]]+q[e[t+11]]+q[e[t+12]]+q[e[t+13]]+q[e[t+14]]+q[e[t+15]]).toLowerCase();if(!On(r))throw TypeError("Stringified UUID is invalid");return r}var Dn=yl;function xl(e,t,r){e=e||{};var n=e.random||(e.rng||Ir)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return Dn(n)}var Cr=xl;var P=10,j=11,K=12,H=13,z=14,Y=15,V=16,Ee=17,ue=18,fe=19,pe=20,me=21,he=22,Te=23;var Ae=24,Se=25;var Oe=26,Ge=27,ae=28,ye=29,ht=30,De=31,Z="fmodel",Fe=()=>({t:ht}),er=()=>({t:Ee}),In=()=>({t:Oe}),Rn=()=>({t:De}),Cn=()=>({t:ue}),Mn=()=>({t:pe}),Pn=()=>({t:he}),jn=()=>({t:fe}),Ln=()=>({t:me}),Un=()=>({t:Te}),Vn=()=>({t:Ae}),Gn=()=>({t:Se}),Fn=()=>({t:Ge}),oe=e=>Object.assign({t:P,fields:[]},e),qn=e=>Object.assign({t:j,schs:[G(()=>qe(null)),G(oe)]},e),Kn=()=>({t:H,sch:G(Fe)}),Bn=()=>({t:z,schs:[G(Fe)]}),Wn=()=>({t:Y,schs:[G(Fe)]}),Hn=()=>({t:V,fields:[{...G(oe),key:"tag_a"}],tagname:"tag",allowedSchs:[oe()],keyPrefix:"tag"}),Yn=()=>({t:K,schs:[G(er),G(Fe)]}),qe=(e,t)=>Object.assign({t:ae,$r:e},t),tr=e=>{try{return e=JSON.parse(e),e==null||["string","number","boolean"].includes(typeof e)?{t:ye,v:e}:!1}catch(t){return!1}},G=(e,t={})=>{let r=e();return r.$a||(r.$a=Cr()),t.force&&(r.$a=Cr()),r},Ke=e=>gl[e],gl={[P]:"record",[j]:"e_record",[K]:"dict",[H]:"list",[z]:"tuple",[Y]:"union",[V]:"tagged_union",[Ee]:"string",[De]:"integer",[ue]:"int8",[fe]:"uint8",[pe]:"int16",[me]:"uint16",[he]:"int32",[Te]:"uint32",[Ae]:"float32",[Se]:"float64",[Oe]:"boolean",[Ge]:"nil",[ae]:"ref",[ye]:"value",[ht]:"any"},Ct=e=>wl[e],wl={[ue]:{min:-128,max:127},[pe]:{min:-32768,max:32767},[he]:{min:-2147483648,max:2147483647},[fe]:{min:0,max:255},[me]:{min:0,max:65535},[Te]:{min:0,max:4294967295}},rr=(e,t)=>e.find(r=>{if(r.t==qe(null).t)return r.to?bl(r,t):!0}),bl=(e,t)=>e.to.find(r=>{var i;let n=r.t==t.sch.t;if((i=t.sch).metadata||(i.metadata={}),r.metadata){let l=!0;for(let a of Object.keys(r.metadata))typeof r.metadata[a]=="boolean"&&(l=l&&r.metadata[a]==!!t.sch.metadata[a]);return n&&l}else return n});var Tt=e=>{var t;((t=e.target.dataset)==null?void 0:t.newline)=="false"&&(e.target.value=e.target.value.replace(/\n/g,"")),e.target.style.overflow="hidden",e.target.style.height="auto",e.target.style.height=`${e.target.scrollHeight}px`},zn=e=>{Tt(e),e.target.setSelectionRange(e.target.value.length,e.target.value.length)},{defineProperty:_l}=Object,Jn=_l,S=(e,t,r)=>Jn(e,t,{value:r,configurable:!0}),nr=(e,t,r)=>Jn(e,t,{value:r,configurable:!0,writable:!0}),Mr=function(e,t,r){var n=null;return function(){n&&clearTimeout(n);var i=arguments;n=setTimeout(function(){n=null,e.apply(r,i)},t)}},ir=(e,t)=>{for(let r=0;r<e.length;r++)if(t(e[r]))return e[r]},Ie=(e,t)=>{for(let r=0;r<e.length;r++)t(e[r],r)},yt=(e,t,r)=>{for(let n=0;n<e.length;n++)t(r,e[n]);return r};var lr=(e,t)=>{let r=JSON.parse(JSON.stringify(e));return B(r,(n,i)=>G(()=>n,{force:!0})),r},Xn=e=>JSON.parse(JSON.stringify(e)),Pr=({t:e,$a:t,key:r},{path:n,lpath:i,level:l})=>({t:e,$a:t,key:r,level:l,path:n,lpath:i}),jr=(e,t)=>{let r=e.slice(0);return r.push(t),r},B=(e,t,r={path:"",lpath:[e],level:1,parent:{}})=>{if(delete e._halt,delete e._pruned,e=t(e,r),e._halt||e._pruned)return e;switch(!0){case e.hasOwnProperty("fields"):Ie(e.fields,(l,a)=>{let o=l.key,s={path:`${r.path}[${o}]`,level:r.level+1,index:a,parent:Pr(e,r),lpath:jr(r.lpath,l)};if(l=B(l,t,s),e.fields[a]=l,l._halt)return Object.assign(e,{_halt:!0})});break;case e.hasOwnProperty("schs"):Ie(e.schs,(l,a)=>{let o={path:`${r.path}[][${a}]`,level:r.level+1,index:a,parent:Pr(e,r),lpath:jr(r.lpath,l)};if(l=B(l,t,o),e.schs[a]=l,l._halt)return Object.assign(e,{_halt:!0})});break;case e.hasOwnProperty("sch"):let n=e.sch,i={path:`${r.path}[][0]`,level:r.level+1,index:0,parent:Pr(e,r),lpath:jr(r.lpath,n)};if(n=B(e.sch,t,i),e.sch=n,n._halt)return Object.assign(e,{_halt:!0});break;default:}return e},Lr=(e,t,r)=>{let n={original:{},popped:[]};return B(e,(i,l)=>{if(typeof t=="function"&&!t.call(null,i,l))return i;if(typeof t!="function"&&l.path!=t)return i;{typeof t=="string"&&(i._halt=!0),typeof r=="function"&&(r=r.call(null,i,l));let a=r.sort((o,s)=>s-o);switch(!0){case i.hasOwnProperty("fields"):for(let o of a)n.popped.unshift({k:i.fields[o].key,sch:i.fields.splice(o,1)[0],index:o});break;case i.hasOwnProperty("sch"):break;case i.hasOwnProperty("schs"):for(let o of a)n.popped.unshift({k:o,sch:i.schs.splice(o,1)[0],index:o});i.schs.length==0&&i.schs.splice(0,0,G(Fe));break;default:}return i}}),n},Nl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r)&&r!="")return!1}}),xt=(e,t,r)=>{let n={original:{},inserted:[]},i=(l,a)=>(l=Math.max(l,0),l=Math.min(l,a),l);return B(e,(l,a)=>{var o;if(typeof t=="function"&&!t.call(null,l,a))return l;if(typeof t!="function"&&a.path!=t)return l;{typeof t=="string"&&(l._halt=!0),typeof r=="function"&&(r=r.call(null,l,a));let s=r.sort((c,m)=>c.index-m.index);switch(!0){case l.hasOwnProperty("fields"):let c=(o=e.taggedLevel)==null?void 0:o[a.level+1],m=[],{keys:u,anchors:x}=yt(l.fields,(f,p)=>(Object.assign(f.keys,{[p.key]:!0}),Object.assign(f.anchors,{[p.$a]:!0}),f),{keys:{},anchors:{}});for(let{k:f,sch:p,index:d}of s){if(x[p().$a])continue;for(f=f==0?"0":f,f=f||`${c||l.keyPrefix||"key"}_${Math.floor(Date.now()/100)}`,f=`${f}`;u[f];)f=`${f} \u2013`;u[f]=!0,d=i(d,l.fields.length+m.length);let h=G(p);h.key=f,h.index=d,m.push(h),n.inserted.push({k:h.key,sch:h,index:d})}s.length!=0&&l.fields.splice(s[0].index,0,...m);break;case l.hasOwnProperty("sch"):break;case l.hasOwnProperty("schs"):for(let{k:f,sch:p,index:d}of s){d=i(d,l.schs.length);let h=G(p);h.index=d,l.schs.splice(d,0,h),n.inserted.push({k:f,sch:l.schs[d],index:d})}break;default:}return l}}),n},or=(e,{isRefConstraint:t,dstPath:r,dstLevel:n,dstStore:i,startIndex:l=0},a)=>{let o=(u,x,f)=>Re(u,x,(p,d)=>(S(p,"_pinId",f),p)),s=Symbol(r);o(e,r,s);let c=ar(e,a,{dstPath:r,dstLevel:n,dstStore:i,isRefConstraint:t});return Ur(e,{dstPin:s,startIndex:l},c)},ar=(e,t,r={})=>{let n={},i=Nl(Object.keys(t));r.isRefConstraint==null&&(r.isRefConstraint=!0);let l=r.dstStore||e;for(let a of i){let o=t[a],s=p=>{var d;return(d=o.find(h=>h.index==p))==null?void 0:d.newK},c=p=>{var d;return((d=p.sch)==null?void 0:d.referrers)&&p.sch.referrers.length!=0&&r.isRefConstraint},m=r.dstLevel!=l.refParentLevel;if(r.dstPath&&ir(o,d=>r.dstPath.startsWith(d.id)))continue;let u=yt(o,(p,d)=>(c(d)&&m?p.refed.push(d):p.indices.push(d.index),p),{indices:[],refed:[]});r.isRefConstraint&&Ie(u.refed,p=>p.setAttribute("data-err","ref"));let f=Lr(e,a,u.indices).popped.map(({k:p,sch:d,index:h})=>({k:s(h)||p,sch:()=>d}));n[a]=f}return n},Ur=(e,{dstPin:t,dstPath:r,startIndex:n=0},i)=>{let l=(c,m)=>Be(c,(u,x)=>u._pinId==m,(u,x)=>(S(u,"_pinned",x),u));n=Math.max(n,0);let a={},o=Object.values(i).flatMap(c=>c).map((c,m)=>Object.assign(c,{index:n+m}));if(t){let c=l(e,t);c&&(r=c._pinned.path)}let s=xt(e,r,o);return s.inserted.length!=0&&(a[r]=s.inserted),a},Fr=(e,{dstPath:t,startIndex:r=0},n)=>{let i=Vr(e,n,{dstPath:t,startIndex:r});return Gr(e,{dstPath:t},i)},Vr=(e,t,r={})=>yt(Object.values(t),(n,i)=>{let l=i.map(o=>o.id),a=[];Be(e,(o,s)=>(l.includes(s.path)&&(S(o,"_meta",s),a.unshift(o)),a.length==l.length),(o,s)=>o);for(let o of i){if(r.dstPath&&r.dstPath.startsWith(o.id))continue;let s=a.find(c=>c._meta.path==o.id);s&&n.unshift({k:o.key,sch:()=>lr(s,e),index:r.startIndex+n.length,id:o.id})}return n},[]),Gr=(e,{dstPath:t},r)=>{let n={},i=xt(e,t,r);return i.inserted.length!=0&&(n[t]=i.inserted),n},sr=(e,t,r)=>Re(e,t,(n,i)=>{let l=G(r),{title:a,description:o,rw:s,required:c,$a:m,key:u}=n,x=l.t==ae&&l.$r!=n.$r,f=l.t==ye&&l.v!=n.v,p=l.t!=n.t;return l.$r==m?n:p||f||x?Object.assign(l,{metadata:{title:a,description:o,rw:s,required:c},$a:m,key:u}):n}),ne=(e,t)=>Be(e,(r,n)=>n.path==t,(r,n)=>(S(r,"_meta",n),r)),Re=(e,t,r)=>Be(e,(n,i)=>i.path==t,r),Be=(e,t,r)=>{let n;return B(e,(i,l)=>t(i,l)?(n=r(i,l),n._halt=!0,n):i),n&&delete n._halt,n};var qr={};An(qr,{clearClipboard:()=>He,collapseSelected:()=>Wr,createWalker:()=>Qn,ensureNodeConnected:()=>dr,expandSelected:()=>Br,findUnselectedNode:()=>Pt,reselectNodes:()=>wt,selectMultiNode:()=>it,selectMultiNodeTo:()=>Mt,selectNode:()=>R,selectedGroupedByParent:()=>We,toggleSelectNode:()=>ti});var ie="aria-selected",cr="aria-expanded",Qn=e=>(e._walker=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{var r;if(t.hasAttribute(ie)){let n=(r=t.parentElement.closest(`[${cr}]`))==null?void 0:r.getAttribute(cr);return n&&n=="false"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}else return NodeFilter.FILTER_SKIP}},!1),e),R=(e,t,r={focus:!0})=>{t=dr(e,t),!!t&&(e._walker.currentNode=t,Zn(e),gt(t),r.focus&&t.focus())},ti=(e,t)=>{e&&(e.tabIndex=-1),ei(t)},it=(e,t,r={focus:!0})=>{!t||(e&&(e.tabIndex=-1),t.getAttribute(ie)=="true"?ei(e):gt(t),r.focus&&t.focus())},Zn=(e,t={})=>{t=Object.assign({sync:!0},t);for(let r of e.querySelectorAll(`[${ie}='true']`))t.sync?ur(r):Mr(ur,0)(r)},Kr=(e,t,r,n={})=>{var a,o,s;let i=e._walker.currentNode,l=t();if(!!l){if(i==r)return(a=n.target)==null?void 0:a.call(null,r);(o=n.pre)==null||o.call(null,i,l),Kr(e,t,r,n),(s=n.post)==null||s.call(null,i,l)}},Mt=(e,t,r)=>{if(!(!t||!r))switch(t.compareDocumentPosition(r)){case Node.DOCUMENT_POSITION_FOLLOWING:e._walker.currentNode=t,Kr(e,()=>e._walker.nextSibling(),r,{pre:(n,i)=>{it(n,i,{focus:!1})}}),e._walker.currentNode=r,gt(r),r.focus();break;case Node.DOCUMENT_POSITION_PRECEDING:e._walker.currentNode=t,gt(r.parentNode.closest(`[${ie}]`)),Kr(e,()=>e._walker.previousSibling(),r,{pre:(n,i)=>{it(n,i,{focus:!1})}}),ur(r.parentNode.closest(`[${ie}]`)),e._walker.currentNode=r,gt(r),r.focus();break}},gt=e=>{!e||(e.setAttribute(ie,!0),e.tabIndex=0)},ur=e=>{!e||(e.setAttribute(ie,!1),e.tabIndex=-1)},ei=e=>(e==null?void 0:e.getAttribute(ie))=="true"?ur(e):gt(e),Pt=(e,t)=>{do t=e();while((t==null?void 0:t.getAttribute(ie))=="true");return t},vl=e=>e.filter(t=>{for(let r of e){if(t==r)return!0;if(t.startsWith(r))return!1}}),wt=(e,t,r={})=>{Zn(e,r);for(let n of vl(Object.keys(t))){let i=t[n];if(n==""?n=e.querySelector("[id][aria-level]"):n=e.querySelector(`[id='${CSS.escape(n)}'][aria-level]`),!n)continue;let l=parseInt(n.getAttribute("aria-level")),a=n.querySelectorAll(`[aria-level='${l+1}'][role='treeitem']`);for(let o=0;o<i.length;o++){let s=i[o].index,c=a[s];if(!c)return;r.direction&&c.classList.add(r.direction),it(a[s-1],c,{focus:!1}),e._walker.currentNode=c}r=Object.assign({sync:!0},r),r.sync?e._walker.currentNode.focus():Mr(()=>e._walker.currentNode.focus())()}},We=(e,t={})=>{let r=e.querySelectorAll(`${t.ops||`[${ie}='true']`}`),n={};for(let i=0;i<r.length;i++){let l=r[i],a=l.parentNode.closest("[role='treeitem']");if(!a)break;l.index=l.index||parseInt(l.getAttribute("aria-posinset"))-1,n[a.id]=n[a.id]||[],n[a.id].push(l)}return n},Br=e=>{let t=e.querySelectorAll(`[${ie}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(cr,"true")},Wr=e=>{let t=e.querySelectorAll(`[${ie}='true']`);for(let r=0;r<t.length;r++)t[r].setAttribute(cr,"false")},He=e=>{Ie(e.querySelectorAll(".item-cutting, .item-copying, [data-err]"),t=>{t.classList.remove("item-cutting","item-copying"),t.removeAttribute("data-err")}),window._treeClipboard=null},dr=(e,t)=>t&&!t.isConnected?t.id?e.querySelector(`[id='${CSS.escape(t.id)}']`):e.querySelector("[id]"):t;var kl=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.firstChild();Mt(e,t,r)},$l=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.parentNode()&&e._walker.lastChild();Mt(e,t,r)},El=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.previousSibling();it(t,r)},Al=({tree:e})=>{let t=e._walker.currentNode,r=e._walker.nextSibling();it(t,r)},Sl=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.firstChild();R(e,t)},Ol=({tree:e})=>{let t=e._walker.parentNode()&&e._walker.lastChild();R(e,t)},Dl=({tree:e})=>R(e,e._walker.previousSibling()),Il=({tree:e})=>R(e,e._walker.nextSibling()),Rl=({tree:e})=>R(e,e._walker.previousNode()),Cl=({tree:e})=>R(e,e._walker.nextNode()),Ml=({tree:e})=>{for(;e._walker.parentNode(););R(e,e._walker.nextNode()),R(e,e._walker.parentNode())},Pl=({tree:e})=>{for(;e._walker.nextNode(););R(e,e._walker.currentNode)},jt=({tree:e},t={})=>R(e,e._walker.currentNode,{focus:t.notFocusIfTextArea}),Lt=({tree:e,store:t},r)=>ri(e,t,r),fr={selectMultiNodeUpTo:kl,selectMultiNodeDownTo:$l,selectMultiNodeUp:El,selectMultiNodeDown:Al,selectUpEnd:Sl,selectDownEnd:Ol,selectUp:Rl,selectDown:Cl,selectPrevious:Dl,selectNext:Il,selectRoot:Ml,selectLast:Pl},xe=({tree:e,store:t})=>{var a,o;let r=e._walker.currentNode,n=ne(t,r.id),i,l=((a=Hr(e,t))==null?void 0:a[0])||n._addSchDefault||n.allowedSchs&&n.allowedSchs[0]||t.allowedSchs&&t.allowedSchs[0];!l||(((o=t.put)==null?void 0:o.pos)=="prepend"?i=0:i=Number.MAX_SAFE_INTEGER,xt(t,r.id,[{k:null,sch:()=>lr(l),index:i}]),e._render(t),R(e,r))},bt=({tree:e,store:t})=>{var i,l;let r=e._walker.currentNode;if(((l=(i=r.closest("[role='group']"))==null?void 0:i.dataset)==null?void 0:l.group)=="keyed"){let a=r.querySelector(".k").getBoundingClientRect();ni({tree:e,store:t,editMode:"editKey",textRect:a})}},_t=({tree:e,store:t})=>{let r=e._walker.currentNode.querySelector(".t").getBoundingClientRect(),n=Hr(e,t)||t.allowedSchs;ni({tree:e,store:t,editMode:"editType",textRect:r,opts:{allowedTs:n}})},ni=({tree:e,store:t,editMode:r,textRect:n,opts:i={}})=>{let l=e._walker.currentNode,a=Re(t,l.id,(c,m)=>S(c,"uiMode",r));e._render(t);let o=e.querySelector("textarea");if(!o)return;let s=window.getComputedStyle(o);o.style.minWidth=n.width+"px",o.style.minHeight=n.height+"px",o._treeItem=l,o.opts=i,o.onblur=c=>c.relatedTarget&&c.relatedTarget.id!=o._treeItem.id&&ri(e,t,o),o.focus()},ri=(e,t,r)=>{let n=Re(t,r._treeItem.id,(i,l)=>S(i,"uiMode","cancelled-edit"));e._render(t),n&&(e._walker.currentNode=e.querySelector(`[id='${CSS.escape(r._treeItem.id)}']`),R(e,e._walker.currentNode))},Ce=({tree:e,store:t},r)=>{r.id=="key-edit"?ii(e,t,r,Ll):r.id=="type-edit"&&ii(e,t,r,jl)},ii=(e,t,r,n)=>{let i=e._walker.currentNode;r._treeItem=r.closest("[role='treeitem']"),R(e,r._treeItem,{focus:!1});let l=n(e,t,r)||i.id;Re(t,l,(a,o)=>S(a,"uiMode","editted")),e._render(t),e._walker.currentNode=e.querySelector(`[id='${CSS.escape(l)}']`),R(e,e._walker.currentNode)},jl=(e,t,r)=>{let n=Hr(e,t)||t.allowedSchs,i=n.find(o=>Ke(o.t)==r.value),l=t._models[r.value]&&r.value||Object.keys(t._models).find(o=>{let s=t._models[o];return t._models[o].display==r.value?rr(n,s):!1}),a=tr(r.value);return i?sr(t,r._treeItem.id,()=>lr(i)):l?sr(t,r._treeItem.id,()=>qe(l)):a&&sr(t,r._treeItem.id,()=>a),e._walker.currentNode.id},Ll=(e,t,r)=>{let n=We(e),i=r.dataset.parentPath;n[r.dataset.parentPath]=n[r.dataset.parentPath].filter(c=>c.id==r._treeItem.id).map(c=>Object.assign(c,{newK:r.value}));let l=n[r.dataset.parentPath][0].index,o=or(t,{dstPath:i,startIndex:l,isRefConstraint:!1},n)[i][0].k;return`${r._treeItem.parentNode.closest("[role='treeitem']").id}[${o}]`},le=({tree:e,store:t})=>{let r=e._walker.currentNode,n=Pt(()=>e._walker.nextSibling())||Pt(()=>e._walker.previousSibling())||Pt(()=>e._walker.parentNode());ar(t,We(e)),e._render(t),r.getAttribute("data-err")=="ref"?e._walker.currentNode=r:R(e,n)},Ut=({tree:e,store:t})=>{var n;let r=e._walker.currentNode;!r||((n=t.entryable)==null?void 0:n.includes(r.dataset.tag))&&(Re(t,r.id,(i,l)=>Object.assign(i,{isEntry:!0})),e._render(t),R(e,r))};var lt=({store:e,tree:t})=>{He(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-cutting");let r=We(t,{ops:".item-cutting"});window._treeClipboard={type:"cut",srcStore:e,ops:({dstPath:n,dstLevel:i,dstStore:l})=>ar(e,r,{dstPath:n,dstLevel:i,dstStore:l}),selected:r}},at=({store:e,tree:t})=>{if(document.getSelection().toString().length!=0)return;He(t);for(let n of t.querySelectorAll("[aria-selected='true']"))n.classList.add("item-copying");let r=We(t,{ops:".item-copying"});window._treeClipboard={type:"copy",srcStore:e,ops:({dstPath:n})=>Vr(e,r,{dstPath:n,startIndex:0}),selected:r}},ge=({tree:e,store:t,srcStore:r})=>{var i;let n=ne(t,e._walker.currentNode.id);if(!!(n.hasOwnProperty("fields")||n.hasOwnProperty("schs")||n.hasOwnProperty("sch"))&&!(((i=t.put)==null?void 0:i.onlyDst)&&!t.put.onlyDst[t.taggedLevel[n._meta.level]])&&window._treeClipboard){let l=e._walker.currentNode.id,{type:a,srcStore:o,ops:s,selected:c}=window._treeClipboard,m=c,u={};if(t.key==o.key)switch(a){case"copy":u=Fr(t,{dstPath:l},m);break;case"cut":u=or(t,{dstPath:l,dstLevel:n._meta.level,dstStore:t},m);break}else switch(a){case"copy":let f=s({dstPath:""});u=Gr(t,{dstPath:l},f);break;case"cut":let p=s({dstPath:"",dstLevel:n._meta.level,dstStore:t});u=Ur(t,{dstPath:l},p);break}let x=(f,p)=>{let d={};for(let h of Object.keys(p))h==n._meta.path?d[""]=p[h]:d[h]=p[h];f._render(n),He(f),wt(f,d)};Object.keys(u).length!=0&&(n._tree?x(n._tree,u):(e._render(t),He(e),wt(e,u)))}},Me=({tree:e,store:t})=>li({tree:e,store:t,direction:""},r=>r[0].index),Pe=({tree:e,store:t})=>li({tree:e,store:t,direction:""},r=>r[r.length-1].index+1),li=({tree:e,store:t,direction:r},n)=>{let i=We(e),l={};for(let a of Object.keys(i))l=Fr(t,{dstPath:a,startIndex:n(i[a])},{[a]:i[a]});Object.keys(l).length!=0&&(e._render(t),wt(e,l,{direction:r,sync:!!e.sync}))},we=({tree:e,store:t})=>ai({tree:e,store:t,startIndex:r=>r-1,direction:""}),be=({tree:e,store:t})=>ai({tree:e,store:t,startIndex:r=>r+1,direction:""}),ai=({tree:e,store:t,startIndex:r,direction:n})=>{let i=We(e),l={};for(let a of Object.keys(i)){let o=i[a].sort((s,c)=>s.index-c.index);l=or(t,{dstPath:a,startIndex:r(o[0].index),isRefConstraint:!1},i)}Object.keys(l).length!=0&&(e._render(t),wt(e,l))},Hr=(e,t)=>{var o,s,c;let r=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!r)return;let n=ne(t,r.id),i=e._walker.currentNode,l=ne(t,i.id),a=(m,u)=>{if(!m)return!1;let x=!0;for(let f of u)x=x&&m[f[0]]==f[1];return x};for(let m of t.rulesTable||[])if(a(n,m.selector)){if((s=(o=m.rules)==null?void 0:o.nthChild)==null?void 0:s[l._meta.index])return m.rules.nthChild[l._meta.index].allowedSchs;if((c=m.rules.children)==null?void 0:c.allowedSchs)return m.rules.children.allowedSchs}return null},Vt=({tree:e})=>Br(e),Gt=({tree:e})=>Wr(e);var{defineProperties:Ul}=Object,pr=({store:e,target:t,view:r,treeKeyDownCmds:n,textAreaKeyDownCmd:i,opts:l={}})=>{Ul(e,{render:{value:function(o){r(o||this)},configurable:!0},currentNode:{writable:!0,configurable:!0},_tree:{writable:!0,configurable:!0}}),e.render();let a=document.querySelector(`${t} [role='tree']`);if(a){a._aria=qr,a._render=r,e._tree=a,Qn(a),a.onkeydown=Vl(e,n,{textAreaKeyDownCmd:i}),a.onclick=Gl(e);let o=a.querySelector(`[id='${CSS.escape(l.selectId)}']`);if(l.selectId!==!1)if(o&&l.selectId!="")a._walker.currentNode=o,R(a,a._walker.currentNode,{focus:l.focus});else{e.currentNode=dr(a,e.currentNode);let s=a._walker.nextNode(),c=e.currentNode||a._walker.nextNode()||s;R(a,c,{focus:l.focus})}return l.focus&&a._walker.currentNode.scrollIntoView({block:"center"}),a}},Vl=(e,t,r)=>function(n){Fl(n,this,e,t,r)};async function Fl(e,t,r,n=[],i={}){if(e.stopPropagation(),e.target instanceof HTMLTextAreaElement)return Kl(e,t,r,i.textAreaKeyDownCmd);switch(e.code){case"ArrowUp":e.preventDefault();break;case"ArrowDown":e.preventDefault();break}let a=new Map(n).get(oi(e));!a||(i.denyCmds||[]).includes(a.name)||ql(t,r,a)||(a({tree:t,store:r}),t._walker.currentNode=dr(t,t._walker.currentNode),R(t._walker.currentNode),r.currentNode=t._walker.currentNode,Yr(t,t._walker.currentNode,a))}var ql=(e,t,r)=>{var s,c,m,u,x,f,p;let n=e._walker.currentNode.parentNode.closest("[role='treeitem']");if(!n)return;let i=ne(t,n.id),l=e._walker.currentNode,a=ne(t,l.id),o=(d,h)=>{if(!d)return!1;let E=!0;for(let L of h)E=E&&d[L[0]]==L[1];return E};for(let d of t.rulesTable||[])if(o(i,d.selector)&&(((m=(c=(s=d.rules)==null?void 0:s.nthChild)==null?void 0:c[a._meta.index])==null?void 0:m.exceptActions)&&d.rules.nthChild[a._meta.index].exceptActions.map(h=>h.name).includes(r.name)||((u=d.rules.children)==null?void 0:u.onlyActions)&&!d.rules.children.onlyActions.map(h=>h.name).includes(r.name)||((x=d.rules.children)==null?void 0:x.exceptActions)&&d.rules.children.exceptActions.map(h=>h.name).includes(r.name))||o(a,d.selector)&&(((f=d.rules.self)==null?void 0:f.onlyActions)&&!d.rules.self.onlyActions.map(h=>h.name).includes(r.name)||((p=d.rules.self)==null?void 0:p.exceptActions)&&d.rules.self.exceptActions.map(h=>h.name).includes(r.name)))return!0;return!1},Kl=(e,t,r,n=[])=>{e.stopPropagation();let i=e.target,a=new Map(n).get(oi(e));!a||(a({tree:t,store:r},i),r.currentNode=t._walker.currentNode,Yr(t,t._walker.currentNode,a))},Gl=e=>function(t){return Bl(t,this,e)};function Bl(e,t,r){e.stopPropagation();let n=t._walker.currentNode,i=e.target.closest("[role='treeitem']"),l=!t.querySelector("textarea");if(!!i){if(e.shiftKey||e.metaKey)switch(n.compareDocumentPosition(i)){case Node.DOCUMENT_POSITION_CONTAINS:return R(t,i);case Node.DOCUMENT_POSITION_CONTAINED_BY:return R(t,n);default:if(i.parentNode.closest("[role='treeitem']")!=n.parentNode.closest("[role='treeitem']"))return R(t,i)}e.shiftKey?(n!=i&&document.getSelection().removeAllRanges(),Mt(t,n,i)):e.metaKey?ti(n,t._walker.currentNode=i):(t._walker.currentNode=i,jt({tree:t},{notFocusIfTextArea:l}),r.currentNode=t._walker.currentNode,Yr(t,i,jt))}}var oi=({shiftKey:e,metaKey:t,altKey:r,ctrlKey:n,key:i})=>{let l=[];return e&&l.push("shift"),(t||n)&&l.push("meta"),r&&l.push("alt"),i&&l.push(i),l.join("-")},Yr=(e,t,r)=>e.dispatchEvent(new CustomEvent("tree-command",{bubbles:!0,detail:{target:t,command:r}}));var si=new WeakMap,Ft=e=>(...t)=>{let r=e(...t);return si.set(r,!0),r},ot=e=>typeof e=="function"&&si.has(e);var zr=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0,mr=(e,t,r=null,n=null)=>{for(;t!==r;){let i=t.nextSibling;e.insertBefore(t,n),t=i}},st=(e,t,r=null)=>{for(;t!==r;){let n=t.nextSibling;e.removeChild(t),t=n}};var ee={},_e={};var Ne=`{{lit-${String(Math.random()).slice(2)}}}`,Jr=`<!--${Ne}-->`,ci=new RegExp(`${Ne}|${Jr}`),Nt="$lit$",hr=class{constructor(t,r){this.parts=[],this.element=r;let n=[],i=[],l=document.createTreeWalker(r.content,133,null,!1),a=0,o=-1,s=0,{strings:c,values:{length:m}}=t;for(;s<m;){let u=l.nextNode();if(u===null){l.currentNode=i.pop();continue}if(o++,u.nodeType===1){if(u.hasAttributes()){let x=u.attributes,{length:f}=x,p=0;for(let d=0;d<f;d++)di(x[d].name,Nt)&&p++;for(;p-- >0;){let d=c[s],h=Tr.exec(d)[2],E=h.toLowerCase()+Nt,L=u.getAttribute(E);u.removeAttribute(E);let F=L.split(ci);this.parts.push({type:"attribute",index:o,name:h,strings:F}),s+=F.length-1}}u.tagName==="TEMPLATE"&&(i.push(u),l.currentNode=u.content)}else if(u.nodeType===3){let x=u.data;if(x.indexOf(Ne)>=0){let f=u.parentNode,p=x.split(ci),d=p.length-1;for(let h=0;h<d;h++){let E,L=p[h];if(L==="")E=te();else{let F=Tr.exec(L);F!==null&&di(F[2],Nt)&&(L=L.slice(0,F.index)+F[1]+F[2].slice(0,-Nt.length)+F[3]),E=document.createTextNode(L)}f.insertBefore(E,u),this.parts.push({type:"node",index:++o})}p[d]===""?(f.insertBefore(te(),u),n.push(u)):u.data=p[d],s+=d}}else if(u.nodeType===8)if(u.data===Ne){let x=u.parentNode;(u.previousSibling===null||o===a)&&(o++,x.insertBefore(te(),u)),a=o,this.parts.push({type:"node",index:o}),u.nextSibling===null?u.data="":(n.push(u),o--),s++}else{let x=-1;for(;(x=u.data.indexOf(Ne,x+1))!==-1;)this.parts.push({type:"node",index:-1}),s++}}for(let u of n)u.parentNode.removeChild(u)}},di=(e,t)=>{let r=e.length-t.length;return r>=0&&e.slice(r)===t},Xr=e=>e.index!==-1,te=()=>document.createComment(""),Tr=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;var qt=class{constructor(t,r,n){this.__parts=[],this.template=t,this.processor=r,this.options=n}update(t){let r=0;for(let n of this.__parts)n!==void 0&&n.setValue(t[r]),r++;for(let n of this.__parts)n!==void 0&&n.commit()}_clone(){let t=zr?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),r=[],n=this.template.parts,i=document.createTreeWalker(t,133,null,!1),l=0,a=0,o,s=i.nextNode();for(;l<n.length;){if(o=n[l],!Xr(o)){this.__parts.push(void 0),l++;continue}for(;a<o.index;)a++,s.nodeName==="TEMPLATE"&&(r.push(s),i.currentNode=s.content),(s=i.nextNode())===null&&(i.currentNode=r.pop(),s=i.nextNode());if(o.type==="node"){let c=this.processor.handleTextExpression(this.options);c.insertAfterNode(s.previousSibling),this.__parts.push(c)}else this.__parts.push(...this.processor.handleAttributeExpressions(s,o.name,o.strings,this.options));l++}return zr&&(document.adoptNode(t),customElements.upgrade(t)),t}};var ui=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),Wl=` ${Ne} `,vt=class{constructor(t,r,n,i){this.strings=t,this.values=r,this.type=n,this.processor=i}getHTML(){let t=this.strings.length-1,r="",n=!1;for(let i=0;i<t;i++){let l=this.strings[i],a=l.lastIndexOf("<!--");n=(a>-1||n)&&l.indexOf("-->",a+1)===-1;let o=Tr.exec(l);o===null?r+=l+(n?Wl:Jr):r+=l.substr(0,o.index)+o[1]+o[2]+Nt+o[3]+Ne}return r+=this.strings[t],r}getTemplateElement(){let t=document.createElement("template"),r=this.getHTML();return ui!==void 0&&(r=ui.createHTML(r)),t.innerHTML=r,t}};var yr=e=>e===null||!(typeof e=="object"||typeof e=="function"),xr=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]),Kt=class{constructor(t,r,n){this.dirty=!0,this.element=t,this.name=r,this.strings=n,this.parts=[];for(let i=0;i<n.length-1;i++)this.parts[i]=this._createPart()}_createPart(){return new kt(this)}_getValue(){let t=this.strings,r=t.length-1,n=this.parts;if(r===1&&t[0]===""&&t[1]===""){let l=n[0].value;if(typeof l=="symbol")return String(l);if(typeof l=="string"||!xr(l))return l}let i="";for(let l=0;l<r;l++){i+=t[l];let a=n[l];if(a!==void 0){let o=a.value;if(yr(o)||!xr(o))i+=typeof o=="string"?o:String(o);else for(let s of o)i+=typeof s=="string"?s:String(s)}}return i+=t[r],i}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}},kt=class{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==ee&&(!yr(t)||t!==this.value)&&(this.value=t,ot(t)||(this.committer.dirty=!0))}commit(){for(;ot(this.value);){let t=this.value;this.value=ee,t(this)}this.value!==ee&&this.committer.commit()}},se=class{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(te()),this.endNode=t.appendChild(te())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=te()),t.__insert(this.endNode=te())}insertAfterPart(t){t.__insert(this.startNode=te()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;ot(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=ee,r(this)}let t=this.__pendingValue;t!==ee&&(yr(t)?t!==this.value&&this.__commitText(t):t instanceof vt?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):xr(t)?this.__commitIterable(t):t===_e?(this.value=_e,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){let r=this.startNode.nextSibling;t=t==null?"":t;let n=typeof t=="string"?t:String(t);r===this.endNode.previousSibling&&r.nodeType===3?r.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){let r=this.options.templateFactory(t);if(this.value instanceof qt&&this.value.template===r)this.value.update(t.values);else{let n=new qt(r,t.processor,this.options),i=n._clone();n.update(t.values),this.__commitNode(i),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());let r=this.value,n=0,i;for(let l of t)i=r[n],i===void 0&&(i=new se(this.options),r.push(i),n===0?i.appendIntoPart(this):i.insertAfterPart(r[n-1])),i.setValue(l),i.commit(),n++;n<r.length&&(r.length=n,this.clear(i&&i.endNode))}clear(t=this.startNode){st(this.startNode.parentNode,t.nextSibling,this.endNode)}},gr=class{constructor(t,r,n){if(this.value=void 0,this.__pendingValue=void 0,n.length!==2||n[0]!==""||n[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=r,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;ot(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=ee,r(this)}if(this.__pendingValue===ee)return;let t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=ee}},wr=class extends Kt{constructor(t,r,n){super(t,r,n);this.single=n.length===2&&n[0]===""&&n[1]===""}_createPart(){return new Qr(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}},Qr=class extends kt{},fi=!1;(()=>{try{let e={get capture(){return fi=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();var br=class{constructor(t,r,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=r,this.eventContext=n,this.__boundHandleEvent=i=>this.handleEvent(i)}setValue(t){this.__pendingValue=t}commit(){for(;ot(this.__pendingValue);){let l=this.__pendingValue;this.__pendingValue=ee,l(this)}if(this.__pendingValue===ee)return;let t=this.__pendingValue,r=this.value,n=t==null||r!=null&&(t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive),i=t!=null&&(r==null||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=Hl(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=ee}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}},Hl=e=>e&&(fi?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);var Zr=class{handleAttributeExpressions(t,r,n,i){let l=r[0];return l==="."?new wr(t,r.slice(1),n).parts:l==="@"?[new br(t,r.slice(1),i.eventContext)]:l==="?"?[new gr(t,r.slice(1),n)]:new Kt(t,r,n).parts}handleTextExpression(t){return new se(t)}},en=new Zr;function rn(e){let t=tn.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},tn.set(e.type,t));let r=t.stringsArray.get(e.strings);if(r!==void 0)return r;let n=e.strings.join(Ne);return r=t.keyString.get(n),r===void 0&&(r=new hr(e,e.getTemplateElement()),t.keyString.set(n,r)),t.stringsArray.set(e.strings,r),r}var tn=new Map;var nn=new WeakMap,Ye=(e,t,r)=>{let n=nn.get(t);n===void 0&&(st(t,t.firstChild),nn.set(t,n=new se(Object.assign({templateFactory:rn},r))),n.appendInto(t)),n.setValue(e),n.commit()};typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");var y=(e,...t)=>new vt(e,t,"html",en);var pi=(e,t)=>{let r=e.startNode.parentNode,n=t===void 0?e.endNode:t.startNode,i=r.insertBefore(te(),n);r.insertBefore(te(),n);let l=new se(e.options);return l.insertAfterNode(i),l},ct=(e,t)=>(e.setValue(t),e.commit(),e),ln=(e,t,r)=>{let n=e.startNode.parentNode,i=r?r.startNode:e.endNode,l=t.endNode.nextSibling;l!==i&&mr(n,t.startNode,l,i)},an=e=>{st(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},mi=(e,t,r)=>{let n=new Map;for(let i=t;i<=r;i++)n.set(e[i],i);return n},hi=new WeakMap,Ti=new WeakMap,ce=Ft((e,t,r)=>{let n;return r===void 0?r=t:t!==void 0&&(n=t),i=>{if(!(i instanceof se))throw new Error("repeat can only be used in text bindings");let l=hi.get(i)||[],a=Ti.get(i)||[],o=[],s=[],c=[],m=0;for(let E of e)c[m]=n?n(E,m):m,s[m]=r(E,m),m++;let u,x,f=0,p=l.length-1,d=0,h=s.length-1;for(;f<=p&&d<=h;)if(l[f]===null)f++;else if(l[p]===null)p--;else if(a[f]===c[d])o[d]=ct(l[f],s[d]),f++,d++;else if(a[p]===c[h])o[h]=ct(l[p],s[h]),p--,h--;else if(a[f]===c[h])o[h]=ct(l[f],s[h]),ln(i,l[f],o[h+1]),f++,h--;else if(a[p]===c[d])o[d]=ct(l[p],s[d]),ln(i,l[p],l[f]),p--,d++;else if(u===void 0&&(u=mi(c,d,h),x=mi(a,f,p)),!u.has(a[f]))an(l[f]),f++;else if(!u.has(a[p]))an(l[p]),p--;else{let E=x.get(c[d]),L=E!==void 0?l[E]:null;if(L===null){let F=pi(i,l[f]);ct(F,s[d]),o[d]=F}else o[d]=ct(L,s[d]),ln(i,L,l[f]),l[E]=null;d++}for(;d<=h;){let E=pi(i,o[h+1]);ct(E,s[d]),o[d++]=E}for(;f<=p;){let E=l[f++];E!==null&&an(E)}hi.set(i,o),Ti.set(i,c)}});var on=new WeakMap,J=Ft(e=>t=>{let r=on.get(t);if(e===void 0&&t instanceof kt){if(r!==void 0||!on.has(t)){let n=t.committer.name;t.committer.element.removeAttribute(n)}}else e!==r&&t.setValue(e);on.set(t,e)});var _r={};An(_r,{ENTRY_MARKED:()=>At,MOVED:()=>ve,NEW:()=>Je,NEW_KEY:()=>Ze,NEW_ORDER:()=>Qe,NEW_TYPE:()=>ke,REMOVED:()=>Xe,buildBaseIndices:()=>sn,diff:()=>Ql,mergeToBase:()=>Zl,mergeToCurrent:()=>ea});var de="file",$t="project",yi=(e,t)=>(Object.assign(t,e),t.fields=[],G(()=>t)),xi=(e,t)=>B(e,(r,n)=>(t[r.$a]&&(r.metadata=t[r.$a]),r)),gi=(e,t)=>{sn(e);let r=e._indices;for(let n of e.fields)for(let i of n.fields)if(t[i.$a]){let l=yt(t[i.$a],(a,o)=>(r[o]&&a.push(r[o]),a),[]);l.length!=0?S(i,"referrers",l):delete i.referrers}else delete i.referrers},Et=(e,t,r)=>(t||(t=wi()),Object.assign(t,e),G(()=>t)),_i=()=>bi({taggedLevel:{1:$t,2:de,3:Z},refParentLevel:2,allowedSchs:[wi],put:{pos:"prepend",onlyDst:{[de]:!0}}}),wi=()=>bi({taggedLevel:{1:de,2:Z},refParentLevel:1,addDefault:oe,entryable:[Z],put:{pos:"prepend"},rulesTable:cn}),bi=(e={})=>{let t=G(oe);return t.allowedSchs=(e.allowedSchs||dn).map(r=>r()),t.taggedLevel=e.taggedLevel,e.put&&(t.put=e.put),e.entryable&&(t.entryable=e.entryable),e.addDefault&&(t._addSchDefault=t.allowedSchs.find(r=>r.t==e.addDefault().t)&&e.addDefault()),e.rulesTable&&(t.rulesTable=e.rulesTable),e.refParentLevel&&(t.refParentLevel=e.refParentLevel),t},Bt=(e,t)=>ne(e,`[${t}]`)||e._currentFileStore,ze=e=>{let t={};return un(e,(r,n)=>{t[r.$a]={display:[n.file.key,r.key].join(" :: "),file:n.file.key,fmodel:r.key,sch:r}}),t},un=(e,t)=>{for(let r of e.fields)for(let n=0;n<r.fields.length;n++)r.fields[n]=t(r.fields[n],{path:`[${r.key}][${r.fields[n].key}]`,file:r})||r.fields[n]},dn=[er,oe,Kn,Bn,Wn,Fe,In,Fn,()=>tr('"json string"'),Rn,Cn,Mn,Pn,jn,Ln,Un,Vn,Gn,Hn,Yn,qn,()=>qe(null)],zl={selector:[["t",K]],rules:{self:{exceptActions:[xe,ge]},children:{exceptActions:[lt,at,Me,Pe,le,we,be]},nthChild:[{allowedSchs:[er()]}]}},Jl={selector:[["t",j]],rules:{self:{exceptActions:[xe,ge]},children:{exceptActions:[lt,at,Me,Pe,le,we,be]},nthChild:[{allowedSchs:[qe(null,{to:[oe({metadata:{strict:!1}})]})]},{allowedSchs:[oe()],exceptActions:[_t,Ce]}]}},Xl={selector:[["t",V]],rules:{children:{min:1,allowedSchs:[oe(),qe(null,{to:[oe()]})]}}},cn=[zl,Xl,Jl];var Je="new",Xe="removed",ve="moved",Qe="order_changed",Ze="key_changed",ke="type_changed",At="entry_changed",sn=e=>{let t={};return B(e,(r,n)=>(S(r,"_meta",n),Object.assign(t,{[r.$a]:r}),delete r._visit,delete r._pruned,r)),S(e,"_indices",t),e},Ql=(e,t,r={})=>{let n=[],i=t._indices;B(e,(a,o)=>{delete a._diff;let s={},c=i[a.$a];if(c){let m=o.parent,u=c._meta.parent;u.$a!=m.$a&&Object.assign(s,{[ve]:{oldParent:u,newParent:m,oldPath:c._meta.path,newPath:o.path}}),c._meta.index!=o.index&&u.$a==m.$a&&Object.assign(s,{[Qe]:{oldOrder:c.index,newOrder:a.index}}),c.t!=a.t&&Object.assign(s,{[ke]:{oldType:c.t,newType:a.t,parent:m}}),c.$r!=a.$r&&Object.assign(s,{[ke]:{oldType:c.$r,newType:a.$r,parent:m}}),c.v!=a.v&&Object.assign(s,{[ke]:{oldType:c.v,newType:a.v,parent:m}}),c.key!=a.key&&Object.assign(s,{[Ze]:{oldKey:c.key,newKey:a.key,parent:m}}),c.isEntry!=a.isEntry&&Object.assign(s,{[At]:{oldIsEntry:c.isEntry,newIsEntry:a.isEntry,parent:m}}),Object.keys(s).length!=0&&(S(a,"_diff",Object.assign(s,{meta:fn(o)})),n.push(a)),S(c,"_visit",!0)}else S(a,"_diff",{[Je]:{parent:o.parent},meta:fn(o)}),n.push(a);return a});let l=[];return B(t,(a,o)=>(a._visit||(S(a,"_diff",{[Xe]:{parent:o.parent},meta:fn(o)}),l.push(a),S(a,"_pruned",!0)),delete a._visit,a)),n=n.concat(l),n},fn=({level:e,path:t,lpath:r,parent:n})=>({level:e,path:t,lpath:r,pa:n.$a}),Zl=(e,t)=>(e._indices||(e._indices={}),vi(e,t.removed),ki(e,t.added),Ni(e,t.changed),$i(e,t.reorder),e),ea=(e,t)=>(e._indices||(e._indices={}),vi(e,t.removed),ki(e,t.added),Ni(e,t.changed),$i(e,t.reorder),e),Ni=(e,{fmodels:t,files:r})=>{Ei(e,r,(n,i)=>{let{key:l,index:a}=i;return Object.assign(n,{key:l,index:a})}),Ei(e,t,(n,i)=>(n.referrers&&S(i,"referrers",n.referrers),i))},Ei=(e,t,r=n=>n)=>{let n={};for(let a of t)n[a.$a]=!0;let i={},l={};for(let a of t)B(a,(o,s)=>(i[o.$a]=o,l[o.$a]=o,o));B(e,(a,o)=>{if(Object.keys(i).length==0&&(a._halt=!0),i[a.$a]){if(e._indices[a.$a]){let s=e._indices[a.$a].metadata;s&&nr(i[a.$a],"metadata",s)}n[a.$a]?a=r(a,i[a.$a]):a=i[a.$a],delete i[a.$a]}return a}),pn(e,l)},vi=(e,{fmodels:t,files:r})=>{Ai(e,r,n=>Et(n)),Ai(e,t)},Ai=(e,t)=>{var i;let r={};for(let l of t)r[i=l.pa]||(r[i]=[]),r[l.pa].push(l.$a);let n=(l,a)=>a.reduce((o,s,c)=>(r[l.$a].includes(s.$a)&&o.push(c),o),[]);if(Lr(e,(l,a)=>(Object.keys(r).length==0&&(l._halt=!0),r[l.$a]),(l,a)=>{let o=[];switch(!0){case l.hasOwnProperty("fields"):o=n(l,l.fields);break;case l.hasOwnProperty("schs"):o=n(l,l.schs);break}return delete r[l.$a],o}),e._indices)for(let l of t)delete e._indices[l.$a]},ki=(e,{fmodels:t,files:r})=>{Si(e,r,n=>Et(n)),Si(e,t)},Si=(e,t,r=n=>n)=>{var l;let n={};for(let a of t)n[l=a.pa]||(n[l]=[]),n[a.pa].push({k:a.key,sch:()=>Xn(r(a)),index:a.index});xt(e,(a,o)=>(Object.keys(n).length==0&&(a._halt=!0),n[a.$a]),(a,o)=>{let s=n[a.$a];return delete n[a.$a],s});let i={};for(let a of t)B(a,(o,s)=>(i[o.$a]=o,o));pn(e,i)},$i=(e,{fmodels:t,files:r})=>{Oi(e,r,n=>Et(n)),Oi(e,t)},Oi=(e,t)=>{var l;let r={};for(let a of t){let{$a:o,index:s}=a;r[l=a.pa]||(r[l]=[]),r[a.pa].push({$a:o,index:s})}let n=(a,o)=>{let s={};for(let c of o)s[c.$a]=c;return r[a.$a].sort((c,m)=>c.index-m.index).map(c=>s[c.$a])};Be(e,(a,o)=>(Object.keys(r).length==0&&(a._halt=!0),r[a.$a]),(a,o)=>{switch(!0){case a.hasOwnProperty("fields"):a.fields=n(a,a.fields);break;case a.hasOwnProperty("schs"):a.schs=n(a,a.schs);break}return delete r[a.$a],a});let i={};for(let a of t)i[a.$a]=a;pn(e,i)},pn=(e,t)=>B(e,(r,n)=>(Object.keys(t).length==0&&(r._halt=!0),t[r.$a]&&(S(r,"_visit",!0),S(r,"_meta",n),e._indices[r.$a]=r,delete r._diff,delete t[r.$a]),r));var Wt=(e,t)=>{let r,n=e.metadata;switch(!0){case(e.t==P&&e.fields.length==0&&(n==null?void 0:n.strict)):r="{ empty }";break;case(e.t==P&&e.fields.length==0):r="{ any }";break;case(e.t==P&&(n==null?void 0:n.strict)):r="{ strict }";break;case e.t==P:r="{ \xA0 }";break;case(e.t==j&&(n==null?void 0:n.strict)):r="{ e | r strict }";break;case e.t==j:r="{ e | r }";break;case e.t==H:r=y`[\xa0 ${Wt(e.sch,t)} \xa0]`;break;case e.t==z:r="( \xA0 )";break;case e.t==K:r="dict";break;case e.t==Y:r="||";break;case e.t==V:r=`|| ${(n==null?void 0:n.tagname)||e.tagname}`;break;case e.t==Ee:r="string",t.showMeta&&(n==null?void 0:n.pattern)&&(r=y`<span style="flex-shrink:0">${r}</span> <span class="m pattern">/${n.pattern}/<span>`);break;case e.t==De:r="integer";break;case e.t==ue:r="int_8";break;case e.t==pe:r="int_16";break;case e.t==he:r="int_32";break;case e.t==fe:r="uint_8";break;case e.t==me:r="uint_16";break;case e.t==Te:r="uint_32";break;case e.t==Ae:r="float_32";break;case e.t==Se:r="float_64";break;case e.t==Oe:r="bool";break;case e.t==Ge:r="nil";break;case e.t==ht:r="any";break;case(e.t==ae&&!!t.models[e.$r]):nr(e,"_text",Nr(e,t)),r=y`<span class="ref" ._a="${e.$r}">${e._text}</span >`;break;case(e.t==ae&&e.$r==null):r=y`<span class="ref" title="Ref type">{ }</span>`;break;case e.t==ae:r=y`<span class="ref notfound" title="Ref type">${`${e._text||e.$r} (#404)`}</span>`;break;case e.t==ye:r=y`<span class="value" title="Value type">${Nr(e,t)}</span>`;break;default:r="# UNDEFINED_TYPE #"}return t.tText&&(r=t.tText(e,t)||r),r},Nr=(e,t)=>{var r;switch(!0){case e.t==ye:return JSON.stringify(e.v);case e.t==ae:return(r=t.models[e.$r])==null?void 0:r.display;default:return Ke(e.t)}};(function(){var e={},t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},r={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},n=/(&amp;|&lt;|&gt;|&quot;|&#39;)/g,i=/[&<>"']/g;function l(w){return t[w]}function a(w){return r[w]}function o(w){return w==null?"":String(w).replace(i,l)}function s(w){return w==null?"":String(w).replace(n,a)}o.options=s.options={},e={encode:o,escape:o,decode:s,unescape:s,version:"1.0.0-browser"};var c=function(w){return typeof w=="string"?w.toLowerCase():w};function m(w,v){return w[v]=!0,w}var u=function(w){return w.reduce(m,{})},x=u(["background","base","cite","href","longdesc","src","usemap"]),f={voids:u(["area","br","col","hr","img","wbr","input","base","basefont","link","meta"])},p=f,d=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,h=/^<\s*\/\s*([\w:-]+)[^>]*>/,E=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,L=/^</,F=/^<\s*\//,b=function(w,v){var $,A=v||{};return I(),{start:function(O,k,Q){var Le=c(O);$.ignoring||(A.allowedTags||[]).indexOf(Le)===-1||A.filter&&!A.filter({tag:Le,attrs:k})?N(Le):(C("<"),C(Le),Object.keys(k).forEach(function(mt){var It,Ue=k[mt],W=(A.allowedClasses||{})[Le]||[],re=(A.allowedAttributes||{})[Le]||[];re=re.concat((A.allowedAttributes||{})["*"]||[]);var U=c(mt);U==="class"&&re.indexOf(U)===-1?It=(Ue=Ue.split(" ").filter(function(M){return W&&W.indexOf(M)!==-1}).join(" ").trim()).length:It=re.indexOf(U)!==-1&&(x[U]!==!0||function(M){var Ve=M[0];if(Ve==="#"||Ve==="/")return!0;var nt=M.indexOf(":");if(nt===-1)return!0;var Rt=M.indexOf("?");if(Rt!==-1&&nt>Rt)return!0;var Or=M.indexOf("#");return Or!==-1&&nt>Or||A.allowedSchemes.some(function(Dr){return M.indexOf(Dr+":")===0})}(Ue)),It&&(C(" "),C(mt),typeof Ue=="string"&&(C('="'),C(e.encode(Ue)),C('"')))}),C(Q?"/>":">"))},end:function(O){var k=c(O);(A.allowedTags||[]).indexOf(k)!==-1&&$.ignoring===!1?(C("</"),C(k),C(">")):function(Q){$.ignoring===Q&&--$.depth<=0&&I()}(k)},chars:function(O){$.ignoring===!1&&C(A.transformText?A.transformText(O):O)}};function C(O){w.push(O)}function N(O){f.voids[O]||($.ignoring===!1?$={ignoring:O,depth:1}:$.ignoring===O&&$.depth++)}function I(){$={ignoring:!1,depth:0}}},g={allowedAttributes:{"*":["title","accesskey"],a:["href","name","target","aria-label"],iframe:["allowfullscreen","frameborder","src"],img:["src","alt","title","aria-label"]},allowedClasses:{},allowedSchemes:["http","https","mailto"],allowedTags:["a","abbr","article","b","blockquote","br","caption","code","del","details","div","em","h1","h2","h3","h4","h5","h6","hr","i","img","ins","kbd","li","main","mark","ol","p","pre","section","span","strike","strong","sub","summary","sup","table","tbody","td","th","thead","tr","u","ul"],filter:null};function _(w,v,$){var A=[],C=$===!0?v:function N(I){for(var O,k,Q=Array.prototype.slice.call(arguments,1);Q.length;)for(k in O=Q.shift())O.hasOwnProperty(k)&&(Object.prototype.toString.call(I[k])==="[object Object]"?I[k]=N(I[k],O[k]):I[k]=O[k]);return I}({},g,v);return function(N,I){for(var O,k=function(){var W=[];return W.lastItem=function(){return W[W.length-1]},W}(),Q=N;N;)Le();function Le(){var W;O=!0,N.substr(0,4)==="<!--"?(W=N.indexOf("-->"))>=0&&(I.comment&&I.comment(N.substring(4,W)),N=N.substring(W+3),O=!1):F.test(N)?mt(h,Ue):L.test(N)&&mt(d,It),function(){if(O){var U,M=N.indexOf("<");M>=0?(U=N.substring(0,M),N=N.substring(M)):(U=N,N=""),I.chars&&I.chars(U)}}();var re=N===Q;Q=N,re&&(N="")}function mt(W,re){var U=N.match(W);U&&(N=N.substring(U[0].length),U[0].replace(W,re),O=!1)}function It(W,re,U,M){var Ve={},nt=c(re),Rt=p.voids[nt]||!!M;U.replace(E,function(Or,Dr,kn,$n,En){Ve[Dr]=kn===void 0&&$n===void 0&&En===void 0?void 0:e.decode(kn||$n||En||"")}),Rt||k.push(nt),I.start&&I.start(nt,Ve,Rt)}function Ue(W,re){var U,M=0,Ve=c(re);if(Ve)for(M=k.length-1;M>=0&&k[M]!==Ve;M--);if(M>=0){for(U=k.length-1;U>=M;U--)I.end&&I.end(k[U]);k.length=M}}Ue()}(w,b(A,C)),A.join("")}_.defaults=g,window&&(window.insane=_)})();var ta={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function Di(e){return e.replace(RegExp("^"+(e.match(/^(\t| )+/)||"")[0],"gm"),"")}function Ht(e){return(e+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Yt(e,t){var r,n,i,l,a,o=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,s=[],c="",m=t||{},u=0;function x(p){var d=ta[p[1]||""],h=s[s.length-1]==p;return d?d[1]?(h?s.pop():s.push(p),d[0|h]):d[0]:p}function f(){for(var p="";s.length;)p+=x(s[s.length-1]);return p}for(e=e.replace(/^\[(.+?)\]:\s*(.+)$/gm,function(p,d,h){return m[d.toLowerCase()]=h,""}).replace(/^\n+|\n+$/g,"");i=o.exec(e);)n=e.substring(u,i.index),u=o.lastIndex,r=i[0],n.match(/[^\\](\\\\)*\\$/)||((a=i[3]||i[4])?r='<pre class="code '+(i[4]?"poetry":i[2].toLowerCase())+'"><code'+(i[2]?' class="language-'+i[2].toLowerCase()+'"':"")+">"+Di(Ht(a).replace(/^\n+|\n+$/g,""))+"</code></pre>":(a=i[6])?(a.match(/\./)&&(i[5]=i[5].replace(/^\d+/gm,"")),l=Yt(Di(i[5].replace(/^\s*[>*+.-]/gm,""))),a==">"?a="blockquote":(a=a.match(/\./)?"ol":"ul",l=l.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),r="<"+a+">"+l+"</"+a+">"):i[8]?r='<img src="'+Ht(i[8])+'" alt="'+Ht(i[7])+'">':i[10]?(c=c.replace("<a>",'<a href="'+Ht(i[11]||m[n.toLowerCase()])+'">'),r=f()+"</a>"):i[9]?r="<a>":i[12]||i[14]?r="<"+(a="h"+(i[14]?i[14].length:i[13]>"="?1:2))+">"+Yt(i[12]||i[15],m)+"</"+a+">":i[16]?r="<code>"+Ht(i[16])+"</code>":(i[17]||i[1])&&(r=x(i[17]||"--"))),c+=n,c+=r;return(c+e.substring(u)+f()).replace(/^\n+|\n+$/g,"")}customElements.define("t-md",class extends HTMLElement{connectedCallback(){this.innerHTML=insane(Yt(this.textContent))}});var Ii=(e,t)=>y`
  ${ra(e)}
  <ul>
    ${na(e,{models:t._models,path:"",rootKey:t.key})}
  </ul>`,ra=e=>{switch(!0){case[P,j].includes(e.t):return y`<p class="defs-docs">Fields Description</p>`;case[z,H].includes(e.t):return y`<p class="defs-docs">Elements Description</p>`;case[K].includes(e.t):return y`<p class="defs-docs">K V Description</p>`;case[Y,V].includes(e.t):return y`<p class="defs-docs">Cases Description</p>`}},na=(e,t)=>{switch(!0){case e.hasOwnProperty("fields"):return ce(e.fields,r=>r.$a,(r,n)=>hn({key:r.key,m:r.metadata,sch:r,ui:{...t,path:`${mn(e,t)}[${r.key}]`}}));case e.hasOwnProperty("schs"):return ce(e.schs,r=>r.$a,(r,n)=>hn({key:ia(e,n),m:r.metadata,sch:r,ui:{...t,path:`${mn(e,t)}[][${n}]`}}));case e.hasOwnProperty("sch"):return hn({key:"\u2514",m:e.sch.metadata,sch:e.sch,ui:{...t,path:`${mn(e,t)}[][${0}]`}})}},mn=(e,t)=>e._meta.path.replace(`[${t.rootKey}]`,""),ia=(e,t)=>{switch(e.t){case j:return{0:"e",1:"r"}[t];case K:return{0:"k",1:"v"}[t];default:return t}},hn=({key:e,sch:t,ui:r,m:n})=>y`<li>
  <dl>
    <dt>
      <a href="#${r.path}" class="k">${e}</a>
      <span class="s">:</span>
      <span class="t">${Wt(t,Object.assign(r,{showMeta:!0}))}</span>
    </dt>
    ${n&&n.description?y`<dd><t-md>${n.description}</t-md></dd>`:y`<dd><t-md>–––</t-md></dd>`}
  </dl>
</li>`;customElements.define("sch-meta",class extends HTMLElement{connectedCallback(){this.addEventListener("change",this.handleMetaChange),this.addEventListener("input",this.handleMetaChange),this.addEventListener("paste",this.handleMetaChange),this.addEventListener("focusout",this.handleMetaChange)}disconnectedCallback(){this.removeEventListener("change",this.handleMetaChange),this.removeEventListener("input",this.handleMetaChange),this.removeEventListener("paste",this.handleMetaChange),this.removeEventListener("focusout",this.handleMetaChange)}handleMetaChange(e){if(e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement){let t=l=>["checkbox","radio"].includes(l.type)?l.checked:l.value,r=this.querySelector("form").elements,n={};for(let l=0;l<r.length;l++){let a=t(r[l]);!(r[l]instanceof HTMLTextAreaElement)&&a==""||(n[r[l].name]=a)}let i={path:e.target.closest("[data-path]").dataset.path,file:e.target.closest("[data-file]").dataset.file,attrs:n};this.dispatchEvent(new CustomEvent("sch-update",{detail:i,bubbles:!0}))}}});customElements.define("autosize-text",class extends HTMLElement{static get observedAttributes(){return["data-value"]}attributeChangedCallback(e,t,r){this.autosize(r)}connectedCallback(){this.autosize.bind(this)()}autosize(e){for(let t of this.getElementsByTagName("textarea"))e||(e=t.value),e&&(t.value=e,Tt({target:t}))}});var Ri=e=>Ye(ce([{$a:"nothing"}],t=>t.$a,t=>_e),document.querySelector(e)),Tn=(e,t,r)=>{try{let n=t.referrers||[];Ye(ce([t],i=>i.$a,i=>y`
    <p class="meta-def">${oa(r.key,i._meta.path)||"-"}</p>
    <p>${Ke(i.t)}</p>
    <form data-path="${i._meta.path}" data-file="${r.key}" class="fbox">
      ${dt(i,"title",{keyDisplay:"Title"})}
      ${dt(i,"description",{keyDisplay:"Description"})}
      ${ca(i)}
      ${Ci(i,"rw",{collection:[["r","Readonly"],["w","Writeonly"],["rw","Read and Write"]],selected:D(i,"rw","rw"),keyDisplay:"Read / Write"})}
      ${sa(i,"default",{keyDisplay:"Default",min:D(i,"min"),max:D(i,"max")})}
    </form>
    ${la(n)}
    ${aa(i,r)}
  `),document.querySelector(e))}catch(n){console.log(n)}},la=e=>e.length!=0?y`
    <p class="referrers">Referrers</p>
    <ul>
      ${e.map(t=>y`<li>${t._meta.lpath.slice(1).map(r=>r.key||r.index||r._meta.index).join(" / ")}</li>`)}
    </ul>
    `:_e,aa=(e,t)=>Ii(e,t),oa=(e,t)=>{t=t.substring(1,t.length-1).split("][").filter(n=>n!=""),t.splice(0,0,e);let r=y`<span style="color: var(--meta-def-color);">${t[0]} :: ${t[1]}</span>`;return t=t.slice(2).flatMap(n=>[y`<span style="margin: 0 .5rem;">/</span>`,document.createTextNode(n)]),t.splice(0,0,r),t},St=(e,t,r,n={})=>{var i;return y`
  <label class="${n.readonly&&`box-label ${t} readonly`||`box-label ${t}`}">
    <p class="l">${n.keyDisplay||t}</p>
    ${n.title}
    ${r}
    ${(i=zt(e,t))==null?void 0:i.map(l=>y`<p class="err">${l}</p>`)}
  </label>
  `};var dt=(e,t,r={})=>St(e,t,y`
    <autosize-text data-value="${D(e,t)||""}">
      <textarea name="${Ot(e,t)}" maxlength="${J(et(r.maxlength))}" minlength="${J(et(r.minlength))}" ?readonly="${r.readonly}" rows="1" spellcheck="false" class="${J(zt(e,t)&&"invalid")}" @input="${Tt}">${r.value||D(e,t,"")}</textarea>
    </autosize-text>
  `,r),ut=(e,t,r={})=>St(e,t,y`
    <input type="number" name="${Ot(e,t)}" inputmode="decimal" step="${r.step||"any"}" min="${J(et(r.min))}" max="${J(et(r.max))}" value="${J(et(r.value)||D(e,t))}" ?readonly="${r.readonly}" class="${J(zt(e,t)&&"invalid")}">
  `,r),tt=(e,t,r={})=>St(e,t,y`
    <input type="number" name="${Ot(e,t)}" inputmode="numeric" pattern="[0-9]*" min="${J(et(r.min))}" max="${J(et(r.max))}" value="${J(et(r.value)||D(e,t))}" ?readonly="${r.readonly}" class="${J(zt(e,t)&&"invalid")}">
  `,r),ft=(e,t,r={})=>St(e,t,y`
    <input type="checkbox" name="${Ot(e,t)}" ?disabled="${r.readonly}" ?checked="${!!D(e,t)}" .checked="${!!D(e,t)}" .indeterminate="${r.indeterminate}">
  `,r),Ci=(e,t,r={})=>St(e,t,y`
    <select name="${Ot(e,t)}" ?disabled="${r.readonly}">
      ${r.collection.map(([n,i])=>y`<option value="${n}" ?selected="${(r.selected||D(e,t))==n}">${i}</option>`)}
    </select>
  `,r),da=(e,t,r={})=>St(e,t,y`
    <input type="text" list="${e._meta.level}${e._meta.index}" name="${Ot(e,t)}" ?readonly="${r.readonly}" class="${J(zt(e,t)&&"invalid")}">
    <datalist id="${e._meta.level}${e._meta.index}">
      ${r.collection.map(([n,i])=>y`<option value="${n}">${i}</option>`)}
    </datalist>
  `,r),sa=(e,t,r={})=>{let n=Ct(e.t)||{};switch(e.t){case Oe:let i={collection:[["t","True"],["f","False"],["i","Unset"]],selected:D(e,t,"i")};return Ci(e,t,Object.assign(r,i));case De:case ue:case pe:case he:case fe:case me:case Te:case Ae:case Se:return ut(e,t,Object.assign(r,n));case Ee:return dt(e,t,r);default:return""}},ua=["uuid","date-time","date","time","duration","email","idn-email","hostname","idn-hostname","ipv4","ipv6","uri","uri-reference","iri","iri-reference","uri-template","json-pointer","relative-json-pointer"],et=e=>e==0?"0":e,Ot=(e,t)=>t,D=(e,t,r)=>(e.metadata||{})[t]||r,Dt=e=>Math.max(0,e),ca=e=>{let t,r=Ct(e.t)||{};switch(e.t){case P:!e.referrers||e.referrers.length==0?t=[ft(e,"strict",{keyDisplay:"Strict"})]:t=[];break;case j:!e.referrers||e.referrers.length==0?t=[ft(e,"strict",{keyDisplay:"Strict"})]:t=[];break;case H:t=[tt(e,"min",{keyDisplay:"Min Items",min:0,max:Dt(D(e,"max"))}),tt(e,"max",{keyDisplay:"Max Items",min:Dt(D(e,"min",0))}),ft(e,"unique",{keyDisplay:"Item uniqueness"})];break;case z:t=[tt(e,"min",{keyDisplay:"Min Items",value:e.schs.length,readonly:!0}),tt(e,"max",{keyDisplay:"Max Items",value:e.schs.length,readonly:!0})];break;case K:t=[tt(e,"min",{keyDisplay:"Min Properties",min:0,max:Dt(D(e,"max"))}),tt(e,"max",{keyDisplay:"Max Properties",min:Dt(D(e,"min",0))})];break;case V:t=[dt(e,"tagname",{keyDisplay:"Tag name",value:e.tagname})];break;case Ee:t=[tt(e,"min",{keyDisplay:"Min Length",min:0,max:Dt(D(e,"max"))}),tt(e,"max",{keyDisplay:"Max Length",min:Dt(D(e,"min",0))}),dt(e,"pattern",{keyDisplay:"String Pattern",maxlength:256}),da(e,"format",{collection:ua.map(l=>[l,l]),keyDisplay:"Format"})];break;case De:t=[ut(e,"min",{keyDisplay:"Min",max:D(e,"max")}),ut(e,"max",{keyDisplay:"Max",min:D(e,"min")}),ut(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:Math.min(D(e,"max",r.max),r.max)})];break;case ue:case pe:case he:case fe:case me:case Te:t=[ut(e,"multipleOf",{keyDisplay:"Multiple of",min:1,max:Math.min(D(e,"max",r.max),r.max)}),dt(e,"format",{keyDisplay:"Format"})];break;case Ae:case Se:t=[ut(e,"min",{keyDisplay:"Min",max:D(e,"max")}),ut(e,"max",{keyDisplay:"Max",min:D(e,"min")}),dt(e,"format",{keyDisplay:"Format"})];break;case Oe:t=[];case Ge:t=[];break;case Y:e.schs.reduce((l,a)=>a.t==ye&&l,!0)?t=[ft(e,"asUnion",{keyDisplay:"As Union"})]:t=[];break;case ht:t=[];case ae:t=[];case ye:t=[];default:t=[]}let n=e._meta.parent.t==P,i=e._meta.level>2;if(n&&i)switch(!0){case(!D(e,"isKeyPattern")&&!D(e,"required")):t.push(ft(e,"required",{keyDisplay:"Required"}));break;case D(e,"isKeyPattern"):t.push(ft(e,"required",{keyDisplay:"Required",readonly:!0}));break;case D(e,"required"):t.push(ft(e,"required",{keyDisplay:"Required"}));break}return t},zt=(e,t)=>e.errors&&e.errors[t];var Mi=e=>Ye(y`<ul role="tree"></ul>`,document.querySelector(e)),vr=(e,t,r={})=>{var n;try{let i={level:1,tab:((n=r.ui)==null?void 0:n.tab)||0,models:t._models||{},taggedLevel:t.taggedLevel||{}};i.rootLevel=i.level,Object.assign(i,r.ui),r.ui.lineClass&&Object.assign(i,{tab:r.ui.tab+2}),fa(e,{sch:t,ui:i,path:t.path||"",key:t.key,parent:t})}catch(i){console.log(i)}},fa=(e,t)=>Ye(y`
  <ul role="tree" aria-multiselectable="true" class="${`${t.ui.lineClass||""} text-sm`}" aria-labelledby="${yn(t.ui)+"_tree"}">
    ${Jt(t)}
  </ul>
  `,document.querySelector(e)),xn=e=>J(yn(e)),yn=e=>e.taggedLevel[e.level],Pi=e=>{let t;if(!e)return"";for(let r of Object.keys(e))switch(r){case Je:t="N";break;case Xe:t="R";break;case ve:t="M";break;case Qe:t="O";break;case Ze:t="C";break;case ke:t="C";break;case At:t="C";break}return t||""},Jt=e=>{switch(!0){case e.ui.level==e.ui.rootLevel:return Object.assign(e.ui,{expanded:!0}),pa(e);case[H].includes(e.sch.t):return e.sch.sch.hasOwnProperty("fields")||e.sch.sch.hasOwnProperty("schs")?Object.assign(e.ui,{expanded:!0}):Object.assign(e.ui,{expanded:!1}),ji(e);case(e.sch.hasOwnProperty("fields")||e.sch.hasOwnProperty("schs")):return Object.assign(e.ui,{expanded:!0}),ji(e);default:return ma(e)}},pa=e=>y`
  <li id="${e.path}" data-tag="${xn(e.ui)}" .key="${e.key}" .index="${0}" .sch=${e.sch} aria-posinset="${1}" class="root-item" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" id="${yn(e.ui)}_tree">
      ${gn(e.key)}
    </dfn>
    <ul data-group="${Ui(e.sch)}" role="group" tabindex="-1">
      ${Li(e)}
    </ul>
  </li>`,ji=e=>y`
  <li id="${e.path}" data-tag="${xn(e.ui)}" .key="${e.key}" .index="${e.ui.index}" .sch=${e.sch} aria-posinset="${e.ui.index+1}" class="folder" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" aria-expanded="${e.ui.expanded}" tabindex="-1">
    <dfn class="h" data-diff="${Pi(e.sch._diff)}" data-group-size="${ha(e.sch)}">
      ${Vi(Object.assign(e,{key:gn(e.key)}))}
      ${Gi(e)}
    </dfn>
    <ul data-group="${Ui(e.sch)}" role="group">
      ${Li(e)}
    </ul>
  </li>`,ma=e=>y`
  <li id="${e.path}" data-tag="${xn(e.ui)}" data-diff="${Pi(e.sch._diff)}" .key="${e.key}" .index="${e.ui.index}" .sch=${e.sch} aria-posinset="${e.ui.index+1}" class="file" role="treeitem" aria-level="${e.ui.level}" aria-selected="false" tabindex="-1">
    ${Vi(Object.assign(e,{key:gn(e.key)}))}
    ${Gi(e)}
  </li>`,Li=e=>{if(e.ui.depthLimit&&e.ui.level>=e.ui.depthLimit)return _e;switch(!0){case[P,V].includes(e.sch.t):return Ta(e);case[z,K,j].includes(e.sch.t):return ya(e);case[H].includes(e.sch.t):return xa(e);case[Y].includes(e.sch.t):return ga(e);default:return _e}},Ta=e=>ce(e.sch.fields,t=>t.$a,(t,r)=>Jt({key:t.key,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[${t.key}]`})),ya=e=>ce(e.sch.schs,t=>t.$a,(t,r)=>Jt({key:r,sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),xa=e=>ce([e.sch.sch],t=>t.$a,(t,r)=>Jt({key:r,sch:e.sch.sch,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),ga=e=>ce(e.sch.schs,t=>t.$a,(t,r)=>Jt({key:"",sch:t,parent:e.sch,ui:{...e.ui,level:e.ui.level+1,index:r,parentPath:e.path},path:`${e.path}[][${r}]`})),$e=(e,t=0)=>`padding-left: ${(e.ui.level-1)*2+e.ui.tab-1+t}ch`,Fi=(e,t,r)=>y`<textarea id="${e}" class="no-resize" spellcheck="false" maxlength="255" rows="1" autofocus
  data-parent-path="${t}"
  data-newline="false"
  @input="${Tt}"
  @focus="${zn}"
  >${r}</textarea>`,Vi=e=>e.ui.level==e.ui.rootLevel+1?wa(e):ba(e),wa=e=>y`
  <span class="def" style="${$e(e)}">
    ${_a(e.sch,e.ui)}
  </span>
  <span class="k">${kr(e)}</span>
  <span class="s">=</span>
  `,ba=e=>{var t,r;switch(!0){case e.parent.t==Y:return y`
      <span class="s" style="${$e(e,1)}">|</span>
      `;case(e.parent.t==K&&e.sch.$a==e.parent.schs[0].$a):return y`
      <span class="s" style="${$e(e)}">k</span>
      `;case(e.parent.t==K&&e.sch.$a==e.parent.schs[1].$a):return y`
      <span class="s" style="${$e(e)}">v</span>
      `;case(e.parent.t==j&&e.sch.$a==e.parent.schs[0].$a):return y`
      <span class="s" style="${$e(e)}">e</span>
      `;case(e.parent.t==j&&e.sch.$a==e.parent.schs[1].$a):return y`
      <span class="s" style="${$e(e)}">r</span>
      `;case e.parent.t==H:return y`
      <span class="s" style="${$e(e)}">└</span>
      `;case e.parent.t==P:return y`
      <span class="k" style="${$e(e,1)}" data-required="${!!((t=e.sch.metadata)==null?void 0:t.required)}" data-is-pattern="${!!((r=e.sch.metadata)==null?void 0:r.isKeyPattern)}">
        ${kr(e)}
      </span>
      <span class="s">:</span>
    `;case e.parent.t==V:return y`
      <span class="s" style="${$e(e,.5)}">|</span>
      <span class="k tag">
        ${kr(e)}
      </span>
      <span class="s">·</span>
    `;default:return y`
      <span class="k" style="${$e(e,1)}">
        ${kr(e)}
      </span >
      <span class="s">:</span>
    `}},kr=e=>e.sch.uiMode=="editKey"?Fi("key-edit",e.ui.parentPath,e.key):y`${e.key}`,Gi=e=>e.ui.level==e.ui.rootLevel+1?Na(e):va(e),Na=e=>e.ui.viewTypeTop?e.ui.viewTypeTop(e):y`<span class="t">${qi(e)}</span>`,va=e=>y`<span class="t">${qi(e)}</span>`,qi=e=>e.sch.uiMode=="editType"?y`<combo-box id="type_search" list="typesearch">
      ${Fi("type-edit",e.ui.parentPath,ka(e.sch,e.ui))}
    </combo-box>`:y`${$a(e.sch,e.ui)}`,ka=(e,t)=>Nr(e,t),$a=(e,t)=>Wt(e,t),gn=e=>e,Ui=e=>{switch(!0){case[P,V].includes(e.t):return"keyed";case[z,Y,j].includes(e.t):return"indexed";default:return"none"}},ha=e=>{switch(!0){case[P,V].includes(e.t):return e.fields.length;case[z,Y,j].includes(e.t):return e.schs.length;case[H].includes(e.t):return 1;default:return 0}},_a=(e,t)=>{let r;switch(!0){case e.t==P:r="record";break;case e.t==H:r="list";break;case e.t==z:r="tuple";break;case e.t==Y:r="union";break;case e.t==V:r="tagged union";break;case e.t==j:r="extensible union";break;default:r="field"}return t.modelTypeText&&(r=t.modelTypeText(e,t)||r),r};var{selectMultiNodeUpTo:Ki,selectMultiNodeDownTo:Bi,selectMultiNodeUp:Wi,selectMultiNodeDown:Hi,selectUpEnd:Yi,selectDownEnd:zi,selectUp:wn,selectDown:bn,selectPrevious:Ea,selectNext:Aa,selectRoot:Ji,selectLast:Xi}=fr,Qi=({store:e,target:t,select:r,focus:n=!0})=>{pr({store:e,target:t,treeKeyDownCmds:[["shift-meta-ArrowUp",Ki],["shift-meta-ArrowDown",Bi],["shift-ArrowUp",Wi],["shift-ArrowDown",Hi],["meta-ArrowUp",Yi],["meta-ArrowDown",zi],["ArrowUp",wn],["ArrowDown",bn],["Home",Ji],["End",Xi],["shift-+",xe],["Enter",bt],["Delete",le],["meta-v",ge],["alt-ArrowUp",we],["alt-ArrowDown",be]],textAreaKeyDownCmd:[["Enter",Ce],["Escape",Lt]],view:i=>vr(t,i||e,{ui:{depthLimit:2,tab:0,modelTypeText:(l,a)=>"modu",typeText:(l,a)=>{if(l.t==T.RECORD)return"record";if(l.t==T.VALUE)return"value";if(l.t==T.TUPLE)return"tuple";if(l.t==T.UNION)return"union"},viewTypeTop:l=>""}}),opts:{focus:n,selectId:r}})},$r=(e={})=>{let{store:t,target:r}=e;pr({store:t,target:r,treeKeyDownCmds:[["shift-meta-ArrowUp",Ki],["shift-meta-ArrowDown",Bi],["shift-ArrowUp",Wi],["shift-ArrowDown",Hi],["meta-ArrowUp",Yi],["meta-ArrowDown",zi],["ArrowUp",wn],["ArrowDown",bn],["k",Ea],["j",Aa],["Home",Ji],["End",Xi],["shift-+",xe],["Enter",bt],["shift-Enter",_t],["Delete",le],["m",Ut],["meta-x",lt],["meta-c",at],["meta-v",ge],["shift-alt-ArrowUp",Me],["shift-alt-ArrowDown",Pe],["alt-ArrowUp",we],["alt-ArrowDown",be],["ArrowRight",Vt],["ArrowLeft",Gt],["Escape",({tree:n})=>He(n)]],textAreaKeyDownCmd:[["Enter",Ce],["Escape",Lt]],view:n=>vr(r,n||t,{ui:{lineClass:"setnu",tab:3,modelTypeText:(i,l)=>i.isEntry?"entrypoint":"type"}}),opts:{focus:e.focus,selectId:e.select}})},Er=({store:e,target:t,select:r,focus:n=!1})=>{pr({store:e,target:t,treeKeyDownCmds:[["ArrowUp",wn],["ArrowDown",bn],["ArrowRight",Vt],["ArrowLeft",Gt]],textAreaKeyDownCmd:[],view:i=>vr(t,i||e,{ui:{lineClass:"setnu",tab:3,modelTypeText:(l,a)=>l.isEntry?"entrypoint":"type"}}),opts:{focus:n,selectId:r}})},Ar=({store:e,target:t,treeTarget:r})=>{let n=document.querySelector(t),i=document.querySelector(`${r} [role='tree']`);!n||!i||(S(e,"renderSchMeta",function(l){Sa({tree:i,store:l||this,metaForm:t})}),e.renderSchMeta())},Sa=({tree:e,store:t,metaForm:r})=>{let n=e.querySelectorAll("[role='treeitem'][aria-selected='true']");if(n.length==1){let i=ne(t,n[0].id);i&&Tn(r,i,t)}},Zi=e=>Mi(e),el=e=>Ri(e);var rl=(e,t)=>{e.errors={},e.changes={},e.metadata||(e.metadata={}),pt(e,"title",t),pt(e,"description",t),tl(e,"rw",["rw","r","w"],t),Oa(e,t);for(let r of Object.keys(e.changes))(e.errors[r]||[]).length==0&&e.changes[r]!=null?e.metadata[r]=e.changes[r]:delete e.metadata[r];return e},Oa=(e,t)=>{let r=Ct(e.t)||{};switch(e.t){case P:Ca(e,t);break;case j:Ma(e,t);break;case H:Pa(e,t);break;case z:ja(e,t);break;case K:La(e,t);break;case Y:Ua(e,t);break;case V:Va(e,t);break;case Ee:Da(e,t);break;case De:_n(e,t);break;case ue:case pe:case he:case fe:case me:case Te:_n(e,t,{min:r.min,max:r.max});break;case Ae:case Se:_n(e,t);break;case Oe:Ia(e,t);break;case Ge:Ra(e,t);break}switch(e._meta.parent.t){case P:Xt(e,"required",t);break}},Da=(e,t)=>{Ga(e,"pattern",t),je(e,"min",t,{min:0}),je(e,"max",t,{min:0}),pt(e,"format",t),Qt(e,t),pt(e,"default",t,Object.assign(nl(e,["min","max","pattern"]),{ignoreEmpty:!0}))},Ia=(e,t)=>{tl(e,"default",["t","f","i"],t)},_n=(e,t,r)=>{Sr(e,"min",t,r),Sr(e,"max",t,r),je(e,"multipleOf",t),pt(e,"format",t),Qt(e,t),Sr(e,"default",t,Object.assign(nl(e,["min","max","multipleOf"]),r))},Ra=(e,t)=>{Fa(e,"default",t)},Ca=(e,t)=>{Xt(e,"strict",t)},Ma=(e,t)=>{Xt(e,"strict",t)},Pa=(e,t)=>{je(e,"min",t,{min:0}),je(e,"max",t,{min:0}),Qt(e,t),Xt(e,"unique",t)},ja=(e,t)=>{je(e,"min",t,{min:1}),je(e,"max",t,{min:1}),Qt(e,t)},La=(e,t)=>{je(e,"min",t,{min:0}),je(e,"max",t,{min:0}),Qt(e,t)},Ua=(e,t)=>{Xt(e,"asUnion",t)},Va=(e,t)=>{pt(e,"tagname",t,{min:1})},nl=(e,t=[])=>{let r={};for(let n of t)(e.errors[n]||[]).length==0&&(typeof e.changes[n]=="number"?(e.changes[n]||e.changes[n]==0)&&(r[n]=e.changes[n]):r[n]=e.changes[n]);return r},pt=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;if(n.ignoreEmpty&&r[t]=="")return;let i=r[t],l=2**18,a=s=>new Blob([s]).size,o=s=>n[s]!=null;a(i)>l?X(e,t,`string size limit is ${Math.ceil(l/1024)} KB`):o("max")&&i.length>n.max?X(e,t,`must be less than or equal ${n.max} length`):o("min")&&i.length<n.min?X(e,t,`must be grater than or equal ${n.min} length`):o("pattern")&&n.pattern!=""?new RegExp(n.pattern).test(i)||X(e,t,`must matche pattern ${n.pattern}`):e.changes[t]=i},Xt=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;let n=!!r[t];e.changes[t]=n},Sr=(e,t,r,n={})=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;let i=Nn(r[t]),l=a=>n[a]!=null;!i&&i!=0?X(e,t,"must be number"):l("min")&&i<n.min?X(e,t,`must be greater than or equal ${n.min}`):l("max")&&i>n.max?X(e,t,`must be less than than or equal ${n.max}`):l("multipleOf")&&i%n.multipleOf!=0?X(e,t,`must be multiple of ${n.multipleOf}`):e.changes[t]=i},je=(e,t,r,n)=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;Sr(e,t,r,n);let i=e.changes[t];(e.errors[t]||[]).length==0&&!Number.isInteger(e.changes[t])&&X(e,t,"must be integer number")},Ga=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;if(pt(e,t,r),(e.errors[t]||[]).length==0)try{let n=r[t];if(n=="")return;new RegExp(n),e.changes[t]=n}catch(n){X(e,t,"invalid regex")}},Qt=(e,t)=>{if(t.min&&t.max){let r=Nn(t.min),n=Nn(t.max);(r||r==0)&&(n||n==0)&&r>n&&(X(e,"min","min is greater than max"),X(e,"max","max is less than min"))}},Fa=(e,t,r)=>{if(!r.hasOwnProperty(t))return e.changes[t]=void 0;r[t]!=null?X(e,t,"must be null"):e.changes[t]=r[t]},tl=(e,t,r,n)=>{if(!n.hasOwnProperty(t))return e.changes[t]=void 0;r.includes(n[t])?e.changes[t]=n[t]:X(e,t,"value must be r, w, or rw")},X=(e,t,r)=>{e.errors[t]=[],e.errors[t].push(r)},Nn=e=>qa(e,"number");var qa=(e,t)=>{try{return e=JSON.parse(e),t==typeof e?e:void 0}catch(r){return}};var{selectMultiNodeUpTo:il,selectMultiNodeDownTo:ll,selectMultiNodeUp:al,selectMultiNodeDown:ol,selectUpEnd:Ka,selectDownEnd:Ba,selectUp:Wa,selectDown:Ha,selectPrevious:kc,selectNext:$c,selectRoot:sl,selectLast:Ya}=fr,cl=(e,t,r,n)=>{let i=t.closest("[data-tag='file']"),l=i==null?void 0:i.key;t.closest("[id='project']")?za(e,l,r,n):t.closest("[id='fmodel']")&&Ja(e,l,t,r,n)},za=(e,t,r,n)=>{switch(r){case bt:case we:case be:case il:case ll:case al:case ol:case sl:break;case xe:case le:case Me:case Pe:case Ce:case jt:case Ka:case Ba:case Wa:case Ha:case Ya:vn({projectStore:e,filename:t});break;case ge:e.render();break}},Ja=(e,t,r,n,i)=>{switch(n){case sl:case il:case ll:case al:case ol:case we:case be:case Vt:case Gt:case Lt:case bt:case _t:case lt:case at:return}let l=Bt(e,t);switch(r.dataset.tag){case de:switch(n){case xe:case le:case ge:l._models=ze(e),e.render();break}break;case Z:switch(n){case Ut:dl(r,e,t),l.render();break;case le:l._models=ze(e),e.render();break;case Me:case Pe:dl(r,e,t),l._models=ze(e),l.render(),e.render();break;case Ce:l._models=ze(e),l.render()}break}l.renderSchMeta()},vn=e=>{let{projectStore:t,filename:r,fmodelname:n=null,focus:i=!1}=e,l=Bt(t,r);if(l){if(S(t,"_currentFileStore",l),l._models=ze(t),$r({store:l,target:"[id='fmodel']",select:n,focus:i}),Ar({store:l,target:"[id='fsch']",treeTarget:"[id='fmodel']"}),!window._treeClipboard){let a=document.querySelector("[id='fmodel'] [role='tree']");a._aria.clearClipboard(a)}}else if(t.fields.length==0){let a=document.querySelector("[id='fmodel'] [role='tree']");Zi("[id='fmodel']"),el("[id='fsch']")}},dl=(e,t,r)=>{e.dataset.tag==Z&&un(t,(n,i)=>(i.path!=`[${r}]${e.id}`&&n.isEntry&&delete n.isEntry,n))},ul={update:({store:e,detail:t})=>{let{path:r,attrs:n}=t,i=Re(e,r,(l,a)=>rl(l,n));return i&&(e.render&&e.render(e),e.renderSchMeta&&e.renderSchMeta(e)),i}},fl=e=>[xe,le,Ce,ge,Me,Pe,we,be,le,Ut].map(t=>t.name).includes(e);var{assign:rt}=Object,pl=(e,t)=>{var p,d,h,E,L,F;let r={},n=b=>{if(r[b])return r[b];for(let g of e.fields)for(let _ of g.fields)if(r[_.key]={file:g,fmodelOf:_},_.key==b)return r[b]},i={},l=b=>i[b]?i[b]:Be(e,(g,_)=>{if(e.taggedLevel[_.level]==Z&&_.path!="")return b.startsWith(_.path)?(i[b]=g,!0):!1},(g,_)=>(S(g,"_meta",_),g)),a=({$a:b,key:g,index:_,t:w})=>({$a:b,key:g,index:_,t:w}),o=b=>a(b),s=e._diffToRemote;if(!s)return;let c={};c.files=[],c.fmodels=[],c.subfmodels=[];for(let b of s){let g=e.taggedLevel[b._diff.meta.level];g==$t?c.project=b:g==de?c.files.push(b):g==Z?c.fmodels.push(b):c.subfmodels.push(b)}let m={},u={},x={},f={};u.files||(u.files={}),u.fmodels||(u.fmodels={}),x.files||(x.files={}),x.fmodels||(x.fmodels={}),m.files||(m.files={}),m.fmodels||(m.fmodels={}),f.files||(f.files={}),f.fmodels||(f.fmodels={}),c.project&&(m.project=o(c.project));for(let b=0;b<c.files.length;b++){let g=c.files[b],_=a(g),w=g._diff.meta.path;if(g._diff[Je]){u.files[w]=_;for(let v of g.fields)u.fmodels[`[${g.key}][${v.key}]`]=rt(v,{pa:_.$a})}else g._diff[Xe]?x.files[w]={$a:_.$a}:g._diff[Qe]?Ie(e.fields,(v,$)=>{f.files[`[${v.key}]`]=a(Object.assign(v,{index:$}))}):g._diff[ve]?console.log("project does not permit as parent for moving items"):(g._diff[Ze]&&(m.files[w]=_),g._diff[ke]&&console.log("file type is always record, cannot be changed"))}for(let b=0;b<c.fmodels.length;b++){let g=c.fmodels[b],_=g._diff.meta.path,w=g._diff.meta.pa;if(g._diff[Je])u.fmodels[_]=rt(g,{pa:w});else if(g._diff[Xe])x.fmodels[_]={$a:g.$a,pa:w};else if(g._diff[Qe]){let v=g._diff.meta.lpath[1];f.fmodels[`[${v.key}][${g.key}]`]||Ie(v.fields,($,A)=>{f.fmodels[`[${v.key}][${$.key}]`]={$a:$.$a,t:$.t,key:$.key,index:A,pa:v.$a}})}else if(g._diff[ve]){let{oldParent:v,newParent:$,oldPath:A,newPath:C}=g._diff[ve],N,I,O,k,Q;switch(e.taggedLevel[v.level]){case $t:console.log("fmodel was not possible to be a file");break;case de:k=v,x.fmodels[A]={$a:g.$a,pa:k.$a};break;case Z:default:k=v.lpath[1],Q=v.lpath[2]||v,O=`[${k.key}][${Q.key}]`,I=((p=e._indices)==null?void 0:p[Q.$a])||l(O),m.fmodels[O]=rt(I,{pa:k.$a})}switch(e.taggedLevel[$.level]){case de:N=$,I=g,u.fmodels[C]=rt(I,{pa:N.$a});break;default:console.log("fmodel parent can only be file tag")}}u.fmodels[_]||x.fmodels[_]||(g._diff[Ze]||g._diff[ke]||g._diff[At])&&(m.fmodels[_]=rt(g,{pa:w}))}for(let b=0;b<c.subfmodels.length;b++){let g,_,w,v,$,A=c.subfmodels[b];if(A._diff[Je]||A._diff[Xe]||A._diff[Qe]||A._diff[Ze]||A._diff[ke])v=A._diff.meta.lpath[1],$=A._diff.meta.lpath[2],w=`[${v.key}][${$.key}]`,!u.fmodels[w]&&!x.fmodels[w]&&(_=((d=e._indices)==null?void 0:d[$.$a])||l(w),(h=m.fmodels)[w]||(h[w]=rt(_,{pa:v.$a})));else if(A._diff[ve]){let{oldParent:C,newParent:N,oldPath:I,newPath:O}=A._diff[ve];switch(e.taggedLevel[C.level]){case $t:console.log("subfmodel was not possible to be a file");break;case de:v=C,x.fmodels[I]={$a:A.$a,pa:v.$a};break;case Z:default:v=C.lpath[1],$=C.lpath[2]||C,w=`[${v.key}][${$.key}]`,_=((E=e._indices)==null?void 0:E[$.$a])||l(w),(L=m.fmodels)[w]||(L[w]=rt(_,{pa:v.$a}))}switch(e.taggedLevel[N.level]){case $t:console.log("subfmodel parent can only be fmodel or subfmodel");break;case de:console.log("subfmodel parent can only be fmodel or subfmodel");break;case Z:default:g=N.lpath[1],_=N.lpath[2]||ir(g.fields,k=>N.key==k.key),w=`[${g.key}][${_.key}]`,(F=m.fmodels)[w]||(F[w]=rt(_,{pa:g.$a}))}}}return t({changed:m,added:u,removed:x,reorder:f})};var Xa={createProjectStore:_i,getFileStore:Bt,anchorsModels:ze,projectToStore:yi,fileToStore:Et,controller:cl,mergeSchMetas:xi,mergeReferrers:gi,changeFile:vn,taggedDiff:pl,isDiffableCmd:fl,SchMeta:ul,allSchs:dn,rulesTable:cn},Qa={rFmodelTree:Er};export{_r as Diff,$r as FmodelTree,Xa as Project,Qi as ProjectTree,Ar as SchMetaForm,Qa as View,rr as legitTs,Er as rFmodelTree,Ke as tstr};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
